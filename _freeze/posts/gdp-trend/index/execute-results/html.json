{
  "hash": "a5816fe10b712bacccd1a5db97335ad8",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Interactive GDP Trend Dashboard with AI SQL\"\ndate: \"2025-11-18\"\ncategories: [Data Visualization, Streamlit, Economic Analysis, AI]\nimage: \"images/0.png\"\n\nformat:\n  html:\n    code-fold: true\n    code-tools: true\n    \nexecute:\n  eval: false\n  warning: false\n---\n\n# Project Overview\n\nLive Demo: [https://world-GDP-trend.streamlit.app](https://world-GDP-trend.streamlit.app)\n\nGithub: [https://github.com/JCwinning/GDP_trend](https://github.com/JCwinning/GDP_trend)\n\n![GDP Dashboard - Main Interface](images/0.png){width=\"100%\"}\n\nThe GDP Trend Dashboard is a sophisticated web application that visualizes and analyzes economic data from the World Bank API. What makes this system unique is its dual approach: traditional interactive visualizations combined with AI-powered natural language querying, making economic data accessible to both technical analysts and general users.\n\n## Core Architecture\n\n### Technology Stack\n\n- **Primary Framework**: Streamlit for interactive web applications\n- **Data Processing**: Pandas for manipulation and analysis\n- **Visualization**: Plotly Express for interactive charts\n- **Database**: DuckDB for efficient SQL queries\n- **AI Integration**: ModelScope GLM-4.6 for natural language to SQL conversion\n- **Data Sources**: World Bank API via `wbgapi` library\n\n### Key Features\n\n1. **Multi-country GDP trend comparisons**\n2. **Support for multiple economic indicators** (GDP, GDP per capita, population, YoY growth)\n3. **AI-powered natural language querying**\n4. **Direct SQL interface with DuckDB**\n5. **Complete bilingual support** (English/Chinese)\n6. **Time-range filtering** with interactive controls (2000-present)\n\n## Data Pipeline Architecture\n\nThe application implements a sophisticated data pipeline that ensures data quality and real-time availability:\n\n\n\n\n\n```{mermaid}\n%%| eval: true\n%%| fig-cap: \"GDP Application Architecture\"\n\nflowchart TD\n    A[World Bank API] --> B[Data Collection<br/>download_data.py]\n    B --> C[Data Processing<br/>Country Mapping, Indicator Calculation]\n    C --> D[Data Storage<br/>CSV Files]\n\n    D --> E[Streamlit App<br/>app.py]\n    E --> F[DuckDB<br/>In-Memory SQL]\n\n    F --> G[Visualization Engine<br/>Plotly Express]\n    F --> H[AI Query Engine<br/>ModelScope API]\n    F --> I[Session Management<br/>User State]\n\n    G --> J[Interactive Charts]\n    H --> K[Natural Language<br/>to SQL]\n    I --> L[Persistent<br/>Query Results]\n\n    J --> M[User Interface]\n    K --> M\n    L --> M\n```\n\n## Data Collection and Processing\n\n### World Bank API Integration\n\nThe application uses the World Bank API to collect comprehensive economic data:\n\n::: {#5fda7fea .cell execution_count=1}\n``` {.python .cell-code}\nimport wbgapi as wb\nimport pycountry\nimport pandas as pd\n\ndef download_economic_data():\n    \"\"\"Download GDP data from World Bank API for all countries\"\"\"\n\n    # Define economic indicators to download\n    indicators = {\n        'gdp_current_usd': 'NY.GDP.MKTP.CD',\n        'gdp_per_capita_current_usd': 'NY.GDP.PCAP.CD',\n        'population_total': 'SP.POP.TOTL'\n    }\n\n    # Download data from 2000 to present\n    data_frames = []\n    for indicator_name, indicator_code in indicators.items():\n        df = wb.get_series(\n            series=indicator_code,\n            economy='all',\n            time='2000:2024',\n            simplify_index=True\n        )\n\n        # Process and add to collection\n        df = df.reset_index()\n        df['indicator'] = indicator_name\n        data_frames.append(df)\n\n    # Combine all indicators\n    combined_df = pd.concat(data_frames, ignore_index=True)\n    return combined_df\n\ndef create_country_reference_table():\n    \"\"\"Create comprehensive country metadata with ISO codes\"\"\"\n    countries = list(pycountry.countries)\n\n    df_all = pd.DataFrame([{\n        'country_name': country.name,\n        'country_code_2': country.alpha_2,\n        'country_code_3': country.alpha_3\n    } for country in countries])\n\n    # Add continent mapping\n    iso_to_continent = {\n        \"US\": \"North America\", \"CN\": \"Asia\", \"JP\": \"Asia\",\n        \"DE\": \"Europe\", \"GB\": \"Europe\", \"FR\": \"Europe\"\n        # ... complete mapping for all countries\n    }\n\n    df_all['continent'] = df_all['country_code_2'].map(iso_to_continent)\n    return df_all\n```\n:::\n\n\n### Data Schema and Structure\n\nThe application uses a clean, normalized data structure:\n\n::: {#160808ab .cell execution_count=2}\n``` {.python .cell-code}\n-- Main data schema\nCREATE TABLE df_gdp (\n    country_name TEXT,        -- Display name (English)\n    country_code_2 TEXT,      -- ISO alpha-2 code\n    country_code_3 TEXT,      -- ISO alpha-3 code\n    continent TEXT,            -- Continent classification\n    year INTEGER,              -- Data year\n    indicator TEXT,            -- Economic indicator name\n    value REAL                -- Indicator value\n);\n\n-- Example data\nINSERT INTO df_gdp VALUES\n('United States', 'US', 'USA', 'North America', 2023, 'gdp_current_usd', 27444144.3),\n('United States', 'US', 'USA', 'North America', 2023, 'gdp_per_capita_current_usd', 81254.2),\n('United States', 'US', 'USA', 'North America', 2023, 'population_total', 334914895.0);\n```\n:::\n\n\n## Interactive Visualization System\n\n### Plotly Express Implementation\n\nThe application uses Plotly Express for creating interactive charts with consistent color coding:\n\n::: {#bfa2f55c .cell execution_count=3}\n``` {.python .cell-code}\nimport plotly.express as px\n\n@st.cache_data\ndef load_data():\n    \"\"\"Load and cache GDP data\"\"\"\n    return pd.read_csv('data/gdp_data_2000_present.csv')\n\ndef create_gdp_trend_chart(selected_countries, selected_indicator, year_range):\n    \"\"\"Create interactive GDP trend visualization\"\"\"\n\n    # Load filtered data\n    df = load_data()\n\n    # Apply filters\n    filtered_df = df[\n        (df['country_name'].isin(selected_countries)) &\n        (df['indicator'] == selected_indicator) &\n        (df['year'].between(year_range[0], year_range[1]))\n    ]\n\n    # Create interactive line chart\n    fig = px.line(\n        filtered_df,\n        x='year',\n        y='value',\n        color='country_name',\n        title=f'{selected_indicator.replace(\"_\", \" \").title()} Trend',\n        labels={\n            'year': 'Year',\n            'value': format_indicator_label(selected_indicator),\n            'country_name': 'Country'\n        }\n    )\n\n    # Customize chart appearance\n    fig.update_layout(\n        xaxis_title=\"Year\",\n        yaxis_title=format_indicator_label(selected_indicator),\n        hovermode='x unified',\n        showlegend=True,\n        legend=dict(\n            orientation=\"h\",\n            yanchor=\"bottom\",\n            y=1.02,\n            xanchor=\"right\",\n            x=1\n        )\n    )\n\n    return fig\n\ndef format_indicator_label(indicator):\n    \"\"\"Format indicator names for display\"\"\"\n    labels = {\n        'gdp_current_usd': 'GDP (Current USD)',\n        'gdp_per_capita_current_usd': 'GDP Per Capita (Current USD)',\n        'population_total': 'Total Population',\n        'gdp_per_capita_current_usd_yoy': 'GDP Per Capita YoY Growth (%)'\n    }\n    return labels.get(indicator, indicator.replace('_', ' ').title())\n```\n:::\n\n\n## AI-Powered Analytics\n\n### Natural Language to SQL Conversion\n\nThe application's most innovative feature is AI-powered natural language querying:\n\n::: {#a8fea733 .cell execution_count=4}\n``` {.python .cell-code}\nfrom openai import OpenAI\nimport duckdb\n\ndef generate_sql_from_question(question, language):\n    \"\"\"Convert natural language question to SQL using ModelScope API\"\"\"\n\n    # Get database schema for context\n    schema_info = \"\"\"\n    Table: df_gdp\n    Columns:\n    - country_name (TEXT): Country display name\n    - country_code_2 (TEXT): ISO alpha-2 country code\n    - continent (TEXT): Continent classification\n    - year (INTEGER): Data year (2000-2024)\n    - indicator (TEXT): Economic indicator name\n    - value (REAL): Indicator value\n\n    Available indicators:\n    - gdp_current_usd: GDP in current USD\n    - gdp_per_capita_current_usd: GDP per capita in current USD\n    - population_total: Total population\n    - gdp_per_capita_current_usd_yoy: Year-over-year GDP per capita growth (%)\n    \"\"\"\n\n    # Create language-specific prompt\n    if language == \"zh\":\n        prompt = f\"\"\"ËØ∑Â∞Ü‰ª•‰∏ãËá™ÁÑ∂ËØ≠Ë®ÄÈóÆÈ¢òËΩ¨Êç¢‰∏∫SQLÊü•ËØ¢Ôºå‰ªÖËøîÂõûSQLËØ≠Âè•Ôºå‰∏çË¶ÅËß£Èáä„ÄÇ\n\nÊï∞ÊçÆÂ∫ì‰ø°ÊÅØÔºö\n{schema_info}\n\nÁî®Êà∑ÈóÆÈ¢òÔºö{question}\n\nË¶ÅÊ±ÇÔºö\n1. Âè™ËøîÂõûÊ†áÂáÜÁöÑSELECTËØ≠Âè•\n2. ‰∏çË¶ÅÊ∑ªÂä†‰ªª‰ΩïËß£ÈáäÊàñÊ≥®Èáä\n3. ‰ΩøÁî®LIMIT 50ÈôêÂà∂ÁªìÊûúÊï∞Èáè\"\"\"\n    else:\n        prompt = f\"\"\"Convert the following natural language question to SQL query. Return only the SQL statement, no explanation.\n\nDatabase information:\n{schema_info}\n\nUser question: {question}\n\nRequirements:\n1. Return only standard SELECT statement\n2. Do not add any explanation or comments\n3. Use LIMIT 50 to restrict results\"\"\"\n\n    # Call ModelScope API\n    client = OpenAI(\n        api_key=os.getenv('MODELSCOPE_API_KEY'),\n        base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\"\n    )\n\n    response = client.chat.completions.create(\n        model=\"qwen/Qwen3-235B\",\n        messages=[{\"role\": \"user\", \"content\": prompt}],\n        temperature=0.1,  # Low temperature for consistent SQL\n        max_tokens=500\n    )\n\n    return response.choices[0].message.content.strip()\n```\n:::\n\n\n### Query Execution and AI Summarization\n\n::: {#98ea42a7 .cell execution_count=5}\n``` {.python .cell-code}\ndef execute_query_with_ai_summary(sql_query, original_question):\n    \"\"\"Execute SQL query and generate AI summary\"\"\"\n\n    try:\n        # Execute query with DuckDB\n        conn = duckdb.connect()\n        result_df = conn.execute(sql_query).fetchdf()\n\n        # Store results in session state\n        st.session_state.sql_result = result_df\n        st.session_state.sql_query = sql_query\n\n        # Generate AI summary if data is available\n        if not result_df.empty:\n            generate_ai_summary(result_df, original_question)\n\n        return result_df\n\n    except Exception as e:\n        st.error(f\"Query execution error: {str(e)}\")\n        return None\n\ndef generate_ai_summary(data_frame, question):\n    \"\"\"Generate AI summary of query results\"\"\"\n\n    # Convert DataFrame to text for analysis\n    data_summary = data_frame.to_string(index=False)\n\n    summary_prompt = f\"\"\"Based on the following data analysis results, provide a concise summary:\n\nOriginal Question: {question}\n\nQuery Results:\n{data_summary}\n\nPlease provide:\n1. A brief analysis of the key findings\n2. Any notable trends or patterns\n3. Important insights from the data\n\nKeep the summary under 200 words and make it easy to understand.\"\"\"\n\n    # Generate summary using AI\n    client = OpenAI(\n        api_key=os.getenv('MODELSCOPE_API_KEY'),\n        base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\"\n    )\n\n    response = client.chat.completions.create(\n        model=\"qwen/Qwen3-235B\",\n        messages=[{\"role\": \"user\", \"content\": summary_prompt}],\n        temperature=0.3,\n        max_tokens=300\n    )\n\n    st.session_state.ai_summary = response.choices[0].message.content\n```\n:::\n\n\n![AI Query Interface - Natural Language Processing](images/1.png){width=\"100%\"}\n\n## Bilingual Support System\n\n### Internationalization Architecture\n\nThe application implements comprehensive English/Chinese support:\n\n::: {#72002585 .cell execution_count=6}\n``` {.python .cell-code}\n# language.py - Complete translation system\ntranslations = {\n    \"en\": {\n        \"title\": \"üåç GDP Trend Dashboard\",\n        \"gdp_trend\": \"GDP Trend\",\n        \"ai_powered_chat\": \"AI-Powered Data Chat\",\n        \"default_question\": \"What is the average GDP per capita for China, Japan, and Korea during 2020 to 2023?\"\n    },\n    \"zh\": {\n        \"title\": \"üåç GDPË∂ãÂäø‰ª™Ë°®Êùø\",\n        \"gdp_trend\": \"GDPË∂ãÂäø\",\n        \"ai_powered_chat\": \"AIÊï∞ÊçÆÂØπËØù\",\n        \"default_question\": \"2020Âπ¥Ëá≥2023Âπ¥ÊúüÈó¥Ôºå‰∏≠ÂõΩ„ÄÅÊó•Êú¨ÂíåÈü©ÂõΩÁöÑÂπ≥Âùá‰∫∫ÂùáGDPÊòØÂ§öÂ∞ëÔºü\"\n    }\n}\n\ndef get_text(key):\n    \"\"\"Get translated text for current language\"\"\"\n    language = st.session_state.get(\"language\", \"en\")\n    return translations.get(language, {}).get(key, key)\n\n# Language switching in UI\ncol1, col2 = st.columns([1, 1])\nwith col1:\n    if st.button(\"English\"):\n        st.session_state.language = \"en\"\n        st.rerun()\nwith col2:\n    if st.button(\"‰∏≠Êñá\"):\n        st.session_state.language = \"zh\"\n        st.rerun()\n```\n:::\n\n\n## User Interface Design\n\n### Main Application Structure\n\n::: {#049af224 .cell execution_count=7}\n``` {.python .cell-code}\ndef main():\n    \"\"\"Main application with tab-based navigation\"\"\"\n\n    # Language toggle in top-right corner\n    with st.container():\n        st.markdown(\"\"\"\n        <div class=\"language-toggle\">\n            <button onclick=\"setLanguage('en')\">EN</button>\n            <button onclick=\"setLanguage('zh')\">‰∏≠Êñá</button>\n        </div>\n        \"\"\", unsafe_allow_html=True)\n\n    st.title(get_text(\"title\"))\n\n    # Tab-based interface\n    tab1, tab2 = st.tabs([get_text(\"gdp_trend\"), get_text(\"query\")])\n\n    with tab1:\n        render_gdp_trends_tab()\n\n    with tab2:\n        render_query_interface_tab()\n\ndef render_gdp_trends_tab():\n    \"\"\"Render GDP trends visualization tab\"\"\"\n\n    st.header(get_text(\"gdp_trend\"))\n\n    # Load data\n    df = load_data()\n\n    # Filter controls\n    col1, col2, col3 = st.columns([2, 1, 1])\n\n    with col1:\n        selected_countries = st.multiselect(\n            get_text(\"select_countries\"),\n            options=df['country_name'].unique(),\n            default=['United States', 'China', 'Japan']\n        )\n\n    with col2:\n        selected_indicator = st.selectbox(\n            get_text(\"select_indicator\"),\n            options=[\n                'gdp_current_usd',\n                'gdp_per_capita_current_usd',\n                'population_total',\n                'gdp_per_capita_current_usd_yoy'\n            ],\n            format_func=lambda x: format_indicator_label(x)\n        )\n\n    with col3:\n        year_range = st.slider(\n            get_text(\"select_year_range\"),\n            min_value=2000,\n            max_value=2024,\n            value=(2010, 2024),\n            step=1\n        )\n\n    # Generate and display chart\n    if selected_countries and selected_indicator:\n        fig = create_gdp_trend_chart(selected_countries, selected_indicator, year_range)\n        st.plotly_chart(fig, use_container_width=True)\n\n        # Display raw data option\n        if st.checkbox(get_text(\"show_raw_data\")):\n            display_filtered_data_table(selected_countries, selected_indicator, year_range)\n\ndef render_query_interface_tab():\n    \"\"\"Render AI-powered query interface\"\"\"\n\n    st.header(get_text(\"ai_powered_chat\"))\n    st.markdown(get_text(\"ai_chat_description\"))\n\n    # Natural language input\n    user_question = st.text_input(\n        get_text(\"your_question\"),\n        value=st.session_state.get(\"user_question\", get_text(\"default_question\"))\n    )\n\n    col1, col2 = st.columns([1, 1])\n\n    with col1:\n        if st.button(get_text(\"run_ai\"), type=\"primary\"):\n            if user_question:\n                with st.spinner(\"Processing with AI...\"):\n                    # Generate SQL from natural language\n                    sql_query = generate_sql_from_question(\n                        user_question,\n                        st.session_state.language\n                    )\n\n                    if sql_query:\n                        # Execute query and generate summary\n                        result_df = execute_query_with_ai_summary(sql_query, user_question)\n\n                        st.session_state.user_question = user_question\n                        st.session_state.should_generate_ai_summary = True\n\n    # Display results\n    if st.session_state.get(\"sql_result\") is not None:\n        display_query_results()\n```\n:::\n\n\n## Performance Optimization\n\n### Data Caching and Efficiency\n\n::: {#3c40214d .cell execution_count=8}\n``` {.python .cell-code}\n# Streamlit caching for data operations\n@st.cache_data(ttl=3600)  # Cache for 1 hour\ndef load_data():\n    \"\"\"Load and cache GDP data\"\"\"\n    return pd.read_csv('data/gdp_data_2000_present.csv')\n\n@st.cache_data(ttl=1800)  # Cache for 30 minutes\ndef get_country_list():\n    \"\"\"Get and cache unique country list\"\"\"\n    df = load_data()\n    return sorted(df['country_name'].unique())\n\n# Session state management for AI interactions\ndef init_session_state():\n    \"\"\"Initialize all session state variables\"\"\"\n    if \"sql_result\" not in st.session_state:\n        st.session_state.sql_result = None\n    if \"ai_summary\" not in st.session_state:\n        st.session_state.ai_summary = None\n    if \"should_generate_ai_summary\" not in st.session_state:\n        st.session_state.should_generate_ai_summary = False\n```\n:::\n\n\n### Error Handling and User Experience\n\n::: {#53b6a203 .cell execution_count=9}\n``` {.python .cell-code}\ndef safe_api_call(func, *args, **kwargs):\n    \"\"\"Safe API call with error handling\"\"\"\n    try:\n        return func(*args, **kwargs)\n    except Exception as e:\n        st.error(f\"API Error: {str(e)}\")\n        return None\n\ndef validate_sql_query(sql_query):\n    \"\"\"Basic SQL query validation\"\"\"\n    sql_lower = sql_query.lower().strip()\n\n    # Basic security checks\n    dangerous_keywords = ['drop', 'delete', 'update', 'insert', 'alter']\n    for keyword in dangerous_keywords:\n        if keyword in sql_lower:\n            raise ValueError(f\"Dangerous SQL keyword detected: {keyword}\")\n\n    # Ensure query starts with SELECT\n    if not sql_lower.startswith('select'):\n        raise ValueError(\"Only SELECT queries are allowed\")\n\n    return True\n```\n:::\n\n\n## Deployment and Accessibility\n\n### Environment Setup\n\n```bash\n# Environment configuration\n# .env file\nMODELSCOPE_API_KEY=your_modelscope_key\n\n# Installation\npip install -r requirements.txt\n\n# Data collection\npython download_data.py\n\n# Run application\nstreamlit run app.py\n```\n\n### Requirements and Dependencies\n\n```txt\nstreamlit>=1.28.0\npandas>=1.5.0\nplotly>=5.15.0\nduckdb>=0.8.0\nopenai>=1.0.0\npython-dotenv>=1.0.0\nwbgapi>=1.0.0\npycountry>=22.0.0\nnumpy>=1.24.0\n```\n\n## Technical Achievements\n\n### Key Innovations\n\n1. **Dual Interface Approach**: Both visual and natural language access to data\n2. **AI-Powered SQL Generation**: Complex economic queries in plain English/Chinese\n3. **Real-time Data Processing**: Efficient caching and session management\n4. **Comprehensive Internationalization**: True bilingual support with localized data\n5. **Production-Ready Deployment**: Robust error handling and performance optimization\n\n\n![AI Summary Generation](images/2.png){width=\"100%\"}\n\n## Economic Analysis Examples\n\n### Supported Query Types\n\n1. **Comparative Analysis**\n   - \"Compare GDP growth between China and Japan from 2010 to 2020\"\n   - \"Which countries had the highest GDP per capita in 2023?\"\n\n2. **Time-Series Analysis**\n   - \"Show GDP trends for BRIC countries over the last decade\"\n   - \"What was the population growth rate for India from 2000 to 2020?\"\n\n3. **Statistical Queries**\n   - \"Calculate average GDP growth rate for European countries\"\n   - \"Find countries with GDP per capita above $50,000 in 2022\"\n\n4. **Complex Multi-Variable Analysis**\n   - \"What is the correlation between population and GDP for Asian countries?\"\n   - \"List countries with GDP per capita growth above 5% for 3 consecutive years\"\n\n\n## Conclusion\n\nThis GDP Trend Dashboard represents an innovative approach to economic data analysis, combining traditional visualization techniques with cutting-edge AI capabilities. The project demonstrates:\n\n- **Advanced Data Integration**: World Bank API with comprehensive economic indicators\n- **Natural Language Processing**: AI-powered SQL generation for accessible data querying\n- **Professional Visualization**: Interactive Plotly charts with consistent design\n- **Bilingual Support**: Complete English/Chinese localization\n- **Production-Grade Architecture**: Robust error handling, caching, and deployment\n\nWhether you're an economist, data scientist, or policy analyst, this application showcases how modern AI technologies can make complex economic data more accessible and actionable through intuitive interfaces and intelligent automation.\n\n---\n\n**Technology Stack**: Streamlit, DuckDB, Plotly, ModelScope API, World Bank API\n\n**Data Source**: World Bank (2000-2024, 200+ countries, 15K+ data points)\n\n",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}