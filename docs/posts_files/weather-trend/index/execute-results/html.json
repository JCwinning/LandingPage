{
  "hash": "8e51443084ab31ef85fa345ad426dda2",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Weather Forecast App with Streamlit and AI Integration\"\nauthor: \"Tony D\"\ndate: \"2025-11-06\"\ncategories: [Python, Streamlit, AI, tutorial]\nimage: \"images/0.png\"\n\nformat:\n  html:\n    code-fold: true\n    code-tools: true\n    code-copy: true\n\nexecute:\n  eval: false\n  warning: false\n---\n\n\n# Project Overview\n\nIn this comprehensive tutorial, I'll guide you through creating a sophisticated weather forecast application that combines modern web development with artificial intelligence. This project demonstrates how to build a production-ready weather app with interactive maps, bilingual support, real-time data visualization, and AI-powered weather insights.\n\n\nLive Demo: [https://weather-trend.streamlit.app/](https://weather-trend.streamlit.app/)\n\nGithub: [https://github.com/JCwinning/weather_trend](https://github.com/JCwinning/weather_trend)\n\n\n![Weather Forecast App Main Interface](images/0.png){width=\"100%\"}\n\n\n\nThis weather forecast application goes beyond basic weather data by integrating multiple advanced features:\n\n- **Interactive Location Selection**: Click anywhere on the map or search by city name\n- **Bilingual Interface**: Full English/Chinese language support with toggle functionality\n- **AI-Powered Insights**: Weather analysis and recommendations using DeepSeek AI\n- **Advanced Visualization**: Temperature trends, air quality monitoring, and rain probability\n- **Real-time Data**: 7-day historical and 5-day forecast data\n- **Responsive Design**: Works seamlessly across desktop, tablet, and mobile devices\n\n## Technical Architecture\n\n```{mermaid}\n%%| fig-cap: \"Weather App Architecture\"\n%%| eval: true\nflowchart TD\n    A[User Interface<br/>Streamlit Web App] --> B[Location Services]\n    A --> C[Weather Data API]\n    A --> D[AI Integration Layer]\n    A --> E[Visualization Engine]\n\n    B --> F[Interactive Map<br/>Folium + OpenStreetMap]\n    B --> G[City Search<br/>Nominatim Geocoding]\n\n    C --> H[Open-Meteo API<br/>Weather + Air Quality]\n    C --> I[Data Processing<br/>Pandas DataFrame]\n\n    D --> J[ModelScope API<br/>DeepSeek-V3.2 AI]\n    D --> K[Intelligent Analysis<br/>Weather Recommendations]\n\n    E --> L[Altair Charts<br/>Temperature Trends]\n    E --> M[Data Tables<br/>Weather Details]\n\n    F --> A\n    G --> A\n    I --> E\n    K --> A\n```\n\n### Technology Stack\n\n- **Frontend Framework**: Streamlit for rapid web application development\n- **Mapping**: Folium with OpenStreetMap tiles for interactive location selection\n- **Data Visualization**: Altair for professional charts and graphs\n- **API Integration**: Open-Meteo for weather and air quality data\n- **AI Services**: ModelScope API with DeepSeek-V3.2 for intelligent analysis\n- **Geocoding**: Nominatim for address-to-coordinate conversion\n- **Internationalization**: Custom language system for English/Chinese support\n\n## Getting Started\n\n### Prerequisites and Installation\n\nBefore we dive into the code, let's set up our development environment:\n\n```bash\n# 1. Clone the repository\ngit clone <your-repo-url>\ncd weather_trend\n\n# 2. Install required packages\npip install streamlit pandas requests altair folium streamlit-folium geopy python-dotenv openai\n\n# 3. Set up environment variables for AI features\necho \"modelscope=your_api_key_here\" > .env\n```\n\n### Required Dependencies Explained\n\n- **streamlit**: Web application framework with reactive UI components\n- **pandas**: Data manipulation and analysis for weather datasets\n- **requests**: HTTP client for API communication\n- **altair**: Declarative statistical visualization library\n- **folium + streamlit-folium**: Interactive map integration\n- **geopy**: Geocoding services for location lookup\n- **python-dotenv**: Environment variable management\n- **openai**: AI model integration (compatible with ModelScope)\n\n## Core Features Implementation\n\n### 1. Interactive Map with Location Selection\n\nThe map functionality allows users to click anywhere and get weather data for that exact location:\n\n::: {#ccb08e15 .cell execution_count=1}\n``` {.python .cell-code}\nimport folium\nfrom streamlit_folium import st_folium\n\n# Create interactive map centered on default location\ndef create_interactive_map(lat=40.7128, lon=-74.0060, zoom=10):\n    \"\"\"Create an interactive Folium map\"\"\"\n    m = folium.Map(\n        location=[lat, lon],\n        zoom_start=zoom,\n        tiles=\"OpenStreetMap\"\n    )\n\n    # Add click event handler to capture coordinates\n    m.add_child(folium.LatLngPopup())\n\n    return m\n\n# Display map in Streamlit\nif 'map_data' not in st.session_state:\n    st.session_state.map_data = None\n\nmap_object = create_interactive_map()\nst_data = st_folium(map_object, width=700, height=500)\n\n# Capture clicked coordinates\nif st_data['last_clicked']:\n    lat = st_data['last_clicked']['lat']\n    lon = st_data['last_clicked']['lng']\n    st.session_state.clicked_location = (lat, lon)\n    get_weather_for_coordinates(lat, lon)\n```\n:::\n\n\n**Key Features:**\n- **Click-to-Select**: Users can click anywhere on the map\n- **Zoom Controls**: Standard map navigation\n- **Responsive Design**: Adapts to different screen sizes\n- **Coordinate Capture**: Automatic extraction of clicked locations\n\n### 2. Bilingual City Search System\n\nThe app supports both English and Chinese city names with intelligent fallback:\n\n::: {#d7c350ed .cell execution_count=2}\n``` {.python .cell-code}\nimport re\nfrom geopy.geocoders import Nominatim\n\n# Extended Chinese character detection\ndef contains_chinese(text):\n    \"\"\"Check if text contains Chinese characters including CJK Unified Ideographs\"\"\"\n    chinese_pattern = re.compile(\n        r\"[\\u4e00-\\u9fff\\u3400-\\u4dbf\\U00020000-\\U0002a6df\\U0002a700-\\U0002b73f]\"\n    )\n    return bool(chinese_pattern.search(text))\n\n# Chinese city mapping for better geocoding\nCHINESE_CITY_MAPPING = {\n    \"Á∫ΩÁ∫¶\": \"New York\",\n    \"‰∏ú‰∫¨\": \"Tokyo\",\n    \"‰º¶Êï¶\": \"London\",\n    \"Â∑¥Èªé\": \"Paris\",\n    \"Ê¥õÊùâÁü∂\": \"Los Angeles\",\n    # ... more mappings\n}\n\ndef get_coordinates_for_city(city_name):\n    \"\"\"Get coordinates for city with multilingual support\"\"\"\n    # Check for Chinese city name mapping\n    if contains_chinese(city_name) and city_name in CHINESE_CITY_MAPPING:\n        city_name = CHINESE_CITY_MAPPING[city_name]\n\n    # Geocode the city\n    geolocator = Nominatim(user_agent=\"weather_app\")\n    try:\n        location = geolocator.geocode(city_name)\n        return (location.latitude, location.longitude) if location else None\n    except:\n        return None\n```\n:::\n\n\n**Bilingual Features:**\n- **Chinese Character Detection**: Advanced regex pattern for CJK characters\n- **City Name Mapping**: Translation database for major cities\n- **Fallback Handling**: Graceful degradation when geocoding fails\n- **Unicode Support**: Full international character support\n\n### 3. Weather Data Integration\n\nThe application fetches comprehensive weather data from Open-Meteo API:\n\n::: {#77ad33e6 .cell execution_count=3}\n``` {.python .cell-code}\nimport requests\nimport pandas as pd\n\ndef get_weather_data(latitude, longitude):\n    \"\"\"Fetch 12-day weather data (7 historical + 5 forecast)\"\"\"\n\n    # API endpoint configuration\n    url = \"https://api.open-meteo.com/v1/forecast\"\n    params = {\n        'latitude': latitude,\n        'longitude': longitude,\n        'daily': [\n            'temperature_2m_max', 'temperature_2m_min', 'temperature_2m_mean',\n            'weathercode', 'windspeed_10m_max', 'precipitation_probability_max',\n            'pm10', 'pm2_5'\n        ],\n        'timezone': 'auto',\n        'past_days': 7,  # Get historical data\n        'forecast_days': 5  # Get future forecast\n    }\n\n    try:\n        response = requests.get(url, params=params, timeout=10)\n        response.raise_for_status()\n\n        # Process response data\n        data = response.json()\n        df = process_weather_data(data)\n\n        return df\n\n    except requests.RequestException as e:\n        st.error(f\"API request failed: {e}\")\n        return None\n\ndef process_weather_data(data):\n    \"\"\"Convert API response to structured DataFrame\"\"\"\n    daily_data = data['daily']\n\n    # Create date range (historical + future)\n    dates = pd.date_range(\n        start=pd.to_datetime(daily_data['time'][0]),\n        periods=len(daily_data['time']),\n        freq='D'\n    )\n\n    # Build DataFrame\n    df = pd.DataFrame({\n        'date': dates,\n        'temperature_max': daily_data['temperature_2m_max'],\n        'temperature_min': daily_data['temperature_2m_min'],\n        'temperature_mean': daily_data['temperature_2m_mean'],\n        'weather_code': daily_data['weathercode'],\n        'wind_speed_max': daily_data['windspeed_10m_max'],\n        'rain_probability': daily_data['precipitation_probability_max'],\n        'pm2_5': daily_data.get('pm2_5', [0] * len(dates))\n    })\n\n    # Add derived columns\n    df['is_today'] = df['date'].dt.date == pd.Timestamp.now().date()\n    df['is_future'] = df['date'] > pd.Timestamp.now()\n\n    return df\n```\n:::\n\n\n**Data Processing Features:**\n- **Historical + Forecast**: 7 days past + 5 days future\n- **Air Quality Integration**: PM2.5 and PM10 data\n- **Derived Metrics**: Today detection and future projection\n- **Error Handling**: Robust API error management\n\n### 4. Advanced Data Visualization\n\nTemperature trends with clear visual distinction between historical and forecast data:\n\n::: {#903a144a .cell execution_count=4}\n``` {.python .cell-code}\nimport altair as alt\n\ndef create_temperature_chart(weather_df):\n    \"\"\"Create interactive temperature trend chart\"\"\"\n\n    # Base chart with temperature line\n    base_chart = alt.Chart(weather_df).mark_line(\n        point=True,\n        strokeWidth=3,\n        opacity=0.8\n    ).encode(\n        x=alt.X('date:T', title='Date'),\n        y=alt.Y('temperature_mean:Q', title='Temperature (¬∞C)', scale=alt.Scale(domain=[weather_df['temperature_min'].min()-5, weather_df['temperature_max'].max()+5]))\n    ).properties(\n        width=800,\n        height=400,\n        title='Temperature Trends'\n    )\n\n    # Historical data (solid line)\n    historical_data = weather_df[weather_df['is_future'] == False]\n    historical_line = base_chart.transform_filter(\n        'datum.is_future == false'\n    ).encode(\n        color=alt.value('blue'),\n        strokeDash=alt.value([0])  # Solid line\n    )\n\n    # Future forecast (dotted line)\n    future_data = weather_df[weather_df['is_future'] == True]\n    future_line = base_chart.transform_filter(\n        'datum.is_future == true'\n    ).encode(\n        color=alt.value('red'),\n        strokeDash=alt.value([5, 5])  # Dotted line\n    )\n\n    # Today indicator\n    today_line = alt.Chart(pd.DataFrame({'x': [pd.Timestamp.now()]})).mark_rule(\n        strokeDash=[2, 2],\n        stroke='green',\n        strokeWidth=2\n    ).encode(x='x:T')\n\n    return (historical_line + future_line + today_line).resolve_scale(color='independent')\n```\n:::\n\n\n**Visualization Features:**\n- **Line Style Differentiation**: Solid (historical) vs Dotted (forecast)\n- **Today Indicator**: Clear visual marker for current day\n- **Color Coding**: Blue for past, red for future\n- **Interactive Tooltips**: Hover information for data points\n\n### 5. Air Quality Monitoring\n\nPM2.5 levels with EPA-compliant color coding:\n\n::: {#864d4555 .cell execution_count=5}\n``` {.python .cell-code}\ndef get_air_quality_level(pm25_value):\n    \"\"\"Get air quality level based on US EPA PM2.5 standards\"\"\"\n\n    if pm25_value <= 12:\n        return {\n            'level': 'Good',\n            'color': '#00e400',  # Deeper green\n            'text_color': 'white',\n            'icon': 'üü¢'\n        }\n    elif pm25_value <= 35.4:\n        return {\n            'level': 'Moderate',\n            'color': '#ffff00',  # Light green\n            'text_color': 'black',\n            'icon': 'üü¢'\n        }\n    elif pm25_value <= 55.4:\n        return {\n            'level': 'Unhealthy for Sensitive Groups',\n            'color': '#ff7e00',  # Darker yellow\n            'text_color': 'black',\n            'icon': 'üü°'\n        }\n    elif pm25_value <= 150.4:\n        return {\n            'level': 'Unhealthy',\n            'color': '#ff0000',  # Darker orange\n            'text_color': 'white',\n            'icon': 'üü†'\n        }\n    elif pm25_value <= 250.4:\n        return {\n            'level': 'Very Unhealthy',\n            'color': '#8f3f97',  # Darker red\n            'text_color': 'white',\n            'icon': 'üî¥'\n        }\n    else:\n        return {\n            'level': 'Hazardous',\n            'color': '#7e0023',  # Very dark red\n            'text_color': 'white',\n            'icon': '‚ö´'\n        }\n\ndef display_air_quality_badge(pm25_value):\n    \"\"\"Display air quality with visual indicators\"\"\"\n    aq_info = get_air_quality_level(pm25_value)\n\n    st.markdown(f\"\"\"\n    <div style=\"background-color: {aq_info['color']}; color: {aq_info['text_color']};\n                padding: 10px; border-radius: 5px; text-align: center; margin: 5px 0;\">\n        <strong>{aq_info['icon']} PM2.5: {pm25_value} Œºg/m¬≥</strong><br>\n        <small>{aq_info['level']}</small>\n    </div>\n    \"\"\", unsafe_allow_html=True)\n```\n:::\n\n\n**Air Quality Features:**\n- **EPA Standards**: Based on US Environmental Protection Agency\n- **Visual Indicators**: Color-coded badges with icons\n- **Accessibility**: High contrast colors for readability\n- **Educational**: Level descriptions for user understanding\n\n## AI-Powered Weather Intelligence\n\n### Integration with DeepSeek AI\n\nThe most innovative feature is AI-powered weather analysis using ModelScope's DeepSeek-V3.2 model:\n\n![AI Weather Recommendations](images/1.png){width=\"100%\"}\n\n::: {#be0a585b .cell execution_count=6}\n``` {.python .cell-code}\nfrom openai import OpenAI\nimport os\n\n# Initialize AI client with ModelScope\ndef init_ai_client():\n    \"\"\"Initialize OpenAI client for ModelScope API\"\"\"\n    return OpenAI(\n        base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n        api_key=os.getenv(\"modelscope\"),\n    )\n\ndef generate_weather_insights(weather_df, location_name, language=\"en\"):\n    \"\"\"Generate AI-powered weather recommendations\"\"\"\n\n    # Prepare weather data for AI analysis\n    today_index = weather_df[weather_df['is_today']].index[0] if any(weather_df['is_today']) else 0\n    historical_data = weather_df.iloc[:today_index+1]  # Up to today\n    future_data = weather_df.iloc[today_index:]  # Today onwards\n\n    # Create weather summary for AI\n    weather_summary = f\"\"\"\n    Location: {location_name}\n\n    Historical Weather (Last {len(historical_data)} days):\n    - Temperature Range: {historical_data['temperature_min'].min():.1f}¬∞C to {historical_data['temperature_max'].max():.1f}¬∞C\n    - Average Temperature: {historical_data['temperature_mean'].mean():.1f}¬∞C\n    - Air Quality Range: {historical_data['pm2_5'].min():.1f} to {historical_data['pm2_5'].max():.1f} PM2.5\n\n    Forecast (Next {len(future_data)} days):\n    - Temperature Range: {future_data['temperature_min'].min():.1f}¬∞C to {future_data['temperature_max'].max():.1f}¬∞C\n    - Average Rain Probability: {future_data['rain_probability'].mean():.0f}%\n    \"\"\"\n\n    # Generate prompt based on language\n    if language == \"zh\":\n        prompt = f\"\"\"\n        Âü∫‰∫é‰ª•‰∏ãÂ§©Ê∞îÊï∞ÊçÆÔºåËØ∑Êèê‰æõÁÆÄÊ¥ÅÂÆûÁî®ÁöÑÂ§©Ê∞îÂª∫ËÆÆÔºà100-200Â≠óÔºâÔºö\n\n        {weather_summary}\n\n        ËØ∑ÂåÖÊã¨Ôºö\n        1. Â§©Ê∞îÊ®°ÂºèÂàÜÊûê\n        2. Á©øË°£Âª∫ËÆÆ\n        3. Êà∑Â§ñÊ¥ªÂä®Âª∫ËÆÆ\n        4. ÂÅ•Â∫∑Ê≥®ÊÑè‰∫ãÈ°πÔºàÂ¶ÇÁ©∫Ê∞îË¥®ÈáèÁõ∏ÂÖ≥Ôºâ\n\n        ËØ∑Áî®‰∏≠ÊñáÂõûÂ§çÔºåËØ≠Ê∞îÂèãÂ•ΩÂÆûÁî®„ÄÇ\n        \"\"\"\n    else:\n        prompt = f\"\"\"\n        Based on the following weather data, please provide concise and practical weather advice (100-200 words):\n\n        {weather_summary}\n\n        Please include:\n        1. Weather pattern analysis\n        2. Clothing recommendations\n        3. Outdoor activity suggestions\n        4. Health considerations (related to air quality if applicable)\n\n        Please respond in {language} with a friendly and practical tone.\n        \"\"\"\n\n    try:\n        client = init_ai_client()\n        response = client.chat.completions.create(\n            model=\"deepseek-ai/DeepSeek-V3\",\n            messages=[{\"role\": \"user\", \"content\": prompt}],\n            max_tokens=300,\n            temperature=0.7\n        )\n\n        return response.choices[0].message.content\n\n    except Exception as e:\n        return f\"AI service temporarily unavailable. Error: {str(e)}\"\n\n# In Streamlit app\nif st.button(get_text(\"ai_button\", language)):\n    with st.spinner(\"Getting AI weather advice...\"):\n        if 'weather_df' in st.session_state and 'location_name' in st.session_state:\n            ai_insights = generate_weather_insights(\n                st.session_state.weather_df,\n                st.session_state.location_name,\n                language\n            )\n            st.markdown(\"### ü§ñ AI Weather Analysis\")\n            st.write(ai_insights)\n        else:\n            st.warning(\"Please get weather data first.\")\n```\n:::\n\n\n**AI Features:**\n- **Context-Aware Analysis**: Processes both historical and forecast data\n- **Multilingual Support**: AI responds in user's selected language\n- **Practical Recommendations**: Clothing, activities, and health advice\n- **Error Handling**: Graceful fallback when AI service unavailable\n\n### AI Prompt Engineering\n\nThe AI system uses carefully crafted prompts to generate useful insights:\n\n**Prompt Structure:**\n1. **Data Context**: Comprehensive weather statistics\n2. **Task Definition**: Clear requirements for analysis\n3. **Output Format**: Structured response categories\n4. **Language Adaptation**: Matches user interface language\n\n**Response Categories:**\n- **Weather Pattern Analysis**: Trends and anomalies\n- **Clothing Recommendations**: Practical dress suggestions\n- **Activity Advice**: Outdoor planning recommendations\n- **Health Considerations**: Air quality and weather impacts\n\n## Internationalization System\n\n### Language Management Architecture\n\nThe app implements a comprehensive bilingual system:\n\n::: {#8d929abd .cell execution_count=7}\n``` {.python .cell-code}\n# language.py - Translation management\nTRANSLATIONS = {\n    \"en\": {\n        \"app_title\": \"Weather Forecast App\",\n        \"sidebar_header\": \"Weather Query\",\n        \"city_input_placeholder\": \"Enter a city name\",\n        \"get_weather_button\": \"Get Weather\",\n        \"weather_trends_title\": \"Weather Trends for\",\n        \"ai_button\": \"AI Weather Advice\",\n        # ... more translations\n    },\n    \"zh\": {\n        \"app_title\": \"Â§©Ê∞îÈ¢ÑÊä•Â∫îÁî®\",\n        \"sidebar_header\": \"Â§©Ê∞îÊü•ËØ¢\",\n        \"city_input_placeholder\": \"ËæìÂÖ•ÂüéÂ∏ÇÂêçÁß∞\",\n        \"get_weather_button\": \"Ëé∑ÂèñÂ§©Ê∞î\",\n        \"weather_trends_title\": \"Â§©Ê∞îË∂ãÂäø\",\n        \"ai_button\": \"AIÂ§©Ê∞îÂª∫ËÆÆ\",\n        # ... more translations\n    }\n}\n\ndef get_text(key, language=\"en\"):\n    \"\"\"Get translated text for given key and language\"\"\"\n    return TRANSLATIONS.get(language, {}).get(key, key)\n\ndef get_available_languages():\n    \"\"\"Get available language options\"\"\"\n    return {\"en\": \"English\", \"zh\": \"‰∏≠Êñá\"}\n\n# In main app (app.py)\ndef main():\n    # Language state management\n    if 'language' not in st.session_state:\n        st.session_state.language = \"en\"\n\n    # Language toggle button\n    current_lang = st.session_state.language\n    available_langs = get_available_languages()\n\n    col1, col2, col3 = st.columns([1,1,6])\n    with col1:\n        if st.button(\"EN\", disabled=current_lang==\"en\"):\n            st.session_state.language = \"en\"\n            st.rerun()\n\n    with col2:\n        if st.button(\"‰∏≠Êñá\", disabled=current_lang==\"zh\"):\n            st.session_state.language = \"zh\"\n            st.rerun()\n\n    # Use current language for all UI elements\n    language = st.session_state.language\n    st.title(get_text(\"app_title\", language))\n    st.sidebar.header(get_text(\"sidebar_header\", language))\n```\n:::\n\n\n**Internationalization Features:**\n- **Complete UI Translation**: All interface elements localized\n- **Dynamic Language Switching**: Instant UI updates on language change\n- **Chinese Character Support**: Full Unicode and CJK support\n- **Consistent Language**: AI responses match UI language\n\n## Advanced UI Components\n\n### Weather Data Table with Visual Indicators\n\nThe weather table combines data with visual elements for quick understanding:\n\n::: {#c930b26e .cell execution_count=8}\n``` {.python .cell-code}\ndef create_weather_table(weather_df, language=\"en\"):\n    \"\"\"Create enhanced weather table with icons and colors\"\"\"\n\n    # Weather code to emoji mapping\n    WEATHER_ICONS = {\n        0: \"‚òÄÔ∏è\",   # Clear sky\n        1: \"‚õÖ\",   # Mainly clear\n        2: \"‚òÅÔ∏è\",   # Partly cloudy\n        3: \"‚òÅÔ∏è\",   # Overcast\n        45: \"üå´Ô∏è\",  # Fog\n        48: \"üå¶Ô∏è\",  # Drizzle\n        51: \"üåßÔ∏è\",  # Rain\n        53: \"‚ùÑÔ∏è\",  # Snow\n        95: \"‚õàÔ∏è\",  # Thunderstorm\n    }\n\n    def format_weather_row(row):\n        \"\"\"Format individual weather row with styling\"\"\"\n        date_str = row['date'].strftime('%Y-%m-%d')\n        temp_range = f\"{row['temperature_min']:.1f}¬∞ ~ {row['temperature_max']:.1f}¬∞\"\n        weather_icon = WEATHER_ICONS.get(row['weather_code'], \"üå°Ô∏è\")\n\n        # Air quality badge\n        aq_info = get_air_quality_level(row['pm2_5'])\n        aq_badge = f'<span style=\"background-color: {aq_info[\"color\"]}; color: {aq_info[\"text_color\"]}; padding: 2px 6px; border-radius: 3px; font-size: 0.8em;\">{aq_info[\"icon\"]} {row[\"pm2_5\"]:.0f}</span>'\n\n        # Rain probability indicator\n        rain_color = 'red' if row['rain_probability'] >= 80 else 'orange' if row['rain_probability'] >= 50 else 'gray'\n        rain_indicator = f'<span style=\"color: {rain_color};\">üî¥ {row[\"rain_probability\"]:.0f}%</span>' if row['rain_probability'] >= 50 else f'<span style=\"color: {rain_color};\">üü¢ {row[\"rain_probability\"]:.0f}%</span>'\n\n        # Today highlighting\n        row_style = 'font-size: 1.2em; font-weight: bold;' if row['is_today'] else ''\n\n        return {\n            'Date': f'<span style=\"{row_style}\">{date_str}</span>',\n            'Weather': f'<span style=\"{row_style}\">{weather_icon}</span>',\n            'Temperature': f'<span style=\"{row_style}\">{temp_range}</span>',\n            'Wind': f'<span style=\"{row_style}\">üí® {row[\"wind_speed_max\"]:.1f} km/h</span>',\n            'Rain': rain_indicator,\n            'Air Quality': aq_badge\n        }\n\n    # Apply formatting to all rows\n    formatted_rows = [format_weather_row(row) for _, row in weather_df.iterrows()]\n\n    return pd.DataFrame(formatted_rows)\n\n# Display in Streamlit\nst.markdown(\"### üìä Weather Details\")\nst.dataframe(\n    create_weather_table(weather_df, language),\n    width=1200,\n    hide_index=True,\n    unsafe_allow_html=True\n)\n```\n:::\n\n\n**Table Features:**\n- **Weather Icons**: Emoji representation for quick visual understanding\n- **Today Highlighting**: Larger, bold text for current day\n- **Air Quality Badges**: Color-coded PM2.5 indicators\n- **Rain Probability**: Visual indicators with Material Design colors\n- **Responsive Layout**: Adapts to different screen sizes\n\n## Deployment and Production\n\n### Environment Configuration\n\nFor production deployment, configure environment variables:\n\n```bash\n# .env file\nmodelscope=your_modelscope_api_key_here\n\n# Additional production settings\n# Consider rate limiting, caching, and monitoring\n```\n\n### Streamlit Cloud Deployment\n\n```bash\n# 1. Install Streamlit CLI\npip install streamlit\n\n# 2. Login to Streamlit\nstreamlit login\n\n# 3. Deploy to Streamlit Cloud\nstreamlit run app.py  # Test locally first\n# Then deploy through cloud.streamlit.io or using CLI\n```\n\n### Docker Deployment (Optional)\n\n```dockerfile\nFROM python:3.9-slim\n\nWORKDIR /app\n\nCOPY requirements.txt .\nRUN pip install -r requirements.txt\n\nCOPY . .\n\nEXPOSE 8501\n\nCMD [\"streamlit\", \"run\", \"app.py\", \"--server.address\", \"0.0.0.0\"]\n```\n\n## Performance Optimization\n\n### Caching Strategy\n\n```python\n@st.cache_data(ttl=3600)  # Cache for 1 hour\ndef get_weather_data_cached(lat, lon):\n    \"\"\"Cached weather data fetching\"\"\"\n    return get_weather_data(lat, lon)\n\n@st.cache_resource\ndef get_ai_client():\n    \"\"\"Cached AI client initialization\"\"\"\n    return init_ai_client()\n\n# Cache map generation\n@st.cache_data(ttl=3600)\ndef create_map_cached(lat, lon):\n    \"\"\"Cached map creation\"\"\"\n    return create_interactive_map(lat, lon)\n```\n\n### Error Handling and Resilience\n\n::: {#0f3be0ae .cell execution_count=9}\n``` {.python .cell-code}\ndef robust_api_call(func, *args, max_retries=3, **kwargs):\n    \"\"\"Robust API calling with retry logic\"\"\"\n    for attempt in range(max_retries):\n        try:\n            return func(*args, **kwargs)\n        except requests.exceptions.Timeout:\n            if attempt == max_retries - 1:\n                st.error(\"Weather service temporarily unavailable\")\n                return None\n            time.sleep(2 ** attempt)  # Exponential backoff\n        except requests.exceptions.RequestException as e:\n            st.error(f\"API error: {e}\")\n            return None\n```\n:::\n\n\n## Best Practices and Lessons Learned\n\n### Development Insights\n\n1. **Modular Architecture**: Separate concerns (API, UI, AI, Visualization)\n2. **Error Resilience**: Comprehensive error handling and fallbacks\n3. **User Experience**: Fast loading with caching and progress indicators\n4. **Internationalization**: Plan for multilingual support from the start\n5. **API Management**: Rate limiting and request optimization\n6. **Responsive Design**: Test across different devices and screen sizes\n7. **Security**: Environment variables for sensitive data\n\n### Performance Considerations\n\n- **Data Caching**: 1-hour TTL for weather data\n- **Lazy Loading**: Load components only when needed\n- **Async Operations**: Non-blocking API calls where possible\n- **Optimization**: Minimize re-renders and state updates\n\n## Future Enhancements\n\n### Potential Improvements\n\n1. **Extended AI Capabilities**:\n   - Multi-day activity planning\n   - Personalized recommendations based on user preferences\n   - Integration with calendar applications\n\n2. **Advanced Visualizations**:\n   - Wind direction and speed maps\n   - Precipitation intensity charts\n   - Historical weather comparisons\n\n3. **Data Sources**:\n   - Multiple weather provider integration\n   - Real-time radar integration\n   - Weather alert systems\n\n4. **User Features**:\n   - Saved locations and favorites\n   - Weather notifications\n   - Historical data analysis\n   - Export functionality\n\n5. **Technical Enhancements**:\n   - WebSocket real-time updates\n   - Progressive Web App (PWA) features\n   - Offline functionality\n\n## Conclusion\n\nThis weather forecast application demonstrates how modern web development technologies can be combined to create a comprehensive, intelligent weather service. The integration of AI-powered recommendations elevates it from a simple data display tool to a practical weather assistant that helps users make informed decisions about their daily activities.\n\nThe project showcases:\n\n- **Modern Web Development**: Streamlit for rapid prototyping\n\n- **Data Visualization**: Professional charts and interactive maps\n\n- **AI Integration**: Practical use of language models for data analysis\n\n- **Internationalization**: Complete bilingual support\n\n- **Production Readiness**: Error handling, caching, and optimization\n\nWhether you're building weather applications, data dashboards, or AI-powered tools, this project provides an excellent foundation for creating sophisticated, user-friendly applications.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}