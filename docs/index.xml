<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>AI Blog</title>
<link>https://your-website-url.example.com/</link>
<atom:link href="https://your-website-url.example.com/index.xml" rel="self" type="application/rss+xml"/>
<description>A blog built with Quarto</description>
<generator>quarto-1.8.25</generator>
<lastBuildDate>Wed, 07 Jan 2026 16:00:00 GMT</lastBuildDate>
<item>
  <title>LLM Summary System: A Multi-Platform AI Summarization Tool</title>
  <dc:creator>Tony D</dc:creator>
  <link>https://your-website-url.example.com/posts/llm-summary/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In the era of information explosion, keeping up with content across multiple platforms like YouTube, Bilibili, Spotify, and Xiaohongshu can be overwhelming. The <strong>LLM Summary System</strong> is a powerful, unified tool designed to solve this by automating the process of downloading, transcribing, and summarizing content using state-of-the-art Large Language Models (LLMs).</p>
<p>This project provides a seamless experience for converting long-form audio/video content into concise, actionable summaries.</p>
<p><img src="https://your-website-url.example.com/posts/llm-summary/image/1.png" class="img-fluid"></p>
</section>
<section id="key-features" class="level1">
<h1>Key Features</h1>
<p>The system is packed with features that make it a robust choice for content consumption:</p>
<ul>
<li><strong>Multi-Platform Support</strong>: Unified interface for YouTube, Bilibili, Spotify, Xiaohongshu, and Xiaoyuzhou FM.</li>
<li><strong>Intelligent Processing</strong>: Automatic chunking for large files and transcripts to handle long-form content (up to 2M tokens).</li>
<li><strong>High-Quality Transcription</strong>: Uses MLX Whisper (optimized for Apple Silicon) with an OpenAI Whisper fallback.</li>
<li><strong>Advanced Summarization</strong>: Support for 15+ LLM models (including Qwen, GLM, DeepSeek, GPT-4, Gemini, and Grok).</li>
<li><strong>Text-to-Speech (TTS)</strong>: Convert summaries back to audio using Google Cloud TTS, Qwen, or Gemini.</li>
<li><strong>Search Integration</strong>: Automatically finds related reading materials using AI-extracted keywords.</li>
<li><strong>Real-time Progress Tracking</strong>: A user-friendly Streamlit web interface with live updates.</li>
</ul>
</section>
<section id="architecture-overview" class="level1">
<h1>Architecture Overview</h1>
<p>The system follows a streamlined pipeline:</p>
<pre class="mermaid"><code>graph LR
    A[URL Input] --&gt; B[Platform Detection]
    B --&gt; C[Content Download]
    C --&gt; D[Audio Extraction]
    D --&gt; E[Transcription - Whisper]
    E --&gt; F[AI Summarization]
    F --&gt; G[TTS Generation]
    G --&gt; H[File Output + Web Display]</code></pre>
<section id="core-components" class="level3">
<h3 class="anchored" data-anchor-id="core-components">Core Components</h3>
<ul>
<li><strong><code>app.py</code></strong>: The main Streamlit web interface handle concurrent URL submission and dynamic queuing.</li>
<li><strong><code>download.py</code></strong>: A unified downloader with comprehensive retry logic for all supported platforms.</li>
<li><strong><code>process.py</code></strong>: Handles audio transcription and AI summarization with intelligent chunking.</li>
<li><strong><code>config.py</code></strong>: Manages LLM model configurations and environment variables.</li>
<li><strong><code>tts.py</code></strong>: Multi-provider text-to-speech with hash-based caching.</li>
</ul>
</section>
</section>
<section id="advanced-intelligence" class="level1">
<h1>Advanced Intelligence</h1>
<p>What sets this system apart is its handling of complex tasks:</p>
<section id="intelligent-chunking" class="level3">
<h3 class="anchored" data-anchor-id="intelligent-chunking">Intelligent Chunking</h3>
<p>To prevent RAM exhaustion and handle extremely long content: - <strong>Audio</strong>: Automatically splits files longer than 60 minutes for transcription. - <strong>Text</strong>: Transcripts exceeding 240K characters are split into 100K character chunks.</p>
</section>
<section id="search-integration" class="level3">
<h3 class="anchored" data-anchor-id="search-integration">Search Integration</h3>
<p>After generating a summary, the system extracts key terms and searches for supplemental materials via DuckDuckGo (or Baidu as a fallback). This ensures you get a well-rounded understanding of the topic.</p>
</section>
</section>
<section id="getting-started" class="level1">
<h1>Getting Started</h1>
<p>The easiest way to run the system is via the Web Interface:</p>
<ol type="1">
<li><p><strong>Clone the repository</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone https://github.com/JCwinning/llm_summary.git</span>
<span id="cb2-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> llm_summary</span></code></pre></div></div></li>
<li><p><strong>Configure your environment</strong>: Create a <code>.env</code> file with your API keys (OpenAI, DashScope, etc.).</p></li>
<li><p><strong>Install dependencies</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> requirements.txt</span></code></pre></div></div></li>
<li><p><strong>Run the app</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">streamlit</span> run app.py</span></code></pre></div></div></li>
</ol>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The LLM Summary System is more than just a downloader; it‚Äôs a personalized AI research assistant. Whether you‚Äôre a student, researcher, or just someone who wants to stay informed, this tool can significantly boost your productivity by distilling hours of content into minutes of reading.</p>
<p>Check out the full source code and contribute on <a href="https://github.com/JCwinning/llm_summary">GitHub</a>.</p>


<!-- -->

</section>

 ]]></description>
  <category>AI</category>
  <category>Python</category>
  <category>LLM</category>
  <category>Open Source</category>
  <guid>https://your-website-url.example.com/posts/llm-summary/</guid>
  <pubDate>Wed, 07 Jan 2026 16:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/llm-summary/image/cover.png" medium="image" type="image/png" height="98" width="144"/>
</item>
<item>
  <title>AI Chat: A Multilingual Multi-Model application</title>
  <dc:creator>Tony D</dc:creator>
  <link>https://your-website-url.example.com/posts/AI-Chat/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In the rapidly evolving landscape of Artificial Intelligence, having a unified interface to interact with multiple models is invaluable. <a href="https://github.com/JCwinning/AI_Chat">AI Chat</a> is a multilingual, multi-model AI chat application built with Streamlit. It supports streaming responses, image inputs, concurrent model querying, web search, and comprehensive file processing.</p>
<p>Whether you‚Äôre comparing responses from different LLMs or generating stunning visuals, AI Chat provides a seamless and powerful experience.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true" href="">Text answer</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false" href="">Create image</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false" href="">summary upload document</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" aria-controls="tabset-1-4" aria-selected="false" href="">pre define prompt</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p><img src="https://your-website-url.example.com/posts/AI-Chat/images/1.png" class="img-fluid"></p>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p><img src="https://your-website-url.example.com/posts/AI-Chat/images/2.png" class="img-fluid"></p>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<p><img src="https://your-website-url.example.com/posts/AI-Chat/images/4.png" class="img-fluid"></p>
<p>AI summary paper:DeepSeek-R1: Incentivizing Reasoning Capability in LLMs via Reinforcement Learning (https://arxiv.org/pdf/2501.12948)</p>
</div>
<div id="tabset-1-4" class="tab-pane" aria-labelledby="tabset-1-4-tab">
<p><img src="https://your-website-url.example.com/posts/AI-Chat/images/3.png" class="img-fluid"></p>
</div>
</div>
</div>
</section>
<section id="key-features" class="level1">
<h1>‚ú® Key Features</h1>
<ul>
<li><strong>üåê Multilingual Support</strong>: Instant switching between English and Chinese interfaces.</li>
<li><strong>ü§ñ Multi-Model Chat</strong>: Query multiple AI models simultaneously with a side-by-side comparison view.</li>
<li><strong>üé® Image Generation &amp; Editing</strong>: Create and edit images using models like FLUX, Qwen Image, and Gemini.</li>
<li><strong>üìö Prompt Bay</strong>: Access a library of 100+ searchable system prompts for specialized interactions.</li>
<li><strong>üîç Web Search</strong>: Integrated Tavily AI search for real-time information retrieval.</li>
<li><strong>üñºÔ∏è Comprehensive File Support</strong>: Upload and process PDFs, Word docs, Excel, CSV, and images.</li>
<li><strong>‚ö° Streaming Responses</strong>: Real-time feedback from multiple models concurrently.</li>
</ul>
</section>
<section id="quick-start" class="level1">
<h1>üöÄ Quick Start</h1>
<p>To get started with AI Chat locally, follow these steps:</p>
<section id="prerequisites" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites">Prerequisites</h3>
<ul>
<li>Python 3.7 or higher</li>
<li>pip package manager</li>
</ul>
</section>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<ol type="1">
<li><p><strong>Clone the repository</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone https://github.com/JCwinning/AI_Chat.git</span>
<span id="cb1-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> AI_Chat</span></code></pre></div></div></li>
<li><p><strong>Install dependencies</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> requirements.txt</span></code></pre></div></div></li>
<li><p><strong>Configure API keys</strong>: Create a <code>.env</code> file in the project root and add your keys:</p>
<pre class="env"><code>modelscope=your-modelscope-api-key
openrouter=your-openrouter-api-key
dashscope=your-dashscope-api-key
bigmodel=your-bigmodel-api-key
tavily_api_key=your-tavily-api-key</code></pre></li>
<li><p><strong>Run the application</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">streamlit</span> run app.py</span></code></pre></div></div></li>
</ol>
</section>
</section>
<section id="architecture-components" class="level1">
<h1>üèóÔ∏è Architecture &amp; Components</h1>
<p>The project is structured for modularity and performance:</p>
<ul>
<li><strong><code>app.py</code></strong>: The main entry point using Streamlit for the UI and session management.</li>
<li><strong><code>config.py</code></strong>: Centralized model definitions and provider settings.</li>
<li><strong><code>search_providers.py</code></strong>: Handles web search integration with caching.</li>
<li><strong>Multi-threading</strong>: Uses Python‚Äôs <code>threading</code> and <code>Queue</code> to handle parallel model requests and streaming.</li>
<li><strong>File Processing</strong>: Leverages <code>markitdown</code> for document conversion and <code>Pillow</code> for image handling.</li>
</ul>
</section>
<section id="usage-tips" class="level1">
<h1>üìñ Usage Tips</h1>
<section id="side-by-side-comparison" class="level3">
<h3 class="anchored" data-anchor-id="side-by-side-comparison">Side-by-Side Comparison</h3>
<p>One of the most powerful features is the ability to select multiple models in the ‚Äúü§ñ Models‚Äù tab. When you send a message, the app queries all selected models in parallel and displays their responses side-by-side, making it easy to compare performance and accuracy.</p>
</section>
<section id="using-the-prompt-bay" class="level3">
<h3 class="anchored" data-anchor-id="using-the-prompt-bay">Using the Prompt Bay</h3>
<p>Don‚Äôt know how to start? Use the ‚Äúüìö Prompt Bay‚Äù to find the perfect system prompt. You can search by category or keyword and apply it to your current session with a single click.</p>
</section>
<section id="advanced-file-analysis" class="level3">
<h3 class="anchored" data-anchor-id="advanced-file-analysis">Advanced File Analysis</h3>
<p>Upload a PDF or Excel file, and the app will automatically convert it to markdown or a table, including it in the conversation context. This allows you to ask the AI questions directly about your documents.</p>
<hr>
<p><em>Check out the full source code on <a href="https://github.com/JCwinning/AI_Chat">GitHub</a> and start building your own AI-powered workflows!</em></p>


<!-- -->

</section>
</section>

 ]]></description>
  <category>AI</category>
  <category>Streamlit</category>
  <category>Python</category>
  <category>LLM</category>
  <guid>https://your-website-url.example.com/posts/AI-Chat/</guid>
  <pubDate>Tue, 06 Jan 2026 16:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/AI-Chat/images/featured.png" medium="image" type="image/png" height="126" width="144"/>
</item>
<item>
  <title>Interactive GDP Trend Dashboard with AI SQL</title>
  <link>https://your-website-url.example.com/posts/gdp-trend/</link>
  <description><![CDATA[ 





<section id="project-overview" class="level1">
<h1>Project Overview</h1>
<p>Live Demo: <a href="https://world-GDP-trend.streamlit.app">https://world-GDP-trend.streamlit.app</a></p>
<p>Github: <a href="https://github.com/JCwinning/GDP_trend">https://github.com/JCwinning/GDP_trend</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/gdp-trend/images/0.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>GDP Dashboard - Main Interface</figcaption>
</figure>
</div>
<p>The GDP Trend Dashboard is a sophisticated web application that visualizes and analyzes economic data from the World Bank API. What makes this system unique is its dual approach: traditional interactive visualizations combined with AI-powered natural language querying, making economic data accessible to both technical analysts and general users.</p>
<section id="core-architecture" class="level2">
<h2 class="anchored" data-anchor-id="core-architecture">Core Architecture</h2>
<section id="technology-stack" class="level3">
<h3 class="anchored" data-anchor-id="technology-stack">Technology Stack</h3>
<ul>
<li><strong>Primary Framework</strong>: Streamlit for interactive web applications</li>
<li><strong>Data Processing</strong>: Pandas for manipulation and analysis</li>
<li><strong>Visualization</strong>: Plotly Express for interactive charts</li>
<li><strong>Database</strong>: DuckDB for efficient SQL queries</li>
<li><strong>AI Integration</strong>: ModelScope GLM-4.6 for natural language to SQL conversion</li>
<li><strong>Data Sources</strong>: World Bank API via <code>wbgapi</code> library</li>
</ul>
</section>
<section id="key-features" class="level3">
<h3 class="anchored" data-anchor-id="key-features">Key Features</h3>
<ol type="1">
<li><strong>Multi-country GDP trend comparisons</strong></li>
<li><strong>Support for multiple economic indicators</strong> (GDP, GDP per capita, population, YoY growth)</li>
<li><strong>AI-powered natural language querying</strong></li>
<li><strong>Direct SQL interface with DuckDB</strong></li>
<li><strong>Complete bilingual support</strong> (English/Chinese)</li>
<li><strong>Time-range filtering</strong> with interactive controls (2000-present)</li>
</ol>
</section>
</section>
<section id="data-pipeline-architecture" class="level2">
<h2 class="anchored" data-anchor-id="data-pipeline-architecture">Data Pipeline Architecture</h2>
<p>The application implements a sophisticated data pipeline that ensures data quality and real-time availability:</p>
<div class="cell" data-eval="true" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[World Bank API] --&gt; B[Data Collection&lt;br/&gt;download_data.py]
    B --&gt; C[Data Processing&lt;br/&gt;Country Mapping, Indicator Calculation]
    C --&gt; D[Data Storage&lt;br/&gt;CSV Files]

    D --&gt; E[Streamlit App&lt;br/&gt;app.py]
    E --&gt; F[DuckDB&lt;br/&gt;In-Memory SQL]

    F --&gt; G[Visualization Engine&lt;br/&gt;Plotly Express]
    F --&gt; H[AI Query Engine&lt;br/&gt;ModelScope API]
    F --&gt; I[Session Management&lt;br/&gt;User State]

    G --&gt; J[Interactive Charts]
    H --&gt; K[Natural Language&lt;br/&gt;to SQL]
    I --&gt; L[Persistent&lt;br/&gt;Query Results]

    J --&gt; M[User Interface]
    K --&gt; M
    L --&gt; M
</pre>
</div>
<p></p><figcaption> GDP Application Architecture</figcaption> </figure><p></p>
</div>
</div>
</div>
</section>
<section id="data-collection-and-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-collection-and-processing">Data Collection and Processing</h2>
<section id="world-bank-api-integration" class="level3">
<h3 class="anchored" data-anchor-id="world-bank-api-integration">World Bank API Integration</h3>
<p>The application uses the World Bank API to collect comprehensive economic data:</p>
<div id="64b59583" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> wbgapi <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> wb</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pycountry</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> download_economic_data():</span>
<span id="cb1-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Download GDP data from World Bank API for all countries"""</span></span>
<span id="cb1-7"></span>
<span id="cb1-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define economic indicators to download</span></span>
<span id="cb1-9">    indicators <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb1-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdp_current_usd'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'NY.GDP.MKTP.CD'</span>,</span>
<span id="cb1-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdp_per_capita_current_usd'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'NY.GDP.PCAP.CD'</span>,</span>
<span id="cb1-12">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'population_total'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'SP.POP.TOTL'</span></span>
<span id="cb1-13">    }</span>
<span id="cb1-14"></span>
<span id="cb1-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Download data from 2000 to present</span></span>
<span id="cb1-16">    data_frames <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb1-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> indicator_name, indicator_code <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> indicators.items():</span>
<span id="cb1-18">        df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> wb.get_series(</span>
<span id="cb1-19">            series<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>indicator_code,</span>
<span id="cb1-20">            economy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'all'</span>,</span>
<span id="cb1-21">            time<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2000:2024'</span>,</span>
<span id="cb1-22">            simplify_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb1-23">        )</span>
<span id="cb1-24"></span>
<span id="cb1-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Process and add to collection</span></span>
<span id="cb1-26">        df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.reset_index()</span>
<span id="cb1-27">        df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'indicator'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> indicator_name</span>
<span id="cb1-28">        data_frames.append(df)</span>
<span id="cb1-29"></span>
<span id="cb1-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine all indicators</span></span>
<span id="cb1-31">    combined_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat(data_frames, ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> combined_df</span>
<span id="cb1-33"></span>
<span id="cb1-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> create_country_reference_table():</span>
<span id="cb1-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Create comprehensive country metadata with ISO codes"""</span></span>
<span id="cb1-36">    countries <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(pycountry.countries)</span>
<span id="cb1-37"></span>
<span id="cb1-38">    df_all <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame([{</span>
<span id="cb1-39">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country_name'</span>: country.name,</span>
<span id="cb1-40">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country_code_2'</span>: country.alpha_2,</span>
<span id="cb1-41">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country_code_3'</span>: country.alpha_3</span>
<span id="cb1-42">    } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> country <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> countries])</span>
<span id="cb1-43"></span>
<span id="cb1-44">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add continent mapping</span></span>
<span id="cb1-45">    iso_to_continent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb1-46">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"US"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"North America"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CN"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asia"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JP"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asia"</span>,</span>
<span id="cb1-47">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DE"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Europe"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GB"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Europe"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FR"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Europe"</span></span>
<span id="cb1-48">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... complete mapping for all countries</span></span>
<span id="cb1-49">    }</span>
<span id="cb1-50"></span>
<span id="cb1-51">    df_all[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'continent'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_all[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country_code_2'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(iso_to_continent)</span>
<span id="cb1-52">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df_all</span></code></pre></div></div>
</details>
</div>
</section>
<section id="data-schema-and-structure" class="level3">
<h3 class="anchored" data-anchor-id="data-schema-and-structure">Data Schema and Structure</h3>
<p>The application uses a clean, normalized data structure:</p>
<div id="460fcf86" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> Main data schema</span>
<span id="cb2-2">CREATE TABLE df_gdp (</span>
<span id="cb2-3">    country_name TEXT,        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> Display name (English)</span>
<span id="cb2-4">    country_code_2 TEXT,      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> ISO alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> code</span>
<span id="cb2-5">    country_code_3 TEXT,      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> ISO alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> code</span>
<span id="cb2-6">    continent TEXT,            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> Continent classification</span>
<span id="cb2-7">    year INTEGER,              <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> Data year</span>
<span id="cb2-8">    indicator TEXT,            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> Economic indicator name</span>
<span id="cb2-9">    value REAL                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> Indicator value</span>
<span id="cb2-10">)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--</span> Example data</span>
<span id="cb2-13">INSERT INTO df_gdp VALUES</span>
<span id="cb2-14">(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'United States'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'US'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'USA'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'North America'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdp_current_usd'</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">27444144.3</span>),</span>
<span id="cb2-15">(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'United States'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'US'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'USA'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'North America'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdp_per_capita_current_usd'</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">81254.2</span>),</span>
<span id="cb2-16">(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'United States'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'US'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'USA'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'North America'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'population_total'</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">334914895.0</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="interactive-visualization-system" class="level2">
<h2 class="anchored" data-anchor-id="interactive-visualization-system">Interactive Visualization System</h2>
<section id="plotly-express-implementation" class="level3">
<h3 class="anchored" data-anchor-id="plotly-express-implementation">Plotly Express Implementation</h3>
<p>The application uses Plotly Express for creating interactive charts with consistent color coding:</p>
<div id="6b761d0b" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> plotly.express <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> px</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@st.cache_data</span></span>
<span id="cb3-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> load_data():</span>
<span id="cb3-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Load and cache GDP data"""</span></span>
<span id="cb3-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data/gdp_data_2000_present.csv'</span>)</span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> create_gdp_trend_chart(selected_countries, selected_indicator, year_range):</span>
<span id="cb3-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Create interactive GDP trend visualization"""</span></span>
<span id="cb3-10"></span>
<span id="cb3-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load filtered data</span></span>
<span id="cb3-12">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> load_data()</span>
<span id="cb3-13"></span>
<span id="cb3-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply filters</span></span>
<span id="cb3-15">    filtered_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[</span>
<span id="cb3-16">        (df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country_name'</span>].isin(selected_countries)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span></span>
<span id="cb3-17">        (df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'indicator'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> selected_indicator) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span></span>
<span id="cb3-18">        (df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'year'</span>].between(year_range[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], year_range[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb3-19">    ]</span>
<span id="cb3-20"></span>
<span id="cb3-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create interactive line chart</span></span>
<span id="cb3-22">    fig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> px.line(</span>
<span id="cb3-23">        filtered_df,</span>
<span id="cb3-24">        x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'year'</span>,</span>
<span id="cb3-25">        y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'value'</span>,</span>
<span id="cb3-26">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country_name'</span>,</span>
<span id="cb3-27">        title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>selected_indicator<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>title()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> Trend'</span>,</span>
<span id="cb3-28">        labels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb3-29">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'year'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Year'</span>,</span>
<span id="cb3-30">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'value'</span>: format_indicator_label(selected_indicator),</span>
<span id="cb3-31">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country_name'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Country'</span></span>
<span id="cb3-32">        }</span>
<span id="cb3-33">    )</span>
<span id="cb3-34"></span>
<span id="cb3-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Customize chart appearance</span></span>
<span id="cb3-36">    fig.update_layout(</span>
<span id="cb3-37">        xaxis_title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,</span>
<span id="cb3-38">        yaxis_title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>format_indicator_label(selected_indicator),</span>
<span id="cb3-39">        hovermode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x unified'</span>,</span>
<span id="cb3-40">        showlegend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb3-41">        legend<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(</span>
<span id="cb3-42">            orientation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"h"</span>,</span>
<span id="cb3-43">            yanchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="cb3-44">            y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02</span>,</span>
<span id="cb3-45">            xanchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>,</span>
<span id="cb3-46">            x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-47">        )</span>
<span id="cb3-48">    )</span>
<span id="cb3-49"></span>
<span id="cb3-50">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> fig</span>
<span id="cb3-51"></span>
<span id="cb3-52"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> format_indicator_label(indicator):</span>
<span id="cb3-53">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Format indicator names for display"""</span></span>
<span id="cb3-54">    labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb3-55">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdp_current_usd'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GDP (Current USD)'</span>,</span>
<span id="cb3-56">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdp_per_capita_current_usd'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GDP Per Capita (Current USD)'</span>,</span>
<span id="cb3-57">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'population_total'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Population'</span>,</span>
<span id="cb3-58">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdp_per_capita_current_usd_yoy'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GDP Per Capita YoY Growth (%)'</span></span>
<span id="cb3-59">    }</span>
<span id="cb3-60">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> labels.get(indicator, indicator.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' '</span>).title())</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="ai-powered-analytics" class="level2">
<h2 class="anchored" data-anchor-id="ai-powered-analytics">AI-Powered Analytics</h2>
<section id="natural-language-to-sql-conversion" class="level3">
<h3 class="anchored" data-anchor-id="natural-language-to-sql-conversion">Natural Language to SQL Conversion</h3>
<p>The application‚Äôs most innovative feature is AI-powered natural language querying:</p>
<div id="39393316" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> duckdb</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> generate_sql_from_question(question, language):</span>
<span id="cb4-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Convert natural language question to SQL using ModelScope API"""</span></span>
<span id="cb4-6"></span>
<span id="cb4-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get database schema for context</span></span>
<span id="cb4-8">    schema_info <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb4-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    Table: df_gdp</span></span>
<span id="cb4-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    Columns:</span></span>
<span id="cb4-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    - country_name (TEXT): Country display name</span></span>
<span id="cb4-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    - country_code_2 (TEXT): ISO alpha-2 country code</span></span>
<span id="cb4-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    - continent (TEXT): Continent classification</span></span>
<span id="cb4-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    - year (INTEGER): Data year (2000-2024)</span></span>
<span id="cb4-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    - indicator (TEXT): Economic indicator name</span></span>
<span id="cb4-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    - value (REAL): Indicator value</span></span>
<span id="cb4-17"></span>
<span id="cb4-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    Available indicators:</span></span>
<span id="cb4-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    - gdp_current_usd: GDP in current USD</span></span>
<span id="cb4-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    - gdp_per_capita_current_usd: GDP per capita in current USD</span></span>
<span id="cb4-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    - population_total: Total population</span></span>
<span id="cb4-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    - gdp_per_capita_current_usd_yoy: Year-over-year GDP per capita growth (%)</span></span>
<span id="cb4-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb4-24"></span>
<span id="cb4-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create language-specific prompt</span></span>
<span id="cb4-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> language <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zh"</span>:</span>
<span id="cb4-27">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""ËØ∑Â∞Ü‰ª•‰∏ãËá™ÁÑ∂ËØ≠Ë®ÄÈóÆÈ¢òËΩ¨Êç¢‰∏∫SQLÊü•ËØ¢Ôºå‰ªÖËøîÂõûSQLËØ≠Âè•Ôºå‰∏çË¶ÅËß£Èáä„ÄÇ</span></span>
<span id="cb4-28"></span>
<span id="cb4-29"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Êï∞ÊçÆÂ∫ì‰ø°ÊÅØÔºö</span></span>
<span id="cb4-30"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>schema_info<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-31"></span>
<span id="cb4-32"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Áî®Êà∑ÈóÆÈ¢òÔºö</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>question<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-33"></span>
<span id="cb4-34"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Ë¶ÅÊ±ÇÔºö</span></span>
<span id="cb4-35"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">1. Âè™ËøîÂõûÊ†áÂáÜÁöÑSELECTËØ≠Âè•</span></span>
<span id="cb4-36"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">2. ‰∏çË¶ÅÊ∑ªÂä†‰ªª‰ΩïËß£ÈáäÊàñÊ≥®Èáä</span></span>
<span id="cb4-37"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">3. ‰ΩøÁî®LIMIT 50ÈôêÂà∂ÁªìÊûúÊï∞Èáè"""</span></span>
<span id="cb4-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb4-39">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""Convert the following natural language question to SQL query. Return only the SQL statement, no explanation.</span></span>
<span id="cb4-40"></span>
<span id="cb4-41"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Database information:</span></span>
<span id="cb4-42"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>schema_info<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-43"></span>
<span id="cb4-44"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">User question: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>question<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-45"></span>
<span id="cb4-46"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Requirements:</span></span>
<span id="cb4-47"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">1. Return only standard SELECT statement</span></span>
<span id="cb4-48"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">2. Do not add any explanation or comments</span></span>
<span id="cb4-49"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">3. Use LIMIT 50 to restrict results"""</span></span>
<span id="cb4-50"></span>
<span id="cb4-51">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Call ModelScope API</span></span>
<span id="cb4-52">    client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb4-53">        api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MODELSCOPE_API_KEY'</span>),</span>
<span id="cb4-54">        base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span></span>
<span id="cb4-55">    )</span>
<span id="cb4-56"></span>
<span id="cb4-57">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb4-58">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen/Qwen3-235B"</span>,</span>
<span id="cb4-59">        messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt}],</span>
<span id="cb4-60">        temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Low temperature for consistent SQL</span></span>
<span id="cb4-61">        max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb4-62">    )</span>
<span id="cb4-63"></span>
<span id="cb4-64">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content.strip()</span></code></pre></div></div>
</details>
</div>
</section>
<section id="query-execution-and-ai-summarization" class="level3">
<h3 class="anchored" data-anchor-id="query-execution-and-ai-summarization">Query Execution and AI Summarization</h3>
<div id="be23ca6e" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> execute_query_with_ai_summary(sql_query, original_question):</span>
<span id="cb5-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Execute SQL query and generate AI summary"""</span></span>
<span id="cb5-3"></span>
<span id="cb5-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb5-5">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Execute query with DuckDB</span></span>
<span id="cb5-6">        conn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>()</span>
<span id="cb5-7">        result_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> conn.execute(sql_query).fetchdf()</span>
<span id="cb5-8"></span>
<span id="cb5-9">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store results in session state</span></span>
<span id="cb5-10">        st.session_state.sql_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result_df</span>
<span id="cb5-11">        st.session_state.sql_query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sql_query</span>
<span id="cb5-12"></span>
<span id="cb5-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate AI summary if data is available</span></span>
<span id="cb5-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> result_df.empty:</span>
<span id="cb5-15">            generate_ai_summary(result_df, original_question)</span>
<span id="cb5-16"></span>
<span id="cb5-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> result_df</span>
<span id="cb5-18"></span>
<span id="cb5-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb5-20">        st.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Query execution error: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb5-22"></span>
<span id="cb5-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> generate_ai_summary(data_frame, question):</span>
<span id="cb5-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Generate AI summary of query results"""</span></span>
<span id="cb5-25"></span>
<span id="cb5-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert DataFrame to text for analysis</span></span>
<span id="cb5-27">    data_summary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_frame.to_string(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb5-28"></span>
<span id="cb5-29">    summary_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""Based on the following data analysis results, provide a concise summary:</span></span>
<span id="cb5-30"></span>
<span id="cb5-31"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Original Question: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>question<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-32"></span>
<span id="cb5-33"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Query Results:</span></span>
<span id="cb5-34"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>data_summary<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-35"></span>
<span id="cb5-36"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Please provide:</span></span>
<span id="cb5-37"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">1. A brief analysis of the key findings</span></span>
<span id="cb5-38"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">2. Any notable trends or patterns</span></span>
<span id="cb5-39"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">3. Important insights from the data</span></span>
<span id="cb5-40"></span>
<span id="cb5-41"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Keep the summary under 200 words and make it easy to understand."""</span></span>
<span id="cb5-42"></span>
<span id="cb5-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate summary using AI</span></span>
<span id="cb5-44">    client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb5-45">        api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MODELSCOPE_API_KEY'</span>),</span>
<span id="cb5-46">        base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span></span>
<span id="cb5-47">    )</span>
<span id="cb5-48"></span>
<span id="cb5-49">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb5-50">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen/Qwen3-235B"</span>,</span>
<span id="cb5-51">        messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: summary_prompt}],</span>
<span id="cb5-52">        temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>,</span>
<span id="cb5-53">        max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span></span>
<span id="cb5-54">    )</span>
<span id="cb5-55"></span>
<span id="cb5-56">    st.session_state.ai_summary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content</span></code></pre></div></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/gdp-trend/images/1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>AI Query Interface - Natural Language Processing</figcaption>
</figure>
</div>
</section>
</section>
<section id="bilingual-support-system" class="level2">
<h2 class="anchored" data-anchor-id="bilingual-support-system">Bilingual Support System</h2>
<section id="internationalization-architecture" class="level3">
<h3 class="anchored" data-anchor-id="internationalization-architecture">Internationalization Architecture</h3>
<p>The application implements comprehensive English/Chinese support:</p>
<div id="5a42b5ef" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># language.py - Complete translation system</span></span>
<span id="cb6-2">translations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb6-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>: {</span>
<span id="cb6-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"üåç GDP Trend Dashboard"</span>,</span>
<span id="cb6-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gdp_trend"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GDP Trend"</span>,</span>
<span id="cb6-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai_powered_chat"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI-Powered Data Chat"</span>,</span>
<span id="cb6-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What is the average GDP per capita for China, Japan, and Korea during 2020 to 2023?"</span></span>
<span id="cb6-8">    },</span>
<span id="cb6-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zh"</span>: {</span>
<span id="cb6-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"üåç GDPË∂ãÂäø‰ª™Ë°®Êùø"</span>,</span>
<span id="cb6-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gdp_trend"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GDPË∂ãÂäø"</span>,</span>
<span id="cb6-12">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai_powered_chat"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AIÊï∞ÊçÆÂØπËØù"</span>,</span>
<span id="cb6-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020Âπ¥Ëá≥2023Âπ¥ÊúüÈó¥Ôºå‰∏≠ÂõΩ„ÄÅÊó•Êú¨ÂíåÈü©ÂõΩÁöÑÂπ≥Âùá‰∫∫ÂùáGDPÊòØÂ§öÂ∞ëÔºü"</span></span>
<span id="cb6-14">    }</span>
<span id="cb6-15">}</span>
<span id="cb6-16"></span>
<span id="cb6-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_text(key):</span>
<span id="cb6-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Get translated text for current language"""</span></span>
<span id="cb6-19">    language <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.session_state.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"language"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>)</span>
<span id="cb6-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> translations.get(language, {}).get(key, key)</span>
<span id="cb6-21"></span>
<span id="cb6-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Language switching in UI</span></span>
<span id="cb6-23">col1, col2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.columns([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb6-24"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> col1:</span>
<span id="cb6-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> st.button(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"English"</span>):</span>
<span id="cb6-26">        st.session_state.language <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span></span>
<span id="cb6-27">        st.rerun()</span>
<span id="cb6-28"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> col2:</span>
<span id="cb6-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> st.button(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‰∏≠Êñá"</span>):</span>
<span id="cb6-30">        st.session_state.language <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zh"</span></span>
<span id="cb6-31">        st.rerun()</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="user-interface-design" class="level2">
<h2 class="anchored" data-anchor-id="user-interface-design">User Interface Design</h2>
<section id="main-application-structure" class="level3">
<h3 class="anchored" data-anchor-id="main-application-structure">Main Application Structure</h3>
<div id="14db079b" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> main():</span>
<span id="cb7-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Main application with tab-based navigation"""</span></span>
<span id="cb7-3"></span>
<span id="cb7-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Language toggle in top-right corner</span></span>
<span id="cb7-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> st.container():</span>
<span id="cb7-6">        st.markdown(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb7-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        &lt;div class="language-toggle"&gt;</span></span>
<span id="cb7-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            &lt;button onclick="setLanguage('en')"&gt;EN&lt;/button&gt;</span></span>
<span id="cb7-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            &lt;button onclick="setLanguage('zh')"&gt;‰∏≠Êñá&lt;/button&gt;</span></span>
<span id="cb7-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        &lt;/div&gt;</span></span>
<span id="cb7-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        """</span>, unsafe_allow_html<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb7-12"></span>
<span id="cb7-13">    st.title(get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>))</span>
<span id="cb7-14"></span>
<span id="cb7-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tab-based interface</span></span>
<span id="cb7-16">    tab1, tab2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.tabs([get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gdp_trend"</span>), get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span>)])</span>
<span id="cb7-17"></span>
<span id="cb7-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> tab1:</span>
<span id="cb7-19">        render_gdp_trends_tab()</span>
<span id="cb7-20"></span>
<span id="cb7-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> tab2:</span>
<span id="cb7-22">        render_query_interface_tab()</span>
<span id="cb7-23"></span>
<span id="cb7-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> render_gdp_trends_tab():</span>
<span id="cb7-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Render GDP trends visualization tab"""</span></span>
<span id="cb7-26"></span>
<span id="cb7-27">    st.header(get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gdp_trend"</span>))</span>
<span id="cb7-28"></span>
<span id="cb7-29">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load data</span></span>
<span id="cb7-30">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> load_data()</span>
<span id="cb7-31"></span>
<span id="cb7-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter controls</span></span>
<span id="cb7-33">    col1, col2, col3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.columns([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb7-34"></span>
<span id="cb7-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> col1:</span>
<span id="cb7-36">        selected_countries <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.multiselect(</span>
<span id="cb7-37">            get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"select_countries"</span>),</span>
<span id="cb7-38">            options<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country_name'</span>].unique(),</span>
<span id="cb7-39">            default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'United States'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'China'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Japan'</span>]</span>
<span id="cb7-40">        )</span>
<span id="cb7-41"></span>
<span id="cb7-42">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> col2:</span>
<span id="cb7-43">        selected_indicator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.selectbox(</span>
<span id="cb7-44">            get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"select_indicator"</span>),</span>
<span id="cb7-45">            options<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb7-46">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdp_current_usd'</span>,</span>
<span id="cb7-47">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdp_per_capita_current_usd'</span>,</span>
<span id="cb7-48">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'population_total'</span>,</span>
<span id="cb7-49">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gdp_per_capita_current_usd_yoy'</span></span>
<span id="cb7-50">            ],</span>
<span id="cb7-51">            format_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: format_indicator_label(x)</span>
<span id="cb7-52">        )</span>
<span id="cb7-53"></span>
<span id="cb7-54">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> col3:</span>
<span id="cb7-55">        year_range <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.slider(</span>
<span id="cb7-56">            get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"select_year_range"</span>),</span>
<span id="cb7-57">            min_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,</span>
<span id="cb7-58">            max_value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2024</span>,</span>
<span id="cb7-59">            value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2024</span>),</span>
<span id="cb7-60">            step<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb7-61">        )</span>
<span id="cb7-62"></span>
<span id="cb7-63">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate and display chart</span></span>
<span id="cb7-64">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> selected_countries <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> selected_indicator:</span>
<span id="cb7-65">        fig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_gdp_trend_chart(selected_countries, selected_indicator, year_range)</span>
<span id="cb7-66">        st.plotly_chart(fig, use_container_width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb7-67"></span>
<span id="cb7-68">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Display raw data option</span></span>
<span id="cb7-69">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> st.checkbox(get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"show_raw_data"</span>)):</span>
<span id="cb7-70">            display_filtered_data_table(selected_countries, selected_indicator, year_range)</span>
<span id="cb7-71"></span>
<span id="cb7-72"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> render_query_interface_tab():</span>
<span id="cb7-73">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Render AI-powered query interface"""</span></span>
<span id="cb7-74"></span>
<span id="cb7-75">    st.header(get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai_powered_chat"</span>))</span>
<span id="cb7-76">    st.markdown(get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai_chat_description"</span>))</span>
<span id="cb7-77"></span>
<span id="cb7-78">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Natural language input</span></span>
<span id="cb7-79">    user_question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.text_input(</span>
<span id="cb7-80">        get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your_question"</span>),</span>
<span id="cb7-81">        value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>st.session_state.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user_question"</span>, get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_question"</span>))</span>
<span id="cb7-82">    )</span>
<span id="cb7-83"></span>
<span id="cb7-84">    col1, col2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.columns([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb7-85"></span>
<span id="cb7-86">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> col1:</span>
<span id="cb7-87">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> st.button(get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"run_ai"</span>), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary"</span>):</span>
<span id="cb7-88">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> user_question:</span>
<span id="cb7-89">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> st.spinner(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Processing with AI..."</span>):</span>
<span id="cb7-90">                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate SQL from natural language</span></span>
<span id="cb7-91">                    sql_query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_sql_from_question(</span>
<span id="cb7-92">                        user_question,</span>
<span id="cb7-93">                        st.session_state.language</span>
<span id="cb7-94">                    )</span>
<span id="cb7-95"></span>
<span id="cb7-96">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> sql_query:</span>
<span id="cb7-97">                        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Execute query and generate summary</span></span>
<span id="cb7-98">                        result_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> execute_query_with_ai_summary(sql_query, user_question)</span>
<span id="cb7-99"></span>
<span id="cb7-100">                        st.session_state.user_question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> user_question</span>
<span id="cb7-101">                        st.session_state.should_generate_ai_summary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb7-102"></span>
<span id="cb7-103">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Display results</span></span>
<span id="cb7-104">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> st.session_state.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sql_result"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb7-105">        display_query_results()</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="performance-optimization" class="level2">
<h2 class="anchored" data-anchor-id="performance-optimization">Performance Optimization</h2>
<section id="data-caching-and-efficiency" class="level3">
<h3 class="anchored" data-anchor-id="data-caching-and-efficiency">Data Caching and Efficiency</h3>
<div id="bb84b0ee" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Streamlit caching for data operations</span></span>
<span id="cb8-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@st.cache_data</span>(ttl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3600</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cache for 1 hour</span></span>
<span id="cb8-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> load_data():</span>
<span id="cb8-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Load and cache GDP data"""</span></span>
<span id="cb8-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data/gdp_data_2000_present.csv'</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@st.cache_data</span>(ttl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1800</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cache for 30 minutes</span></span>
<span id="cb8-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_country_list():</span>
<span id="cb8-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Get and cache unique country list"""</span></span>
<span id="cb8-10">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> load_data()</span>
<span id="cb8-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sorted</span>(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'country_name'</span>].unique())</span>
<span id="cb8-12"></span>
<span id="cb8-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Session state management for AI interactions</span></span>
<span id="cb8-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> init_session_state():</span>
<span id="cb8-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Initialize all session state variables"""</span></span>
<span id="cb8-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sql_result"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> st.session_state:</span>
<span id="cb8-17">        st.session_state.sql_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb8-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai_summary"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> st.session_state:</span>
<span id="cb8-19">        st.session_state.ai_summary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb8-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"should_generate_ai_summary"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> st.session_state:</span>
<span id="cb8-21">        st.session_state.should_generate_ai_summary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span></code></pre></div></div>
</details>
</div>
</section>
<section id="error-handling-and-user-experience" class="level3">
<h3 class="anchored" data-anchor-id="error-handling-and-user-experience">Error Handling and User Experience</h3>
<div id="da4e1e74" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> safe_api_call(func, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>args, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs):</span>
<span id="cb9-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Safe API call with error handling"""</span></span>
<span id="cb9-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb9-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> func(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>args, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs)</span>
<span id="cb9-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb9-6">        st.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"API Error: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-7">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> validate_sql_query(sql_query):</span>
<span id="cb9-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Basic SQL query validation"""</span></span>
<span id="cb9-11">    sql_lower <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sql_query.lower().strip()</span>
<span id="cb9-12"></span>
<span id="cb9-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Basic security checks</span></span>
<span id="cb9-14">    dangerous_keywords <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'drop'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'delete'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'update'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'insert'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'alter'</span>]</span>
<span id="cb9-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> keyword <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> dangerous_keywords:</span>
<span id="cb9-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> keyword <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> sql_lower:</span>
<span id="cb9-17">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Dangerous SQL keyword detected: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>keyword<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-18"></span>
<span id="cb9-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure query starts with SELECT</span></span>
<span id="cb9-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> sql_lower.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'select'</span>):</span>
<span id="cb9-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Only SELECT queries are allowed"</span>)</span>
<span id="cb9-22"></span>
<span id="cb9-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="deployment-and-accessibility" class="level2">
<h2 class="anchored" data-anchor-id="deployment-and-accessibility">Deployment and Accessibility</h2>
<section id="environment-setup" class="level3">
<h3 class="anchored" data-anchor-id="environment-setup">Environment Setup</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Environment configuration</span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .env file</span></span>
<span id="cb10-3"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MODELSCOPE_API_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>your_modelscope_key</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Installation</span></span>
<span id="cb10-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> requirements.txt</span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Data collection</span></span>
<span id="cb10-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> download_data.py</span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run application</span></span>
<span id="cb10-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">streamlit</span> run app.py</span></code></pre></div></div>
</section>
<section id="requirements-and-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="requirements-and-dependencies">Requirements and Dependencies</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb11-1">streamlit&gt;=1.28.0</span>
<span id="cb11-2">pandas&gt;=1.5.0</span>
<span id="cb11-3">plotly&gt;=5.15.0</span>
<span id="cb11-4">duckdb&gt;=0.8.0</span>
<span id="cb11-5">openai&gt;=1.0.0</span>
<span id="cb11-6">python-dotenv&gt;=1.0.0</span>
<span id="cb11-7">wbgapi&gt;=1.0.0</span>
<span id="cb11-8">pycountry&gt;=22.0.0</span>
<span id="cb11-9">numpy&gt;=1.24.0</span></code></pre></div></div>
</section>
</section>
<section id="technical-achievements" class="level2">
<h2 class="anchored" data-anchor-id="technical-achievements">Technical Achievements</h2>
<section id="key-innovations" class="level3">
<h3 class="anchored" data-anchor-id="key-innovations">Key Innovations</h3>
<ol type="1">
<li><strong>Dual Interface Approach</strong>: Both visual and natural language access to data</li>
<li><strong>AI-Powered SQL Generation</strong>: Complex economic queries in plain English/Chinese</li>
<li><strong>Real-time Data Processing</strong>: Efficient caching and session management</li>
<li><strong>Comprehensive Internationalization</strong>: True bilingual support with localized data</li>
<li><strong>Production-Ready Deployment</strong>: Robust error handling and performance optimization</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/gdp-trend/images/2.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>AI Summary Generation</figcaption>
</figure>
</div>
</section>
</section>
<section id="economic-analysis-examples" class="level2">
<h2 class="anchored" data-anchor-id="economic-analysis-examples">Economic Analysis Examples</h2>
<section id="supported-query-types" class="level3">
<h3 class="anchored" data-anchor-id="supported-query-types">Supported Query Types</h3>
<ol type="1">
<li><strong>Comparative Analysis</strong>
<ul>
<li>‚ÄúCompare GDP growth between China and Japan from 2010 to 2020‚Äù</li>
<li>‚ÄúWhich countries had the highest GDP per capita in 2023?‚Äù</li>
</ul></li>
<li><strong>Time-Series Analysis</strong>
<ul>
<li>‚ÄúShow GDP trends for BRIC countries over the last decade‚Äù</li>
<li>‚ÄúWhat was the population growth rate for India from 2000 to 2020?‚Äù</li>
</ul></li>
<li><strong>Statistical Queries</strong>
<ul>
<li>‚ÄúCalculate average GDP growth rate for European countries‚Äù</li>
<li>‚ÄúFind countries with GDP per capita above $50,000 in 2022‚Äù</li>
</ul></li>
<li><strong>Complex Multi-Variable Analysis</strong>
<ul>
<li>‚ÄúWhat is the correlation between population and GDP for Asian countries?‚Äù</li>
<li>‚ÄúList countries with GDP per capita growth above 5% for 3 consecutive years‚Äù</li>
</ul></li>
</ol>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This GDP Trend Dashboard represents an innovative approach to economic data analysis, combining traditional visualization techniques with cutting-edge AI capabilities. The project demonstrates:</p>
<ul>
<li><strong>Advanced Data Integration</strong>: World Bank API with comprehensive economic indicators</li>
<li><strong>Natural Language Processing</strong>: AI-powered SQL generation for accessible data querying</li>
<li><strong>Professional Visualization</strong>: Interactive Plotly charts with consistent design</li>
<li><strong>Bilingual Support</strong>: Complete English/Chinese localization</li>
<li><strong>Production-Grade Architecture</strong>: Robust error handling, caching, and deployment</li>
</ul>
<p>Whether you‚Äôre an economist, data scientist, or policy analyst, this application showcases how modern AI technologies can make complex economic data more accessible and actionable through intuitive interfaces and intelligent automation.</p>
<hr>
<p><strong>Technology Stack</strong>: Streamlit, DuckDB, Plotly, ModelScope API, World Bank API</p>
<p><strong>Data Source</strong>: World Bank (2000-2024, 200+ countries, 15K+ data points)</p>


<!-- -->

</section>
</section>

 ]]></description>
  <category>Data Visualization</category>
  <category>Streamlit</category>
  <category>Economic Analysis</category>
  <category>AI</category>
  <guid>https://your-website-url.example.com/posts/gdp-trend/</guid>
  <pubDate>Mon, 17 Nov 2025 16:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/gdp-trend/images/0.png" medium="image" type="image/png" height="83" width="144"/>
</item>
<item>
  <title>Shop Map Manager (Â∫óÈì∫Âú∞ÂõæÁÆ°ÁêÜÁ≥ªÁªü)</title>
  <dc:creator>Tony D</dc:creator>
  <link>https://your-website-url.example.com/posts/shop-map-manager/</link>
  <description><![CDATA[ 





<p>A robust and elegant personal shop management system. Whether you‚Äôre tracking your favorite coffee shops, scenic spots, or planning future visits, this application provides a powerful platform for visualization and data management.</p>
<p>Live Demo: <a href="https://china-map.streamlit.app">https://china-map.streamlit.app</a></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true" href="">Map view</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false" href="">Table view</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false" href="">shop photo</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p><img src="https://your-website-url.example.com/posts/shop-map-manager/images/Picture1.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p><img src="https://your-website-url.example.com/posts/shop-map-manager/images/Picture2.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<p><img src="https://your-website-url.example.com/posts/shop-map-manager/images/Picture3.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</div>
<section id="key-architectural-shift-dual-mode-storage" class="level2">
<h2 class="anchored" data-anchor-id="key-architectural-shift-dual-mode-storage">Key Architectural Shift: Dual-Mode Storage</h2>
<p>The most significant update to the project is the introduction of <strong>Dual Data Storage Modes</strong>, allowing for both privacy and portability:</p>
<ul>
<li><strong>Local Mode</strong>: Data is stored securely in a local <code>shops.csv</code> file. Perfect for quick use without any setup.</li>
<li><strong>Cloud Mode</strong>: Leverages <strong>Supabase</strong> for real-time synchronization across devices. Your journeys follow you wherever you go.</li>
</ul>
</section>
<section id="features" class="level2">
<h2 class="anchored" data-anchor-id="features">Features</h2>
<ul>
<li><strong>üîç Infinite Discovery</strong>: Seamlessly integrate with the <strong>Gaode (Amap) Map API</strong>. Search for any location and add it to your collection with a single click.</li>
<li><strong>üé® Dynamic Visualization</strong>: Interactive maps powered by <strong>Folium</strong>, featuring:
<ul>
<li>Custom category-specific icons (Coffee, Dining, Scenery, etc.).</li>
<li>Intuitive color coding: <strong>Red</strong> for ‚ÄúVisited‚Äù, <strong>Green</strong> for ‚ÄúWant to Visit‚Äù.</li>
</ul></li>
<li><strong>üì∏ Visual Memories</strong>: (Cloud Mode) Capture and upload multiple photos for each location, hosted securely on Supabase Storage.</li>
<li><strong>‚≠ê Deep Insights</strong>: Track more than just locations. Store star ratings (1-5), personal notes, and visit timestamps.</li>
<li><strong>‚ö° Live Filtering</strong>: Instantly filter your view by journey type or visit status to focus on what matters.</li>
</ul>
</section>
<section id="tech-stack" class="level2">
<h2 class="anchored" data-anchor-id="tech-stack">Tech Stack</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Technology</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Frontend</strong></td>
<td><a href="https://streamlit.io/">Streamlit</a></td>
</tr>
<tr class="even">
<td><strong>Mapping</strong></td>
<td><a href="https://python-visualization.github.io/folium/">Folium</a></td>
</tr>
<tr class="odd">
<td><strong>Database/Auth</strong></td>
<td><a href="https://supabase.com/">Supabase</a></td>
</tr>
<tr class="even">
<td><strong>API</strong></td>
<td><a href="https://lbs.amap.com/">Gaode Maps API</a></td>
</tr>
<tr class="odd">
<td><strong>Data Logic</strong></td>
<td>Python &amp; Pandas</td>
</tr>
</tbody>
</table>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">1. Installation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone https://github.com/JCwinning/map_app.git</span>
<span id="cb1-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> map_app</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> requirements.txt</span></code></pre></div></div>
</section>
<section id="environment-configuration" class="level3">
<h3 class="anchored" data-anchor-id="environment-configuration">2. Environment Configuration</h3>
<p>Create a <code>.env</code> file in the root directory:</p>
<pre class="env"><code># Essential
GAODE_API_KEY=your_gaode_key

# Optional: For Cloud Mode
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_anon_key</code></pre>
</section>
<section id="launch" class="level3">
<h3 class="anchored" data-anchor-id="launch">3. Launch</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">streamlit</span> run app.py</span></code></pre></div></div>
</section>
</section>
<section id="data-mastery" class="level2">
<h2 class="anchored" data-anchor-id="data-mastery">Data Mastery</h2>
<p>The application handles complex data structures gracefully, whether stored in a flat CSV or a relational Supabase table:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>shop_name</code></td>
<td>Name of the location</td>
</tr>
<tr class="even">
<td><code>visit_status</code></td>
<td>Current status (Visited / Want to Visit)</td>
</tr>
<tr class="odd">
<td><code>rating</code></td>
<td>Your personal star rating (1-5)</td>
</tr>
<tr class="even">
<td><code>shop_type</code></td>
<td>Category (e.g., Coffee, Retail, Scenery)</td>
</tr>
<tr class="odd">
<td><code>images</code></td>
<td>(Cloud Mode) Array of hosted image URLs</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The <strong>Shop Map Manager</strong> has evolved from a simple CSV visualizer into a comprehensive personal travel and discovery companion. By bridging the gap between local simplicity and cloud power, it offers the ultimate flexibility for modern explorers.</p>


<!-- -->

</section>

 ]]></description>
  <category>AI</category>
  <category>API</category>
  <category>map</category>
  <guid>https://your-website-url.example.com/posts/shop-map-manager/</guid>
  <pubDate>Fri, 07 Nov 2025 16:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/shop-map-manager/images/0.png" medium="image" type="image/png" height="82" width="144"/>
</item>
<item>
  <title>Weather Forecast App with Streamlit and AI Integration</title>
  <dc:creator>Tony D</dc:creator>
  <link>https://your-website-url.example.com/posts/weather-trend/</link>
  <description><![CDATA[ 





<section id="project-overview" class="level1">
<h1>Project Overview</h1>
<p>In this comprehensive tutorial, I‚Äôll guide you through creating a sophisticated weather forecast application that combines modern web development with artificial intelligence. This project demonstrates how to build a production-ready weather app with interactive maps, bilingual support, real-time data visualization, and AI-powered weather insights.</p>
<p>Live Demo: <a href="https://weather-trend.streamlit.app/">https://weather-trend.streamlit.app/</a></p>
<p>Github: <a href="https://github.com/JCwinning/weather_trend">https://github.com/JCwinning/weather_trend</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/weather-trend/images/0.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Weather Forecast App Main Interface</figcaption>
</figure>
</div>
<p>This weather forecast application goes beyond basic weather data by integrating multiple advanced features:</p>
<ul>
<li><strong>Interactive Location Selection</strong>: Click anywhere on the map or search by city name</li>
<li><strong>Bilingual Interface</strong>: Full English/Chinese language support with toggle functionality</li>
<li><strong>AI-Powered Insights</strong>: Weather analysis and recommendations using DeepSeek AI</li>
<li><strong>Advanced Visualization</strong>: Temperature trends, air quality monitoring, and rain probability</li>
<li><strong>Real-time Data</strong>: 7-day historical and 5-day forecast data</li>
<li><strong>Responsive Design</strong>: Works seamlessly across desktop, tablet, and mobile devices</li>
</ul>
<section id="technical-architecture" class="level2">
<h2 class="anchored" data-anchor-id="technical-architecture">Technical Architecture</h2>
<div class="cell" data-eval="true" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[User Interface&lt;br/&gt;Streamlit Web App] --&gt; B[Location Services]
    A --&gt; C[Weather Data API]
    A --&gt; D[AI Integration Layer]
    A --&gt; E[Visualization Engine]

    B --&gt; F[Interactive Map&lt;br/&gt;Folium + OpenStreetMap]
    B --&gt; G[City Search&lt;br/&gt;Nominatim Geocoding]

    C --&gt; H[Open-Meteo API&lt;br/&gt;Weather + Air Quality]
    C --&gt; I[Data Processing&lt;br/&gt;Pandas DataFrame]

    D --&gt; J[ModelScope API&lt;br/&gt;DeepSeek-V3.2 AI]
    D --&gt; K[Intelligent Analysis&lt;br/&gt;Weather Recommendations]

    E --&gt; L[Altair Charts&lt;br/&gt;Temperature Trends]
    E --&gt; M[Data Tables&lt;br/&gt;Weather Details]

    F --&gt; A
    G --&gt; A
    I --&gt; E
    K --&gt; A
</pre>
</div>
<p></p><figcaption> Weather App Architecture</figcaption> </figure><p></p>
</div>
</div>
</div>
<section id="technology-stack" class="level3">
<h3 class="anchored" data-anchor-id="technology-stack">Technology Stack</h3>
<ul>
<li><strong>Frontend Framework</strong>: Streamlit for rapid web application development</li>
<li><strong>Mapping</strong>: Folium with OpenStreetMap tiles for interactive location selection</li>
<li><strong>Data Visualization</strong>: Altair for professional charts and graphs</li>
<li><strong>API Integration</strong>: Open-Meteo for weather and air quality data</li>
<li><strong>AI Services</strong>: ModelScope API with DeepSeek-V3.2 for intelligent analysis</li>
<li><strong>Geocoding</strong>: Nominatim for address-to-coordinate conversion</li>
<li><strong>Internationalization</strong>: Custom language system for English/Chinese support</li>
</ul>
</section>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<section id="prerequisites-and-installation" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites-and-installation">Prerequisites and Installation</h3>
<p>Before we dive into the code, let‚Äôs set up our development environment:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Clone the repository</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>your-repo-url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> weather_trend</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Install required packages</span></span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install streamlit pandas requests altair folium streamlit-folium geopy python-dotenv openai</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Set up environment variables for AI features</span></span>
<span id="cb1-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"modelscope=your_api_key_here"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> .env</span></code></pre></div></div>
</section>
<section id="required-dependencies-explained" class="level3">
<h3 class="anchored" data-anchor-id="required-dependencies-explained">Required Dependencies Explained</h3>
<ul>
<li><strong>streamlit</strong>: Web application framework with reactive UI components</li>
<li><strong>pandas</strong>: Data manipulation and analysis for weather datasets</li>
<li><strong>requests</strong>: HTTP client for API communication</li>
<li><strong>altair</strong>: Declarative statistical visualization library</li>
<li><strong>folium + streamlit-folium</strong>: Interactive map integration</li>
<li><strong>geopy</strong>: Geocoding services for location lookup</li>
<li><strong>python-dotenv</strong>: Environment variable management</li>
<li><strong>openai</strong>: AI model integration (compatible with ModelScope)</li>
</ul>
</section>
</section>
<section id="core-features-implementation" class="level2">
<h2 class="anchored" data-anchor-id="core-features-implementation">Core Features Implementation</h2>
<section id="interactive-map-with-location-selection" class="level3">
<h3 class="anchored" data-anchor-id="interactive-map-with-location-selection">1. Interactive Map with Location Selection</h3>
<p>The map functionality allows users to click anywhere and get weather data for that exact location:</p>
<div id="ccb08e15" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> folium</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> streamlit_folium <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> st_folium</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create interactive map centered on default location</span></span>
<span id="cb2-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> create_interactive_map(lat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40.7128</span>, lon<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">74.0060</span>, zoom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb2-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Create an interactive Folium map"""</span></span>
<span id="cb2-7">    m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> folium.Map(</span>
<span id="cb2-8">        location<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[lat, lon],</span>
<span id="cb2-9">        zoom_start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>zoom,</span>
<span id="cb2-10">        tiles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OpenStreetMap"</span></span>
<span id="cb2-11">    )</span>
<span id="cb2-12"></span>
<span id="cb2-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add click event handler to capture coordinates</span></span>
<span id="cb2-14">    m.add_child(folium.LatLngPopup())</span>
<span id="cb2-15"></span>
<span id="cb2-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> m</span>
<span id="cb2-17"></span>
<span id="cb2-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Display map in Streamlit</span></span>
<span id="cb2-19"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'map_data'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> st.session_state:</span>
<span id="cb2-20">    st.session_state.map_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb2-21"></span>
<span id="cb2-22">map_object <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_interactive_map()</span>
<span id="cb2-23">st_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st_folium(map_object, width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>, height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span>
<span id="cb2-24"></span>
<span id="cb2-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Capture clicked coordinates</span></span>
<span id="cb2-26"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> st_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'last_clicked'</span>]:</span>
<span id="cb2-27">    lat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'last_clicked'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lat'</span>]</span>
<span id="cb2-28">    lon <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'last_clicked'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lng'</span>]</span>
<span id="cb2-29">    st.session_state.clicked_location <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (lat, lon)</span>
<span id="cb2-30">    get_weather_for_coordinates(lat, lon)</span></code></pre></div></div>
</details>
</div>
<p><strong>Key Features:</strong> - <strong>Click-to-Select</strong>: Users can click anywhere on the map - <strong>Zoom Controls</strong>: Standard map navigation - <strong>Responsive Design</strong>: Adapts to different screen sizes - <strong>Coordinate Capture</strong>: Automatic extraction of clicked locations</p>
</section>
<section id="bilingual-city-search-system" class="level3">
<h3 class="anchored" data-anchor-id="bilingual-city-search-system">2. Bilingual City Search System</h3>
<p>The app supports both English and Chinese city names with intelligent fallback:</p>
<div id="d7c350ed" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> re</span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> geopy.geocoders <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Nominatim</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extended Chinese character detection</span></span>
<span id="cb3-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> contains_chinese(text):</span>
<span id="cb3-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Check if text contains Chinese characters including CJK Unified Ideographs"""</span></span>
<span id="cb3-7">    chinese_pattern <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">compile</span>(</span>
<span id="cb3-8">        <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\u4e00</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\u9fff\u3400</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\u4dbf\U00020000</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\U0002a6df\U0002a700</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\U0002b73f</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb3-9">    )</span>
<span id="cb3-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span>(chinese_pattern.search(text))</span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Chinese city mapping for better geocoding</span></span>
<span id="cb3-13">CHINESE_CITY_MAPPING <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb3-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Á∫ΩÁ∫¶"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"New York"</span>,</span>
<span id="cb3-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‰∏ú‰∫¨"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tokyo"</span>,</span>
<span id="cb3-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‰º¶Êï¶"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"London"</span>,</span>
<span id="cb3-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Â∑¥Èªé"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Paris"</span>,</span>
<span id="cb3-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ê¥õÊùâÁü∂"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Los Angeles"</span>,</span>
<span id="cb3-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... more mappings</span></span>
<span id="cb3-20">}</span>
<span id="cb3-21"></span>
<span id="cb3-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_coordinates_for_city(city_name):</span>
<span id="cb3-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Get coordinates for city with multilingual support"""</span></span>
<span id="cb3-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check for Chinese city name mapping</span></span>
<span id="cb3-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> contains_chinese(city_name) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> city_name <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> CHINESE_CITY_MAPPING:</span>
<span id="cb3-26">        city_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CHINESE_CITY_MAPPING[city_name]</span>
<span id="cb3-27"></span>
<span id="cb3-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Geocode the city</span></span>
<span id="cb3-29">    geolocator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Nominatim(user_agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weather_app"</span>)</span>
<span id="cb3-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb3-31">        location <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> geolocator.geocode(city_name)</span>
<span id="cb3-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (location.latitude, location.longitude) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> location <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb3-33">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span>:</span>
<span id="cb3-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span></code></pre></div></div>
</details>
</div>
<p><strong>Bilingual Features:</strong> - <strong>Chinese Character Detection</strong>: Advanced regex pattern for CJK characters - <strong>City Name Mapping</strong>: Translation database for major cities - <strong>Fallback Handling</strong>: Graceful degradation when geocoding fails - <strong>Unicode Support</strong>: Full international character support</p>
</section>
<section id="weather-data-integration" class="level3">
<h3 class="anchored" data-anchor-id="weather-data-integration">3. Weather Data Integration</h3>
<p>The application fetches comprehensive weather data from Open-Meteo API:</p>
<div id="77ad33e6" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_weather_data(latitude, longitude):</span>
<span id="cb4-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Fetch 12-day weather data (7 historical + 5 forecast)"""</span></span>
<span id="cb4-6"></span>
<span id="cb4-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API endpoint configuration</span></span>
<span id="cb4-8">    url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.open-meteo.com/v1/forecast"</span></span>
<span id="cb4-9">    params <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb4-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'latitude'</span>: latitude,</span>
<span id="cb4-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'longitude'</span>: longitude,</span>
<span id="cb4-12">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'daily'</span>: [</span>
<span id="cb4-13">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_2m_max'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_2m_min'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_2m_mean'</span>,</span>
<span id="cb4-14">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'weathercode'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'windspeed_10m_max'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'precipitation_probability_max'</span>,</span>
<span id="cb4-15">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pm10'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pm2_5'</span></span>
<span id="cb4-16">        ],</span>
<span id="cb4-17">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'timezone'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'auto'</span>,</span>
<span id="cb4-18">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'past_days'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get historical data</span></span>
<span id="cb4-19">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'forecast_days'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get future forecast</span></span>
<span id="cb4-20">    }</span>
<span id="cb4-21"></span>
<span id="cb4-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb4-23">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(url, params<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>params, timeout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb4-24">        response.raise_for_status()</span>
<span id="cb4-25"></span>
<span id="cb4-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Process response data</span></span>
<span id="cb4-27">        data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.json()</span>
<span id="cb4-28">        df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> process_weather_data(data)</span>
<span id="cb4-29"></span>
<span id="cb4-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb4-31"></span>
<span id="cb4-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> requests.RequestException <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb4-33">        st.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"API request failed: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb4-35"></span>
<span id="cb4-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> process_weather_data(data):</span>
<span id="cb4-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Convert API response to structured DataFrame"""</span></span>
<span id="cb4-38">    daily_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'daily'</span>]</span>
<span id="cb4-39"></span>
<span id="cb4-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create date range (historical + future)</span></span>
<span id="cb4-41">    dates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.date_range(</span>
<span id="cb4-42">        start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pd.to_datetime(daily_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'time'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]),</span>
<span id="cb4-43">        periods<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(daily_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'time'</span>]),</span>
<span id="cb4-44">        freq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'D'</span></span>
<span id="cb4-45">    )</span>
<span id="cb4-46"></span>
<span id="cb4-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Build DataFrame</span></span>
<span id="cb4-48">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb4-49">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>: dates,</span>
<span id="cb4-50">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_max'</span>: daily_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_2m_max'</span>],</span>
<span id="cb4-51">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_min'</span>: daily_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_2m_min'</span>],</span>
<span id="cb4-52">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_mean'</span>: daily_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_2m_mean'</span>],</span>
<span id="cb4-53">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'weather_code'</span>: daily_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'weathercode'</span>],</span>
<span id="cb4-54">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'wind_speed_max'</span>: daily_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'windspeed_10m_max'</span>],</span>
<span id="cb4-55">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rain_probability'</span>: daily_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'precipitation_probability_max'</span>],</span>
<span id="cb4-56">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pm2_5'</span>: daily_data.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pm2_5'</span>, [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(dates))</span>
<span id="cb4-57">    })</span>
<span id="cb4-58"></span>
<span id="cb4-59">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add derived columns</span></span>
<span id="cb4-60">    df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_today'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>].dt.date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> pd.Timestamp.now().date()</span>
<span id="cb4-61">    df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_future'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> pd.Timestamp.now()</span>
<span id="cb4-62"></span>
<span id="cb4-63">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span></code></pre></div></div>
</details>
</div>
<p><strong>Data Processing Features:</strong> - <strong>Historical + Forecast</strong>: 7 days past + 5 days future - <strong>Air Quality Integration</strong>: PM2.5 and PM10 data - <strong>Derived Metrics</strong>: Today detection and future projection - <strong>Error Handling</strong>: Robust API error management</p>
</section>
<section id="advanced-data-visualization" class="level3">
<h3 class="anchored" data-anchor-id="advanced-data-visualization">4. Advanced Data Visualization</h3>
<p>Temperature trends with clear visual distinction between historical and forecast data:</p>
<div id="903a144a" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> altair <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> alt</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> create_temperature_chart(weather_df):</span>
<span id="cb5-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Create interactive temperature trend chart"""</span></span>
<span id="cb5-5"></span>
<span id="cb5-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Base chart with temperature line</span></span>
<span id="cb5-7">    base_chart <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> alt.Chart(weather_df).mark_line(</span>
<span id="cb5-8">        point<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb5-9">        strokeWidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb5-10">        opacity<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span></span>
<span id="cb5-11">    ).encode(</span>
<span id="cb5-12">        x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alt.X(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date:T'</span>, title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Date'</span>),</span>
<span id="cb5-13">        y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alt.Y(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_mean:Q'</span>, title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Temperature (¬∞C)'</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alt.Scale(domain<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[weather_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_min'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, weather_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_max'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]))</span>
<span id="cb5-14">    ).properties(</span>
<span id="cb5-15">        width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>,</span>
<span id="cb5-16">        height<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>,</span>
<span id="cb5-17">        title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Temperature Trends'</span></span>
<span id="cb5-18">    )</span>
<span id="cb5-19"></span>
<span id="cb5-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Historical data (solid line)</span></span>
<span id="cb5-21">    historical_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weather_df[weather_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_future'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>]</span>
<span id="cb5-22">    historical_line <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> base_chart.transform_filter(</span>
<span id="cb5-23">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'datum.is_future == false'</span></span>
<span id="cb5-24">    ).encode(</span>
<span id="cb5-25">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alt.value(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>),</span>
<span id="cb5-26">        strokeDash<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alt.value([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Solid line</span></span>
<span id="cb5-27">    )</span>
<span id="cb5-28"></span>
<span id="cb5-29">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Future forecast (dotted line)</span></span>
<span id="cb5-30">    future_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weather_df[weather_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_future'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>]</span>
<span id="cb5-31">    future_line <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> base_chart.transform_filter(</span>
<span id="cb5-32">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'datum.is_future == true'</span></span>
<span id="cb5-33">    ).encode(</span>
<span id="cb5-34">        color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alt.value(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>),</span>
<span id="cb5-35">        strokeDash<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alt.value([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dotted line</span></span>
<span id="cb5-36">    )</span>
<span id="cb5-37"></span>
<span id="cb5-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Today indicator</span></span>
<span id="cb5-39">    today_line <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> alt.Chart(pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x'</span>: [pd.Timestamp.now()]})).mark_rule(</span>
<span id="cb5-40">        strokeDash<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb5-41">        stroke<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'green'</span>,</span>
<span id="cb5-42">        strokeWidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb5-43">    ).encode(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x:T'</span>)</span>
<span id="cb5-44"></span>
<span id="cb5-45">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (historical_line <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> future_line <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> today_line).resolve_scale(color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'independent'</span>)</span></code></pre></div></div>
</details>
</div>
<p><strong>Visualization Features:</strong> - <strong>Line Style Differentiation</strong>: Solid (historical) vs Dotted (forecast) - <strong>Today Indicator</strong>: Clear visual marker for current day - <strong>Color Coding</strong>: Blue for past, red for future - <strong>Interactive Tooltips</strong>: Hover information for data points</p>
</section>
<section id="air-quality-monitoring" class="level3">
<h3 class="anchored" data-anchor-id="air-quality-monitoring">5. Air Quality Monitoring</h3>
<p>PM2.5 levels with EPA-compliant color coding:</p>
<div id="864d4555" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_air_quality_level(pm25_value):</span>
<span id="cb6-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Get air quality level based on US EPA PM2.5 standards"""</span></span>
<span id="cb6-3"></span>
<span id="cb6-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> pm25_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>:</span>
<span id="cb6-5">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb6-6">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'level'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Good'</span>,</span>
<span id="cb6-7">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#00e400'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Deeper green</span></span>
<span id="cb6-8">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text_color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'white'</span>,</span>
<span id="cb6-9">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'icon'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'üü¢'</span></span>
<span id="cb6-10">        }</span>
<span id="cb6-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> pm25_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">35.4</span>:</span>
<span id="cb6-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb6-13">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'level'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Moderate'</span>,</span>
<span id="cb6-14">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#ffff00'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Light green</span></span>
<span id="cb6-15">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text_color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'black'</span>,</span>
<span id="cb6-16">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'icon'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'üü¢'</span></span>
<span id="cb6-17">        }</span>
<span id="cb6-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> pm25_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.4</span>:</span>
<span id="cb6-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb6-20">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'level'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Unhealthy for Sensitive Groups'</span>,</span>
<span id="cb6-21">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#ff7e00'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Darker yellow</span></span>
<span id="cb6-22">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text_color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'black'</span>,</span>
<span id="cb6-23">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'icon'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'üü°'</span></span>
<span id="cb6-24">        }</span>
<span id="cb6-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> pm25_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">150.4</span>:</span>
<span id="cb6-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb6-27">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'level'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Unhealthy'</span>,</span>
<span id="cb6-28">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#ff0000'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Darker orange</span></span>
<span id="cb6-29">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text_color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'white'</span>,</span>
<span id="cb6-30">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'icon'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'üü†'</span></span>
<span id="cb6-31">        }</span>
<span id="cb6-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> pm25_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">250.4</span>:</span>
<span id="cb6-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb6-34">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'level'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Very Unhealthy'</span>,</span>
<span id="cb6-35">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#8f3f97'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Darker red</span></span>
<span id="cb6-36">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text_color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'white'</span>,</span>
<span id="cb6-37">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'icon'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'üî¥'</span></span>
<span id="cb6-38">        }</span>
<span id="cb6-39">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb6-40">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb6-41">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'level'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Hazardous'</span>,</span>
<span id="cb6-42">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#7e0023'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Very dark red</span></span>
<span id="cb6-43">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text_color'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'white'</span>,</span>
<span id="cb6-44">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'icon'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'‚ö´'</span></span>
<span id="cb6-45">        }</span>
<span id="cb6-46"></span>
<span id="cb6-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> display_air_quality_badge(pm25_value):</span>
<span id="cb6-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Display air quality with visual indicators"""</span></span>
<span id="cb6-49">    aq_info <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_air_quality_level(pm25_value)</span>
<span id="cb6-50"></span>
<span id="cb6-51">    st.markdown(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb6-52"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    &lt;div style="background-color: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>aq_info[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'color'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">; color: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>aq_info[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text_color'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-53"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">                padding: 10px; border-radius: 5px; text-align: center; margin: 5px 0;"&gt;</span></span>
<span id="cb6-54"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        &lt;strong&gt;</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>aq_info[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'icon'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> PM2.5: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>pm25_value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> Œºg/m¬≥&lt;/strong&gt;&lt;br&gt;</span></span>
<span id="cb6-55"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        &lt;small&gt;</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>aq_info[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'level'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;/small&gt;</span></span>
<span id="cb6-56"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    &lt;/div&gt;</span></span>
<span id="cb6-57"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    """</span>, unsafe_allow_html<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div></div>
</details>
</div>
<p><strong>Air Quality Features:</strong> - <strong>EPA Standards</strong>: Based on US Environmental Protection Agency - <strong>Visual Indicators</strong>: Color-coded badges with icons - <strong>Accessibility</strong>: High contrast colors for readability - <strong>Educational</strong>: Level descriptions for user understanding</p>
</section>
</section>
<section id="ai-powered-weather-intelligence" class="level2">
<h2 class="anchored" data-anchor-id="ai-powered-weather-intelligence">AI-Powered Weather Intelligence</h2>
<section id="integration-with-deepseek-ai" class="level3">
<h3 class="anchored" data-anchor-id="integration-with-deepseek-ai">Integration with DeepSeek AI</h3>
<p>The most innovative feature is AI-powered weather analysis using ModelScope‚Äôs DeepSeek-V3.2 model:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/weather-trend/images/1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>AI Weather Recommendations</figcaption>
</figure>
</div>
<div id="be0a585b" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize AI client with ModelScope</span></span>
<span id="cb7-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> init_ai_client():</span>
<span id="cb7-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Initialize OpenAI client for ModelScope API"""</span></span>
<span id="cb7-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> OpenAI(</span>
<span id="cb7-8">        base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span>,</span>
<span id="cb7-9">        api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"modelscope"</span>),</span>
<span id="cb7-10">    )</span>
<span id="cb7-11"></span>
<span id="cb7-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> generate_weather_insights(weather_df, location_name, language<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>):</span>
<span id="cb7-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Generate AI-powered weather recommendations"""</span></span>
<span id="cb7-14"></span>
<span id="cb7-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prepare weather data for AI analysis</span></span>
<span id="cb7-16">    today_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weather_df[weather_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_today'</span>]].index[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">any</span>(weather_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_today'</span>]) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb7-17">    historical_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weather_df.iloc[:today_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Up to today</span></span>
<span id="cb7-18">    future_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weather_df.iloc[today_index:]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Today onwards</span></span>
<span id="cb7-19"></span>
<span id="cb7-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create weather summary for AI</span></span>
<span id="cb7-21">    weather_summary <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb7-22"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Location: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>location_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-23"></span>
<span id="cb7-24"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Historical Weather (Last </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(historical_data)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> days):</span></span>
<span id="cb7-25"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    - Temperature Range: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>historical_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_min'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">¬∞C to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>historical_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_max'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">¬∞C</span></span>
<span id="cb7-26"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    - Average Temperature: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>historical_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_mean'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">¬∞C</span></span>
<span id="cb7-27"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    - Air Quality Range: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>historical_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pm2_5'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>historical_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pm2_5'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> PM2.5</span></span>
<span id="cb7-28"></span>
<span id="cb7-29"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    Forecast (Next </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(future_data)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> days):</span></span>
<span id="cb7-30"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    - Temperature Range: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>future_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_min'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">¬∞C to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>future_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_max'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">¬∞C</span></span>
<span id="cb7-31"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    - Average Rain Probability: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>future_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rain_probability'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">%</span></span>
<span id="cb7-32"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb7-33"></span>
<span id="cb7-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate prompt based on language</span></span>
<span id="cb7-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> language <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zh"</span>:</span>
<span id="cb7-36">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb7-37"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Âü∫‰∫é‰ª•‰∏ãÂ§©Ê∞îÊï∞ÊçÆÔºåËØ∑Êèê‰æõÁÆÄÊ¥ÅÂÆûÁî®ÁöÑÂ§©Ê∞îÂª∫ËÆÆÔºà100-200Â≠óÔºâÔºö</span></span>
<span id="cb7-38"></span>
<span id="cb7-39"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>weather_summary<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-40"></span>
<span id="cb7-41"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        ËØ∑ÂåÖÊã¨Ôºö</span></span>
<span id="cb7-42"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        1. Â§©Ê∞îÊ®°ÂºèÂàÜÊûê</span></span>
<span id="cb7-43"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        2. Á©øË°£Âª∫ËÆÆ</span></span>
<span id="cb7-44"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        3. Êà∑Â§ñÊ¥ªÂä®Âª∫ËÆÆ</span></span>
<span id="cb7-45"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        4. ÂÅ•Â∫∑Ê≥®ÊÑè‰∫ãÈ°πÔºàÂ¶ÇÁ©∫Ê∞îË¥®ÈáèÁõ∏ÂÖ≥Ôºâ</span></span>
<span id="cb7-46"></span>
<span id="cb7-47"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        ËØ∑Áî®‰∏≠ÊñáÂõûÂ§çÔºåËØ≠Ê∞îÂèãÂ•ΩÂÆûÁî®„ÄÇ</span></span>
<span id="cb7-48"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb7-49">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb7-50">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb7-51"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Based on the following weather data, please provide concise and practical weather advice (100-200 words):</span></span>
<span id="cb7-52"></span>
<span id="cb7-53"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>weather_summary<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-54"></span>
<span id="cb7-55"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Please include:</span></span>
<span id="cb7-56"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        1. Weather pattern analysis</span></span>
<span id="cb7-57"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        2. Clothing recommendations</span></span>
<span id="cb7-58"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        3. Outdoor activity suggestions</span></span>
<span id="cb7-59"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        4. Health considerations (related to air quality if applicable)</span></span>
<span id="cb7-60"></span>
<span id="cb7-61"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        Please respond in </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>language<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> with a friendly and practical tone.</span></span>
<span id="cb7-62"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb7-63"></span>
<span id="cb7-64">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb7-65">        client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> init_ai_client()</span>
<span id="cb7-66">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb7-67">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deepseek-ai/DeepSeek-V3"</span>,</span>
<span id="cb7-68">            messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt}],</span>
<span id="cb7-69">            max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>,</span>
<span id="cb7-70">            temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span></span>
<span id="cb7-71">        )</span>
<span id="cb7-72"></span>
<span id="cb7-73">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content</span>
<span id="cb7-74"></span>
<span id="cb7-75">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb7-76">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"AI service temporarily unavailable. Error: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb7-77"></span>
<span id="cb7-78"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># In Streamlit app</span></span>
<span id="cb7-79"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> st.button(get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai_button"</span>, language)):</span>
<span id="cb7-80">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> st.spinner(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Getting AI weather advice..."</span>):</span>
<span id="cb7-81">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'weather_df'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> st.session_state <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'location_name'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> st.session_state:</span>
<span id="cb7-82">            ai_insights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_weather_insights(</span>
<span id="cb7-83">                st.session_state.weather_df,</span>
<span id="cb7-84">                st.session_state.location_name,</span>
<span id="cb7-85">                language</span>
<span id="cb7-86">            )</span>
<span id="cb7-87">            st.markdown(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"### ü§ñ AI Weather Analysis"</span>)</span>
<span id="cb7-88">            st.write(ai_insights)</span>
<span id="cb7-89">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb7-90">            st.warning(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Please get weather data first."</span>)</span></code></pre></div></div>
</details>
</div>
<p><strong>AI Features:</strong> - <strong>Context-Aware Analysis</strong>: Processes both historical and forecast data - <strong>Multilingual Support</strong>: AI responds in user‚Äôs selected language - <strong>Practical Recommendations</strong>: Clothing, activities, and health advice - <strong>Error Handling</strong>: Graceful fallback when AI service unavailable</p>
</section>
<section id="ai-prompt-engineering" class="level3">
<h3 class="anchored" data-anchor-id="ai-prompt-engineering">AI Prompt Engineering</h3>
<p>The AI system uses carefully crafted prompts to generate useful insights:</p>
<p><strong>Prompt Structure:</strong> 1. <strong>Data Context</strong>: Comprehensive weather statistics 2. <strong>Task Definition</strong>: Clear requirements for analysis 3. <strong>Output Format</strong>: Structured response categories 4. <strong>Language Adaptation</strong>: Matches user interface language</p>
<p><strong>Response Categories:</strong> - <strong>Weather Pattern Analysis</strong>: Trends and anomalies - <strong>Clothing Recommendations</strong>: Practical dress suggestions - <strong>Activity Advice</strong>: Outdoor planning recommendations - <strong>Health Considerations</strong>: Air quality and weather impacts</p>
</section>
</section>
<section id="internationalization-system" class="level2">
<h2 class="anchored" data-anchor-id="internationalization-system">Internationalization System</h2>
<section id="language-management-architecture" class="level3">
<h3 class="anchored" data-anchor-id="language-management-architecture">Language Management Architecture</h3>
<p>The app implements a comprehensive bilingual system:</p>
<div id="8d929abd" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># language.py - Translation management</span></span>
<span id="cb8-2">TRANSLATIONS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>: {</span>
<span id="cb8-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"app_title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weather Forecast App"</span>,</span>
<span id="cb8-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sidebar_header"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weather Query"</span>,</span>
<span id="cb8-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"city_input_placeholder"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enter a city name"</span>,</span>
<span id="cb8-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get_weather_button"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Get Weather"</span>,</span>
<span id="cb8-8">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weather_trends_title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weather Trends for"</span>,</span>
<span id="cb8-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai_button"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Weather Advice"</span>,</span>
<span id="cb8-10">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... more translations</span></span>
<span id="cb8-11">    },</span>
<span id="cb8-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zh"</span>: {</span>
<span id="cb8-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"app_title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Â§©Ê∞îÈ¢ÑÊä•Â∫îÁî®"</span>,</span>
<span id="cb8-14">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sidebar_header"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Â§©Ê∞îÊü•ËØ¢"</span>,</span>
<span id="cb8-15">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"city_input_placeholder"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ËæìÂÖ•ÂüéÂ∏ÇÂêçÁß∞"</span>,</span>
<span id="cb8-16">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get_weather_button"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ëé∑ÂèñÂ§©Ê∞î"</span>,</span>
<span id="cb8-17">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weather_trends_title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Â§©Ê∞îË∂ãÂäø"</span>,</span>
<span id="cb8-18">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai_button"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AIÂ§©Ê∞îÂª∫ËÆÆ"</span>,</span>
<span id="cb8-19">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... more translations</span></span>
<span id="cb8-20">    }</span>
<span id="cb8-21">}</span>
<span id="cb8-22"></span>
<span id="cb8-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_text(key, language<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>):</span>
<span id="cb8-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Get translated text for given key and language"""</span></span>
<span id="cb8-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> TRANSLATIONS.get(language, {}).get(key, key)</span>
<span id="cb8-26"></span>
<span id="cb8-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_available_languages():</span>
<span id="cb8-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Get available language options"""</span></span>
<span id="cb8-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"English"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zh"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‰∏≠Êñá"</span>}</span>
<span id="cb8-30"></span>
<span id="cb8-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># In main app (app.py)</span></span>
<span id="cb8-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> main():</span>
<span id="cb8-33">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Language state management</span></span>
<span id="cb8-34">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'language'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> st.session_state:</span>
<span id="cb8-35">        st.session_state.language <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span></span>
<span id="cb8-36"></span>
<span id="cb8-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Language toggle button</span></span>
<span id="cb8-38">    current_lang <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.session_state.language</span>
<span id="cb8-39">    available_langs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_available_languages()</span>
<span id="cb8-40"></span>
<span id="cb8-41">    col1, col2, col3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.columns([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>])</span>
<span id="cb8-42">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> col1:</span>
<span id="cb8-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> st.button(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EN"</span>, disabled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>current_lang<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>):</span>
<span id="cb8-44">            st.session_state.language <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span></span>
<span id="cb8-45">            st.rerun()</span>
<span id="cb8-46"></span>
<span id="cb8-47">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> col2:</span>
<span id="cb8-48">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> st.button(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‰∏≠Êñá"</span>, disabled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>current_lang<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zh"</span>):</span>
<span id="cb8-49">            st.session_state.language <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zh"</span></span>
<span id="cb8-50">            st.rerun()</span>
<span id="cb8-51"></span>
<span id="cb8-52">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use current language for all UI elements</span></span>
<span id="cb8-53">    language <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.session_state.language</span>
<span id="cb8-54">    st.title(get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"app_title"</span>, language))</span>
<span id="cb8-55">    st.sidebar.header(get_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sidebar_header"</span>, language))</span></code></pre></div></div>
</details>
</div>
<p><strong>Internationalization Features:</strong> - <strong>Complete UI Translation</strong>: All interface elements localized - <strong>Dynamic Language Switching</strong>: Instant UI updates on language change - <strong>Chinese Character Support</strong>: Full Unicode and CJK support - <strong>Consistent Language</strong>: AI responses match UI language</p>
</section>
</section>
<section id="advanced-ui-components" class="level2">
<h2 class="anchored" data-anchor-id="advanced-ui-components">Advanced UI Components</h2>
<section id="weather-data-table-with-visual-indicators" class="level3">
<h3 class="anchored" data-anchor-id="weather-data-table-with-visual-indicators">Weather Data Table with Visual Indicators</h3>
<p>The weather table combines data with visual elements for quick understanding:</p>
<div id="c930b26e" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> create_weather_table(weather_df, language<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>):</span>
<span id="cb9-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Create enhanced weather table with icons and colors"""</span></span>
<span id="cb9-3"></span>
<span id="cb9-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Weather code to emoji mapping</span></span>
<span id="cb9-5">    WEATHER_ICONS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb9-6">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‚òÄÔ∏è"</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clear sky</span></span>
<span id="cb9-7">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‚õÖ"</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mainly clear</span></span>
<span id="cb9-8">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‚òÅÔ∏è"</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Partly cloudy</span></span>
<span id="cb9-9">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‚òÅÔ∏è"</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Overcast</span></span>
<span id="cb9-10">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"üå´Ô∏è"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fog</span></span>
<span id="cb9-11">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"üå¶Ô∏è"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Drizzle</span></span>
<span id="cb9-12">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"üåßÔ∏è"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rain</span></span>
<span id="cb9-13">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">53</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‚ùÑÔ∏è"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Snow</span></span>
<span id="cb9-14">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‚õàÔ∏è"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Thunderstorm</span></span>
<span id="cb9-15">    }</span>
<span id="cb9-16"></span>
<span id="cb9-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> format_weather_row(row):</span>
<span id="cb9-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Format individual weather row with styling"""</span></span>
<span id="cb9-19">        date_str <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>].strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'%Y-%m-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb9-20">        temp_range <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_min'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">¬∞ ~ </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature_max'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">¬∞"</span></span>
<span id="cb9-21">        weather_icon <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> WEATHER_ICONS.get(row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'weather_code'</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"üå°Ô∏è"</span>)</span>
<span id="cb9-22"></span>
<span id="cb9-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Air quality badge</span></span>
<span id="cb9-24">        aq_info <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_air_quality_level(row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pm2_5'</span>])</span>
<span id="cb9-25">        aq_badge <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'&lt;span style="background-color: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>aq_info[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">; color: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>aq_info[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text_color"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">; padding: 2px 6px; border-radius: 3px; font-size: 0.8em;"&gt;</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>aq_info[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"icon"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pm2_5"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;/span&gt;'</span></span>
<span id="cb9-26"></span>
<span id="cb9-27">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rain probability indicator</span></span>
<span id="cb9-28">        rain_color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rain_probability'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orange'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rain_probability'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span></span>
<span id="cb9-29">        rain_indicator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'&lt;span style="color: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>rain_color<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">;"&gt;üî¥ </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rain_probability"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">%&lt;/span&gt;'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rain_probability'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'&lt;span style="color: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>rain_color<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">;"&gt;üü¢ </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rain_probability"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">%&lt;/span&gt;'</span></span>
<span id="cb9-30"></span>
<span id="cb9-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Today highlighting</span></span>
<span id="cb9-32">        row_style <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'font-size: 1.2em; font-weight: bold;'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_today'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span></span>
<span id="cb9-33"></span>
<span id="cb9-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb9-35">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Date'</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'&lt;span style="</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>row_style<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>date_str<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;/span&gt;'</span>,</span>
<span id="cb9-36">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Weather'</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'&lt;span style="</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>row_style<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>weather_icon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;/span&gt;'</span>,</span>
<span id="cb9-37">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Temperature'</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'&lt;span style="</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>row_style<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>temp_range<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;/span&gt;'</span>,</span>
<span id="cb9-38">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Wind'</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'&lt;span style="</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>row_style<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;üí® </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wind_speed_max"</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> km/h&lt;/span&gt;'</span>,</span>
<span id="cb9-39">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Rain'</span>: rain_indicator,</span>
<span id="cb9-40">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Air Quality'</span>: aq_badge</span>
<span id="cb9-41">        }</span>
<span id="cb9-42"></span>
<span id="cb9-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply formatting to all rows</span></span>
<span id="cb9-44">    formatted_rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [format_weather_row(row) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _, row <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weather_df.iterrows()]</span>
<span id="cb9-45"></span>
<span id="cb9-46">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pd.DataFrame(formatted_rows)</span>
<span id="cb9-47"></span>
<span id="cb9-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Display in Streamlit</span></span>
<span id="cb9-49">st.markdown(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"### üìä Weather Details"</span>)</span>
<span id="cb9-50">st.dataframe(</span>
<span id="cb9-51">    create_weather_table(weather_df, language),</span>
<span id="cb9-52">    width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1200</span>,</span>
<span id="cb9-53">    hide_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb9-54">    unsafe_allow_html<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb9-55">)</span></code></pre></div></div>
</details>
</div>
<p><strong>Table Features:</strong> - <strong>Weather Icons</strong>: Emoji representation for quick visual understanding - <strong>Today Highlighting</strong>: Larger, bold text for current day - <strong>Air Quality Badges</strong>: Color-coded PM2.5 indicators - <strong>Rain Probability</strong>: Visual indicators with Material Design colors - <strong>Responsive Layout</strong>: Adapts to different screen sizes</p>
</section>
</section>
<section id="deployment-and-production" class="level2">
<h2 class="anchored" data-anchor-id="deployment-and-production">Deployment and Production</h2>
<section id="environment-configuration" class="level3">
<h3 class="anchored" data-anchor-id="environment-configuration">Environment Configuration</h3>
<p>For production deployment, configure environment variables:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .env file</span></span>
<span id="cb10-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">modelscope</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>your_modelscope_api_key_here</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Additional production settings</span></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Consider rate limiting, caching, and monitoring</span></span></code></pre></div></div>
</section>
<section id="streamlit-cloud-deployment" class="level3">
<h3 class="anchored" data-anchor-id="streamlit-cloud-deployment">Streamlit Cloud Deployment</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Install Streamlit CLI</span></span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install streamlit</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Login to Streamlit</span></span>
<span id="cb11-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">streamlit</span> login</span>
<span id="cb11-6"></span>
<span id="cb11-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Deploy to Streamlit Cloud</span></span>
<span id="cb11-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">streamlit</span> run app.py  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Test locally first</span></span>
<span id="cb11-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Then deploy through cloud.streamlit.io or using CLI</span></span></code></pre></div></div>
</section>
<section id="docker-deployment-optional" class="level3">
<h3 class="anchored" data-anchor-id="docker-deployment-optional">Docker Deployment (Optional)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">FROM</span> python:3.9-slim</span>
<span id="cb12-2"></span>
<span id="cb12-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">WORKDIR</span> /app</span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">COPY</span> requirements.txt .</span>
<span id="cb12-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">RUN</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> requirements.txt</span>
<span id="cb12-7"></span>
<span id="cb12-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">COPY</span> . .</span>
<span id="cb12-9"></span>
<span id="cb12-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">EXPOSE</span> 8501</span>
<span id="cb12-11"></span>
<span id="cb12-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">CMD</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"streamlit"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"run"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"app.py"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--server.address"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.0.0.0"</span>]</span></code></pre></div></div>
</section>
</section>
<section id="performance-optimization" class="level2">
<h2 class="anchored" data-anchor-id="performance-optimization">Performance Optimization</h2>
<section id="caching-strategy" class="level3">
<h3 class="anchored" data-anchor-id="caching-strategy">Caching Strategy</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@st.cache_data</span>(ttl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3600</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cache for 1 hour</span></span>
<span id="cb13-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_weather_data_cached(lat, lon):</span>
<span id="cb13-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Cached weather data fetching"""</span></span>
<span id="cb13-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> get_weather_data(lat, lon)</span>
<span id="cb13-5"></span>
<span id="cb13-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@st.cache_resource</span></span>
<span id="cb13-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_ai_client():</span>
<span id="cb13-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Cached AI client initialization"""</span></span>
<span id="cb13-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> init_ai_client()</span>
<span id="cb13-10"></span>
<span id="cb13-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cache map generation</span></span>
<span id="cb13-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@st.cache_data</span>(ttl<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3600</span>)</span>
<span id="cb13-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> create_map_cached(lat, lon):</span>
<span id="cb13-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Cached map creation"""</span></span>
<span id="cb13-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> create_interactive_map(lat, lon)</span></code></pre></div></div>
</section>
<section id="error-handling-and-resilience" class="level3">
<h3 class="anchored" data-anchor-id="error-handling-and-resilience">Error Handling and Resilience</h3>
<div id="0f3be0ae" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> robust_api_call(func, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>args, max_retries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs):</span>
<span id="cb14-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Robust API calling with retry logic"""</span></span>
<span id="cb14-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> attempt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(max_retries):</span>
<span id="cb14-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb14-5">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> func(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>args, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs)</span>
<span id="cb14-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> requests.exceptions.Timeout:</span>
<span id="cb14-7">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> attempt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> max_retries <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb14-8">                st.error(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weather service temporarily unavailable"</span>)</span>
<span id="cb14-9">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb14-10">            time.sleep(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> attempt)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exponential backoff</span></span>
<span id="cb14-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> requests.exceptions.RequestException <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb14-12">            st.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"API error: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb14-13">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="best-practices-and-lessons-learned" class="level2">
<h2 class="anchored" data-anchor-id="best-practices-and-lessons-learned">Best Practices and Lessons Learned</h2>
<section id="development-insights" class="level3">
<h3 class="anchored" data-anchor-id="development-insights">Development Insights</h3>
<ol type="1">
<li><strong>Modular Architecture</strong>: Separate concerns (API, UI, AI, Visualization)</li>
<li><strong>Error Resilience</strong>: Comprehensive error handling and fallbacks</li>
<li><strong>User Experience</strong>: Fast loading with caching and progress indicators</li>
<li><strong>Internationalization</strong>: Plan for multilingual support from the start</li>
<li><strong>API Management</strong>: Rate limiting and request optimization</li>
<li><strong>Responsive Design</strong>: Test across different devices and screen sizes</li>
<li><strong>Security</strong>: Environment variables for sensitive data</li>
</ol>
</section>
<section id="performance-considerations" class="level3">
<h3 class="anchored" data-anchor-id="performance-considerations">Performance Considerations</h3>
<ul>
<li><strong>Data Caching</strong>: 1-hour TTL for weather data</li>
<li><strong>Lazy Loading</strong>: Load components only when needed</li>
<li><strong>Async Operations</strong>: Non-blocking API calls where possible</li>
<li><strong>Optimization</strong>: Minimize re-renders and state updates</li>
</ul>
</section>
</section>
<section id="future-enhancements" class="level2">
<h2 class="anchored" data-anchor-id="future-enhancements">Future Enhancements</h2>
<section id="potential-improvements" class="level3">
<h3 class="anchored" data-anchor-id="potential-improvements">Potential Improvements</h3>
<ol type="1">
<li><strong>Extended AI Capabilities</strong>:
<ul>
<li>Multi-day activity planning</li>
<li>Personalized recommendations based on user preferences</li>
<li>Integration with calendar applications</li>
</ul></li>
<li><strong>Advanced Visualizations</strong>:
<ul>
<li>Wind direction and speed maps</li>
<li>Precipitation intensity charts</li>
<li>Historical weather comparisons</li>
</ul></li>
<li><strong>Data Sources</strong>:
<ul>
<li>Multiple weather provider integration</li>
<li>Real-time radar integration</li>
<li>Weather alert systems</li>
</ul></li>
<li><strong>User Features</strong>:
<ul>
<li>Saved locations and favorites</li>
<li>Weather notifications</li>
<li>Historical data analysis</li>
<li>Export functionality</li>
</ul></li>
<li><strong>Technical Enhancements</strong>:
<ul>
<li>WebSocket real-time updates</li>
<li>Progressive Web App (PWA) features</li>
<li>Offline functionality</li>
</ul></li>
</ol>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This weather forecast application demonstrates how modern web development technologies can be combined to create a comprehensive, intelligent weather service. The integration of AI-powered recommendations elevates it from a simple data display tool to a practical weather assistant that helps users make informed decisions about their daily activities.</p>
<p>The project showcases:</p>
<ul>
<li><p><strong>Modern Web Development</strong>: Streamlit for rapid prototyping</p></li>
<li><p><strong>Data Visualization</strong>: Professional charts and interactive maps</p></li>
<li><p><strong>AI Integration</strong>: Practical use of language models for data analysis</p></li>
<li><p><strong>Internationalization</strong>: Complete bilingual support</p></li>
<li><p><strong>Production Readiness</strong>: Error handling, caching, and optimization</p></li>
</ul>
<p>Whether you‚Äôre building weather applications, data dashboards, or AI-powered tools, this project provides an excellent foundation for creating sophisticated, user-friendly applications.</p>


<!-- -->

</section>
</section>

 ]]></description>
  <category>Python</category>
  <category>Streamlit</category>
  <category>AI</category>
  <category>tutorial</category>
  <guid>https://your-website-url.example.com/posts/weather-trend/</guid>
  <pubDate>Wed, 05 Nov 2025 16:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/weather-trend/images/0.png" medium="image" type="image/png" height="83" width="144"/>
</item>
<item>
  <title>Weight Tracking Dashboard with Shiny,streamlit and AI Integration</title>
  <dc:creator>Tony D</dc:creator>
  <link>https://your-website-url.example.com/posts/weight-tracking/</link>
  <description><![CDATA[ 





<section id="project-overview" class="level1">
<h1>Project Overview</h1>
<p>The weight tracking application is a comprehensive R Shiny web application that helps users monitor their weight trends, calculate BMI, and receive personalized AI-powered health suggestions. What makes this project particularly interesting is its integration of multiple AI providers and real-time data synchronization capabilities.</p>
<p>Live Demo: <a href="https://jcflyingco.shinyapps.io/weight_tracking/">https://jcflyingco.shinyapps.io/weight_tracking/</a></p>
<p>Github: <a href="https://github.com/JCwinning/weight_tracking">https://github.com/JCwinning/weight_tracking</a></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true" href="">Weight Tracking trend</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false" href="">AI feedback</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false" href="">‰ΩìÈáçË∂ãÂäøÂõæ</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" aria-controls="tabset-1-4" aria-selected="false" href="">AIÂèçÈ¶à</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/weight-tracking/images/0.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Application Dashboard - Weight Tracking View</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/weight-tracking/images/1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>AI Configuration Panel</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/weight-tracking/images/2.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Data Table View</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" aria-labelledby="tabset-1-4-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/weight-tracking/images/3.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Code Viewer Section</figcaption>
</figure>
</div>
</div>
</div>
</div>
<section id="core-features" class="level2">
<h2 class="anchored" data-anchor-id="core-features">Core Features</h2>
<section id="health-monitoring-capabilities" class="level3">
<h3 class="anchored" data-anchor-id="health-monitoring-capabilities">Health Monitoring Capabilities</h3>
<ul>
<li><strong>Weight Tracking</strong>: Interactive logging and visualization of weight over time</li>
<li><strong>BMI Calculator</strong>: Automatic BMI calculation with health range comparisons</li>
<li><strong>Unit Conversion</strong>: Seamless switching between metric (kg/cm) and imperial (pounds/inches)</li>
<li><strong>Real-time Updates</strong>: Automatic data refresh when Excel files are modified</li>
</ul>
</section>
<section id="advanced-technical-features" class="level3">
<h3 class="anchored" data-anchor-id="advanced-technical-features">Advanced Technical Features</h3>
<ul>
<li><strong>Multi-provider AI Integration</strong>: Support for Modelscope, OpenRouter, Gemini, and OpenAI-compatible APIs</li>
<li><strong>Complete Internationalization</strong>: Full English/Chinese language support with 50+ translated strings</li>
<li><strong>Real-time File Monitoring</strong>: Automatic UI updates when data files change</li>
<li><strong>Interactive Visualizations</strong>: Plotly charts with zoom, pan, and hover capabilities</li>
<li><strong>Data Management</strong>: Excel import/export with reactive data updates</li>
</ul>
</section>
</section>
<section id="technical-architecture" class="level2">
<h2 class="anchored" data-anchor-id="technical-architecture">Technical Architecture</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>

</div>
<p></p><figcaption> Weight Tracking Application Architecture</figcaption> </figure><p></p>
</div>
</div>
</div>
<section id="technology-stack" class="level3">
<h3 class="anchored" data-anchor-id="technology-stack">Technology Stack</h3>
<ul>
<li><strong>Primary Framework</strong>: R Shiny (Classic architecture)</li>
<li><strong>UI Components</strong>: Bootstrap-based responsive design with <code>bslib</code></li>
<li><strong>Data Processing</strong>: <code>tidyverse</code>, <code>readxl</code>, <code>openxlsx</code></li>
<li><strong>Visualization</strong>: <code>plotly</code> for interactive charts</li>
<li><strong>AI Integration</strong>: <code>ellmer</code> for multi-provider AI support</li>
</ul>
</section>
<section id="file-structure-analysis" class="level3">
<h3 class="anchored" data-anchor-id="file-structure-analysis">File Structure Analysis</h3>
<pre><code>weight_tracking/
‚îú‚îÄ‚îÄ ui.R              # Multi-tab interface with controls
‚îú‚îÄ‚îÄ server.R          # Server logic and data management
‚îú‚îÄ‚îÄ global.R          # URL bookmarking configuration
‚îú‚îÄ‚îÄ ai_config.R       # Centralized AI provider management
‚îú‚îÄ‚îÄ language.R        # Complete internationalization system
‚îú‚îÄ‚îÄ weight.xlsx       # Primary data storage
‚îú‚îÄ‚îÄ www/logo.png      # Application branding
‚îî‚îÄ‚îÄ images/           # Application screenshots</code></pre>
</section>
</section>
<section id="data-management-system" class="level2">
<h2 class="anchored" data-anchor-id="data-management-system">Data Management System</h2>
<p>The application implements a sophisticated data processing workflow that ensures real-time synchronization and efficient data handling.</p>
<section id="data-processing-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="data-processing-pipeline">Data Processing Pipeline</h3>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>

</div>
<p></p><figcaption> Data Processing Workflow</figcaption> </figure><p></p>
</div>
</div>
</div>
</section>
<section id="real-time-file-monitoring" class="level3">
<h3 class="anchored" data-anchor-id="real-time-file-monitoring">Real-time File Monitoring</h3>
<p>The application uses <code>reactivePoll()</code> to monitor the Excel data file for changes:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Real-time data monitoring with 1000ms interval</span></span>
<span id="cb2-2">weight_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactivePoll</span>(</span>
<span id="cb2-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intervalMillis =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,</span>
<span id="cb2-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">session =</span> session,</span>
<span id="cb2-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">checkFunc =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>() {</span>
<span id="cb2-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check file modification time</span></span>
<span id="cb2-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight.xlsx"</span>)) {</span>
<span id="cb2-8">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.info</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight.xlsx"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>mtime</span>
<span id="cb2-9">    } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb2-10">      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb2-11">    }</span>
<span id="cb2-12">  },</span>
<span id="cb2-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">valueFunc =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>() {</span>
<span id="cb2-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read and process the Excel file</span></span>
<span id="cb2-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.exists</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight.xlsx"</span>)) {</span>
<span id="cb2-16">      data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight.xlsx"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-17">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-18">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anytime</span>(Date),</span>
<span id="cb2-19">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BMI =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb2-20">            Unit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kg"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Weight <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (Height<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb2-21">            Unit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pound"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> (Weight <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.453592</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ((Height <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.54</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb2-22">          )</span>
<span id="cb2-23">        )</span>
<span id="cb2-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(data)</span>
<span id="cb2-25">    }</span>
<span id="cb2-26">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>())</span>
<span id="cb2-27">  }</span>
<span id="cb2-28">)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="bmi-calculation-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="bmi-calculation-algorithm">BMI Calculation Algorithm</h3>
<p>The application implements comprehensive BMI calculations with unit conversions:</p>
<section id="bmi-categories-and-health-ranges" class="level4">
<h4 class="anchored" data-anchor-id="bmi-categories-and-health-ranges">BMI Categories and Health Ranges</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>BMI Range</th>
<th>Category</th>
<th>Health Risk</th>
<th>Color Code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt; 18.5</td>
<td>Underweight</td>
<td>Moderate risk</td>
<td>Yellow</td>
</tr>
<tr class="even">
<td>18.5 - 24.9</td>
<td>Normal weight</td>
<td>Minimal risk</td>
<td>Green</td>
</tr>
<tr class="odd">
<td>25.0 - 29.9</td>
<td>Overweight</td>
<td>Increased risk</td>
<td>Orange</td>
</tr>
<tr class="even">
<td>‚â• 30.0</td>
<td>Obese</td>
<td>High risk</td>
<td>Red</td>
</tr>
</tbody>
</table>
</section>
<section id="unit-conversion-examples" class="level4">
<h4 class="anchored" data-anchor-id="unit-conversion-examples">Unit Conversion Examples</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BMI calculation for metric and imperial units</span></span>
<span id="cb3-2">calculate_bmi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(weight, height, unit) {</span>
<span id="cb3-3">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (unit <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kg"</span>) {</span>
<span id="cb3-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Metric calculation</span></span>
<span id="cb3-5">    bmi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> weight <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ((height<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-6">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb3-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Imperial calculation with conversion</span></span>
<span id="cb3-8">    weight_kg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> weight <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.453592</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pounds to kg</span></span>
<span id="cb3-9">    height_m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> height <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.54</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># inches to meters</span></span>
<span id="cb3-10">    bmi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> weight_kg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (height_m<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-11">  }</span>
<span id="cb3-12"></span>
<span id="cb3-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Categorize BMI</span></span>
<span id="cb3-14">  category <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb3-15">    bmi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"underweight"</span>,</span>
<span id="cb3-16">    bmi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>,</span>
<span id="cb3-17">    bmi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"overweight"</span>,</span>
<span id="cb3-18">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"obese"</span></span>
<span id="cb3-19">  )</span>
<span id="cb3-20"></span>
<span id="cb3-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bmi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(bmi, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">category =</span> category))</span>
<span id="cb3-22">}</span></code></pre></div></div>
</details>
</div>
</section>
</section>
</section>
<section id="ai-integration-architecture" class="level2">
<h2 class="anchored" data-anchor-id="ai-integration-architecture">AI Integration Architecture</h2>
<section id="multi-provider-ai-system" class="level3">
<h3 class="anchored" data-anchor-id="multi-provider-ai-system">Multi-Provider AI System</h3>
<p>The application supports multiple AI providers with dynamic switching:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AI Provider Configuration</span></span>
<span id="cb4-2">ai_providers <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb4-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">modelscope =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb4-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">provider_url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api-inference.modelscope.cn/v1"</span>,</span>
<span id="cb4-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">models =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zhipuAI/GLM-4.6"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Qwen/Qwen3-Next-80B-A3B-Instruct"</span>)</span>
<span id="cb4-6">  ),</span>
<span id="cb4-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">openrouter =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb4-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">provider_url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb4-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">models =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai/gpt-oss-120b:exacto"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minimax/minimax-m2:free"</span>)</span>
<span id="cb4-10">  ),</span>
<span id="cb4-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Gemini =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb4-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">provider_url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://generativelanguage.googleapis.com/v1beta/openai/"</span>,</span>
<span id="cb4-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">models =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gemini-2.5-flash"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gemini-2.5-pro"</span>)</span>
<span id="cb4-14">  )</span>
<span id="cb4-15">)</span>
<span id="cb4-16"></span>
<span id="cb4-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dynamic provider selection</span></span>
<span id="cb4-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">observeEvent</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ai_provider, {</span>
<span id="cb4-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_current_provider</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ai_provider)</span>
<span id="cb4-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">updateSelectInput</span>(session, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai_model"</span>,</span>
<span id="cb4-21">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">choices =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_provider_models</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ai_provider))</span>
<span id="cb4-22">})</span></code></pre></div></div>
</details>
</div>
</section>
<section id="ai-health-recommendation-system" class="level3">
<h3 class="anchored" data-anchor-id="ai-health-recommendation-system">AI Health Recommendation System</h3>
<p>The AI generates personalized health advice based on weight trends:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AI suggestion generation</span></span>
<span id="cb5-2">get_ai_suggestion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(weight_data, api_key, model, provider) {</span>
<span id="cb5-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prepare data for AI analysis</span></span>
<span id="cb5-4">  recent_trend <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">analyze_weight_trend</span>(weight_data)</span>
<span id="cb5-5">  current_bmi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_current_bmi</span>(weight_data)</span>
<span id="cb5-6"></span>
<span id="cb5-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create language-specific prompts</span></span>
<span id="cb5-8">  prompt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (current_language <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zh"</span>) {</span>
<span id="cb5-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Âü∫‰∫é‰ª•‰∏ã‰ΩìÈáçÊï∞ÊçÆÂàÜÊûêÔºåËØ∑Êèê‰æõ‰∏™ÊÄßÂåñÁöÑÂÅ•Â∫∑Âª∫ËÆÆÔºö"</span>,</span>
<span id="cb5-10">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ÊúÄËøë‰ΩìÈáçË∂ãÂäøÔºö"</span>, recent_trend,</span>
<span id="cb5-11">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ÂΩìÂâçBMIÔºö"</span>, current_bmi,</span>
<span id="cb5-12">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ËØ∑Áî®‰∏≠ÊñáÂõûÂ§çÔºåÂåÖÂê´ÂÖ∑‰ΩìÁöÑÈ•ÆÈ£üÂíåËøêÂä®Âª∫ËÆÆ„ÄÇ"</span>)</span>
<span id="cb5-13">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb5-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Based on the following weight data analysis, please provide personalized health advice:"</span>,</span>
<span id="cb5-15">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Recent weight trend:"</span>, recent_trend,</span>
<span id="cb5-16">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Current BMI:"</span>, current_bmi,</span>
<span id="cb5-17">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Please respond in English with specific diet and exercise recommendations."</span>)</span>
<span id="cb5-18">  }</span>
<span id="cb5-19"></span>
<span id="cb5-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make API call to selected provider</span></span>
<span id="cb5-21">  response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ellmer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chat_completion</span>(</span>
<span id="cb5-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> model,</span>
<span id="cb5-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">messages =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb5-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">role =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">content =</span> prompt)</span>
<span id="cb5-25">    ),</span>
<span id="cb5-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">api_key =</span> api_key,</span>
<span id="cb5-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_url =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_provider_url</span>(provider)</span>
<span id="cb5-28">  )</span>
<span id="cb5-29"></span>
<span id="cb5-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(response<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>choices[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>content)</span>
<span id="cb5-31">}</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="user-interface-design" class="level2">
<h2 class="anchored" data-anchor-id="user-interface-design">User Interface Design</h2>
<section id="multi-tab-navigation-structure" class="level3">
<h3 class="anchored" data-anchor-id="multi-tab-navigation-structure">Multi-Tab Navigation Structure</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tab-based interface organization</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mainPanel</span>(</span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabsetPanel</span>(</span>
<span id="cb6-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot_tab"</span>),</span>
<span id="cb6-5">             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Weight and BMI charts</span></span>
<span id="cb6-6">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidRow</span>(</span>
<span id="cb6-7">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">column</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotlyOutput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight_plot"</span>)),</span>
<span id="cb6-8">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">column</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotlyOutput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bmi_plot"</span>))</span>
<span id="cb6-9">             )</span>
<span id="cb6-10">    ),</span>
<span id="cb6-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ui_tab"</span>),</span>
<span id="cb6-12">             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UI code viewer with syntax highlighting</span></span>
<span id="cb6-13">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">verbatimTextOutput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ui_code"</span>)</span>
<span id="cb6-14">    ),</span>
<span id="cb6-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"server_tab"</span>),</span>
<span id="cb6-16">             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Server code viewer</span></span>
<span id="cb6-17">             <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">verbatimTextOutput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"server_code"</span>)</span>
<span id="cb6-18">    ),</span>
<span id="cb6-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_tab"</span>),</span>
<span id="cb6-20">             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Interactive data table</span></span>
<span id="cb6-21">             DT<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dataTableOutput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_table"</span>)</span>
<span id="cb6-22">    )</span>
<span id="cb6-23">  )</span>
<span id="cb6-24">)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="internationalization-system" class="level3">
<h3 class="anchored" data-anchor-id="internationalization-system">Internationalization System</h3>
<p>Complete bilingual support with dynamic language switching:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Language translation system</span></span>
<span id="cb7-2">translations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">en =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">app_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight tracking"</span>,</span>
<span id="cb7-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">your_weight =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Your weight:"</span>,</span>
<span id="cb7-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">your_bmi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Your BMI:"</span>,</span>
<span id="cb7-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">get_ai_suggestion =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Get AI Suggestion"</span></span>
<span id="cb7-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... more translations</span></span>
<span id="cb7-9">  ),</span>
<span id="cb7-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zh =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">app_title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‰ΩìÈáçËøΩË∏™"</span>,</span>
<span id="cb7-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">your_weight =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ÊÇ®ÁöÑ‰ΩìÈáç:"</span>,</span>
<span id="cb7-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">your_bmi =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ÊÇ®ÁöÑBMI:"</span>,</span>
<span id="cb7-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">get_ai_suggestion =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ëé∑ÂèñAIÂª∫ËÆÆ"</span></span>
<span id="cb7-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... more translations</span></span>
<span id="cb7-16">  )</span>
<span id="cb7-17">)</span>
<span id="cb7-18"></span>
<span id="cb7-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Language switching handlers</span></span>
<span id="cb7-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">observeEvent</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lang_en, {</span>
<span id="cb7-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">current_lang</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>)</span>
<span id="cb7-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_language</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>)</span>
<span id="cb7-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">updateUI</span>()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Trigger UI update</span></span>
<span id="cb7-24">})</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization">Data Visualization</h2>
<section id="interactive-plotly-charts" class="level3">
<h3 class="anchored" data-anchor-id="interactive-plotly-charts">Interactive Plotly Charts</h3>
<p>The application features dynamic charts with health indicators:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BMI chart with health ranges</span></span>
<span id="cb8-2">output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>bmi_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderPlotly</span>({</span>
<span id="cb8-3">  data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weight_data</span>()</span>
<span id="cb8-4"></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_ly</span>(data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>BMI, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'scatter'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lines+markers'</span>,</span>
<span id="cb8-6">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chart_bmi_legend"</span>),</span>
<span id="cb8-7">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb8-8">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">marker =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add health range bands</span></span>
<span id="cb8-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_trace</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18.5</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lines'</span>,</span>
<span id="cb8-11">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'green'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dash =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dash'</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Good Range Start"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_trace</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">24.9</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lines'</span>,</span>
<span id="cb8-13">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dash =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dash'</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Good Range End"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">layout</span>(</span>
<span id="cb8-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chart_bmi_title"</span>),</span>
<span id="cb8-16">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xaxis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>),</span>
<span id="cb8-17">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yaxis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BMI"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>)),</span>
<span id="cb8-18">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hovermode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x unified'</span></span>
<span id="cb8-19">    )</span>
<span id="cb8-20">})</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="deployment-and-configuration" class="level2">
<h2 class="anchored" data-anchor-id="deployment-and-configuration">Deployment and Configuration</h2>
<section id="shinyapps.io-deployment" class="level3">
<h3 class="anchored" data-anchor-id="shinyapps.io-deployment">ShinyApps.io Deployment</h3>
<p>The application is deployed and accessible at: <strong>https://jcflyingco.shinyapps.io/weight-tracking/</strong></p>
</section>
<section id="url-bookmarking-system" class="level3">
<h3 class="anchored" data-anchor-id="url-bookmarking-system">URL Bookmarking System</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Enable URL bookmarking in global.R</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shinyServer</span>(</span>
<span id="cb9-3">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(input, output, session) {</span>
<span id="cb9-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bookmarking configuration</span></span>
<span id="cb9-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enableBookmarking</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"url"</span>)</span>
<span id="cb9-6"></span>
<span id="cb9-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save/restore UI state</span></span>
<span id="cb9-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setBookmarkExclude</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lang_en"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lang_zh"</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exclude language buttons</span></span>
<span id="cb9-9">  }</span>
<span id="cb9-10">)</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="performance-optimizations" class="level2">
<h2 class="anchored" data-anchor-id="performance-optimizations">Performance Optimizations</h2>
<section id="reactive-programming-best-practices" class="level3">
<h3 class="anchored" data-anchor-id="reactive-programming-best-practices">Reactive Programming Best Practices</h3>
<p>The application implements efficient reactive programming:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Efficient data processing with caching</span></span>
<span id="cb10-2">processed_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactive</span>({</span>
<span id="cb10-3">  data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weight_data</span>()</span>
<span id="cb10-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span>
<span id="cb10-5"></span>
<span id="cb10-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate derived metrics once</span></span>
<span id="cb10-7">  data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb10-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Weight_Change =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(Weight)),</span>
<span id="cb10-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BMI_Category =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb10-11">        BMI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"underweight"</span>,</span>
<span id="cb10-12">        BMI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>,</span>
<span id="cb10-13">        BMI <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"overweight"</span>,</span>
<span id="cb10-14">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"obese"</span></span>
<span id="cb10-15">      ),</span>
<span id="cb10-16">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Date_Formatted =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(Date, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d"</span>)</span>
<span id="cb10-17">    )</span>
<span id="cb10-18">})</span>
<span id="cb10-19"></span>
<span id="cb10-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Shared calculation for multiple outputs</span></span>
<span id="cb10-21">current_stats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactive</span>({</span>
<span id="cb10-22">  data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">processed_data</span>()</span>
<span id="cb10-23">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.null</span>(data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span>
<span id="cb10-24"></span>
<span id="cb10-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb10-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">last_weight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Weight, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb10-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">last_bmi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>BMI, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb10-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calculate_trend</span>(data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Weight),</span>
<span id="cb10-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">days_tracked =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data)</span>
<span id="cb10-30">  )</span>
<span id="cb10-31">})</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="security-and-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="security-and-best-practices">Security and Best Practices</h2>
<section id="api-key-management" class="level3">
<h3 class="anchored" data-anchor-id="api-key-management">API Key Management</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Secure API key handling (session-only storage)</span></span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">observeEvent</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>get_ai_suggestion, {</span>
<span id="cb11-3">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.null</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>api_key) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span> input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>api_key <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) {</span>
<span id="cb11-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showNotification</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"please_provide_api_key"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error"</span>)</span>
<span id="cb11-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>()</span>
<span id="cb11-6">  }</span>
<span id="cb11-7"></span>
<span id="cb11-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use API key from session (no persistence)</span></span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">withBusyIndicator</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Getting AI suggestion..."</span>, {</span>
<span id="cb11-10">    suggestion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_ai_suggestion</span>(</span>
<span id="cb11-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight_data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weight_data</span>(),</span>
<span id="cb11-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">api_key =</span> input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>api_key,</span>
<span id="cb11-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ai_model,</span>
<span id="cb11-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">provider =</span> input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ai_provider</span>
<span id="cb11-15">    )</span>
<span id="cb11-16"></span>
<span id="cb11-17">    output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ai_response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderUI</span>({</span>
<span id="cb11-18">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">div</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"markdown-content"</span>,</span>
<span id="cb11-19">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HTML</span>(markdown<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderMarkdown</span>(suggestion))</span>
<span id="cb11-20">      )</span>
<span id="cb11-21">    })</span>
<span id="cb11-22">  })</span>
<span id="cb11-23">})</span></code></pre></div></div>
</details>
</div>
</section>
<section id="error-handling" class="level3">
<h3 class="anchored" data-anchor-id="error-handling">Error Handling</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Comprehensive error handling</span></span>
<span id="cb12-2">get_ai_suggestion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(...) {</span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tryCatch</span>({</span>
<span id="cb12-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API call logic</span></span>
<span id="cb12-5">    response <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ellmer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chat_completion</span>(...)</span>
<span id="cb12-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(response<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>choices[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>content)</span>
<span id="cb12-7">  }, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">error =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(e) {</span>
<span id="cb12-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Error logging and user feedback</span></span>
<span id="cb12-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log_error</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI API Error:"</span>, e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>message))</span>
<span id="cb12-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai_error_check_config"</span>))</span>
<span id="cb12-11">  })</span>
<span id="cb12-12">}</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="usage-examples-and-user-workflows" class="level2">
<h2 class="anchored" data-anchor-id="usage-examples-and-user-workflows">Usage Examples and User Workflows</h2>
<section id="daily-weight-tracking-workflow" class="level3">
<h3 class="anchored" data-anchor-id="daily-weight-tracking-workflow">Daily Weight Tracking Workflow</h3>
<ol type="1">
<li>Open the application in browser</li>
<li>View current weight trends and BMI charts</li>
<li>Add new weight data via Excel upload</li>
<li>Get AI-powered health recommendations</li>
<li>Download updated data for offline use</li>
</ol>
</section>
<section id="multi-language-usage" class="level3">
<h3 class="anchored" data-anchor-id="multi-language-usage">Multi-language Usage</h3>
<ol type="1">
<li>Switch between EN/‰∏≠Êñá using top-right buttons</li>
<li>All UI elements update dynamically</li>
<li>AI prompts adapt to selected language</li>
<li>Charts and data maintain context</li>
</ol>
</section>
</section>
<section id="technical-achievements" class="level2">
<h2 class="anchored" data-anchor-id="technical-achievements">Technical Achievements</h2>
<section id="key-innovations" class="level3">
<h3 class="anchored" data-anchor-id="key-innovations">Key Innovations</h3>
<ol type="1">
<li><strong>Real-time Excel Synchronization</strong>: Automatic UI updates when data changes</li>
<li><strong>Multi-provider AI Integration</strong>: Flexible AI provider switching</li>
<li><strong>Complete Internationalization</strong>: Full bilingual support</li>
<li><strong>Professional UI Design</strong>: Bootstrap-based responsive layout</li>
<li><strong>Interactive Visualizations</strong>: Zoomable, hoverable Plotly charts</li>
</ol>
</section>
<section id="performance-metrics" class="level3">
<h3 class="anchored" data-anchor-id="performance-metrics">Performance Metrics</h3>
<ul>
<li><strong>Data Refresh</strong>: 1-second polling interval</li>
<li><strong>Chart Rendering</strong>: &lt;100ms for typical datasets</li>
<li><strong>API Response</strong>: 2-5 seconds for AI suggestions</li>
<li><strong>Memory Usage</strong>: &lt;50MB for 1000+ records</li>
</ul>
</section>
</section>
<section id="future-enhancements" class="level2">
<h2 class="anchored" data-anchor-id="future-enhancements">Future Enhancements</h2>
<p>Potential improvements for next versions:</p>
<ol type="1">
<li><strong>Database Integration</strong>: Replace Excel with SQLite/PostgreSQL</li>
<li><strong>User Authentication</strong>: Multi-user support with personal data isolation</li>
<li><strong>Mobile Optimization</strong>: PWA features for mobile devices</li>
<li><strong>Advanced Analytics</strong>: Weight prediction models using time series</li>
<li><strong>Integration APIs</strong>: Connect with fitness trackers and health apps</li>
</ol>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This weight tracking application demonstrates the power of combining R Shiny‚Äôs reactive programming with modern AI technologies. The project showcases:</p>
<ul>
<li><strong>Sophisticated Data Management</strong>: Real-time file monitoring and reactive updates</li>
<li><strong>AI Integration</strong>: Multi-provider support with personalized health recommendations</li>
<li><strong>Internationalization</strong>: Complete bilingual implementation</li>
<li><strong>Professional UI/UX</strong>: Modern responsive design with interactive visualizations</li>
</ul>
<p>Whether you‚Äôre interested in health monitoring, data visualization, or AI integration, this project provides an excellent example of building production-grade web applications with R Shiny.</p>
<hr>


<!-- -->

</section>
</section>

 ]]></description>
  <category>AI</category>
  <category>API</category>
  <category>tutorial</category>
  <guid>https://your-website-url.example.com/posts/weight-tracking/</guid>
  <pubDate>Tue, 04 Nov 2025 16:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/weight-tracking/images/0.png" medium="image" type="image/png" height="84" width="144"/>
</item>
<item>
  <title>Whisky Tasting note with RAG</title>
  <dc:creator>Tony D</dc:creator>
  <link>https://your-website-url.example.com/posts/whisky-tasting/</link>
  <description><![CDATA[ 





<section id="project-overview" class="level1">
<h1>Project Overview</h1>
<p>The whisky tasting application is an advanced AI-powered web application that generates detailed, professional whisky tasting notes and recommendations. What makes this system special is its multi-agent architecture with specialized AI personalities, each trained on different whisky review sources and linguistic styles.</p>
<p>Live Demo(modelscope): <a href="https://modelscope.cn/studios/ttflying/whisky_AI_tasting">https://modelscope.cn/studios/ttflying/whisky_AI_tasting</a></p>
<p>Live Demo(shinyapp): <a href="https://jcflyingco.shinyapps.io/ai-whisky-tasting">https://jcflyingco.shinyapps.io/ai-whisky-tasting/</a></p>
<p>Github: <a href="https://github.com/JCwinning/whisky_tasting">https://github.com/JCwinning/whisky_tasting</a></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true" href="">AI tasting note</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false" href="">AI recommendation</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false" href="">AIÂìÅÈâ¥ËØç</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" aria-controls="tabset-1-4" aria-selected="false" href="">AIÊé®Ëçê</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p><img src="https://your-website-url.example.com/posts/whisky-tasting/images/2.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p><img src="https://your-website-url.example.com/posts/whisky-tasting/images/3.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<p><img src="https://your-website-url.example.com/posts/whisky-tasting/images/0.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div id="tabset-1-4" class="tab-pane" aria-labelledby="tabset-1-4-tab">
<p><img src="https://your-website-url.example.com/posts/whisky-tasting/images/1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</div>
<section id="core-architecture" class="level2">
<h2 class="anchored" data-anchor-id="core-architecture">Core Architecture</h2>
<section id="multi-agent-ai-system" class="level3">
<h3 class="anchored" data-anchor-id="multi-agent-ai-system">Multi-Agent AI System</h3>
<p>The application features three specialized AI agents, each with unique characteristics and data sources:</p>
<ol type="1">
<li><strong>DrunkTony (dt)</strong> - Chinese-language agent specializing in Chinese whisky reviews</li>
<li><strong>WhiskyFunny (wf)</strong> - English-language agent with data from whiskyfun.com</li>
<li><strong>WhiskyNotebook (wn)</strong> - English-language agent with data from whiskynotes.be</li>
</ol>
</section>
<section id="technology-stack" class="level3">
<h3 class="anchored" data-anchor-id="technology-stack">Technology Stack</h3>
<ul>
<li><strong>Primary Language</strong>: Python 3.13+</li>
<li><strong>Web Framework</strong>: Streamlit (primary) + Shiny for Python (alternative)</li>
<li><strong>Database</strong>: DuckDB (376MB, optimized for vector operations)</li>
<li><strong>AI/ML</strong>: OpenAI API, Vector embeddings, RAG system</li>
<li><strong>Data Sources</strong>: Web scraping with BeautifulSoup4</li>
</ul>
</section>
</section>
<section id="database-architecture" class="level2">
<h2 class="anchored" data-anchor-id="database-architecture">Database Architecture</h2>
<section id="data-schema-and-sources" class="level3">
<h3 class="anchored" data-anchor-id="data-schema-and-sources">Data Schema and Sources</h3>
<p>The system uses DuckDB as its primary database, chosen for its excellent performance with vector operations:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- Database structure</span></span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">CREATE</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">TABLE</span> drinktony_embed (</span>
<span id="cb1-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">full</span> TEXT,</span>
<span id="cb1-4">    bottle_embedding <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">FLOAT</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-- 1024-dimensional vectors</span></span>
<span id="cb1-5">);</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">CREATE</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">TABLE</span> whiskyfun_embed (</span>
<span id="cb1-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">full</span> TEXT,</span>
<span id="cb1-9">    bottle_embedding <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">FLOAT</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>]</span>
<span id="cb1-10">);</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">CREATE</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">TABLE</span> whiskynote_embed (</span>
<span id="cb1-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">full</span> TEXT,</span>
<span id="cb1-14">    bottle_embedding <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">FLOAT</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>]</span>
<span id="cb1-15">);</span></code></pre></div></div>
</section>
<section id="data-collection-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="data-collection-pipeline">Data Collection Pipeline</h3>
<div id="6e3f3970" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Web scraping example from get_data_dt.py</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> scrape_drinktony_reviews():</span>
<span id="cb2-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Scrape Chinese whisky reviews from drinktony.netlify.app"""</span></span>
<span id="cb2-4">    url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://drinktony.netlify.app/"</span></span>
<span id="cb2-5">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(url)</span>
<span id="cb2-6">    soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(response.content, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html.parser"</span>)</span>
<span id="cb2-7"></span>
<span id="cb2-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find all review links</span></span>
<span id="cb2-9">    post_links <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [urljoin(url, a.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"href"</span>))</span>
<span id="cb2-10">                 <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> a <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> soup.select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a.quarto-grid-link"</span>)]</span>
<span id="cb2-11"></span>
<span id="cb2-12">    all_reviews <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> post_url <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> post_links:</span>
<span id="cb2-14">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(post_url)</span>
<span id="cb2-15">        soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(response.content, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html.parser"</span>)</span>
<span id="cb2-16"></span>
<span id="cb2-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract review sections</span></span>
<span id="cb2-18">        review_sections <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"section.level1"</span>)</span>
<span id="cb2-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> section <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> review_sections:</span>
<span id="cb2-20">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Parse whisky name and review content</span></span>
<span id="cb2-21">            whisky_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract_whisky_name(section)</span>
<span id="cb2-22">            review_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract_review_text(section)</span>
<span id="cb2-23">            all_reviews.append({</span>
<span id="cb2-24">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'whisky'</span>: whisky_name,</span>
<span id="cb2-25">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'review'</span>: review_text</span>
<span id="cb2-26">            })</span>
<span id="cb2-27"></span>
<span id="cb2-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> all_reviews</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="aiml-implementation" class="level2">
<h2 class="anchored" data-anchor-id="aiml-implementation">AI/ML Implementation</h2>
<section id="vector-embedding-technology" class="level3">
<h3 class="anchored" data-anchor-id="vector-embedding-technology">Vector Embedding Technology</h3>
<p>The application uses state-of-the-art embedding technology to convert text into high-dimensional vectors for semantic similarity search.</p>
<section id="embedding-model-details" class="level4">
<h4 class="anchored" data-anchor-id="embedding-model-details">Embedding Model Details</h4>
<p><strong>Model</strong>: BAAI/bge-large-zh-v1.5 - <strong>Dimensions</strong>: 1024 - <strong>Provider</strong>: SiliconFlow API - <strong>Purpose</strong>: Cross-lingual text understanding (works well for both Chinese and English)</p>
</section>
<section id="why-bge-large-zh" class="level4">
<h4 class="anchored" data-anchor-id="why-bge-large-zh">Why BGE-Large-ZH?</h4>
<ol type="1">
<li><strong>Cross-lingual Capability</strong>: Excels at understanding both Chinese and English whisky terminology</li>
<li><strong>High Performance</strong>: Superior semantic understanding compared to generic embeddings</li>
<li><strong>Efficient Size</strong>: 1024 dimensions balance between performance and storage efficiency</li>
<li><strong>API Access</strong>: Stable service via SiliconFlow</li>
</ol>
</section>
<section id="embedding-process" class="level4">
<h4 class="anchored" data-anchor-id="embedding-process">Embedding Process</h4>
<p>The application uses BGE-Large-ZH-v1.5 model for generating embeddings:</p>
<div id="69c217de" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_embedding(text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, api_key: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb3-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Generate text embeddings using SiliconFlow API"""</span></span>
<span id="cb3-3">    client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb3-4">        api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>api_key,</span>
<span id="cb3-5">        base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.siliconflow.cn/v1"</span></span>
<span id="cb3-6">    )</span>
<span id="cb3-7">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.embeddings.create(</span>
<span id="cb3-8">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BAAI/bge-large-zh-v1.5"</span>,</span>
<span id="cb3-9">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[text]</span>
<span id="cb3-10">    )</span>
<span id="cb3-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.array(response.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding)</span>
<span id="cb3-12"></span>
<span id="cb3-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> cosine_similarity(v1, v2):</span>
<span id="cb3-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Calculate cosine similarity between two vectors"""</span></span>
<span id="cb3-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> v1 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">or</span> v2 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb3-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb3-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.dot(v1, v2) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (np.linalg.norm(v1) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.linalg.norm(v2))</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="rag-system-architecture" class="level3">
<h3 class="anchored" data-anchor-id="rag-system-architecture">RAG System Architecture</h3>
<p>The Retrieval-Augmented Generation (RAG) system is the core innovation of this application. Let‚Äôs explore its components in detail.</p>
</section>
<section id="rag-workflow" class="level3">
<h3 class="anchored" data-anchor-id="rag-workflow">RAG Workflow</h3>
<p>The Retrieval-Augmented Generation process follows these steps:</p>
<pre class="mermaid"><code>%%| fig-cap: "RAG Workflow for Whisky Tasting"
flowchart TD
    A[User Input&lt;br/&gt;Whisky Name] --&gt; B[Generate Embedding]
    B --&gt; C[Vector Similarity Search&lt;br/&gt;in DuckDB]
    C --&gt; D[Retrieve Top 10&lt;br/&gt;Similar Reviews]
    D --&gt; E[Format Context for LLM]
    E --&gt; F[Generate Tasting Notes&lt;br/&gt;with Primary LLM]
    F --&gt; G[Generate Recommendations&lt;br/&gt;with Secondary LLM]
    G --&gt; H[Display Results&lt;br/&gt;with Formatting]

    C --&gt; I[Databases]
    I --&gt; J[drinktony_embed&lt;br/&gt;1.2K Chinese reviews]
    I --&gt; K[whiskyfun_embed&lt;br/&gt;20K English reviews]
    I --&gt; L[whiskynote_embed&lt;br/&gt;5K English reviews]</code></pre>
</section>
<section id="similarity-search-implementation" class="level3">
<h3 class="anchored" data-anchor-id="similarity-search-implementation">Similarity Search Implementation</h3>
<div id="bbb1a061" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> find_similar_chunks(</span>
<span id="cb5-2">    query_embedding,</span>
<span id="cb5-3">    db_path,</span>
<span id="cb5-4">    table_name,</span>
<span id="cb5-5">    text_col,</span>
<span id="cb5-6">    embedding_col,</span>
<span id="cb5-7">    top_n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb5-8">):</span>
<span id="cb5-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Find most similar chunks in database using cosine similarity"""</span></span>
<span id="cb5-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb5-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(database<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>db_path, read_only<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> con:</span>
<span id="cb5-12">            df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.execute(</span>
<span id="cb5-13">                <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'SELECT "</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>text_col<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>embedding_col<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">" FROM "</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"'</span></span>
<span id="cb5-14">            ).fetchdf()</span>
<span id="cb5-15"></span>
<span id="cb5-16">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate similarities</span></span>
<span id="cb5-17">            similarities <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-18">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _, row <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> df.iterrows():</span>
<span id="cb5-19">                text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> row[text_col]</span>
<span id="cb5-20">                embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array(row[embedding_col])</span>
<span id="cb5-21">                similarity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cosine_similarity(query_embedding, embedding)</span>
<span id="cb5-22">                similarities.append((text, similarity))</span>
<span id="cb5-23"></span>
<span id="cb5-24">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by similarity and return top N</span></span>
<span id="cb5-25">            similarities.sort(key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb5-26">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> similarities[:top_n]</span>
<span id="cb5-27"></span>
<span id="cb5-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb5-29">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Error searching similar chunks: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> []</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="specialized-agent-implementation" class="level2">
<h2 class="anchored" data-anchor-id="specialized-agent-implementation">Specialized Agent Implementation</h2>
<section id="drunktony-chinese-agent" class="level3">
<h3 class="anchored" data-anchor-id="drunktony-chinese-agent">DrunkTony (Chinese Agent)</h3>
<div id="bb494418" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> run_conversation(query, api_key, model):</span>
<span id="cb6-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Generate whisky tasting notes in Chinese format"""</span></span>
<span id="cb6-3"></span>
<span id="cb6-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Step 1: Generate embedding and find similar reviews</span></span>
<span id="cb6-5">    query_embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_embedding(query, api_key)</span>
<span id="cb6-6">    similar_reviews <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> find_similar_chunks(</span>
<span id="cb6-7">        query_embedding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query_embedding,</span>
<span id="cb6-8">        db_path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/whisky_database.duckdb"</span>,</span>
<span id="cb6-9">        table_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drinktony_embed"</span>,</span>
<span id="cb6-10">        text_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"full"</span>,</span>
<span id="cb6-11">        embedding_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottle_embedding"</span></span>
<span id="cb6-12">    )</span>
<span id="cb6-13"></span>
<span id="cb6-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Step 2: Format context for LLM</span></span>
<span id="cb6-15">    context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">---</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([review[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> review <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> similar_reviews])</span>
<span id="cb6-16"></span>
<span id="cb6-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Step 3: Generate tasting notes</span></span>
<span id="cb6-18">    prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""‰Ωú‰∏∫Â®ÅÂ£´Âøå‰∏ìÂÆ∂ÔºåÂü∫‰∫é‰ª•‰∏ãÂ®ÅÂ£´ÂøåÂìÅÈâ¥Á¨îËÆ∞Ôºå‰∏∫"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>query<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"ÁîüÊàê‰∏ì‰∏öÁöÑÂìÅÈâ¥Êä•ÂëäÔºö</span></span>
<span id="cb6-19"></span>
<span id="cb6-20"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">ÂèÇËÄÉÂìÅÈâ¥Á¨îËÆ∞Ôºö</span></span>
<span id="cb6-21"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>context<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-22"></span>
<span id="cb6-23"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">ËØ∑Êåâ‰ª•‰∏ãÊ†ºÂºèËæìÂá∫Ôºö</span></span>
<span id="cb6-24"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>query<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-25"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">ÈóªÈ¶ô: [ËØ¶ÁªÜÊèèËø∞]</span></span>
<span id="cb6-26"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">ÂìÅÂë≥: [ËØ¶ÁªÜÊèèËø∞]</span></span>
<span id="cb6-27"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">ÊâìÂàÜ: [90-100ÂàÜ]</span></span>
<span id="cb6-28"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb6-29"></span>
<span id="cb6-30">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm_client.chat.completions.create(</span>
<span id="cb6-31">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model,</span>
<span id="cb6-32">        messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb6-33">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‰Ω†ÊòØ‰∏Ä‰Ωç‰∏ì‰∏öÁöÑÂ®ÅÂ£´ÂøåÂìÅÈâ¥Â∏àÔºåÊìÖÈïøÁîüÊàêËØ¶ÁªÜÂáÜÁ°ÆÁöÑÂìÅÈâ¥Á¨îËÆ∞„ÄÇ"</span>},</span>
<span id="cb6-34">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt}</span>
<span id="cb6-35">        ],</span>
<span id="cb6-36">        temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>,</span>
<span id="cb6-37">        max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb6-38">    )</span>
<span id="cb6-39"></span>
<span id="cb6-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content</span></code></pre></div></div>
</details>
</div>
</section>
<section id="whiskyfunny-english-agent" class="level3">
<h3 class="anchored" data-anchor-id="whiskyfunny-english-agent">WhiskyFunny (English Agent)</h3>
<div id="d7ecee90" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> run_conversation(query, api_key, model):</span>
<span id="cb7-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Generate whisky tasting notes in English format"""</span></span>
<span id="cb7-3"></span>
<span id="cb7-4">    query_embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_embedding(query, api_key)</span>
<span id="cb7-5">    similar_reviews <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> find_similar_chunks(</span>
<span id="cb7-6">        query_embedding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query_embedding,</span>
<span id="cb7-7">        db_path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/whisky_database.duckdb"</span>,</span>
<span id="cb7-8">        table_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"whiskyfun_embed"</span>,</span>
<span id="cb7-9">        text_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"full"</span>,</span>
<span id="cb7-10">        embedding_col<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottle_embedding"</span></span>
<span id="cb7-11">    )</span>
<span id="cb7-12"></span>
<span id="cb7-13">    context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">---</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([review[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> review <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> similar_reviews])</span>
<span id="cb7-14"></span>
<span id="cb7-15">    prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""As a whisky expert, generate professional tasting notes for "</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>query<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">" based on these reference reviews:</span></span>
<span id="cb7-16"></span>
<span id="cb7-17"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Reference reviews:</span></span>
<span id="cb7-18"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>context<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-19"></span>
<span id="cb7-20"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Please output in this format:</span></span>
<span id="cb7-21"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Colour: [detailed description]</span></span>
<span id="cb7-22"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Nose: [detailed aroma description]</span></span>
<span id="cb7-23"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Mouth: [detailed taste description]</span></span>
<span id="cb7-24"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Finish: [detailed finish description]</span></span>
<span id="cb7-25"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Comments: [overall impression]</span></span>
<span id="cb7-26"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">SGP: xxx - xx points</span></span>
<span id="cb7-27"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb7-28"></span>
<span id="cb7-29">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm_client.chat.completions.create(</span>
<span id="cb7-30">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model,</span>
<span id="cb7-31">        messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb7-32">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are a professional whisky taster specializing in detailed sensory analysis."</span>},</span>
<span id="cb7-33">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt}</span>
<span id="cb7-34">        ],</span>
<span id="cb7-35">        temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>,</span>
<span id="cb7-36">        max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1200</span></span>
<span id="cb7-37">    )</span>
<span id="cb7-38"></span>
<span id="cb7-39">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="recommendation-engine" class="level2">
<h2 class="anchored" data-anchor-id="recommendation-engine">Recommendation Engine</h2>
<section id="dual-llm-recommendation-system" class="level3">
<h3 class="anchored" data-anchor-id="dual-llm-recommendation-system">Dual-LLM Recommendation System</h3>
<p>The application uses a separate LLM for generating whisky recommendations:</p>
<div id="4373ef9d" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> recommend_whiskies_by_profile(tasting_notes, api_key, model):</span>
<span id="cb8-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Generate whisky recommendations based on tasting profile"""</span></span>
<span id="cb8-3"></span>
<span id="cb8-4">    prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""Based on these tasting notes, recommend 2 similar whiskies that the user might enjoy:</span></span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>Tasting Notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:}</span></span>
<span id="cb8-7"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tasting_notes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-8"></span>
<span id="cb8-9"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Please provide:</span></span>
<span id="cb8-10"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">1. Whisky name with brief description</span></span>
<span id="cb8-11"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">2. Why it matches the user's preference</span></span>
<span id="cb8-12"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">3. Price range and availability</span></span>
<span id="cb8-13"></span>
<span id="cb8-14"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Format each recommendation as:</span></span>
<span id="cb8-15"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">**Recommendation [1/2]:** [Whisky Name]</span></span>
<span id="cb8-16"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">**Why it matches:** [detailed reasoning]</span></span>
<span id="cb8-17"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">**Details:** [price, availability, tasting profile]</span></span>
<span id="cb8-18"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb8-19"></span>
<span id="cb8-20">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> recommendation_client.chat.completions.create(</span>
<span id="cb8-21">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Different model for recommendations</span></span>
<span id="cb8-22">        messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb8-23">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are a whisky recommendation expert with deep knowledge of global whisky brands and profiles."</span>},</span>
<span id="cb8-24">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt}</span>
<span id="cb8-25">        ],</span>
<span id="cb8-26">        temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb8-27">        max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span></span>
<span id="cb8-28">    )</span>
<span id="cb8-29"></span>
<span id="cb8-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="user-interface-design" class="level2">
<h2 class="anchored" data-anchor-id="user-interface-design">User Interface Design</h2>
<section id="streamlit-implementation" class="level3">
<h3 class="anchored" data-anchor-id="streamlit-implementation">Streamlit Implementation</h3>
<div id="e80a1540" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Main application interface</span></span>
<span id="cb9-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> main():</span>
<span id="cb9-3">    st.set_page_config(</span>
<span id="cb9-4">        page_title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Whisky Tasting System"</span>,</span>
<span id="cb9-5">        page_icon<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ü•É"</span>,</span>
<span id="cb9-6">        layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wide"</span></span>
<span id="cb9-7">    )</span>
<span id="cb9-8"></span>
<span id="cb9-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sidebar for agent selection</span></span>
<span id="cb9-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> st.sidebar:</span>
<span id="cb9-11">        st.header(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ü•É Whisky AI Tasting"</span>)</span>
<span id="cb9-12"></span>
<span id="cb9-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent selection</span></span>
<span id="cb9-14">        agent_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.selectbox(</span>
<span id="cb9-15">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Select Tasting Agent:"</span>,</span>
<span id="cb9-16">            [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DrunkTony (‰∏≠Êñá)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WhiskyFunny (English)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WhiskyNotebook (English)"</span>],</span>
<span id="cb9-17">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Each agent has different personality and data sources"</span></span>
<span id="cb9-18">        )</span>
<span id="cb9-19"></span>
<span id="cb9-20">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Model selection</span></span>
<span id="cb9-21">        model_options <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_model_options(agent_type)</span>
<span id="cb9-22">        selected_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.selectbox(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model:"</span>, model_options)</span>
<span id="cb9-23"></span>
<span id="cb9-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Main content area</span></span>
<span id="cb9-25">    st.header(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Professional Whisky Tasting Notes Generator"</span>)</span>
<span id="cb9-26"></span>
<span id="cb9-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Input section</span></span>
<span id="cb9-28">    col1, col2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.columns([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb9-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> col1:</span>
<span id="cb9-30">        whisky_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.text_input(</span>
<span id="cb9-31">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enter whisky name:"</span>,</span>
<span id="cb9-32">            placeholder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e.g., Macallan 18 Year Old"</span>,</span>
<span id="cb9-33">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enter the full whisky name including age and cask type"</span></span>
<span id="cb9-34">        )</span>
<span id="cb9-35"></span>
<span id="cb9-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> col2:</span>
<span id="cb9-37">        st.write(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Spacer</span></span>
<span id="cb9-38">        generate_btn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.button(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"üç∑ Generate Tasting Notes"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"primary"</span>)</span>
<span id="cb9-39">        recommend_btn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.button(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"üéØ Get Recommendations"</span>)</span>
<span id="cb9-40"></span>
<span id="cb9-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Output sections</span></span>
<span id="cb9-42">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> generate_btn:</span>
<span id="cb9-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> whisky_name:</span>
<span id="cb9-44">            st.error(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Please enter a whisky name"</span>)</span>
<span id="cb9-45">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb9-46">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> st.spinner(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Analyzing whisky..."</span>):</span>
<span id="cb9-47">                tasting_notes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_tasting_notes(whisky_name, agent_type, selected_model)</span>
<span id="cb9-48">                st.markdown(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"### ü•É Tasting Notes"</span>)</span>
<span id="cb9-49">                st.markdown(tasting_notes)</span>
<span id="cb9-50"></span>
<span id="cb9-51">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> recommend_btn:</span>
<span id="cb9-52">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> st.spinner(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Finding recommendations..."</span>):</span>
<span id="cb9-53">            recommendations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_recommendations(tasting_notes, agent_type)</span>
<span id="cb9-54">            st.markdown(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"### üéØ Personalized Recommendations"</span>)</span>
<span id="cb9-55">            st.markdown(recommendations)</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="rate-limiting-and-cost-management" class="level2">
<h2 class="anchored" data-anchor-id="rate-limiting-and-cost-management">Rate Limiting and Cost Management</h2>
<section id="api-usage-control" class="level3">
<h3 class="anchored" data-anchor-id="api-usage-control">API Usage Control</h3>
<div id="5b9f044c" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rate limiting implementation</span></span>
<span id="cb10-2">RATE_LIMIT_FILE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rate_limit.json"</span></span>
<span id="cb10-3">MAX_RUNS_PER_DAY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span></span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_rate_limit_data():</span>
<span id="cb10-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Get current usage data"""</span></span>
<span id="cb10-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb10-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(RATE_LIMIT_FILE, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb10-9">            data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json.load(f)</span>
<span id="cb10-10">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure keys exist</span></span>
<span id="cb10-11">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> data <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">or</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> data:</span>
<span id="cb10-12">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(datetime.date.today()), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}</span>
<span id="cb10-13">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> data</span>
<span id="cb10-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> (<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">FileNotFoundError</span>, json.JSONDecodeError):</span>
<span id="cb10-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(datetime.date.today()), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}</span>
<span id="cb10-16"></span>
<span id="cb10-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> check_rate_limit():</span>
<span id="cb10-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Check if user has exceeded daily limit"""</span></span>
<span id="cb10-19">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_rate_limit_data()</span>
<span id="cb10-20">    today <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(datetime.date.today())</span>
<span id="cb10-21"></span>
<span id="cb10-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> today:</span>
<span id="cb10-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reset counter for new day</span></span>
<span id="cb10-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>: today, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"can_run"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>}</span>
<span id="cb10-25"></span>
<span id="cb10-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> MAX_RUNS_PER_DAY:</span>
<span id="cb10-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>: today, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>: data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"can_run"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>}</span>
<span id="cb10-28"></span>
<span id="cb10-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>: today, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>: data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"can_run"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>}</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="performance-optimization" class="level2">
<h2 class="anchored" data-anchor-id="performance-optimization">Performance Optimization</h2>
<section id="vector-database-performance" class="level3">
<h3 class="anchored" data-anchor-id="vector-database-performance">Vector Database Performance</h3>
<div id="764b95a4" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optimized similarity search with batching</span></span>
<span id="cb11-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> batch_similarity_search(query_embedding, db_path, table_name, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>):</span>
<span id="cb11-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Optimized similarity search with batching for large datasets"""</span></span>
<span id="cb11-4"></span>
<span id="cb11-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> duckdb.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(database<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>db_path, read_only<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> con:</span>
<span id="cb11-6">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get total row count</span></span>
<span id="cb11-7">        total_rows <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.execute(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"SELECT COUNT(*) FROM </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>).fetchone()[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb11-8"></span>
<span id="cb11-9">        all_similarities <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb11-10"></span>
<span id="cb11-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Process in batches to manage memory</span></span>
<span id="cb11-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> offset <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, total_rows, batch_size):</span>
<span id="cb11-13">            batch_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> con.execute(</span>
<span id="cb11-14">                <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'SELECT full, bottle_embedding FROM </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> LIMIT </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>batch_size<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> OFFSET </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>offset<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb11-15">            ).fetchdf()</span>
<span id="cb11-16"></span>
<span id="cb11-17">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate similarities for batch</span></span>
<span id="cb11-18">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _, row <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> batch_df.iterrows():</span>
<span id="cb11-19">                embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array(row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bottle_embedding'</span>])</span>
<span id="cb11-20">                similarity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cosine_similarity(query_embedding, embedding)</span>
<span id="cb11-21">                all_similarities.append((row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'full'</span>], similarity))</span>
<span id="cb11-22"></span>
<span id="cb11-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort and return top results</span></span>
<span id="cb11-24">        all_similarities.sort(key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb11-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> all_similarities[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="deployment-and-configuration" class="level2">
<h2 class="anchored" data-anchor-id="deployment-and-configuration">Deployment and Configuration</h2>
<section id="environment-setup" class="level3">
<h3 class="anchored" data-anchor-id="environment-setup">Environment Setup</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Environment variables in .env file</span></span>
<span id="cb12-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">SILICONFLOW_API_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>your_siliconflow_key</span>
<span id="cb12-3"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MODELSCOPE_API_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>your_modelscope_key</span>
<span id="cb12-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">GEMINI_API_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>your_gemini_key  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optional</span></span>
<span id="cb12-5"></span>
<span id="cb12-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Database initialization</span></span>
<span id="cb12-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb12-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">import duckdb</span></span>
<span id="cb12-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">conn = duckdb.connect('data/whisky_database.duckdb')</span></span>
<span id="cb12-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"># Create tables with vector support</span></span>
<span id="cb12-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div></div>
</section>
<section id="shiny-for-python-alternative" class="level3">
<h3 class="anchored" data-anchor-id="shiny-for-python-alternative">Shiny for Python Alternative</h3>
<div id="6df67dc2" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Alternative UI implementation using Shiny</span></span>
<span id="cb13-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shiny <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> App, ui, render, reactive, req</span>
<span id="cb13-3"></span>
<span id="cb13-4">app_ui <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ui.page_fluid(</span>
<span id="cb13-5">    ui.h2(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ü•É AI Whisky Tasting System"</span>),</span>
<span id="cb13-6">    ui.layout_sidebar(</span>
<span id="cb13-7">        ui.sidebar(</span>
<span id="cb13-8">            ui.input_select(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Select Agent:"</span>, [</span>
<span id="cb13-9">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DrunkTony (‰∏≠Êñá)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WhiskyFunny (English)"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WhiskyNotebook (English)"</span></span>
<span id="cb13-10">            ]),</span>
<span id="cb13-11">            ui.input_text(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"whisky_name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Whisky Name:"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>),</span>
<span id="cb13-12">            ui.input_action_button(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Generate Notes"</span>)</span>
<span id="cb13-13">        ),</span>
<span id="cb13-14">        ui.output_text_verbatim(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tasting_notes"</span>),</span>
<span id="cb13-15">        ui.output_text_verbatim(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"recommendations"</span>)</span>
<span id="cb13-16">    )</span>
<span id="cb13-17">)</span>
<span id="cb13-18"></span>
<span id="cb13-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> server(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>, output, session):</span>
<span id="cb13-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@output</span></span>
<span id="cb13-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@render.text</span></span>
<span id="cb13-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> tasting_notes():</span>
<span id="cb13-23">        req(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>.generate())</span>
<span id="cb13-24">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate tasting notes logic</span></span>
<span id="cb13-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> generate_tasting_notes(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>.whisky_name(), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>.agent())</span>
<span id="cb13-26"></span>
<span id="cb13-27">app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> App(app_ui, server)</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="technical-achievements" class="level2">
<h2 class="anchored" data-anchor-id="technical-achievements">Technical Achievements</h2>
<section id="key-innovations" class="level3">
<h3 class="anchored" data-anchor-id="key-innovations">Key Innovations</h3>
<ol type="1">
<li><strong>Multi-Agent Architecture</strong>: Different AI personalities and data sources</li>
<li><strong>RAG Implementation</strong>: Retrieval-augmented generation with real whisky reviews</li>
<li><strong>Vector Database</strong>: Efficient similarity search with 376MB database</li>
<li><strong>Bilingual Support</strong>: Chinese and English language agents</li>
<li><strong>Cost Management</strong>: Built-in rate limiting and API optimization</li>
<li><strong>Professional Tasting Formats</strong>: Industry-standard note structures</li>
</ol>
</section>
<section id="performance-metrics" class="level3">
<h3 class="anchored" data-anchor-id="performance-metrics">Performance Metrics</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Database Size</td>
<td>376MB (26K+ reviews)</td>
</tr>
<tr class="even">
<td>Embedding Dimension</td>
<td>1024</td>
</tr>
<tr class="odd">
<td>Search Latency</td>
<td>&lt;2 seconds</td>
</tr>
<tr class="even">
<td>Daily Request Limit</td>
<td>80 requests</td>
</tr>
<tr class="odd">
<td>Support Languages</td>
<td>2 (EN/ZH)</td>
</tr>
<tr class="even">
<td>Data Sources</td>
<td>3 (drinktony, whiskyfun, whiskynotes)</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="future-enhancements" class="level2">
<h2 class="anchored" data-anchor-id="future-enhancements">Future Enhancements</h2>
<p>Potential improvements for next versions:</p>
<ol type="1">
<li><strong>Advanced Similarity Algorithms</strong>: Implement hybrid search with text + metadata</li>
<li><strong>User Personalization</strong>: Learn from user preferences over time</li>
<li><strong>Mobile App</strong>: Native iOS/Android applications</li>
<li><strong>Real-time Data Updates</strong>: Automated web scraping pipeline</li>
<li><strong>Tasting Profile Analysis</strong>: Generate user taste profiles from preferences</li>
<li><strong>Social Features</strong>: Share tasting notes and recommendations with community</li>
</ol>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This whisky tasting application demonstrates the power of combining RAG technology with specialized AI agents to create a sophisticated domain-specific system. The project showcases:</p>
<ul>
<li><strong>Advanced AI Architecture</strong>: Multi-agent system with different personalities</li>
<li><strong>Data Engineering</strong>: Large-scale vector database management</li>
<li><strong>Professional Knowledge</strong>: Industry-standard tasting note formats</li>
<li><strong>User Experience</strong>: Clean, intuitive interfaces across platforms</li>
<li><strong>Cost Efficiency</strong>: Smart rate limiting and optimization</li>
</ul>
<p>Whether you‚Äôre a whisky enthusiast, AI developer, or data scientist, this project provides an excellent example of building production-grade AI applications that combine real-world data with advanced machine learning techniques.</p>
<hr>
<p><strong>Technology Stack</strong>: Python, Streamlit, DuckDB, OpenAI API, Vector Embeddings</p>
<p><strong>Database</strong>: 26K+ real whisky reviews across 3 specialized sources</p>


<!-- -->

</section>
</section>

 ]]></description>
  <category>AI</category>
  <category>API</category>
  <category>tutorial</category>
  <guid>https://your-website-url.example.com/posts/whisky-tasting/</guid>
  <pubDate>Tue, 04 Nov 2025 16:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/whisky-tasting/images/0.png" medium="image" type="image/png" height="66" width="144"/>
</item>
<item>
  <title>YOLO Object Detection App with Streamlit</title>
  <dc:creator>Tony D</dc:creator>
  <link>https://your-website-url.example.com/posts/yolo-app/</link>
  <description><![CDATA[ 





<section id="overview" class="level1">
<h1>Overview</h1>
<p>The application is a comprehensive Streamlit web app that provides object detection capabilities using YOLO11 (Ultralytics framework) with support for multiple input sources and processing backends. What makes this project special is its multi-model architecture and production-ready features.</p>
<p>Live Demo: <a href="https://yolo-live.streamlit.app/">https://yolo-live.streamlit.app/</a></p>
<p>Github: <a href="https://github.com/JCwinning/YOLO_app">https://github.com/JCwinning/YOLO_app</a></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true" href="">Object detection</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false" href="">Áâ©‰ΩìËØÜÂà´</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/yolo-app/images/0.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Application Screenshot - Main Interface</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://your-website-url.example.com/posts/yolo-app/images/1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Application Screenshot - Detection Results</figcaption>
</figure>
</div>
</div>
</div>
</div>
<section id="key-features" class="level2">
<h2 class="anchored" data-anchor-id="key-features">Key Features</h2>
<section id="multi-input-support" class="level3">
<h3 class="anchored" data-anchor-id="multi-input-support">Multi-Input Support</h3>
<p>The application supports various input methods: - <strong>File Upload</strong>: Images and videos from local storage - <strong>URL Input</strong>: Direct image URLs from the web - <strong>Live Camera</strong>: Real-time photo capture using device cameras</p>
</section>
<section id="multi-model-architecture" class="level3">
<h3 class="anchored" data-anchor-id="multi-model-architecture">Multi-Model Architecture</h3>
<p>One of the standout features is the support for different AI models:</p>
<section id="local-yolo11-models" class="level4">
<h4 class="anchored" data-anchor-id="local-yolo11-models">1. Local YOLO11 Models</h4>
<ul>
<li>Five different model variants (nano, small, medium, large, extra-large)</li>
<li>Automatic device detection with MPS acceleration for Apple Silicon</li>
<li>CPU fallback for broader compatibility</li>
</ul>
</section>
<section id="cloud-based-models" class="level4">
<h4 class="anchored" data-anchor-id="cloud-based-models">2. Cloud-Based Models</h4>
<ul>
<li><strong>Qwen-Image-Edit</strong> via DashScope API for advanced image annotation</li>
<li><strong>Gemini 2.5 Flash Image</strong> via OpenRouter API for cutting-edge processing</li>
</ul>
</section>
</section>
<section id="advanced-features" class="level3">
<h3 class="anchored" data-anchor-id="advanced-features">Advanced Features</h3>
<ul>
<li><strong>Bilingual Interface</strong>: Full English/Chinese support with 113+ translated strings</li>
<li><strong>Smart UI Management</strong>: Automatic hiding of input images after processing</li>
<li><strong>Download Capabilities</strong>: Save annotated results locally</li>
<li><strong>Progress Tracking</strong>: Real-time progress updates for video processing</li>
<li><strong>Session Management</strong>: Persistent state across user interactions</li>
</ul>
</section>
</section>
<section id="technical-architecture" class="level2">
<h2 class="anchored" data-anchor-id="technical-architecture">Technical Architecture</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>

</div>
<p></p><figcaption> System Architecture Diagram</figcaption> </figure><p></p>
</div>
</div>
</div>
<section id="core-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="core-dependencies">Core Dependencies</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[project]</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo-app"</span></span>
<span id="cb1-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">requires-python</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&gt;=3.12"</span></span>
<span id="cb1-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">dependencies</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb1-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashscope&gt;=1.17.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Alibaba Cloud API</span></span>
<span id="cb1-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"opencv-python&gt;=4.11.0.86"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Computer vision</span></span>
<span id="cb1-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"streamlit&gt;=1.50.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Web framework</span></span>
<span id="cb1-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"torch&gt;=2.2"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Deep learning</span></span>
<span id="cb1-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ultralytics&gt;=8.3.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># YOLO framework</span></span>
<span id="cb1-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div></div>
</section>
<section id="application-structure" class="level3">
<h3 class="anchored" data-anchor-id="application-structure">Application Structure</h3>
<p>The main application (<code>app.py</code>) consists of over 1,000 lines of well-structured Python code organized into several key components:</p>
<section id="internationalization-system" class="level4">
<h4 class="anchored" data-anchor-id="internationalization-system">1. Internationalization System</h4>
<div id="3b8b774a" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> language <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> translations</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_translation(key, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs):</span>
<span id="cb2-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Translation function that uses the current session language"""</span></span>
<span id="cb2-5">    lang <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.session_state.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"language"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>)</span>
<span id="cb2-6">    text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> translations[lang].get(key, translations[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>].get(key, key))</span>
<span id="cb2-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> text.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> kwargs <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> text</span></code></pre></div></div>
</details>
</div>
</section>
<section id="device-optimization" class="level4">
<h4 class="anchored" data-anchor-id="device-optimization">2. Device Optimization</h4>
<div id="732a5006" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_device():</span>
<span id="cb3-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Automatically detect the best available device"""</span></span>
<span id="cb3-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> torch.backends.mps.is_available():</span>
<span id="cb3-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apple Silicon GPU acceleration</span></span>
<span id="cb3-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cpu"</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fallback to CPU</span></span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Model loading with device optimization</span></span>
<span id="cb3-8">device <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_device()</span>
<span id="cb3-9">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> YOLO(selected_model).to(device)</span>
<span id="cb3-10">st.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Using device: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>device<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>upper()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="image-processing-pipeline" class="level4">
<h4 class="anchored" data-anchor-id="image-processing-pipeline">3. Image Processing Pipeline</h4>
<div id="0d2154c5" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> encode_image_to_base64(image):</span>
<span id="cb4-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Encode PIL Image to base64 string with size compression"""</span></span>
<span id="cb4-3">    max_size_bytes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 8MB limit</span></span>
<span id="cb4-4"></span>
<span id="cb4-5">    formats_and_qualities <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb4-6">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JPEG"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>), (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JPEG"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>), (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JPEG"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>),</span>
<span id="cb4-7">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WEBP"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>), (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WEBP"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>), (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WEBP"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>),</span>
<span id="cb4-8">    ]</span>
<span id="cb4-9"></span>
<span id="cb4-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> fmt, quality <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> formats_and_qualities:</span>
<span id="cb4-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Try different compression strategies</span></span>
<span id="cb4-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... compression logic</span></span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="multi-model-processing" class="level3">
<h3 class="anchored" data-anchor-id="multi-model-processing">Multi-Model Processing</h3>
<section id="local-yolo-processing" class="level4">
<h4 class="anchored" data-anchor-id="local-yolo-processing">Local YOLO Processing</h4>
<p>The app supports all YOLO11 model variants with automatic performance optimization:</p>
<div id="34ee6418" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Model selection interface</span></span>
<span id="cb5-2">model_options <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11n.pt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11s.pt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11m.pt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11l.pt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11x.pt"</span>]</span>
<span id="cb5-3">model_descriptions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb5-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11n.pt"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nano - Fastest, lowest accuracy"</span>,</span>
<span id="cb5-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11s.pt"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Small - Good balance"</span>,</span>
<span id="cb5-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11m.pt"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medium - Recommended"</span>,</span>
<span id="cb5-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11l.pt"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Large - Higher accuracy"</span>,</span>
<span id="cb5-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11x.pt"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Extra Large - Highest accuracy"</span></span>
<span id="cb5-9">}</span>
<span id="cb5-10"></span>
<span id="cb5-11">selected_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> st.sidebar.selectbox(</span>
<span id="cb5-12">    get_translation(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"model_selection"</span>),</span>
<span id="cb5-13">    model_options,</span>
<span id="cb5-14">    index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model_options.index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yolo11s.pt"</span>),</span>
<span id="cb5-15">    format_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>model_descriptions[x]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span></span>
<span id="cb5-16">)</span>
<span id="cb5-17"></span>
<span id="cb5-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Detection process with progress tracking</span></span>
<span id="cb5-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> detect_objects(image, model, confidence_threshold<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>):</span>
<span id="cb5-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Perform object detection with progress tracking"""</span></span>
<span id="cb5-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> st.spinner(get_translation(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"processing"</span>)):</span>
<span id="cb5-22">        results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.predict(image, conf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>confidence_threshold)</span>
<span id="cb5-23"></span>
<span id="cb5-24">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Process results</span></span>
<span id="cb5-25">        detections <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> result <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> results:</span>
<span id="cb5-27">            boxes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result.boxes</span>
<span id="cb5-28">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> box <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> boxes:</span>
<span id="cb5-29">                x1, y1, x2, y2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> box.xyxy[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].cpu().numpy()</span>
<span id="cb5-30">                conf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> box.conf[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].cpu().numpy()</span>
<span id="cb5-31">                cls <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(box.cls[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].cpu().numpy())</span>
<span id="cb5-32">                class_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.names[cls]</span>
<span id="cb5-33"></span>
<span id="cb5-34">                detections.append({</span>
<span id="cb5-35">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'class'</span>: class_name,</span>
<span id="cb5-36">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>: conf,</span>
<span id="cb5-37">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bbox'</span>: [x1, y1, x2, y2]</span>
<span id="cb5-38">                })</span>
<span id="cb5-39"></span>
<span id="cb5-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> detections, results</span></code></pre></div></div>
</details>
</div>
</section>
<section id="cloud-api-integration" class="level4">
<h4 class="anchored" data-anchor-id="cloud-api-integration">Cloud API Integration</h4>
<p>For cloud-based models, the app handles API authentication and request formatting:</p>
<div id="1760b2b2" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> process_with_qwen(image, api_key):</span>
<span id="cb6-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Process image using Qwen-Image-Edit via DashScope"""</span></span>
<span id="cb6-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb6-4">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MultiModalConversation.call(</span>
<span id="cb6-5">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'qwen-image-edit'</span>,</span>
<span id="cb6-6">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb6-7">                {</span>
<span id="cb6-8">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'role'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'user'</span>,</span>
<span id="cb6-9">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'content'</span>: [</span>
<span id="cb6-10">                        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'image'</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"data:image/jpeg;base64,</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>image_b64<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>},</span>
<span id="cb6-11">                        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Please identify and label all objects in this image.'</span>}</span>
<span id="cb6-12">                    ]</span>
<span id="cb6-13">                }</span>
<span id="cb6-14">            ]</span>
<span id="cb6-15">        )</span>
<span id="cb6-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response</span>
<span id="cb6-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb6-18">        st.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"API Error: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span></code></pre></div></div>
</details>
</div>
</section>
</section>
</section>
<section id="user-interface-design" class="level2">
<h2 class="anchored" data-anchor-id="user-interface-design">User Interface Design</h2>
<section id="layout-structure" class="level3">
<h3 class="anchored" data-anchor-id="layout-structure">Layout Structure</h3>
<p>The application uses a professional three-column layout:</p>
<ol type="1">
<li><strong>Sidebar</strong>: Model selection, confidence threshold, language settings</li>
<li><strong>Main Area</strong>: Input method selection, image/video display, results</li>
<li><strong>Results Panel</strong>: Detection statistics, download options</li>
</ol>
</section>
<section id="bilingual-support" class="level3">
<h3 class="anchored" data-anchor-id="bilingual-support">Bilingual Support</h3>
<p>The translation system handles all UI elements:</p>
<div id="af5be7e6" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">translations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb7-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>: {</span>
<span id="cb7-3">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YOLO11 Object Detection"</span>,</span>
<span id="cb7-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upload_file"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Upload File"</span>,</span>
<span id="cb7-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"camera_input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Use Camera"</span>,</span>
<span id="cb7-6">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... more strings</span></span>
<span id="cb7-7">    },</span>
<span id="cb7-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zh"</span>: {</span>
<span id="cb7-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"YOLO11 ÁõÆÊ†áÊ£ÄÊµã"</span>,</span>
<span id="cb7-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upload_file"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‰∏ä‰º†Êñá‰ª∂"</span>,</span>
<span id="cb7-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"camera_input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‰ΩøÁî®Áõ∏Êú∫"</span>,</span>
<span id="cb7-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ... corresponding translations</span></span>
<span id="cb7-13">    }</span>
<span id="cb7-14">}</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="performance-optimizations" class="level2">
<h2 class="anchored" data-anchor-id="performance-optimizations">Performance Optimizations</h2>
<section id="model-performance-comparison" class="level3">
<h3 class="anchored" data-anchor-id="model-performance-comparison">Model Performance Comparison</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 18%">
<col style="width: 7%">
<col style="width: 31%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Parameters</th>
<th>mAP</th>
<th>Inference Time (CPU)</th>
<th>Inference Time (MPS)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>YOLO11n</td>
<td>2.6M</td>
<td>37.2</td>
<td>15ms</td>
<td>3ms</td>
</tr>
<tr class="even">
<td>YOLO11s</td>
<td>9.4M</td>
<td>45.5</td>
<td>28ms</td>
<td>6ms</td>
</tr>
<tr class="odd">
<td>YOLO11m</td>
<td>25.4M</td>
<td>51.2</td>
<td>52ms</td>
<td>12ms</td>
</tr>
<tr class="even">
<td>YOLO11l</td>
<td>43.7M</td>
<td>53.4</td>
<td>84ms</td>
<td>18ms</td>
</tr>
<tr class="odd">
<td>YOLO11x</td>
<td>68.2M</td>
<td>54.7</td>
<td>126ms</td>
<td>26ms</td>
</tr>
</tbody>
</table>
</section>
<section id="apple-silicon-acceleration" class="level3">
<h3 class="anchored" data-anchor-id="apple-silicon-acceleration">Apple Silicon Acceleration</h3>
<p>The app automatically detects and utilizes Metal Performance Shaders (MPS) on Apple Silicon devices:</p>
<div id="3c8ceb12" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">device <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> torch.backends.mps.is_available() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cpu"</span></span>
<span id="cb8-2">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> YOLO(selected_model).to(device)</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Performance monitoring</span></span>
<span id="cb8-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb8-6">start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb8-7">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.predict(image)</span>
<span id="cb8-8">inference_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb8-9"></span>
<span id="cb8-10">st.metric(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Inference Time (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>device<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>upper()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>inference_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">ms"</span>)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="image-compression-for-cloud-apis" class="level3">
<h3 class="anchored" data-anchor-id="image-compression-for-cloud-apis">Image Compression for Cloud APIs</h3>
<p>To meet API size limits, the app implements smart image compression:</p>
<div id="04bf9668" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> compress_image_for_api(image, max_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>):</span>
<span id="cb9-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Compress image to meet API requirements"""</span></span>
<span id="cb9-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> quality <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>]:</span>
<span id="cb9-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> fmt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JPEG"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WEBP"</span>]:</span>
<span id="cb9-5">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">buffer</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BytesIO()</span>
<span id="cb9-6">            image.save(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">buffer</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fmt, quality<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>quality)</span>
<span id="cb9-7">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">buffer</span>.tell() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> max_size:</span>
<span id="cb9-8">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">buffer</span>.getvalue()</span>
<span id="cb9-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="deployment-and-production-features" class="level2">
<h2 class="anchored" data-anchor-id="deployment-and-production-features">Deployment and Production Features</h2>
<section id="session-management" class="level3">
<h3 class="anchored" data-anchor-id="session-management">Session Management</h3>
<p>The application maintains comprehensive session state:</p>
<div id="c87f9cb1" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">session_state_vars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb10-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"current_image"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uploaded_image_bytes"</span>,</span>
<span id="cb10-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"current_video"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uploaded_video_bytes"</span>,</span>
<span id="cb10-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"camera_active"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"camera_frame"</span>,</span>
<span id="cb10-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen_processed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gemini_processed"</span>,</span>
<span id="cb10-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"language"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input_method_index"</span></span>
<span id="cb10-7">]</span></code></pre></div></div>
</details>
</div>
</section>
<section id="error-handling" class="level3">
<h3 class="anchored" data-anchor-id="error-handling">Error Handling</h3>
<p>Robust error handling ensures graceful degradation:</p>
<div id="48624ce5" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb11-2">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.predict(image, conf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>confidence_threshold)</span>
<span id="cb11-3">    st.success(get_translation(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"detection_success"</span>))</span>
<span id="cb11-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb11-5">    st.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Detection failed: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fallback to alternative processing method</span></span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<section id="prerequisites" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites">Prerequisites</h3>
<ul>
<li>Python 3.12 or higher</li>
<li>Modern package manager (uv recommended)</li>
<li>For cloud models: API keys from DashScope and OpenRouter</li>
</ul>
</section>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clone the repository</span></span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> clone <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>repository-url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb12-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> YOLO_app</span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Install dependencies with uv (recommended)</span></span>
<span id="cb12-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uv</span> sync</span>
<span id="cb12-7"></span>
<span id="cb12-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Alternative: pip install</span></span>
<span id="cb12-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> requirements.txt</span>
<span id="cb12-10"></span>
<span id="cb12-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run the application</span></span>
<span id="cb12-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">streamlit</span> run app.py</span></code></pre></div></div>
</section>
<section id="api-configuration" class="level3">
<h3 class="anchored" data-anchor-id="api-configuration">API Configuration</h3>
<p>Create a <code>.env</code> file with your API keys:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Alibaba Cloud DashScope API</span></span>
<span id="cb13-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">DASHSCOPE_API_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>your_dashscope_key</span>
<span id="cb13-3"></span>
<span id="cb13-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># OpenRouter API (for Gemini)</span></span>
<span id="cb13-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">OPENROUTER_API_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>your_openrouter_key</span></code></pre></div></div>
</section>
<section id="quick-usage-examples" class="level3">
<h3 class="anchored" data-anchor-id="quick-usage-examples">Quick Usage Examples</h3>
<section id="basic-image-detection" class="level4">
<h4 class="anchored" data-anchor-id="basic-image-detection">Basic Image Detection</h4>
<ol type="1">
<li>Launch the application</li>
<li>Upload an image or provide an image URL</li>
<li>Select your preferred YOLO11 model (yolo11s.pt recommended)</li>
<li>Adjust confidence threshold if needed</li>
<li>Click ‚ÄúDetect Objects‚Äù</li>
<li>View results and download annotated image</li>
</ol>
</section>
<section id="real-time-camera-detection" class="level4">
<h4 class="anchored" data-anchor-id="real-time-camera-detection">Real-time Camera Detection</h4>
<ol type="1">
<li>Select ‚ÄúUse Camera‚Äù input method</li>
<li>Grant camera permissions when prompted</li>
<li>Capture a photo</li>
<li>Choose detection model</li>
<li>Get instant object detection results</li>
</ol>
</section>
<section id="cloud-model-processing" class="level4">
<h4 class="anchored" data-anchor-id="cloud-model-processing">Cloud Model Processing</h4>
<ol type="1">
<li>Enter your API keys in the sidebar</li>
<li>Upload an image</li>
<li>Select ‚ÄúQwen-Image-Edit‚Äù or ‚ÄúGemini 2.5 Flash‚Äù model</li>
<li>Process image with advanced AI capabilities</li>
<li>Compare results with local YOLO models</li>
</ol>
</section>
</section>
</section>
<section id="future-enhancements" class="level2">
<h2 class="anchored" data-anchor-id="future-enhancements">Future Enhancements</h2>
<p>Potential improvements for future versions:</p>
<ol type="1">
<li><strong>Additional Models</strong>: Integration with more cloud AI services</li>
<li><strong>Real-time Video Processing</strong>: Enhanced video streaming capabilities</li>
<li><strong>Custom Model Training</strong>: Allow users to train custom YOLO models</li>
<li><strong>Mobile Optimization</strong>: PWA features for mobile device support</li>
<li><strong>Batch Processing</strong>: Process multiple images simultaneously</li>
</ol>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This YOLO object detection application demonstrates how to build a sophisticated, production-ready computer vision system. The combination of local and cloud-based models, bilingual support, and comprehensive error handling makes it suitable for both development and production environments.</p>
<p>The project showcases best practices in: - Modern Python development with dependency management - Streamlit web application architecture - Computer vision API integration - Internationalization and accessibility - Performance optimization for different hardware platforms</p>
<p>Whether you‚Äôre interested in computer vision, web development, or AI applications, this project provides an excellent foundation for building advanced AI-powered web applications.</p>
<hr>


<!-- -->

</section>
</section>

 ]]></description>
  <category>AI</category>
  <category>API</category>
  <category>tutorial</category>
  <guid>https://your-website-url.example.com/posts/yolo-app/</guid>
  <pubDate>Tue, 04 Nov 2025 16:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/yolo-app/images/0.png" medium="image" type="image/png" height="83" width="144"/>
</item>
<item>
  <title>Retrieval-Augmented Generation(RAG) in R &amp; Python</title>
  <dc:creator>Tony D</dc:creator>
  <link>https://your-website-url.example.com/posts/RAG/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Retrieval-Augmented Generation (RAG) is a powerful technique that combines the generative capabilities of Large Language Models (LLMs) with the precision of information retrieval. By grounding LLM responses in external, verifiable data, RAG reduces hallucinations and enables the model to answer questions about specific, private, or up-to-date information.</p>
<p>In this tutorial, we will build a RAG system using both R and Python.</p>
<p>In R, we‚Äôll leverage the <code>ragnar</code> package for RAG workflows and <code>ellmer</code> for chat interfaces.</p>
<p>In Python, we‚Äôll use <code>LangChain</code> for the RAG pipeline, <code>ChromaDB</code> for the vector store, and <code>OpenAI</code> for model interaction.</p>
<p>Our goal is to create a system that can answer questions about the OpenRouter API by scraping its documentation.</p>
</section>
<section id="data-collection" class="level1">
<h1>Data Collection</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true" href="">R</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false" href="">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<p>First, we need to gather the data for our knowledge base. We‚Äôll use the <code>rvest</code> package to scrape URLs from the OpenRouter documentation. This will give us a list of pages to ingest.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ragnar)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ellmer)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dotenv)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load_dot_env</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".env"</span>)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rvest)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># URL to scrape</span></span>
<span id="cb2-4">url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/docs/quickstart"</span></span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read the HTML content of the page</span></span>
<span id="cb2-7">page <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(url)</span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract all &lt;a&gt; tags with href</span></span>
<span id="cb2-10">links <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> page <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_nodes</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"href"</span>)</span>
<span id="cb2-13"></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove NAs and duplicates</span></span>
<span id="cb2-15">links <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>(links))</span>
<span id="cb2-16"></span>
<span id="cb2-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optional: keep only full URLs</span></span>
<span id="cb2-18">links_full <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai"</span>, links[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grepl</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^/docs/"</span>, links)])</span>
<span id="cb2-19"></span>
<span id="cb2-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print all links</span></span>
<span id="cb2-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(links_full)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "https://openrouter.ai/docs/api-reference/overview"                               
 [2] "https://openrouter.ai/docs/quickstart"                                           
 [3] "https://openrouter.ai/docs/api/reference/overview"                               
 [4] "https://openrouter.ai/docs/sdks/call-model/overview"                             
 [5] "https://openrouter.ai/docs/guides/overview/principles"                           
 [6] "https://openrouter.ai/docs/guides/overview/models"                               
 [7] "https://openrouter.ai/docs/faq"                                                  
 [8] "https://openrouter.ai/docs/guides/overview/report-feedback"                      
 [9] "https://openrouter.ai/docs/guides/routing/model-fallbacks"                       
[10] "https://openrouter.ai/docs/guides/routing/provider-selection"                    
[11] "https://openrouter.ai/docs/guides/features/presets"                              
[12] "https://openrouter.ai/docs/guides/features/tool-calling"                         
[13] "https://openrouter.ai/docs/guides/features/structured-outputs"                   
[14] "https://openrouter.ai/docs/guides/features/message-transforms"                   
[15] "https://openrouter.ai/docs/guides/features/zero-completion-insurance"            
[16] "https://openrouter.ai/docs/guides/features/zdr"                                  
[17] "https://openrouter.ai/docs/app-attribution"                                      
[18] "https://openrouter.ai/docs/faq#how-are-rate-limits-calculated"                   
[19] "https://openrouter.ai/docs/api/reference/streaming"                              
[20] "https://openrouter.ai/docs/guides/community/frameworks-and-integrations-overview"</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<p>First, we need to gather the data for our knowledge base. We‚Äôll use <code>requests</code> and <code>BeautifulSoup</code> to scrape URLs from the OpenRouter documentation. This will give us a list of pages to ingest.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> sys</span>
<span id="cb4-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(sys.executable)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>/Library/Frameworks/Python.framework/Versions/3.13/bin/python3</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> bs4 <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BeautifulSoup</span>
<span id="cb6-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb6-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb6-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> markitdown <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> MarkItDown</span>
<span id="cb6-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> io <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BytesIO</span>
<span id="cb6-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> re</span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load environment variables</span></span>
<span id="cb6-10">load_dotenv()</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helper functions</span></span>
<span id="cb8-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> fetch_html(url: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bytes</span>:</span>
<span id="cb8-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Fetch HTML content from URL and return as bytes."""</span></span>
<span id="cb8-4">    resp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(url)</span>
<span id="cb8-5">    resp.raise_for_status()</span>
<span id="cb8-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> resp.content</span>
<span id="cb8-7"></span>
<span id="cb8-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> html_to_markdown(html_bytes: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bytes</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb8-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Convert HTML bytes to markdown using MarkItDown."""</span></span>
<span id="cb8-10">    md <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MarkItDown()</span>
<span id="cb8-11">    stream <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BytesIO(html_bytes)</span>
<span id="cb8-12">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> md.convert_stream(stream, mime_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text/html"</span>)</span>
<span id="cb8-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> result.markdown</span>
<span id="cb8-14"></span>
<span id="cb8-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> save_markdown(md_content: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, output_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb8-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Save markdown content to file."""</span></span>
<span id="cb8-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(output_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb8-18">        f.write(md_content)</span>
<span id="cb8-19"></span>
<span id="cb8-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sanitize_filename(filename: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb8-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Sanitize URL to create a valid filename."""</span></span>
<span id="cb8-22">    filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r'</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">^</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">https</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">?</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">://</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^/]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>, filename)</span>
<span id="cb8-23">    filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r'</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">\w</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\-</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">_.]</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_'</span>, filename)</span>
<span id="cb8-24">    filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> filename.strip(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_'</span>)</span>
<span id="cb8-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> filename.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.md'</span>):</span>
<span id="cb8-26">        filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.md'</span></span>
<span id="cb8-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> filename</span>
<span id="cb8-28"></span>
<span id="cb8-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># URL to scrape</span></span>
<span id="cb8-30">url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/docs/quickstart"</span></span>
<span id="cb8-31"></span>
<span id="cb8-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read the HTML content of the page</span></span>
<span id="cb8-33">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(url)</span>
<span id="cb8-34">soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(response.content, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'html.parser'</span>)</span>
<span id="cb8-35"></span>
<span id="cb8-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract all &lt;a&gt; tags with href</span></span>
<span id="cb8-37">links <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'href'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> a <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> soup.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>, href<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)]</span>
<span id="cb8-38"></span>
<span id="cb8-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove duplicates</span></span>
<span id="cb8-40">links <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(links))</span>
<span id="cb8-41"></span>
<span id="cb8-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only full URLs for docs</span></span>
<span id="cb8-43">links_full <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"https://openrouter.ai</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>link<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> link <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> links <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> link.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/docs/"</span>)]</span>
<span id="cb8-44"></span>
<span id="cb8-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Explicitly add FAQ</span></span>
<span id="cb8-46">links_full.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/docs/faq"</span>)</span>
<span id="cb8-47">links_full <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(links_full))</span>
<span id="cb8-48"></span>
<span id="cb8-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print all links</span></span>
<span id="cb8-50"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Found </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(links_full)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> documentation URLs"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Found 20 documentation URLs</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(links_full)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>['https://openrouter.ai/docs/guides/features/message-transforms', 'https://openrouter.ai/docs/api-reference/overview', 'https://openrouter.ai/docs/app-attribution', 'https://openrouter.ai/docs/guides/features/zdr', 'https://openrouter.ai/docs/guides/overview/principles', 'https://openrouter.ai/docs/guides/features/zero-completion-insurance', 'https://openrouter.ai/docs/guides/overview/models', 'https://openrouter.ai/docs/guides/overview/report-feedback', 'https://openrouter.ai/docs/api/reference/streaming', 'https://openrouter.ai/docs/guides/routing/model-fallbacks', 'https://openrouter.ai/docs/faq#how-are-rate-limits-calculated', 'https://openrouter.ai/docs/guides/community/frameworks-and-integrations-overview', 'https://openrouter.ai/docs/guides/features/presets', 'https://openrouter.ai/docs/sdks/call-model/overview', 'https://openrouter.ai/docs/api/reference/overview', 'https://openrouter.ai/docs/quickstart', 'https://openrouter.ai/docs/guides/routing/provider-selection', 'https://openrouter.ai/docs/guides/features/structured-outputs', 'https://openrouter.ai/docs/guides/features/tool-calling', 'https://openrouter.ai/docs/faq']</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="save-web-to-local-data" class="level1">
<h1>Save web to local data</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" aria-controls="tabset-2-1" aria-selected="true" href="">R</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" aria-controls="tabset-2-2" aria-selected="false" href="">Python DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" aria-controls="tabset-2-3" aria-selected="false" href="">Python Chroma</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" aria-labelledby="tabset-2-1-tab">
<p>To perform semantic search, we need to store our text data as vectors (embeddings). We‚Äôll use <code>DuckDB</code> as our local vector store. We also need an embedding model to convert text into vectors. Here, we configure <code>ragnar</code> to use a specific embedding model via an OpenAI-compatible API (SiliconFlow).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pages &lt;- ragnar_find_links(base_url)</span></span>
<span id="cb12-2">pages <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> links_full</span>
<span id="cb12-3">store_location <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openrouter.duckdb"</span></span>
<span id="cb12-4"></span>
<span id="cb12-5">store <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ragnar_store_create</span>(</span>
<span id="cb12-6">    store_location,</span>
<span id="cb12-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">overwrite =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb12-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">embed =</span> \(x) ragnar<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">embed_openai</span>(x,</span>
<span id="cb12-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BAAI/bge-m3"</span>,</span>
<span id="cb12-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_url =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.siliconflow.cn/v1"</span>,</span>
<span id="cb12-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">api_key =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"siliconflow"</span>)</span>
<span id="cb12-12">    )</span>
<span id="cb12-13">)</span></code></pre></div></div>
</details>
</div>
<p>With our store initialized, we can now ingest the data. We iterate through the list of pages we scraped earlier. For each page, we: 1. Read the content as markdown. 2. Split the content into smaller chunks (approx. 600 characters). 3. Insert these chunks into our vector store.</p>
<p>This process builds the index that we‚Äôll search against.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># page="https://openrouter.ai/docs/faq"</span></span>
<span id="cb13-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># chunks &lt;- page |&gt;read_as_markdown() |&gt;markdown_chunk(target_size = 2000)</span></span>
<span id="cb13-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ragnar_chunks_view(chunks)</span></span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (page <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> pages) {</span>
<span id="cb14-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">message</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ingesting: "</span>, page)</span>
<span id="cb14-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(page)</span>
<span id="cb14-4">    chunks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> page <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-5">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_as_markdown</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb14-6">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">markdown_chunk</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">target_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>)</span>
<span id="cb14-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(chunks)</span></span>
<span id="cb14-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print('chunks done')</span></span>
<span id="cb14-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ragnar_store_insert</span>(store, chunks)</span>
<span id="cb14-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"insrt done"</span>)</span>
<span id="cb14-11">}</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ragnar_store_build_index</span>(store)</span></code></pre></div></div>
</details>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb16-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> llama_index.core <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SimpleDirectoryReader, VectorStoreIndex, StorageContext, Settings</span>
<span id="cb16-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> llama_index.vector_stores.duckdb <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DuckDBVectorStore</span>
<span id="cb16-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> llama_index.embeddings.openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAIEmbedding</span>
<span id="cb16-5"></span>
<span id="cb16-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># --- 1. Configuration ---</span></span>
<span id="cb16-7"></span>
<span id="cb16-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure your API key is available</span></span>
<span id="cb16-9">openrouter_api_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># or paste string directly</span></span>
<span id="cb16-10"></span>
<span id="cb16-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize the embedding model pointing to OpenRouter</span></span>
<span id="cb16-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We use the OpenAI class because OpenRouter uses an OpenAI-compatible API structure</span></span>
<span id="cb16-13">embed_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAIEmbedding(</span>
<span id="cb16-14">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>openrouter_api_key,</span>
<span id="cb16-15">    base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb16-16">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen/qwen3-embedding-8b"</span>  </span>
<span id="cb16-17">)</span>
<span id="cb16-18"></span>
<span id="cb16-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update the global settings so LlamaIndex knows to use this model</span></span>
<span id="cb16-20">Settings.embed_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embed_model</span>
<span id="cb16-21">Settings.chunk_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span></span>
<span id="cb16-22">Settings.chunk_overlap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span>
<span id="cb16-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># --- 2. Ingestion and Indexing ---</span></span>
<span id="cb16-24"></span>
<span id="cb16-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load data</span></span>
<span id="cb16-26">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SimpleDirectoryReader(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"markdown_docs"</span>).load_data()</span>
<span id="cb16-27"></span>
<span id="cb16-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize DuckDB Vector Store</span></span>
<span id="cb16-29">vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DuckDBVectorStore(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openrouter.duckdb"</span>, persist_dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./persist/"</span>)</span>
<span id="cb16-30">storage_context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StorageContext.from_defaults(vector_store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>vector_store)</span>
<span id="cb16-31"></span>
<span id="cb16-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create the index</span></span>
<span id="cb16-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This will now automatically use the Qwen embeddings defined in Settings</span></span>
<span id="cb16-34">index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VectorStoreIndex.from_documents(</span>
<span id="cb16-35">    documents, </span>
<span id="cb16-36">    storage_context<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>storage_context</span>
<span id="cb16-37">)</span></code></pre></div></div>
</details>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" aria-labelledby="tabset-2-3-tab">
<p>To perform semantic search, we need to store our text data as vectors (embeddings). We‚Äôll use <code>ChromaDB</code> as our local vector store. We also need an embedding model to convert text into vectors. Here, we configure a custom <code>OpenRouterEmbeddings</code> class to use the <code>qwen/qwen3-embedding-8b</code> model via the OpenRouter API.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb17-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.embeddings <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Embeddings</span>
<span id="cb17-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_chroma <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Chroma</span>
<span id="cb17-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List</span>
<span id="cb17-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb17-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb17-7"></span>
<span id="cb17-8">load_dotenv()</span>
<span id="cb17-9"></span>
<span id="cb17-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Custom embeddings class for OpenRouter API</span></span>
<span id="cb17-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> OpenRouterEmbeddings(Embeddings):</span>
<span id="cb17-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Custom embeddings class for OpenRouter API."""</span></span>
<span id="cb17-13">    </span>
<span id="cb17-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, api_key: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, model: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>):</span>
<span id="cb17-15">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb17-16">            base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb17-17">            api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>api_key,</span>
<span id="cb17-18">        )</span>
<span id="cb17-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model</span>
<span id="cb17-20">    </span>
<span id="cb17-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> embed_documents(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, texts: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]]:</span>
<span id="cb17-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Embed a list of documents."""</span></span>
<span id="cb17-23">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.embeddings.create(</span>
<span id="cb17-24">            extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb17-25">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://ai-blog.com"</span>,</span>
<span id="cb17-26">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Blog RAG"</span>,</span>
<span id="cb17-27">            },</span>
<span id="cb17-28">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb17-29">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>texts,</span>
<span id="cb17-30">            encoding_format<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float"</span></span>
<span id="cb17-31">        )</span>
<span id="cb17-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> [item.embedding <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> response.data]</span>
<span id="cb17-33">    </span>
<span id="cb17-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> embed_query(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]:</span>
<span id="cb17-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Embed a single query."""</span></span>
<span id="cb17-36">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.embeddings.create(</span>
<span id="cb17-37">            extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb17-38">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://ai-blog.com"</span>,</span>
<span id="cb17-39">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Blog RAG"</span>,</span>
<span id="cb17-40">            },</span>
<span id="cb17-41">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb17-42">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>text,</span>
<span id="cb17-43">            encoding_format<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float"</span></span>
<span id="cb17-44">        )</span>
<span id="cb17-45">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding</span>
<span id="cb17-46"></span>
<span id="cb17-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get OpenRouter API key</span></span>
<span id="cb17-48">openrouter_api_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>)</span>
<span id="cb17-49"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> openrouter_api_key:</span>
<span id="cb17-50">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY not found in environment variables"</span>)</span>
<span id="cb17-51"></span>
<span id="cb17-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create embeddings instance using OpenRouter</span></span>
<span id="cb17-53">embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenRouterEmbeddings(</span>
<span id="cb17-54">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>openrouter_api_key,</span>
<span id="cb17-55">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen/qwen3-embedding-8b"</span></span>
<span id="cb17-56">)</span>
<span id="cb17-57"></span>
<span id="cb17-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define vector store location</span></span>
<span id="cb17-59">persist_directory <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chroma_db_data"</span></span></code></pre></div></div>
</details>
</div>
<p>With our store initialized, we can now ingest the data. We iterate through the markdown files we saved earlier. For each file, we: 1. Load the content. 2. Split the content into smaller chunks (approx. 2000 characters) using <code>RecursiveCharacterTextSplitter</code>. 3. Create a new <code>Chroma</code> vector store from these chunks.</p>
<p>This process builds the index that we‚Äôll search against.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Document</span>
<span id="cb18-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_text_splitters <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RecursiveCharacterTextSplitter</span>
<span id="cb18-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> shutil</span>
<span id="cb18-4"></span>
<span id="cb18-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helper function to load markdown files</span></span>
<span id="cb18-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> load_markdown_files(directory: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[Document]:</span>
<span id="cb18-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Load all markdown files from directory and create Document objects."""</span></span>
<span id="cb18-8">    documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb18-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> os.path.exists(directory):</span>
<span id="cb18-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> documents</span>
<span id="cb18-11">        </span>
<span id="cb18-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> filename <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> os.listdir(directory):</span>
<span id="cb18-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> filename.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.md'</span>):</span>
<span id="cb18-14">            filepath <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(directory, filename)</span>
<span id="cb18-15">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(filepath, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'utf-8'</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb18-16">                content <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb18-17">                doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Document(</span>
<span id="cb18-18">                    page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>content,</span>
<span id="cb18-19">                    metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb18-20">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: filename,</span>
<span id="cb18-21">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"filepath"</span>: filepath</span>
<span id="cb18-22">                    }</span>
<span id="cb18-23">                )</span>
<span id="cb18-24">                documents.append(doc)</span>
<span id="cb18-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> documents</span>
<span id="cb18-26"></span>
<span id="cb18-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create output directory for markdown files</span></span>
<span id="cb18-28">output_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"markdown_docs"</span></span>
<span id="cb18-29">os.makedirs(output_dir, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb18-30"></span>
<span id="cb18-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert each URL to markdown and save</span></span>
<span id="cb18-32"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, link_url <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(links_full, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb18-33">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb18-34">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Processing </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(links_full)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>link_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb18-35">        html_content <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fetch_html(link_url)</span>
<span id="cb18-36">        markdown_content <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> html_to_markdown(html_content)</span>
<span id="cb18-37">        filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sanitize_filename(link_url)</span>
<span id="cb18-38">        output_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(output_dir, filename)</span>
<span id="cb18-39">        save_markdown(markdown_content, output_path)</span>
<span id="cb18-40">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  ‚úì Saved to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>output_path<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb18-41">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb18-42">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  ‚úó Error processing </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>link_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb18-43"></span>
<span id="cb18-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load markdown documents</span></span>
<span id="cb18-45">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> load_markdown_files(output_dir)</span>
<span id="cb18-46"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Loaded </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(documents)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> markdown documents"</span>)</span>
<span id="cb18-47"></span>
<span id="cb18-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Split documents into chunks</span></span>
<span id="cb18-49">text_splitter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RecursiveCharacterTextSplitter(</span>
<span id="cb18-50">    chunk_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,</span>
<span id="cb18-51">    chunk_overlap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>,</span>
<span id="cb18-52">    length_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>,</span>
<span id="cb18-53">    is_separator_regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb18-54">)</span>
<span id="cb18-55"></span>
<span id="cb18-56">splits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> text_splitter.split_documents(documents)</span>
<span id="cb18-57"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Split into </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(splits)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> chunks"</span>)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove existing database if it exists</span></span>
<span id="cb19-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> os.path.exists(persist_directory):</span>
<span id="cb19-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Removing existing database at </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>persist_directory<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb19-4">    shutil.rmtree(persist_directory)</span>
<span id="cb19-5"></span>
<span id="cb19-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create new vector store</span></span>
<span id="cb19-7">vectorstore <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Chroma.from_documents(</span>
<span id="cb19-8">    documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>splits,</span>
<span id="cb19-9">    embedding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>embeddings,</span>
<span id="cb19-10">    persist_directory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>persist_directory</span>
<span id="cb19-11">)</span>
<span id="cb19-12"></span>
<span id="cb19-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">‚úì Successfully created ChromaDB with </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(splits)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> chunks!"</span>)</span>
<span id="cb19-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"‚úì Database saved to: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>persist_directory<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="retrieval" class="level1">
<h1>Retrieval</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" aria-controls="tabset-3-1" aria-selected="true" href="">R</a></li><li class="nav-item"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" aria-controls="tabset-3-2" aria-selected="false" href="">Python DuckDB</a></li><li class="nav-item"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" aria-controls="tabset-3-3" aria-selected="false" href="">Python Chroma</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" aria-labelledby="tabset-3-1-tab">
<p>Now that our knowledge base is populated, we can test the retrieval system. We can ask a specific question, like ‚ÄúWhat are model variants?‚Äù, and query the store to see which text chunks are most relevant. This confirms that our embeddings and search are working correctly.</p>
<section id="questionwhat-are-model-variants" class="level3">
<h3 class="anchored" data-anchor-id="questionwhat-are-model-variants">Question:What are model variants?</h3>
<p>RAG result:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">store_location <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openrouter.duckdb"</span></span>
<span id="cb20-2">store <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ragnar_store_connect</span>(store_location)</span>
<span id="cb20-3"></span>
<span id="cb20-4">text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What are model variants?"</span></span>
<span id="cb20-5"></span>
<span id="cb20-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' # Retrieving Chunks</span></span>
<span id="cb20-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Once the store is set up, retrieve the most relevant text chunks like this</span></span>
<span id="cb20-8"></span>
<span id="cb20-9">relevant_chunks <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ragnar_retrieve</span>(store, text, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">top_k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb20-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Retrieved"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(relevant_chunks), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chunks:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Retrieved 6 chunks:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_len</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(relevant_chunks))) {</span>
<span id="cb22-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--- Chunk %d ---</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">%s</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, i, relevant_chunks<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text[i]))</span>
<span id="cb22-3">}</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>--- Chunk 1 ---
[Zero Completion Insurance](/docs/features/zero-completion-insurance)
  + [Provisioning API Keys](/docs/features/provisioning-api-keys)
  + [App Attribution](/docs/app-attribution)
* API Reference

  + [Overview](/docs/api-reference/overview)
  + [Streaming](/docs/api-reference/streaming)
  + [Embeddings](/docs/api-reference/embeddings)
  + [Limits](/docs/api-reference/limits)
  + [Authentication](/docs/api-reference/authentication)
  + [Parameters](/docs/api-reference/parameters)
  + [Errors](/docs/api-reference/errors)
  + Responses API
  + beta.responses
  + Analytics
  + Credits
  + Embeddings
  + Generations
  + Models
  + Endpoints
  + Parameters
  + Providers
  + API Keys
  + O Auth
  + Chat
  + Completions
* SDK Reference (BETA)

  + [Python SDK](/docs/sdks/python)
  + [TypeScript SDK](/docs/sdks/typescript)
* Use Cases

  + [BYOK](/docs/use-cases/byok)
  + [Crypto API](/docs/use-cases/crypto-api)
  + [OAuth PKCE](/docs/use-cases/oauth-pkce)
  + [MCP Servers](/docs/use-cases/mcp-servers)
  + [Organization Management](/docs/use-cases/organization-management)
  + [For Providers](/docs/use-cases/for-providers)
  + [Reasoning Tokens](/docs/use-cases/reasoning-tokens)
  + [Usage Accounting](/docs/use-cases/usage-accounting)
  + [User Tracking](/docs/use-cases/user-tracking)
* Community

  + [Frameworks and Integrations Overview](/docs/community/frameworks-and-integrations-overview)
  + [Effect AI SDK](/docs/community/effect-ai-sdk)
  + [Arize](/docs/community/arize)
  + [LangChain](/docs/community/lang-chain)
  + [LiveKit](/docs/community/live-kit)
  + [Langfuse](/docs/community/langfuse)
  + [Mastra](/docs/community/mastra)
  + [OpenAI SDK](/docs/community/open-ai-sdk)
  + [PydanticAI](/docs/community/pydantic-ai)
  + [Vercel AI SDK](/docs/community/vercel-ai-sdk)
  + [Xcode](/docs/community/xcode)
  + [Zapier](/docs/community/zapier)
  + [Discord](https://discord.gg/openrouter)

Light

On this page

* [Requests](#requests)
* [Completions Request Format](#completions-request-format)
* [Headers](#headers)
* [Assistant Prefill](#assistant-prefill)
* [Responses](#responses)
* [CompletionsResponse Format](#completionsresponse-format)
* [Finish Reason](#finish-reason)
* [Querying Cost and Stats](#querying-cost-and-stats)

[API Reference](/docs/api-reference/overview)



--- Chunk 2 ---
###### How frequently are new models added?

We work on adding models as quickly as we can. We often have partnerships with
the labs releasing models and can release models as soon as they are
available. If there is a model missing that you‚Äôd like OpenRouter to support, feel free to message us on
[Discord](https://discord.gg/openrouter).

###### What are model variants?

Variants are suffixes that can be added to the model slug to change its behavior.

Static variants can only be used with specific models and these are listed in our [models api](https://openrouter.ai/api/v1/models).

1. `:free` - The model is always provided for free and has low rate limits.
2. `:beta` - The model is not moderated by OpenRouter.
3. `:extended` - The model has longer than usual context length.
4. `:exacto` - The model only uses OpenRouter-curated high-quality endpoints.
5. `:thinking` - The model supports reasoning by default.

Dynamic variants can be used on all models and they change the behavior of how the request is routed or used.

1. `:online` - All requests will run a query to extract web results that are attached to the prompt.
2. `:nitro` - Providers will be sorted by throughput rather than the default sort, optimizing for faster response times.
3. `:floor` - Providers will be sorted by price rather than the default sort, prioritizing the most cost-effective options.

###### I am an inference provider, how can I get listed on OpenRouter?

You can read our requirements at the [Providers
page](/docs/use-cases/for-providers). If you would like to contact us, the best
place to reach us is over email.

###### What is the expected latency/response time for different models?

For each model on OpenRouter we show the latency (time to first token) and the token
throughput for all providers. You can use this to estimate how long requests
will take. If you would like to optimize for throughput you can use the
`:nitro` variant to route to the fastest provider.



--- Chunk 3 ---
###### How frequently are new models added?

We work on adding models as quickly as we can. We often have partnerships with
the labs releasing models and can release models as soon as they are
available. If there is a model missing that you‚Äôd like OpenRouter to support, feel free to message us on
[Discord](https://discord.gg/openrouter).

###### What are model variants?

Variants are suffixes that can be added to the model slug to change its behavior.

Static variants can only be used with specific models and these are listed in our [models api](https://openrouter.ai/api/v1/models).

1. `:free` - The model is always provided for free and has low rate limits.
2. `:beta` - The model is not moderated by OpenRouter.
3. `:extended` - The model has longer than usual context length.
4. `:exacto` - The model only uses OpenRouter-curated high-quality endpoints.
5. `:thinking` - The model supports reasoning by default.

Dynamic variants can be used on all models and they change the behavior of how the request is routed or used.

1. `:online` - All requests will run a query to extract web results that are attached to the prompt.
2. `:nitro` - Providers will be sorted by throughput rather than the default sort, optimizing for faster response times.
3. `:floor` - Providers will be sorted by price rather than the default sort, prioritizing the most cost-effective options.

###### I am an inference provider, how can I get listed on OpenRouter?

You can read our requirements at the [Providers
page](/docs/use-cases/for-providers). If you would like to contact us, the best
place to reach us is over email.

###### What is the expected latency/response time for different models?

For each model on OpenRouter we show the latency (time to first token) and the token
throughput for all providers. You can use this to estimate how long requests
will take. If you would like to optimize for throughput you can use the
`:nitro` variant to route to the fastest provider.



--- Chunk 4 ---
## The `models` parameter

The `models` parameter lets you automatically try other models if the primary model‚Äôs providers are down, rate-limited, or refuse to reply due to content moderation.

TypeScript SDKTypeScript (fetch)Python

```code-block-root not-prose rounded-b-[inherit] rounded-t-none
|  |  |
| --- | --- |
| 1 | import { OpenRouter } from '@openrouter/sdk'; |
| 2 |  |
| 3 | const openRouter = new OpenRouter({ |
| 4 | apiKey: '&lt;OPENROUTER_API_KEY&gt;', |
| 5 | }); |
| 6 |  |
| 7 | const completion = await openRouter.chat.send({ |
| 8 | models: ['anthropic/claude-3.5-sonnet', 'gryphe/mythomax-l2-13b'], |
| 9 | messages: [ |
| 10 | { |
| 11 | role: 'user', |
| 12 | content: 'What is the meaning of life?', |
| 13 | }, |
| 14 | ], |
| 15 | }); |
| 16 |  |
| 17 | console.log(completion.choices[0].message.content); |
```

If the model you selected returns an error, OpenRouter will try to use the fallback model instead. If the fallback model is down or returns an error, OpenRouter will return that error.

By default, any error can trigger the use of a fallback model, including context length validation errors, moderation flags for filtered models, rate-limiting, and downtime.

Requests are priced using the model that was ultimately used, which will be returned in the `model` attribute of the response body.

## Using with OpenAI SDK

To use the `models` array with the OpenAI SDK, include it in the `extra_body` parameter. In the example below, gpt-4o will be tried first, and the `models` array will be tried in order as fallbacks.

PythonTypeScript



--- Chunk 5 ---
[Web Search](/docs/features/web-search)
  + [Zero Completion Insurance](/docs/features/zero-completion-insurance)
  + [Provisioning API Keys](/docs/features/provisioning-api-keys)
  + [App Attribution](/docs/app-attribution)
* API Reference

  + [Overview](/docs/api-reference/overview)
  + [Streaming](/docs/api-reference/streaming)
  + [Embeddings](/docs/api-reference/embeddings)
  + [Limits](/docs/api-reference/limits)
  + [Authentication](/docs/api-reference/authentication)
  + [Parameters](/docs/api-reference/parameters)
  + [Errors](/docs/api-reference/errors)
  + Responses API
  + beta.responses
  + Analytics
  + Credits
  + Embeddings
  + Generations
  + Models
  + Endpoints
  + Parameters
  + Providers
  + API Keys
  + O Auth
  + Chat
  + Completions
* SDK Reference (BETA)

  + [Python SDK](/docs/sdks/python)
  + [TypeScript SDK](/docs/sdks/typescript)
* Use Cases

  + [BYOK](/docs/use-cases/byok)
  + [Crypto API](/docs/use-cases/crypto-api)
  + [OAuth PKCE](/docs/use-cases/oauth-pkce)
  + [MCP Servers](/docs/use-cases/mcp-servers)
  + [Organization Management](/docs/use-cases/organization-management)
  + [For Providers](/docs/use-cases/for-providers)
  + [Reasoning Tokens](/docs/use-cases/reasoning-tokens)
  + [Usage Accounting](/docs/use-cases/usage-accounting)
  + [User Tracking](/docs/use-cases/user-tracking)
* Community

  + [Frameworks and Integrations Overview](/docs/community/frameworks-and-integrations-overview)
  + [Effect AI SDK](/docs/community/effect-ai-sdk)
  + [Arize](/docs/community/arize)
  + [LangChain](/docs/community/lang-chain)
  + [LiveKit](/docs/community/live-kit)
  + [Langfuse](/docs/community/langfuse)
  + [Mastra](/docs/community/mastra)
  + [OpenAI SDK](/docs/community/open-ai-sdk)
  + [PydanticAI](/docs/community/pydantic-ai)
  + [Vercel AI SDK](/docs/community/vercel-ai-sdk)
  + [Xcode](/docs/community/xcode)
  + [Zapier](/docs/community/zapier)
  + [Discord](https://discord.gg/openrouter)

Light

On this page

* [Within OpenRouter](#within-openrouter)
* [Provider Policies](#provider-policies)
* [Training on Prompts](#training-on-prompts)
* [Data Retention &amp; Logging](#data-retention--logging)
* [Enterprise EU in-region routing](#enterprise-eu-in-region-routing)

[Features](/docs/features/privacy-and-logging)



--- Chunk 6 ---
[Web Search](/docs/features/web-search)
  + [Zero Completion Insurance](/docs/features/zero-completion-insurance)
  + [Provisioning API Keys](/docs/features/provisioning-api-keys)
  + [App Attribution](/docs/app-attribution)
* API Reference

  + [Overview](/docs/api-reference/overview)
  + [Streaming](/docs/api-reference/streaming)
  + [Embeddings](/docs/api-reference/embeddings)
  + [Limits](/docs/api-reference/limits)
  + [Authentication](/docs/api-reference/authentication)
  + [Parameters](/docs/api-reference/parameters)
  + [Errors](/docs/api-reference/errors)
  + Responses API
  + beta.responses
  + Analytics
  + Credits
  + Embeddings
  + Generations
  + Models
  + Endpoints
  + Parameters
  + Providers
  + API Keys
  + O Auth
  + Chat
  + Completions
* SDK Reference (BETA)

  + [Python SDK](/docs/sdks/python)
  + [TypeScript SDK](/docs/sdks/typescript)
* Use Cases

  + [BYOK](/docs/use-cases/byok)
  + [Crypto API](/docs/use-cases/crypto-api)
  + [OAuth PKCE](/docs/use-cases/oauth-pkce)
  + [MCP Servers](/docs/use-cases/mcp-servers)
  + [Organization Management](/docs/use-cases/organization-management)
  + [For Providers](/docs/use-cases/for-providers)
  + [Reasoning Tokens](/docs/use-cases/reasoning-tokens)
  + [Usage Accounting](/docs/use-cases/usage-accounting)
  + [User Tracking](/docs/use-cases/user-tracking)
* Community

  + [Frameworks and Integrations Overview](/docs/community/frameworks-and-integrations-overview)
  + [Effect AI SDK](/docs/community/effect-ai-sdk)
  + [Arize](/docs/community/arize)
  + [LangChain](/docs/community/lang-chain)
  + [LiveKit](/docs/community/live-kit)
  + [Langfuse](/docs/community/langfuse)
  + [Mastra](/docs/community/mastra)
  + [OpenAI SDK](/docs/community/open-ai-sdk)
  + [PydanticAI](/docs/community/pydantic-ai)
  + [Vercel AI SDK](/docs/community/vercel-ai-sdk)
  + [Xcode](/docs/community/xcode)
  + [Zapier](/docs/community/zapier)
  + [Discord](https://discord.gg/openrouter)

Light

On this page

* [How OpenRouter Manages Data Policies](#how-openrouter-manages-data-policies)
* [Per-Request ZDR Enforcement](#per-request-zdr-enforcement)
* [Usage](#usage)
* [Caching](#caching)
* [OpenRouter‚Äôs Retention Policy](#openrouters-retention-policy)
* [Zero Retention Endpoints](#zero-retention-endpoints)

[Features](/docs/features/privacy-and-logging)</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ragnar_store_inspect(store)</span></span>
<span id="cb24-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ragnar_chunks_view(chunks)</span></span></code></pre></div></div>
</details>
</div>
</section>
</div>
<div id="tabset-3-2" class="tab-pane" aria-labelledby="tabset-3-2-tab">
<p>In Python, we can use <code>LlamaIndex</code> to interact with our DuckDB vector store. In this step, we‚Äôll configure the embedding model and retrieve the top relevant chunks for our query, saving them to a file for inspection. We won‚Äôt use an LLM for generation yet, focusing solely on verifying the retrieval quality.</p>
<section id="questionwhat-are-model-variants-1" class="level3">
<h3 class="anchored" data-anchor-id="questionwhat-are-model-variants-1">Question:What are model variants?</h3>
<p>RAG result:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb25-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> sys</span>
<span id="cb25-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Python executable: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>executable<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Python executable: /Library/Frameworks/Python.framework/Versions/3.13/bin/python3</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Python path: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sys<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>path<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Python path: ['', '/Library/Frameworks/Python.framework/Versions/3.13/bin', '/Library/Frameworks/Python.framework/Versions/3.13/lib/python313.zip', '/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13', '/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/lib-dynload', '/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages', '/Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/reticulate/python']</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Any, List</span>
<span id="cb29-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb29-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> llama_index.core <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> VectorStoreIndex, Settings</span>
<span id="cb29-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> llama_index.core.embeddings <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseEmbedding</span>
<span id="cb29-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> llama_index.vector_stores.duckdb <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DuckDBVectorStore</span>
<span id="cb29-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb29-7"></span>
<span id="cb29-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load environment variables</span></span>
<span id="cb29-9">load_dotenv()</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure your API key is available</span></span>
<span id="cb31-2">openrouter_api_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>)</span>
<span id="cb31-3"></span>
<span id="cb31-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Custom OpenRouter Embedding class for LlamaIndex</span></span>
<span id="cb31-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> OpenRouterEmbedding(BaseEmbedding):</span>
<span id="cb31-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Custom embedding class for OpenRouter API compatible with LlamaIndex."""</span></span>
<span id="cb31-7">    </span>
<span id="cb31-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(</span>
<span id="cb31-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb31-10">        api_key: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb31-11">        model: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen/qwen3-embedding-8b"</span>,</span>
<span id="cb31-12">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs: Any</span>
<span id="cb31-13">    ):</span>
<span id="cb31-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs)</span>
<span id="cb31-15">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb31-16">            base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb31-17">            api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>api_key,</span>
<span id="cb31-18">        )</span>
<span id="cb31-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model</span>
<span id="cb31-20">    </span>
<span id="cb31-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _get_query_embedding(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, query: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]:</span>
<span id="cb31-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Get embedding for a query string."""</span></span>
<span id="cb31-23">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._client.embeddings.create(</span>
<span id="cb31-24">            extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb31-25">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://ai-blog.com"</span>,</span>
<span id="cb31-26">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Blog RAG"</span>,</span>
<span id="cb31-27">            },</span>
<span id="cb31-28">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._model,</span>
<span id="cb31-29">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query,</span>
<span id="cb31-30">            encoding_format<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float"</span></span>
<span id="cb31-31">        )</span>
<span id="cb31-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding</span>
<span id="cb31-33">    </span>
<span id="cb31-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _get_text_embedding(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]:</span>
<span id="cb31-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Get embedding for a text string."""</span></span>
<span id="cb31-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_query_embedding(text)</span>
<span id="cb31-37">    </span>
<span id="cb31-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _aget_query_embedding(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, query: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]:</span>
<span id="cb31-39">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Async version of get_query_embedding."""</span></span>
<span id="cb31-40">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_query_embedding(query)</span>
<span id="cb31-41">    </span>
<span id="cb31-42">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> _aget_text_embedding(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]:</span>
<span id="cb31-43">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Async version of get_text_embedding."""</span></span>
<span id="cb31-44">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_text_embedding(text)</span>
<span id="cb31-45"></span>
<span id="cb31-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Configure Embedding Model using custom OpenRouter class</span></span>
<span id="cb31-47">embed_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenRouterEmbedding(</span>
<span id="cb31-48">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>openrouter_api_key,</span>
<span id="cb31-49">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen/qwen3-embedding-8b"</span></span>
<span id="cb31-50">)</span>
<span id="cb31-51"></span>
<span id="cb31-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Apply Settings</span></span>
<span id="cb31-53">Settings.embed_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embed_model</span>
<span id="cb31-54"></span>
<span id="cb31-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Load and Retrieve</span></span>
<span id="cb31-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load the existing DuckDB vector store</span></span>
<span id="cb31-57"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loading vector store from openrouter.duckdb..."</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading vector store from openrouter.duckdb...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1">vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DuckDBVectorStore(database_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openrouter.duckdb"</span>,persist_dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./persist/"</span>)</span>
<span id="cb33-2"></span>
<span id="cb33-3">index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VectorStoreIndex.from_vector_store(vector_store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>vector_store)</span>
<span id="cb33-4"></span>
<span id="cb33-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define query</span></span>
<span id="cb33-6">query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What are model variants?"</span></span>
<span id="cb33-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'='</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
============================================================</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Query: '</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>query<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Query: 'What are model variants?'</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'='</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retrieve top 3 chunks</span></span>
<span id="cb39-2">retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index.as_retriever(similarity_top_k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb39-3">nodes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> retriever.retrieve(query)</span>
<span id="cb39-4"></span>
<span id="cb39-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print detailed retrieval info</span></span>
<span id="cb39-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Retrieved </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(nodes)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> chunks from DuckDB:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Retrieved 3 chunks from DuckDB:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, node <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(nodes, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb41-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'‚îÄ'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb41-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Chunk </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb41-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'‚îÄ'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb41-5"></span>
<span id="cb41-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print similarity score</span></span>
<span id="cb41-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hasattr</span>(node, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'score'</span>):</span>
<span id="cb41-8">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Similarity Score: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>node<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>score<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb41-9"></span>
<span id="cb41-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print metadata</span></span>
<span id="cb41-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hasattr</span>(node, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> node.metadata:</span>
<span id="cb41-12">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Metadata:"</span>)</span>
<span id="cb41-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> key, value <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> node.metadata.items():</span>
<span id="cb41-14">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  - </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>key<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb41-15"></span>
<span id="cb41-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print text content (truncated for display)</span></span>
<span id="cb41-17">    text_preview <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> node.text[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"..."</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(node.text) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> node.text</span>
<span id="cb41-18">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Content:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>text_preview<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Chunk 1
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Similarity Score: 0.6170
Metadata:
  - file_path: /Users/jinchaoduan/Documents/post_project/AI_Blog/posts/RAG/markdown_docs/docs_features_exacto-variant.md
  - file_name: docs_features_exacto-variant.md
  - file_type: text/markdown
  - file_size: 7972
  - creation_date: 2025-11-21
  - last_modified_date: 2025-11-21

Content:
Search

`/`

Ask AI

[API](/docs/api-reference/overview)[Models](https://openrouter.ai/models)[Chat](https://openrouter.ai/chat)[Ranking](https://openrouter.ai/rankings)

* Overview

  + [Quickstart](/docs/quickstart)
  + [FAQ](/docs/faq)
  + [Principles](/docs/overview/principles)
  + [Models](/docs/overview/models)
  + [Enterprise](https://openrouter.ai/enterprise)
* Features

  + [Privacy and Logging](/docs/features/privacy-and-logging)
  + [Zero Data Retention (ZDR)](/docs/features/zdr)
  + ...

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Chunk 2
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Similarity Score: 0.6101
Metadata:
  - file_path: /Users/jinchaoduan/Documents/post_project/AI_Blog/posts/RAG/markdown_docs/docs_overview_models.md
  - file_name: docs_overview_models.md
  - file_type: text/markdown
  - file_size: 9021
  - creation_date: 2025-11-21
  - last_modified_date: 2025-11-21

Content:
Search

`/`

Ask AI

[API](/docs/api-reference/overview)[Models](https://openrouter.ai/models)[Chat](https://openrouter.ai/chat)[Ranking](https://openrouter.ai/rankings)

* Overview

  + [Quickstart](/docs/quickstart)
  + [FAQ](/docs/faq)
  + [Principles](/docs/overview/principles)
  + [Models](/docs/overview/models)
  + [Enterprise](https://openrouter.ai/enterprise)
* Features

  + [Privacy and Logging](/docs/features/privacy-and-logging)
  + [Zero Data Retention (ZDR)](/docs/features/zdr)
  + ...

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Chunk 3
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Similarity Score: 0.5821
Metadata:
  - file_path: /Users/jinchaoduan/Documents/post_project/AI_Blog/posts/RAG/markdown_docs/docs_guides_overview_models.md
  - file_name: docs_guides_overview_models.md
  - file_type: text/markdown
  - file_size: 7557
  - creation_date: 2026-01-06
  - last_modified_date: 2026-01-06

Content:
Search

`/`

Ask AI

[Models](https://openrouter.ai/models)[Chat](https://openrouter.ai/chat)[Ranking](https://openrouter.ai/rankings)[Docs](/docs/api-reference/overview)

[Docs](/docs/quickstart)[API Reference](/docs/api/reference/overview)[SDK Reference](/docs/sdks/call-model/overview)

[Docs](/docs/quickstart)[API Reference](/docs/api/reference/overview)[SDK Reference](/docs/sdks/call-model/overview)

* Overview

  + [Quickstart](/docs/quickstart)
  + [Principles](/docs/guides/overview/princi...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"></span>
<span id="cb43-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save retrieved chunks to a markdown file for easy inspection</span></span>
<span id="cb43-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># with open("retriever.md", "w", encoding="utf-8") as f:</span></span>
<span id="cb43-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     f.write(f"# Query: {query}\n\n")</span></span>
<span id="cb43-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     f.write(f"# Retrieved {len(nodes)} chunks from openrouter.duckdb\n\n")</span></span>
<span id="cb43-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     for i, node in enumerate(nodes, 1):</span></span>
<span id="cb43-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         f.write(f"{'‚îÄ'*60}\n")</span></span>
<span id="cb43-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         f.write(f"## Chunk {i}\n\n")</span></span>
<span id="cb43-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         if hasattr(node, 'score'):</span></span>
<span id="cb43-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#             f.write(f"**Similarity Score:** {node.score:.4f}\n\n")</span></span>
<span id="cb43-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         if hasattr(node, 'metadata') and node.metadata:</span></span>
<span id="cb43-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#             f.write(f"**Metadata:**\n")</span></span>
<span id="cb43-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#             for key, value in node.metadata.items():</span></span>
<span id="cb43-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#                 f.write(f"- {key}: {value}\n")</span></span>
<span id="cb43-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#             f.write(f"\n")</span></span>
<span id="cb43-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         f.write(f"{node.text}\n\n")</span></span></code></pre></div></div>
</details>
</div>
</section>
</div>
<div id="tabset-3-3" class="tab-pane" aria-labelledby="tabset-3-3-tab">
<p>Now that our knowledge base is populated, we can test the retrieval system. We can ask a specific question, like ‚ÄúWhat are model variants?‚Äù, and query the <code>Chroma</code> store to see which text chunks are most relevant. This confirms that our embeddings and search are working correctly.</p>
<section id="questionwhat-are-model-variants-2" class="level3">
<h3 class="anchored" data-anchor-id="questionwhat-are-model-variants-2">Question:What are model variants?</h3>
<p>RAG result:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb44-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.embeddings <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Embeddings</span>
<span id="cb44-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_chroma <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Chroma</span>
<span id="cb44-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List</span>
<span id="cb44-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb44-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb44-7"></span>
<span id="cb44-8">load_dotenv()</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Custom embeddings class for OpenRouter API</span></span>
<span id="cb46-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> OpenRouterEmbeddings(Embeddings):</span>
<span id="cb46-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Custom embeddings class for OpenRouter API."""</span></span>
<span id="cb46-4">    </span>
<span id="cb46-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, api_key: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, model: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen/qwen3-embedding-8b"</span>):</span>
<span id="cb46-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb46-7">            base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb46-8">            api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>api_key,</span>
<span id="cb46-9">        )</span>
<span id="cb46-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model</span>
<span id="cb46-11">    </span>
<span id="cb46-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> embed_documents(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, texts: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]]:</span>
<span id="cb46-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Embed a list of documents."""</span></span>
<span id="cb46-14">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.embeddings.create(</span>
<span id="cb46-15">            extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb46-16">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://ai-blog.com"</span>,</span>
<span id="cb46-17">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Blog RAG"</span>,</span>
<span id="cb46-18">            },</span>
<span id="cb46-19">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb46-20">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>texts,</span>
<span id="cb46-21">            encoding_format<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float"</span></span>
<span id="cb46-22">        )</span>
<span id="cb46-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> [item.embedding <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> response.data]</span>
<span id="cb46-24">    </span>
<span id="cb46-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> embed_query(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]:</span>
<span id="cb46-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Embed a single query."""</span></span>
<span id="cb46-27">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.embeddings.create(</span>
<span id="cb46-28">            extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb46-29">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://ai-blog.com"</span>,</span>
<span id="cb46-30">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Blog RAG"</span>,</span>
<span id="cb46-31">            },</span>
<span id="cb46-32">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb46-33">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>text,</span>
<span id="cb46-34">            encoding_format<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float"</span></span>
<span id="cb46-35">        )</span>
<span id="cb46-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding</span>
<span id="cb46-37"></span>
<span id="cb46-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get OpenRouter API key</span></span>
<span id="cb46-39">openrouter_api_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>)</span>
<span id="cb46-40"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> openrouter_api_key:</span>
<span id="cb46-41">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY not found in environment variables"</span>)</span>
<span id="cb46-42"></span>
<span id="cb46-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create embeddings instance using OpenRouter</span></span>
<span id="cb46-44">embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenRouterEmbeddings(</span>
<span id="cb46-45">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>openrouter_api_key,</span>
<span id="cb46-46">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen/qwen3-embedding-8b"</span></span>
<span id="cb46-47">)</span>
<span id="cb46-48"></span>
<span id="cb46-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define vector store location</span></span>
<span id="cb46-50">persist_directory <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chroma_db_data"</span></span>
<span id="cb46-51"></span>
<span id="cb46-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load existing vector store</span></span>
<span id="cb46-53">vectorstore <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Chroma(</span>
<span id="cb46-54">    persist_directory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>persist_directory,</span>
<span id="cb46-55">    embedding_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>embeddings</span>
<span id="cb46-56">)</span>
<span id="cb46-57"></span>
<span id="cb46-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Test query</span></span>
<span id="cb46-59">query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What are model variants?"</span></span>
<span id="cb46-60"></span>
<span id="cb46-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform similarity search</span></span>
<span id="cb46-62">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vectorstore.similarity_search(query, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb46-63"></span>
<span id="cb46-64"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Query: '</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>query<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Query: 'What are model variants?'</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Found </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> relevant chunks:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Found 5 relevant chunks:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, doc <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(results, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb50-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Result </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">:"</span>)</span>
<span id="cb50-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Source: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'source'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'unknown'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb50-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Content preview: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>page_content[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Result 1:
Source: docs_faq_how-are-rate-limits-calculated.md
Content preview: ###### What are model variants?

Variants are suffixes that can be added to the model slug to change its behavior.

Static variants can only be used with specific models and these are listed in our [models api](https://openrouter.ai/api/v1/models).

1. `:free` - The model is always provided for free and has low rate limits.
2. `:beta` - The model is not moderated by OpenRouter.
3. `:extended` - The model has longer than usual context length.
4. `:exacto` - The model only uses OpenRouter-curated high-quality endpoints.
5. `:thinking` - The model supports reasoning by default.

Dynamic variants can be used on all models and they change the behavior of how the request is routed or used.

1. `:online` - All requests will run a query to extract web results that are attached to the prompt.
2. `:...
Result 2:
Source: docs_faq.md
Content preview: ###### What are model variants?

Variants are suffixes that can be added to the model slug to change its behavior.

Static variants can only be used with specific models and these are listed in our [models api](https://openrouter.ai/api/v1/models).

1. `:free` - The model is always provided for free and has low rate limits.
2. `:beta` - The model is not moderated by OpenRouter.
3. `:extended` - The model has longer than usual context length.
4. `:exacto` - The model only uses OpenRouter-curated high-quality endpoints.
5. `:thinking` - The model supports reasoning by default.

Dynamic variants can be used on all models and they change the behavior of how the request is routed or used.

1. `:online` - All requests will run a query to extract web results that are attached to the prompt.
2. `:...
Result 3:
Source: docs_use-cases_crypto-api.md
Content preview: [API](/docs/api-reference/overview)[Models](https://openrouter.ai/models)[Chat](https://openrouter.ai/chat)[Ranking](https://openrouter.ai/rankings)...
Result 4:
Source: docs_sdks_typescript.md
Content preview: [API](/docs/api-reference/overview)[Models](https://openrouter.ai/models)[Chat](https://openrouter.ai/chat)[Ranking](https://openrouter.ai/rankings)...
Result 5:
Source: docs_features_provider-routing.md
Content preview: Route requests through OpenRouter-curated providers

Next](/docs/features/exacto-variant)[Built with](https://buildwithfern.com/?utm_campaign=buildWith&amp;utm_medium=docs&amp;utm_source=openrouter.ai)

[![Logo](https://files.buildwithfern.com/openrouter.docs.buildwithfern.com/docs/2025-11-21T16:36:36.134Z/content/assets/logo.svg)![Logo](https://files.buildwithfern.com/openrouter.docs.buildwithfern.com/docs/2025-11-21T16:36:36.134Z/content/assets/logo-white.svg)](https://openrouter.ai/)

[API](/docs/api-reference/overview)[Models](https://openrouter.ai/models)[Chat](https://openrouter.ai/chat)[Ranking](https://openrouter.ai/rankings)...</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section>
<section id="chat-with-rag" class="level1">
<h1>Chat with RAG</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" aria-controls="tabset-4-1" aria-selected="true" href="">R</a></li><li class="nav-item"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" aria-controls="tabset-4-2" aria-selected="false" href="">Python chatlas</a></li><li class="nav-item"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" aria-controls="tabset-4-3" aria-selected="false" href="">Python LangChain</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" aria-labelledby="tabset-4-1-tab">
<p>The final piece is to connect this retrieval capability to a chat interface. We use <code>ellmer</code> to create a chat client. Crucially, we register a ‚Äúretrieval tool‚Äù using <code>ragnar_register_tool_retrieve</code>. This gives the LLM the ability to query our vector store whenever it needs information to answer a user‚Äôs question.</p>
<p>We also provide a system prompt that instructs the model to always check the knowledge base and cite its sources.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ellmer)</span>
<span id="cb52-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dotenv)</span>
<span id="cb52-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load_dot_env</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".env"</span>)</span>
<span id="cb52-4"></span>
<span id="cb52-5">chat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chat_openrouter</span>(</span>
<span id="cb52-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">api_key =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb52-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai/gpt-oss-120b"</span>,</span>
<span id="cb52-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">system_prompt =</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trim</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb52-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  You are an assistant for question-answering tasks. You are concise.</span></span>
<span id="cb52-10"></span>
<span id="cb52-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  Before responding, retrieve relevant material from the knowledge store. Quote or</span></span>
<span id="cb52-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  paraphrase passages, clearly marking your own words versus the source. Provide a</span></span>
<span id="cb52-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  working link for every source cited, as well as any additional relevant links.</span></span>
<span id="cb52-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  Do not answer unless you have retrieved and cited a source.If you do not find</span></span>
<span id="cb52-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  relevant information, say 'I could not find anything relevant in the knowledge base</span></span>
<span id="cb52-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    "</span>)</span>
<span id="cb52-17">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb52-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ragnar_register_tool_retrieve</span>(store, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">top_k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div></div>
</details>
</div>
<section id="questionwhat-are-model-variants-3" class="level3">
<h3 class="anchored" data-anchor-id="questionwhat-are-model-variants-3">Question:What are model variants?</h3>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1">chat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What are model variants?"</span>)</span></code></pre></div></div>
</details>
<p><strong>Model variants</strong> are suffixes you can add to a model‚Äôs slug in OpenRouter to modify how the model behaves or how the request is routed.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 39%">
<col style="width: 26%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th>Variant</th>
<th>Type</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>:free</code></td>
<td>static</td>
<td>Model is always offered for free (lower rate limits).</td>
</tr>
<tr class="even">
<td><code>:beta</code></td>
<td>static</td>
<td>Model is not moderated by OpenRouter.</td>
</tr>
<tr class="odd">
<td><code>:extended</code></td>
<td>static</td>
<td>Model receives a longer‚Äëthan‚Äëusual context window.</td>
</tr>
<tr class="even">
<td><code>:exacto</code></td>
<td>static</td>
<td>Only high‚Äëquality, OpenRouter‚Äëcurated endpoints are</td>
</tr>
<tr class="odd">
<td>used.</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>:thinking</code></td>
<td>static</td>
<td>Model enables reasoning by default.</td>
</tr>
<tr class="odd">
<td><code>:online</code></td>
<td>dynamic</td>
<td>A web‚Äësearch query runs and its results are appended to</td>
</tr>
<tr class="even">
<td>the prompt.</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>:nitro</code></td>
<td>dynamic</td>
<td>Providers are sorted by throughput (fastest response).</td>
</tr>
<tr class="even">
<td><code>:floor</code></td>
<td>dynamic</td>
<td>Providers are sorted by price (cheapest option).</td>
</tr>
</tbody>
</table>
<p><em>Static variants</em> apply only to specific models (listed in the <strong>Models API</strong>) while <em>dynamic variants</em> can be used with any model and change routing or request handling.</p>
<p>Source: OpenRouter FAQ ‚Äì ‚ÄúWhat are model variants?‚Äù„Äê 3‚Ä†source„Äë</p>
</section>
</div>
<div id="tabset-4-2" class="tab-pane" aria-labelledby="tabset-4-2-tab">
<p>We can also use the <code>chatlas</code> library to create a chat interface. Here, we define a custom tool <code>retrieve_trusted_content</code> that queries our DuckDB index. We then register this tool with the chat model, allowing it to pull in relevant information when answering user questions.</p>
<section id="questionwhat-are-model-variants-4" class="level3">
<h3 class="anchored" data-anchor-id="questionwhat-are-model-variants-4">Question:What are model variants?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb54-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> chatlas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> ctl</span>
<span id="cb54-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> llama_index.core <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> VectorStoreIndex, Settings</span>
<span id="cb54-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> llama_index.vector_stores.duckdb <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DuckDBVectorStore</span>
<span id="cb54-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> llama_index.embeddings.openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAIEmbedding</span>
<span id="cb54-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb54-7">load_dotenv()</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ensure API key</span></span>
<span id="cb56-2">openrouter_api_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>)</span>
<span id="cb56-3"></span>
<span id="cb56-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Configure Embedding Model (LlamaIndex)</span></span>
<span id="cb56-5">embed_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAIEmbedding(</span>
<span id="cb56-6">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>openrouter_api_key,</span>
<span id="cb56-7">    base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb56-8">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use standard OpenAI model name; OpenRouter requires this</span></span>
<span id="cb56-9">)</span>
<span id="cb56-10">Settings.embed_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embed_model</span>
<span id="cb56-11"></span>
<span id="cb56-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Load Vector Store</span></span>
<span id="cb56-13">vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DuckDBVectorStore(database_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"open.duckdb"</span>, persist_dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./persist/"</span>)</span>
<span id="cb56-14">index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VectorStoreIndex.from_vector_store(vector_store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>vector_store)</span>
<span id="cb56-15"></span>
<span id="cb56-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Define Retrieval Tool</span></span>
<span id="cb56-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> retrieve_trusted_content(query: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, top_k: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>):</span>
<span id="cb56-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb56-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Retrieve relevant content from the knowledge store.</span></span>
<span id="cb56-20"></span>
<span id="cb56-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parameters</span></span>
<span id="cb56-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ----------</span></span>
<span id="cb56-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    query</span></span>
<span id="cb56-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        The query used to semantically search the knowledge store.</span></span>
<span id="cb56-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    top_k</span></span>
<span id="cb56-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        The number of results to retrieve from the knowledge store.</span></span>
<span id="cb56-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb56-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(f"Retrieving content for query: '{query}'")</span></span>
<span id="cb56-29">    retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index.as_retriever(similarity_top_k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>top_k)</span>
<span id="cb56-30">    nodes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> retriever.retrieve(query)</span>
<span id="cb56-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"&lt;excerpt&gt;</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;/excerpt&gt;"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> nodes]</span>
<span id="cb56-32"></span>
<span id="cb56-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. Initialize Chat with System Prompt</span></span>
<span id="cb56-34">chat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ctl.ChatOpenAI(</span>
<span id="cb56-35">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai/gpt-oss-120b"</span>,</span>
<span id="cb56-36">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>openrouter_api_key,</span>
<span id="cb56-37">    base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb56-38">    system_prompt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(</span>
<span id="cb56-39">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are an assistant for question-answering tasks. "</span></span>
<span id="cb56-40">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Use the retrieve_trusted_content tool to find relevant information from the knowledge store. "</span></span>
<span id="cb56-41">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Answer questions based on the retrieved content. "</span></span>
<span id="cb56-42">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"If you cannot find relevant information, say so clearly."</span></span>
<span id="cb56-43">    )</span>
<span id="cb56-44">)</span>
<span id="cb56-45"></span>
<span id="cb56-46">chat.register_tool(retrieve_trusted_content)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1">response<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>chat.chat(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What are model variants?"</span>, echo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(response)</span></code></pre></div></div>
</details>
</div>
</section>
</div>
<div id="tabset-4-3" class="tab-pane" aria-labelledby="tabset-4-3-tab">
<p>The final piece is to connect this retrieval capability to a chat interface. We use <code>LangChain</code> to create a RAG chain. We create a <code>retriever</code> from our vector store and combine it with a <code>ChatOpenAI</code> model (using OpenRouter) and a prompt template. This gives the LLM the ability to query our vector store whenever it needs information to answer a user‚Äôs question.</p>
<section id="questionwhat-are-model-variants-5" class="level3">
<h3 class="anchored" data-anchor-id="questionwhat-are-model-variants-5">Question:What are model variants?</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatOpenAI</span>
<span id="cb59-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate</span>
<span id="cb59-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.runnables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RunnablePassthrough</span>
<span id="cb59-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StrOutputParser</span>
<span id="cb59-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb59-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.embeddings <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Embeddings</span>
<span id="cb59-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_chroma <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Chroma</span>
<span id="cb59-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List</span>
<span id="cb59-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb59-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb59-11"></span>
<span id="cb59-12">load_dotenv()</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Custom embeddings class for OpenRouter API</span></span>
<span id="cb61-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> OpenRouterEmbeddings(Embeddings):</span>
<span id="cb61-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Custom embeddings class for OpenRouter API."""</span></span>
<span id="cb61-4">    </span>
<span id="cb61-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, api_key: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, model: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen/qwen3-embedding-8b"</span>):</span>
<span id="cb61-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb61-7">            base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb61-8">            api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>api_key,</span>
<span id="cb61-9">        )</span>
<span id="cb61-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model</span>
<span id="cb61-11">    </span>
<span id="cb61-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> embed_documents(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, texts: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]]:</span>
<span id="cb61-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Embed a list of documents."""</span></span>
<span id="cb61-14">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.embeddings.create(</span>
<span id="cb61-15">            extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb61-16">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://ai-blog.com"</span>,</span>
<span id="cb61-17">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Blog RAG"</span>,</span>
<span id="cb61-18">            },</span>
<span id="cb61-19">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb61-20">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>texts,</span>
<span id="cb61-21">            encoding_format<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float"</span></span>
<span id="cb61-22">        )</span>
<span id="cb61-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> [item.embedding <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> response.data]</span>
<span id="cb61-24">    </span>
<span id="cb61-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> embed_query(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]:</span>
<span id="cb61-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Embed a single query."""</span></span>
<span id="cb61-27">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.embeddings.create(</span>
<span id="cb61-28">            extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb61-29">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://ai-blog.com"</span>,</span>
<span id="cb61-30">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Blog RAG"</span>,</span>
<span id="cb61-31">            },</span>
<span id="cb61-32">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb61-33">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>text,</span>
<span id="cb61-34">            encoding_format<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float"</span></span>
<span id="cb61-35">        )</span>
<span id="cb61-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> response.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding</span>
<span id="cb61-37"></span>
<span id="cb61-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get OpenRouter API key</span></span>
<span id="cb61-39">openrouter_api_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>)</span>
<span id="cb61-40"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> openrouter_api_key:</span>
<span id="cb61-41">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY not found in environment variables"</span>)</span>
<span id="cb61-42"></span>
<span id="cb61-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create embeddings instance using OpenRouter</span></span>
<span id="cb61-44">embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenRouterEmbeddings(</span>
<span id="cb61-45">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>openrouter_api_key,</span>
<span id="cb61-46">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen/qwen3-embedding-8b"</span></span>
<span id="cb61-47">)</span>
<span id="cb61-48"></span>
<span id="cb61-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define vector store location</span></span>
<span id="cb61-50">persist_directory <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chroma_db_data"</span></span>
<span id="cb61-51"></span>
<span id="cb61-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load existing vector store</span></span>
<span id="cb61-53"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Loading existing vectorstore from </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>persist_directory<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading existing vectorstore from chroma_db_data...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1">vectorstore <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Chroma(</span>
<span id="cb63-2">    persist_directory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>persist_directory,</span>
<span id="cb63-3">    embedding_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>embeddings</span>
<span id="cb63-4">)</span>
<span id="cb63-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"‚úì Loaded vectorstore"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>‚úì Loaded vectorstore</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize LLM using OpenRouter</span></span>
<span id="cb65-2">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI(</span>
<span id="cb65-3">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai/gpt-oss-120b"</span>,</span>
<span id="cb65-4">    openai_api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb65-5">    openai_api_base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span></span>
<span id="cb65-6">)</span>
<span id="cb65-7"></span>
<span id="cb65-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create prompt template</span></span>
<span id="cb65-9">system_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb65-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are an assistant for question-answering tasks. "</span></span>
<span id="cb65-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Use the following pieces of retrieved context to answer "</span></span>
<span id="cb65-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the question. If you don't know the answer, say that you "</span></span>
<span id="cb65-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"don't know. Use three sentences maximum and keep the "</span></span>
<span id="cb65-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer concise."</span></span>
<span id="cb65-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb65-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Context: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb65-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb65-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Question: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb65-19">)</span>
<span id="cb65-20"></span>
<span id="cb65-21">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(system_prompt)</span>
<span id="cb65-22"></span>
<span id="cb65-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create retriever</span></span>
<span id="cb65-24">retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vectorstore.as_retriever(search_kwargs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>})</span>
<span id="cb65-25"></span>
<span id="cb65-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helper function to format documents</span></span>
<span id="cb65-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> format_docs(docs):</span>
<span id="cb65-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join(doc.page_content <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> docs)</span>
<span id="cb65-29"></span>
<span id="cb65-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create RAG chain using LCEL</span></span>
<span id="cb65-31">rag_chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb65-32">    {</span>
<span id="cb65-33">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> format_docs,</span>
<span id="cb65-34">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: RunnablePassthrough()</span>
<span id="cb65-35">    }</span>
<span id="cb65-36">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> prompt</span>
<span id="cb65-37">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> llm</span>
<span id="cb65-38">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> StrOutputParser()</span>
<span id="cb65-39">)</span>
<span id="cb65-40"></span>
<span id="cb65-41"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‚úì RAG chain created successfully!"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>‚úì RAG chain created successfully!</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Test the RAG chain</span></span>
<span id="cb67-2">question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What are model variants?"</span></span>
<span id="cb67-3"></span>
<span id="cb67-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Question: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>question<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Question: What are model variants?</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get context documents separately for display</span></span>
<span id="cb69-2">context_docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> retriever.invoke(question)</span>
<span id="cb69-3"></span>
<span id="cb69-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Invoke the RAG chain</span></span>
<span id="cb69-5">answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rag_chain.invoke(question)</span>
<span id="cb69-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> textwrap</span>
<span id="cb69-7"></span>
<span id="cb69-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> line <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> answer.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>):</span>
<span id="cb69-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(textwrap.fill(line, width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>))</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model variants are suffixes you append to a model‚Äôs slug to modify its behavior.
Static variants (e.g.,‚ÄØ`:free`,‚ÄØ`:beta`,‚ÄØ`:extended`,‚ÄØ`:exacto`,‚ÄØ`:thinking`)
are limited to certain models, while dynamic variants
(e.g.,‚ÄØ`:online`,‚ÄØ`:nitro`,‚ÄØ`:floor`) work with any model and affect routing or
features such as web search, speed, or cost. Use them to customize access,
context length, moderation, reasoning, or provider selection.</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>


<!-- -->

</section>

 ]]></description>
  <category>AI</category>
  <category>API</category>
  <category>tutorial</category>
  <guid>https://your-website-url.example.com/posts/RAG/</guid>
  <pubDate>Sat, 01 Nov 2025 16:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/RAG/images.png" medium="image" type="image/png" height="79" width="144"/>
</item>
<item>
  <title>OpenRouter: A Unified API for Multiple AI Models</title>
  <dc:creator>Tony D</dc:creator>
  <link>https://your-website-url.example.com/posts/openrouter/</link>
  <description><![CDATA[ 





<section id="introduction-to-openrouter" class="level1">
<h1>Introduction to OpenRouter</h1>
<p>OpenRouter is a powerful platform that provides a unified API interface for accessing multiple AI models from various providers. Instead of integrating with each AI service separately, developers can use OpenRouter‚Äôs single endpoint to access models from OpenAI, Anthropic, Google, and many others.</p>
<section id="getting-started-with-openrouter" class="level2">
<h2 class="anchored" data-anchor-id="getting-started-with-openrouter">Getting Started with OpenRouter</h2>
<p>Getting started with OpenRouter is straightforward and can be accomplished in just a few steps. The platform is designed to minimize setup time while maintaining security best practices.</p>
</section>
<section id="create-your-openrouter-account" class="level2">
<h2 class="anchored" data-anchor-id="create-your-openrouter-account">1. Create Your OpenRouter Account</h2>
<p>First, visit <a href="https://openrouter.ai">openrouter.ai</a> and create an account. The registration process is simple:</p>
<ol type="1">
<li><strong>Sign Up</strong>: Use your email or social login (Google, GitHub)</li>
<li><strong>Verify Email</strong>: Confirm your email address through the verification link</li>
<li><strong>Access Dashboard</strong>: Navigate to your dashboard where you‚Äôll find your API key</li>
</ol>
<p><strong>üí° Pro Tip</strong>: Your dashboard provides valuable insights including: - Usage statistics and cost tracking - Model performance metrics - API key management - Billing information</p>
</section>
<section id="secure-api-key-management" class="level2">
<h2 class="anchored" data-anchor-id="secure-api-key-management">2. Secure API Key Management</h2>
<p>Security is paramount when working with AI APIs. Never hardcode your API keys directly in your code. Instead, use environment variables to keep your credentials safe:</p>
<section id="why-environment-variables-matter" class="level3">
<h3 class="anchored" data-anchor-id="why-environment-variables-matter">Why Environment Variables Matter</h3>
<ul>
<li><strong>Security</strong>: Prevents accidental exposure in version control</li>
<li><strong>Flexibility</strong>: Allows different keys for development, staging, and production</li>
<li><strong>Collaboration</strong>: Team members can use their own keys without sharing</li>
<li><strong>Deployment</strong>: Easy management across different hosting environments</li>
</ul>
</section>
<section id="setting-up-environment-variables" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-environment-variables">Setting Up Environment Variables</h3>
<p>Create a <code>.env</code> file in your project root:</p>
<p>OPENROUTER_API_KEY=your_actual_api_key_here</p>
<p>Install the <code>python-dotenv</code> library to load environment variables:</p>
<p>pip install python-dotenv</p>
</section>
</section>
<section id="your-first-api-call" class="level2">
<h2 class="anchored" data-anchor-id="your-first-api-call">3. Your First API Call</h2>
<p>Now that you have your API key set up, let‚Äôs make your first API call. OpenRouter cleverly uses the same API format as OpenAI, which means you can use the familiar <code>openai</code> Python library - just with a different base URL.</p>
<section id="understanding-the-architecture" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-architecture">Understanding the Architecture</h3>
<p><strong>üîß How It Works</strong>: OpenRouter acts as a smart proxy that: 1. Receives your standardized API requests 2. Routes them to the appropriate AI model provider 3. Handles provider-specific authentication and formatting 4. Returns responses in a consistent format 5. Tracks usage and costs across all models</p>
</section>
<section id="required-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="required-dependencies">Required Dependencies</h3>
<p>Before you start, ensure you have the necessary Python packages:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install openai python-dotenv</span></code></pre></div></div>
<ul>
<li><strong>openai</strong>: The official OpenAI Python client (compatible with OpenRouter)</li>
<li><strong>python-dotenv</strong>: For loading environment variables from <code>.env</code> files</li>
</ul>
</section>
<section id="basic-text-generation-example" class="level3">
<h3 class="anchored" data-anchor-id="basic-text-generation-example">Basic Text Generation Example</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true" href="">python with OpenAI package</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false" href="">python with chatlas package</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" aria-controls="tabset-1-3" aria-selected="false" href="">R with ellmer package</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load environment variables from .env file</span></span>
<span id="cb2-6">load_dotenv()</span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb2-9">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb2-10">  base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># OpenRouter's API endpoint</span></span>
<span id="cb2-11">  api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Your secure API key</span></span>
<span id="cb2-12">)</span>
<span id="cb2-13"></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a chat completion with OpenRouter</span></span>
<span id="cb2-15">completion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb2-16">  extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb2-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://your-site.com"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optional: Helps OpenRouter improve their service</span></span>
<span id="cb2-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Your Site Name"</span>,             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optional: Your site name for OpenRouter rankings</span></span>
<span id="cb2-19">  },</span>
<span id="cb2-20">  model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai/gpt-oss-20b:free"</span>,          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Free model for testing/development</span></span>
<span id="cb2-21">  messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb2-22">    {</span>
<span id="cb2-23">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>,</span>
<span id="cb2-24">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hello! Can you explain what OpenRouter is in simple terms?"</span></span>
<span id="cb2-25">    }</span>
<span id="cb2-26">  ],</span>
<span id="cb2-27">  temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Controls creativity (0.0 = deterministic, 1.0 = very creative)</span></span>
<span id="cb2-28">)</span>
<span id="cb2-29"></span>
<span id="cb2-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract and print the response</span></span>
<span id="cb2-31"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(completion.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content)</span></code></pre></div></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> chatlas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatOpenRouter</span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load environment variables from .env file</span></span>
<span id="cb3-6">load_dotenv()</span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb3-9">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenRouter(api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>)</span>
<span id="cb3-10">,base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://openrouter.ai/api/v1'</span></span>
<span id="cb3-11"> ,system_prompt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb3-12"> ,model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai/gpt-oss-20b:free"</span>)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">response<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>client.chat(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What is the capital of France?"</span>)</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#str(response)</span></span></code></pre></div></div>
</details>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ellmer)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dotenv)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load_dot_env</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".env"</span>)</span>
<span id="cb5-4"></span>
<span id="cb5-5">chat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chat_openrouter</span>(</span>
<span id="cb5-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">system_prompt =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb5-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">api_key =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sys.getenv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb5-8"> </span>
<span id="cb5-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai/gpt-oss-20b:free"</span>,</span>
<span id="cb5-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">echo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span></span>
<span id="cb5-11">)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">chat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tell me three jokes about statisticians"</span>)</span></code></pre></div></div>
</details>
</div>
</div>
</div>
</div>
<p><strong>Key Components Explained:</strong></p>
<ul>
<li><strong><code>base_url</code></strong>: Points to OpenRouter‚Äôs API instead of OpenAI‚Äôs</li>
<li><strong><code>model</code></strong>: Uses OpenRouter‚Äôs model naming format (<code>provider/model-name</code>)</li>
<li><strong><code>extra_headers</code></strong>: Optional but recommended for OpenRouter‚Äôs analytics</li>
<li><strong><code>temperature</code></strong>: Controls response creativity (0.0-2.0 range)</li>
<li><strong><code>messages</code></strong>: Standard chat format with role-based conversation structure</li>
</ul>
<p><strong>üí° Model Selection Tips:</strong> - <strong>Free Models</strong>: Great for development (<code>*free</code> suffix) - <strong>Budget Models</strong>: Cost-effective for production (<code>*:budget</code> suffix) - <strong>Premium Models</strong>: Best performance (<code>*</code>, <code>*:pro</code>, <code>*:latest</code>) - <strong>Specialized</strong>: Task-optimized models (coding, math, creative writing)</p>
</section>
</section>
<section id="mastering-system-prompts" class="level2">
<h2 class="anchored" data-anchor-id="mastering-system-prompts">4. Mastering System Prompts</h2>
<p>System prompts are powerful tools that shape the AI‚Äôs behavior, personality, and response style. They set the context and rules for the entire conversation, appearing before user messages in the conversation flow.</p>
<section id="what-are-system-prompts" class="level3">
<h3 class="anchored" data-anchor-id="what-are-system-prompts">What Are System Prompts?</h3>
<p>System prompts act as <strong>meta-instructions</strong> that guide how the AI should respond throughout the conversation. They‚Äôre processed first and influence all subsequent interactions.</p>
</section>
<section id="why-system-prompts-matter" class="level3">
<h3 class="anchored" data-anchor-id="why-system-prompts-matter">Why System Prompts Matter</h3>
<ul>
<li><strong>Consistent Behavior</strong>: Ensures AI maintains the desired personality throughout</li>
<li><strong>Output Format</strong>: Dictates response structure (JSON, markdown, code blocks)</li>
<li><strong>Safety Constraints</strong>: Sets boundaries and restrictions on responses</li>
<li><strong>Context Setting</strong>: Provides background information for better responses</li>
<li><strong>Task Specialization</strong>: Optimizes AI for specific use cases</li>
</ul>
</section>
<section id="effective-system-prompt-examples" class="level3">
<h3 class="anchored" data-anchor-id="effective-system-prompt-examples">Effective System Prompt Examples</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example with system prompt</span></span>
<span id="cb7-2">completion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb7-3">  model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai/gpt-oss-20b:free"</span>,</span>
<span id="cb7-4">  messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb7-5">    {</span>
<span id="cb7-6">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>,</span>
<span id="cb7-7">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are a helpful AI assistant that explains technical concepts in simple terms. Always be friendly and use analogies when possible and be simple"</span></span>
<span id="cb7-8">    },</span>
<span id="cb7-9">    {</span>
<span id="cb7-10">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>,</span>
<span id="cb7-11">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"How does temperature in LLM model work?"</span></span>
<span id="cb7-12">    }</span>
<span id="cb7-13">  ],</span>
<span id="cb7-14">  temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span></span>
<span id="cb7-15">)</span>
<span id="cb7-16"></span>
<span id="cb7-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(completion.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content)</span></code></pre></div></div>
</details>
</div>
<p>Common system prompt patterns:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Different system prompt examples</span></span>
<span id="cb8-2">system_prompts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"coding_assistant"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are an expert programmer. Provide clean, well-commented code solutions and explain your reasoning."</span>,</span>
<span id="cb8-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"creative_writer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are a creative storyteller. Write engaging narratives with vivid descriptions and compelling characters."</span>,</span>
<span id="cb8-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_analyst"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are a data analyst. Provide insights based on data, suggest visualizations, and explain statistical concepts clearly."</span>,</span>
<span id="cb8-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tutor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are a patient tutor. Break down complex topics into simple steps and provide encouraging feedback."</span></span>
<span id="cb8-7">}</span>
<span id="cb8-8"></span>
<span id="cb8-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> chat_with_persona(persona, user_message):</span>
<span id="cb8-10">    completion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb8-11">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai/gpt-oss-20b:free"</span>,</span>
<span id="cb8-12">        messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb8-13">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: system_prompts[persona]},</span>
<span id="cb8-14">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: user_message}</span>
<span id="cb8-15">        ],</span>
<span id="cb8-16">        temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span></span>
<span id="cb8-17">    )</span>
<span id="cb8-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> completion.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content</span>
<span id="cb8-19"></span>
<span id="cb8-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example usage</span></span>
<span id="cb8-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#response = chat_with_persona("coding_assistant", "How do I reverse a string in Python?")</span></span>
<span id="cb8-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(response)</span></span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="streaming-responses-real-time-ai-interaction" class="level2">
<h2 class="anchored" data-anchor-id="streaming-responses-real-time-ai-interaction">5. Streaming Responses: Real-Time AI Interaction</h2>
<p>Streaming is a game-changer for user experience, especially in chat applications and interactive tools. Instead of waiting for complete responses, streaming delivers content as it‚Äôs being generated, creating natural and engaging conversations.</p>
<section id="why-streaming-matters" class="level3">
<h3 class="anchored" data-anchor-id="why-streaming-matters">Why Streaming Matters</h3>
<p><strong>üöÄ User Experience Benefits:</strong> - <strong>Immediate Feedback</strong>: Users see responses starting immediately - <strong>Reduced Perceived Latency</strong>: Content appears as it‚Äôs generated - <strong>Natural Conversation Flow</strong>: Mimics human speech patterns - <strong>Progress Indication</strong>: Users know the AI is working - <strong>Early Termination</strong>: Users can stop lengthy responses if needed</p>
<p><strong>‚ö° Technical Advantages:</strong> - <strong>Lower Memory Usage</strong>: No need to buffer complete responses - <strong>Faster Time-to-First-Byte</strong>: Content starts flowing immediately - <strong>Better Error Handling</strong>: Issues detected earlier in process - <strong>Resource Efficiency</strong>: Processes data incrementally</p>
</section>
<section id="implementing-streaming-with-openrouter" class="level3">
<h3 class="anchored" data-anchor-id="implementing-streaming-with-openrouter">Implementing Streaming with OpenRouter</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize the OpenAI client (if not already done)</span></span>
<span id="cb9-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb9-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb9-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb9-5"></span>
<span id="cb9-6">load_dotenv()</span>
<span id="cb9-7">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb9-8">  base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb9-9">  api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb9-10">)</span>
<span id="cb9-11"></span>
<span id="cb9-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> stream_response(model, message):</span>
<span id="cb9-13">    stream <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb9-14">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model,</span>
<span id="cb9-15">        messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: message}],</span>
<span id="cb9-16">        stream<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb9-17">    )</span>
<span id="cb9-18"></span>
<span id="cb9-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> chunk <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> stream:</span>
<span id="cb9-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> chunk.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].delta.content <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb9-21">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(chunk.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].delta.content, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>, flush<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb9-22"></span>
<span id="cb9-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stream example</span></span>
<span id="cb9-24"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Streaming response:"</span>)</span>
<span id="cb9-25">stream_response(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai/gpt-oss-20b:free"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tell me a short story about AI"</span>)</span>
<span id="cb9-26"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add newline after streaming</span></span></code></pre></div></div>
</details>
</div>
</section>
<section id="text-to-image" class="level3">
<h3 class="anchored" data-anchor-id="text-to-image">6. text to image</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb10-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> base64</span>
<span id="cb10-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># | eval: false</span></span>
<span id="cb11-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb11-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb11-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb11-5"></span>
<span id="cb11-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load environment variables from .env file</span></span>
<span id="cb11-7">load_dotenv()</span>
<span id="cb11-8"></span>
<span id="cb11-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb11-10">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb11-11">    base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb11-12">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb11-13">)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Image generation request</span></span>
<span id="cb12-2">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb12-3">    extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb12-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"www.tonydotdev.com"</span>,</span>
<span id="cb12-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TT_AI_blog"</span>,</span>
<span id="cb12-6">    },</span>
<span id="cb12-7">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"google/gemini-2.5-flash-image"</span>,</span>
<span id="cb12-8">    messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb12-9">        {</span>
<span id="cb12-10">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>,</span>
<span id="cb12-11">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Generate a serene and realistic snowy mountain landscape at sunrise."</span>,</span>
<span id="cb12-12">        }</span>
<span id="cb12-13">    ],</span>
<span id="cb12-14">    modalities<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>],</span>
<span id="cb12-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#image_size="1024x1024",</span></span>
<span id="cb12-16">)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> base64</span>
<span id="cb13-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb13-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract message</span></span>
<span id="cb13-4">message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message</span>
<span id="cb13-5"></span>
<span id="cb13-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Handle image output (base64 string inside "data:image/png;base64,...")</span></span>
<span id="cb13-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> message.images:</span>
<span id="cb13-8">    data_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> message.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_url"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"url"</span>]</span>
<span id="cb13-9"></span>
<span id="cb13-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Strip prefix if present</span></span>
<span id="cb13-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> data_url.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data:image"</span>):</span>
<span id="cb13-12">        _, base64_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_url.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb13-14">        base64_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_url</span>
<span id="cb13-15"></span>
<span id="cb13-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Decode and save as PNG</span></span>
<span id="cb13-17">    image_bytes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> base64.b64decode(base64_data)</span>
<span id="cb13-18">    current_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime.datetime.now().strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%H%M"</span>)</span>
<span id="cb13-19">    output_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"text_image_gemini_25_openrouter_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>current_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.png"</span></span>
<span id="cb13-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(output_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb13-21">        f.write(image_bytes)</span>
<span id="cb13-22"></span>
<span id="cb13-23">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"‚úÖ Image saved as </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>output_file<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-24"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb13-25">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‚ùå No image returned in response"</span>)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> IPython.display <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image, display</span>
<span id="cb14-2"></span>
<span id="cb14-3">display(Image(filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text_image_gemini_25_openrouter_1352.png"</span>))</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;IPython.core.display.Image object&gt;</code></pre>
</div>
</div>
</section>
<section id="image-to-text" class="level3">
<h3 class="anchored" data-anchor-id="image-to-text">6 image to text</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> base64</span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert local image to data URL</span></span>
<span id="cb16-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text_image_gemini_25_openrouter_1352.png"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> image_file:</span>
<span id="cb16-5">    base64_image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> base64.b64encode(image_file.read()).decode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'utf-8'</span>)</span>
<span id="cb16-6">    data_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"data:image/png;base64,</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>base64_image<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb16-7"></span>
<span id="cb16-8">completion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb16-9">  extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb16-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;YOUR_SITE_URL&gt;"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optional. Site URL for rankings on openrouter.ai.</span></span>
<span id="cb16-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;YOUR_SITE_NAME&gt;"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optional. Site title for rankings on openrouter.ai.</span></span>
<span id="cb16-12">  },</span>
<span id="cb16-13">  extra_body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{},</span>
<span id="cb16-14">  model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nvidia/nemotron-nano-12b-v2-vl:free"</span>,</span>
<span id="cb16-15">  messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb16-16">              {</span>
<span id="cb16-17">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>,</span>
<span id="cb16-18">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: [</span>
<span id="cb16-19">                  {</span>
<span id="cb16-20">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,</span>
<span id="cb16-21">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What is in this image?"</span></span>
<span id="cb16-22">                  },</span>
<span id="cb16-23">                  {</span>
<span id="cb16-24">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_url"</span>,</span>
<span id="cb16-25">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_url"</span>: {</span>
<span id="cb16-26">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"url"</span>: data_url</span>
<span id="cb16-27">                    }</span>
<span id="cb16-28">                  }</span>
<span id="cb16-29">                ]</span>
<span id="cb16-30">              }</span>
<span id="cb16-31">            ]</span>
<span id="cb16-32">)</span>
<span id="cb16-33"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(completion.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="textimage-to-image" class="level3">
<h3 class="anchored" data-anchor-id="textimage-to-image">7. text,image to image</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># | eval: false</span></span>
<span id="cb17-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> base64</span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert the previously generated image to base64</span></span>
<span id="cb17-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text_image_gemini_25_openrouter_1352.png"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> image_file:</span>
<span id="cb17-6">    base64_image <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> base64.b64encode(image_file.read()).decode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>)</span>
<span id="cb17-7"></span>
<span id="cb17-8">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb17-9">    extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb17-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"www.tonydotdev.com"</span>,</span>
<span id="cb17-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TT_AI_blog"</span>,</span>
<span id="cb17-12">    },</span>
<span id="cb17-13">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"google/gemini-2.5-flash-image"</span>,</span>
<span id="cb17-14">    messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb17-15">        {</span>
<span id="cb17-16">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>,</span>
<span id="cb17-17">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: [</span>
<span id="cb17-18">                {</span>
<span id="cb17-19">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,</span>
<span id="cb17-20">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transform this image into a sunset version with warmer colors and golden light.add one person skiing in the foreground."</span>,</span>
<span id="cb17-21">                },</span>
<span id="cb17-22">                {</span>
<span id="cb17-23">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_url"</span>,</span>
<span id="cb17-24">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_url"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"url"</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"data:image/png;base64,</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>base64_image<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>},</span>
<span id="cb17-25">                },</span>
<span id="cb17-26">            ],</span>
<span id="cb17-27">        }</span>
<span id="cb17-28">    ],</span>
<span id="cb17-29">    modalities<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>],</span>
<span id="cb17-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># image_size="1024x1024",</span></span>
<span id="cb17-31">)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> base64</span>
<span id="cb18-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract message</span></span>
<span id="cb18-4">message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message</span>
<span id="cb18-5"></span>
<span id="cb18-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Handle image output (base64 string inside "data:image/png;base64,...")</span></span>
<span id="cb18-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> message.images:</span>
<span id="cb18-8">    data_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> message.images[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_url"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"url"</span>]</span>
<span id="cb18-9"></span>
<span id="cb18-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Strip prefix if present</span></span>
<span id="cb18-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> data_url.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data:image"</span>):</span>
<span id="cb18-12">        _, base64_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_url.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb18-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb18-14">        base64_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_url</span>
<span id="cb18-15"></span>
<span id="cb18-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Decode and save as PNG</span></span>
<span id="cb18-17">    image_bytes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> base64.b64decode(base64_data)</span>
<span id="cb18-18">    current_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime.datetime.now().strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%H%M"</span>)</span>
<span id="cb18-19">    output_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"text_image_gemini_25_openrouter_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>current_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.png"</span></span>
<span id="cb18-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(output_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb18-21">        f.write(image_bytes)</span>
<span id="cb18-22"></span>
<span id="cb18-23">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"‚úÖ Image saved as </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>output_file<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb18-24"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb18-25">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"‚ùå No image returned in response"</span>)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> IPython.display <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image, display</span>
<span id="cb19-2"></span>
<span id="cb19-3">display(Image(filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text_image_gemini_25_openrouter_1405.png"</span>))</span></code></pre></div></div>
</details>
</div>
</section>
<section id="embedding" class="level3">
<h3 class="anchored" data-anchor-id="embedding">8 Embedding</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb20-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb20-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb20-4"></span>
<span id="cb20-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load environment variables from .env file</span></span>
<span id="cb20-6">load_dotenv()</span>
<span id="cb20-7"></span>
<span id="cb20-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb20-9">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb20-10">    base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb20-11">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb20-12">)</span>
<span id="cb20-13"></span>
<span id="cb20-14"></span>
<span id="cb20-15">embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.embeddings.create(</span>
<span id="cb20-16">  extra_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb20-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP-Referer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;YOUR_SITE_URL&gt;"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optional. Site URL for rankings on openrouter.ai.</span></span>
<span id="cb20-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X-Title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;YOUR_SITE_NAME&gt;"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optional. Site title for rankings on openrouter.ai.</span></span>
<span id="cb20-19">  },</span>
<span id="cb20-20">  model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"thenlper/gte-base"</span>,</span>
<span id="cb20-21">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I can"</span>,</span>
<span id="cb20-22">  encoding_format<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"float"</span></span>
<span id="cb20-23">)</span>
<span id="cb20-24"></span>
<span id="cb20-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(embedding.data[0].embedding) </span></span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(embedding.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding)</span></code></pre></div></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(embedding.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print first 5 dimensions</span></span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="cost-management-optimizing-your-ai-spending" class="level2">
<h2 class="anchored" data-anchor-id="cost-management-optimizing-your-ai-spending">Cost Management: Optimizing Your AI Spending</h2>
<p>One of OpenRouter‚Äôs most powerful features is its transparent pricing model and cost management capabilities. Understanding and managing costs is crucial for production AI applications.</p>
</section>
<section id="why-cost-management-matters" class="level2">
<h2 class="anchored" data-anchor-id="why-cost-management-matters">Why Cost Management Matters</h2>
<p><strong>üí∞ Financial Planning:</strong> - Predictable monthly expenses - Budget allocation across different use cases - ROI analysis for AI features - Cost per user tracking</p>
<p><strong>üîç Technical Optimization:</strong> - Model selection based on cost/performance ratio - Prompt engineering to reduce token usage - Caching strategies for repeated requests - Batch processing for efficiency</p>
</section>
<section id="real-time-cost-tracking" class="level2">
<h2 class="anchored" data-anchor-id="real-time-cost-tracking">Real-Time Cost Tracking</h2>
<p>OpenRouter provides programmatic access to current pricing for all models:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize the OpenAI client (if not already done)</span></span>
<span id="cb23-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb23-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb23-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb23-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb23-6"></span>
<span id="cb23-7">load_dotenv()</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(</span>
<span id="cb25-2">  base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb25-3">  api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb25-4">)</span>
<span id="cb25-5"></span>
<span id="cb25-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_model_pricing():</span>
<span id="cb25-7">    models_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.models.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>()</span>
<span id="cb25-8">    pricing_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb25-9"></span>
<span id="cb25-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> model <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> models_list.data:</span>
<span id="cb25-11">        name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span></span>
<span id="cb25-12">        pricing <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.pricing</span>
<span id="cb25-13"></span>
<span id="cb25-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get model metadata</span></span>
<span id="cb25-15">        context_length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">getattr</span>(model, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'context_length'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb25-16">        description <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">getattr</span>(model, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'description'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb25-17"></span>
<span id="cb25-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get creation date and convert to readable format</span></span>
<span id="cb25-19">        created_timestamp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">getattr</span>(model, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'created'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb25-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> created_timestamp:</span>
<span id="cb25-21">            <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb25-22">            created_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime.datetime.fromtimestamp(created_timestamp).strftime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'%Y-%m-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb25-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb25-24">            created_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb25-25"></span>
<span id="cb25-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract company from model name (first part before '/')</span></span>
<span id="cb25-27">        company <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> name.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> name <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Unknown'</span></span>
<span id="cb25-28"></span>
<span id="cb25-29">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert per-token prices to cost per 1M tokens</span></span>
<span id="cb25-30">        prompt_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>(pricing.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'prompt'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> pricing <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> pricing.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'prompt'</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb25-31">        completion_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>(pricing.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'completion'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> pricing <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> pricing.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'completion'</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb25-32">        request_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>(pricing.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'request'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> pricing <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> pricing.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'request'</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb25-33">        image_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>(pricing.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'image'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> pricing <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> pricing.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'image'</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb25-34"></span>
<span id="cb25-35">        pricing_data.append({</span>
<span id="cb25-36">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Model'</span>: name,</span>
<span id="cb25-37">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Company'</span>: company,</span>
<span id="cb25-38">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Description'</span>: description,</span>
<span id="cb25-39">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Context_Length'</span>: context_length,</span>
<span id="cb25-40">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Created_Date'</span>: created_date,</span>
<span id="cb25-41">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Prompt_Cost_per_1M'</span>: prompt_cost,</span>
<span id="cb25-42">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Completion_Cost_per_1M'</span>: completion_cost,</span>
<span id="cb25-43">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Request_Cost_per_1M'</span>: request_cost,</span>
<span id="cb25-44">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Image_Cost_per_1M'</span>: image_cost</span>
<span id="cb25-45">        })</span>
<span id="cb25-46"></span>
<span id="cb25-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create pandas DataFrame</span></span>
<span id="cb25-48">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(pricing_data)</span>
<span id="cb25-49"></span>
<span id="cb25-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sort by company then by model name for better organization</span></span>
<span id="cb25-51">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.sort_values([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Company'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Model'</span>]).reset_index(drop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb25-52"></span>
<span id="cb25-53">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb25-54"></span>
<span id="cb25-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get pricing DataFrames (all models and paid models only)</span></span>
<span id="cb25-56">all_models_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_model_pricing()</span></code></pre></div></div>
</details>
</div>
<section id="most-expensive-models" class="level4">
<h4 class="anchored" data-anchor-id="most-expensive-models">Most Expensive Models</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> panel <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pn</span>
<span id="cb26-2"></span>
<span id="cb26-3"></span>
<span id="cb26-4">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> all_models_df[</span>
<span id="cb26-5">    [</span>
<span id="cb26-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model"</span>,</span>
<span id="cb26-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Context_Length"</span>,</span>
<span id="cb26-8">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Created_Date"</span>,</span>
<span id="cb26-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prompt_Cost_per_1M"</span>,</span>
<span id="cb26-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Completion_Cost_per_1M"</span>,</span>
<span id="cb26-11">    ]</span>
<span id="cb26-12">].sort_values(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prompt_Cost_per_1M"</span>, ascending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb26-13"></span>
<span id="cb26-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a paginated table</span></span>
<span id="cb26-15">pn.extension(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tabulator"</span>)</span>
<span id="cb26-16">table <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pn.widgets.Tabulator(df, pagination<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"local"</span>, page_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, show_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb26-17">table</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Tabulator(page_size=10, pagination='local', show_index=False, value=              ...)</code></pre>
</div>
</div>
</section>
</section>
<section id="best-practices-production-ready-ai-development" class="level2">
<h2 class="anchored" data-anchor-id="best-practices-production-ready-ai-development">Best Practices: Production-Ready AI Development</h2>
<p>Following these best practices will help you build robust, secure, and efficient AI applications with OpenRouter.</p>
</section>
<section id="security-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="security-best-practices">üîí Security Best Practices</h2>
<section id="api-key-management" class="level3">
<h3 class="anchored" data-anchor-id="api-key-management">1. API Key Management</h3>
<ul>
<li><strong>Never hardcode API keys</strong> in source code or configuration files</li>
<li><strong>Use environment variables</strong> or secret management systems (AWS Secrets Manager, Azure Key Vault)</li>
<li><strong>Rotate API keys regularly</strong> and implement key rotation policies</li>
<li><strong>Use different keys</strong> for development, staging, and production environments</li>
<li><strong>Add .env to .gitignore</strong> - Never commit credentials to version control</li>
</ul>
</section>
<section id="input-validation-and-sanitization" class="level3">
<h3 class="anchored" data-anchor-id="input-validation-and-sanitization">2. Input Validation and Sanitization</h3>
<ul>
<li><strong>Validate user inputs</strong> before sending to AI models</li>
<li><strong>Sanitize prompts</strong> to prevent prompt injection attacks</li>
<li><strong>Implement rate limiting</strong> to prevent abuse</li>
<li><strong>Log and monitor</strong> for suspicious activity patterns</li>
</ul>
</section>
</section>
<section id="performance-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="performance-best-practices">‚ö° Performance Best Practices</h2>
<section id="model-selection-strategy" class="level3">
<h3 class="anchored" data-anchor-id="model-selection-strategy">3. Model Selection Strategy</h3>
<ul>
<li><strong>Choose the right model for your use case</strong> - Not all tasks need the most expensive model</li>
<li><strong>Benchmark models</strong> for your specific use cases</li>
<li><strong>Use free models</strong> for development and testing</li>
<li><strong>Consider specialized models</strong> for specific tasks (coding, math, creative writing)</li>
</ul>
</section>
<section id="optimization-techniques" class="level3">
<h3 class="anchored" data-anchor-id="optimization-techniques">4. Optimization Techniques</h3>
<ul>
<li><strong>Implement caching</strong> for repeated requests to reduce costs</li>
<li><strong>Use streaming</strong> for better user experience</li>
<li><strong>Batch requests</strong> when appropriate for efficiency</li>
<li><strong>Optimize prompts</strong> - Well-crafted prompts reduce token usage and improve results</li>
</ul>
</section>
</section>
<section id="reliability-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="reliability-best-practices">üõ°Ô∏è Reliability Best Practices</h2>
<section id="error-handling-and-resilience" class="level3">
<h3 class="anchored" data-anchor-id="error-handling-and-resilience">5. Error Handling and Resilience</h3>
<ul>
<li><strong>Implement comprehensive error handling</strong> - Models can be unavailable or rate-limited</li>
<li><strong>Use fallback models</strong> - Ensure your application remains functional even if one model is down</li>
<li><strong>Implement retry logic</strong> with exponential backoff</li>
<li><strong>Monitor response times</strong> and set appropriate timeouts</li>
</ul>
</section>
<section id="monitoring-and-analytics" class="level3">
<h3 class="anchored" data-anchor-id="monitoring-and-analytics">6. Monitoring and Analytics</h3>
<ul>
<li><strong>Monitor usage</strong> - Keep track of costs and set limits</li>
<li><strong>Track performance metrics</strong> (latency, success rates, error rates)</li>
<li><strong>Set up alerts</strong> for unusual activity patterns</li>
<li><strong>Create dashboards</strong> for real-time monitoring</li>
</ul>
</section>
</section>
<section id="cost-management-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="cost-management-best-practices">üìä Cost Management Best Practices</h2>
<section id="budget-control" class="level3">
<h3 class="anchored" data-anchor-id="budget-control">7. Budget Control</h3>
<ul>
<li><strong>Set spending limits</strong> and alerts in your OpenRouter dashboard</li>
<li><strong>Use cost-effective models</strong> for non-critical tasks</li>
<li><strong>Implement token counting</strong> to estimate costs before requests</li>
<li><strong>Review usage reports</strong> regularly to identify optimization opportunities</li>
</ul>
</section>
</section>
<section id="conclusion-building-the-future-of-ai-applications" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-building-the-future-of-ai-applications">Conclusion: Building the Future of AI Applications</h2>
<p>OpenRouter represents a paradigm shift in how developers interact with AI models. By providing a unified, reliable, and cost-effective gateway to the world‚Äôs most advanced AI models, OpenRouter enables developers to focus on creating value rather than managing infrastructure complexities.</p>


<!-- -->

</section>
</section>

 ]]></description>
  <category>AI</category>
  <category>API</category>
  <category>tutorial</category>
  <guid>https://your-website-url.example.com/posts/openrouter/</guid>
  <pubDate>Fri, 31 Oct 2025 16:00:00 GMT</pubDate>
  <media:content url="https://your-website-url.example.com/posts/openrouter/images.png" medium="image" type="image/png" height="48" width="144"/>
</item>
</channel>
</rss>
