<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tony D">
<meta name="dcterms.date" content="2025-11-01">

<title>OpenRouter: A Unified API for Multiple AI Models ‚Äì AI Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-d7ae91b437850ec40fb8359b7ecc6ae0.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-cb06e9681ca458196cadc2b80eccd21f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-d7ae91b437850ec40fb8359b7ecc6ae0.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">AI Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://jcwinning.github.io/LandingPage/"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-handbook" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Handbook</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-handbook">    
        <li>
    <a class="dropdown-item" href="https://jcwinning.github.io/Into_sql/">
 <span class="dropdown-text">SQL hangbook</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://jcfly3000.github.io/Into-R/">
 <span class="dropdown-text">R handbook</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://jcfly3000.github.io/Into-Python/">
 <span class="dropdown-text">Python handbook</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://tonyfly3000.github.io/tensorflowing/">
 <span class="dropdown-text">tensorflowing handbook</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://jcfly3000.github.io/into_AI/">
 <span class="dropdown-text">AI handbook</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://jcwinning.github.io/posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv.html"> 
<span class="menu-text">CV / ÁÆÄÂéÜ</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/JCfly3000"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-openrouter" id="toc-introduction-to-openrouter" class="nav-link active" data-scroll-target="#introduction-to-openrouter">Introduction to OpenRouter</a>
  <ul class="collapse">
  <li><a href="#getting-started-with-openrouter" id="toc-getting-started-with-openrouter" class="nav-link" data-scroll-target="#getting-started-with-openrouter">Getting Started with OpenRouter</a></li>
  <li><a href="#create-your-openrouter-account" id="toc-create-your-openrouter-account" class="nav-link" data-scroll-target="#create-your-openrouter-account">1. Create Your OpenRouter Account</a></li>
  <li><a href="#secure-api-key-management" id="toc-secure-api-key-management" class="nav-link" data-scroll-target="#secure-api-key-management">2. Secure API Key Management</a>
  <ul class="collapse">
  <li><a href="#why-environment-variables-matter" id="toc-why-environment-variables-matter" class="nav-link" data-scroll-target="#why-environment-variables-matter">Why Environment Variables Matter</a></li>
  <li><a href="#setting-up-environment-variables" id="toc-setting-up-environment-variables" class="nav-link" data-scroll-target="#setting-up-environment-variables">Setting Up Environment Variables</a></li>
  </ul></li>
  <li><a href="#your-first-api-call" id="toc-your-first-api-call" class="nav-link" data-scroll-target="#your-first-api-call">3. Your First API Call</a>
  <ul class="collapse">
  <li><a href="#understanding-the-architecture" id="toc-understanding-the-architecture" class="nav-link" data-scroll-target="#understanding-the-architecture">Understanding the Architecture</a></li>
  <li><a href="#required-dependencies" id="toc-required-dependencies" class="nav-link" data-scroll-target="#required-dependencies">Required Dependencies</a></li>
  <li><a href="#basic-text-generation-example" id="toc-basic-text-generation-example" class="nav-link" data-scroll-target="#basic-text-generation-example">Basic Text Generation Example</a></li>
  </ul></li>
  <li><a href="#mastering-system-prompts" id="toc-mastering-system-prompts" class="nav-link" data-scroll-target="#mastering-system-prompts">4. Mastering System Prompts</a>
  <ul class="collapse">
  <li><a href="#what-are-system-prompts" id="toc-what-are-system-prompts" class="nav-link" data-scroll-target="#what-are-system-prompts">What Are System Prompts?</a></li>
  <li><a href="#why-system-prompts-matter" id="toc-why-system-prompts-matter" class="nav-link" data-scroll-target="#why-system-prompts-matter">Why System Prompts Matter</a></li>
  <li><a href="#effective-system-prompt-examples" id="toc-effective-system-prompt-examples" class="nav-link" data-scroll-target="#effective-system-prompt-examples">Effective System Prompt Examples</a></li>
  </ul></li>
  <li><a href="#streaming-responses-real-time-ai-interaction" id="toc-streaming-responses-real-time-ai-interaction" class="nav-link" data-scroll-target="#streaming-responses-real-time-ai-interaction">5. Streaming Responses: Real-Time AI Interaction</a>
  <ul class="collapse">
  <li><a href="#why-streaming-matters" id="toc-why-streaming-matters" class="nav-link" data-scroll-target="#why-streaming-matters">Why Streaming Matters</a></li>
  <li><a href="#implementing-streaming-with-openrouter" id="toc-implementing-streaming-with-openrouter" class="nav-link" data-scroll-target="#implementing-streaming-with-openrouter">Implementing Streaming with OpenRouter</a></li>
  <li><a href="#text-to-image" id="toc-text-to-image" class="nav-link" data-scroll-target="#text-to-image">6. text to image</a></li>
  <li><a href="#image-to-text" id="toc-image-to-text" class="nav-link" data-scroll-target="#image-to-text">6 image to text</a></li>
  <li><a href="#textimage-to-image" id="toc-textimage-to-image" class="nav-link" data-scroll-target="#textimage-to-image">7. text,image to image</a></li>
  <li><a href="#embedding" id="toc-embedding" class="nav-link" data-scroll-target="#embedding">8 Embedding</a></li>
  </ul></li>
  <li><a href="#cost-management-optimizing-your-ai-spending" id="toc-cost-management-optimizing-your-ai-spending" class="nav-link" data-scroll-target="#cost-management-optimizing-your-ai-spending">Cost Management: Optimizing Your AI Spending</a></li>
  <li><a href="#why-cost-management-matters" id="toc-why-cost-management-matters" class="nav-link" data-scroll-target="#why-cost-management-matters">Why Cost Management Matters</a></li>
  <li><a href="#real-time-cost-tracking" id="toc-real-time-cost-tracking" class="nav-link" data-scroll-target="#real-time-cost-tracking">Real-Time Cost Tracking</a></li>
  <li><a href="#best-practices-production-ready-ai-development" id="toc-best-practices-production-ready-ai-development" class="nav-link" data-scroll-target="#best-practices-production-ready-ai-development">Best Practices: Production-Ready AI Development</a></li>
  <li><a href="#security-best-practices" id="toc-security-best-practices" class="nav-link" data-scroll-target="#security-best-practices">üîí Security Best Practices</a>
  <ul class="collapse">
  <li><a href="#api-key-management" id="toc-api-key-management" class="nav-link" data-scroll-target="#api-key-management">1. API Key Management</a></li>
  <li><a href="#input-validation-and-sanitization" id="toc-input-validation-and-sanitization" class="nav-link" data-scroll-target="#input-validation-and-sanitization">2. Input Validation and Sanitization</a></li>
  </ul></li>
  <li><a href="#performance-best-practices" id="toc-performance-best-practices" class="nav-link" data-scroll-target="#performance-best-practices">‚ö° Performance Best Practices</a>
  <ul class="collapse">
  <li><a href="#model-selection-strategy" id="toc-model-selection-strategy" class="nav-link" data-scroll-target="#model-selection-strategy">3. Model Selection Strategy</a></li>
  <li><a href="#optimization-techniques" id="toc-optimization-techniques" class="nav-link" data-scroll-target="#optimization-techniques">4. Optimization Techniques</a></li>
  </ul></li>
  <li><a href="#reliability-best-practices" id="toc-reliability-best-practices" class="nav-link" data-scroll-target="#reliability-best-practices">üõ°Ô∏è Reliability Best Practices</a>
  <ul class="collapse">
  <li><a href="#error-handling-and-resilience" id="toc-error-handling-and-resilience" class="nav-link" data-scroll-target="#error-handling-and-resilience">5. Error Handling and Resilience</a></li>
  <li><a href="#monitoring-and-analytics" id="toc-monitoring-and-analytics" class="nav-link" data-scroll-target="#monitoring-and-analytics">6. Monitoring and Analytics</a></li>
  </ul></li>
  <li><a href="#cost-management-best-practices" id="toc-cost-management-best-practices" class="nav-link" data-scroll-target="#cost-management-best-practices">üìä Cost Management Best Practices</a>
  <ul class="collapse">
  <li><a href="#budget-control" id="toc-budget-control" class="nav-link" data-scroll-target="#budget-control">7. Budget Control</a></li>
  </ul></li>
  <li><a href="#conclusion-building-the-future-of-ai-applications" id="toc-conclusion-building-the-future-of-ai-applications" class="nav-link" data-scroll-target="#conclusion-building-the-future-of-ai-applications">Conclusion: Building the Future of AI Applications</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">OpenRouter: A Unified API for Multiple AI Models</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">AI</div>
    <div class="quarto-category">API</div>
    <div class="quarto-category">tutorial</div>
  </div>
  </div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Tony D </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction-to-openrouter" class="level1">
<h1>Introduction to OpenRouter</h1>
<p>OpenRouter is a powerful platform that provides a unified API interface for accessing multiple AI models from various providers. Instead of integrating with each AI service separately, developers can use OpenRouter‚Äôs single endpoint to access models from OpenAI, Anthropic, Google, and many others.</p>
<section id="getting-started-with-openrouter" class="level2">
<h2 class="anchored" data-anchor-id="getting-started-with-openrouter">Getting Started with OpenRouter</h2>
<p>Getting started with OpenRouter is straightforward and can be accomplished in just a few steps. The platform is designed to minimize setup time while maintaining security best practices.</p>
</section>
<section id="create-your-openrouter-account" class="level2">
<h2 class="anchored" data-anchor-id="create-your-openrouter-account">1. Create Your OpenRouter Account</h2>
<p>First, visit <a href="https://openrouter.ai">openrouter.ai</a> and create an account. The registration process is simple:</p>
<ol type="1">
<li><strong>Sign Up</strong>: Use your email or social login (Google, GitHub)</li>
<li><strong>Verify Email</strong>: Confirm your email address through the verification link</li>
<li><strong>Access Dashboard</strong>: Navigate to your dashboard where you‚Äôll find your API key</li>
</ol>
<p><strong>üí° Pro Tip</strong>: Your dashboard provides valuable insights including: - Usage statistics and cost tracking - Model performance metrics - API key management - Billing information</p>
</section>
<section id="secure-api-key-management" class="level2">
<h2 class="anchored" data-anchor-id="secure-api-key-management">2. Secure API Key Management</h2>
<p>Security is paramount when working with AI APIs. Never hardcode your API keys directly in your code. Instead, use environment variables to keep your credentials safe:</p>
<section id="why-environment-variables-matter" class="level3">
<h3 class="anchored" data-anchor-id="why-environment-variables-matter">Why Environment Variables Matter</h3>
<ul>
<li><strong>Security</strong>: Prevents accidental exposure in version control</li>
<li><strong>Flexibility</strong>: Allows different keys for development, staging, and production</li>
<li><strong>Collaboration</strong>: Team members can use their own keys without sharing</li>
<li><strong>Deployment</strong>: Easy management across different hosting environments</li>
</ul>
</section>
<section id="setting-up-environment-variables" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-environment-variables">Setting Up Environment Variables</h3>
<p>Create a <code>.env</code> file in your project root:</p>
<p>OPENROUTER_API_KEY=your_actual_api_key_here</p>
<p>Install the <code>python-dotenv</code> library to load environment variables:</p>
<p>pip install python-dotenv</p>
</section>
</section>
<section id="your-first-api-call" class="level2">
<h2 class="anchored" data-anchor-id="your-first-api-call">3. Your First API Call</h2>
<p>Now that you have your API key set up, let‚Äôs make your first API call. OpenRouter cleverly uses the same API format as OpenAI, which means you can use the familiar <code>openai</code> Python library - just with a different base URL.</p>
<section id="understanding-the-architecture" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-architecture">Understanding the Architecture</h3>
<p><strong>üîß How It Works</strong>: OpenRouter acts as a smart proxy that: 1. Receives your standardized API requests 2. Routes them to the appropriate AI model provider 3. Handles provider-specific authentication and formatting 4. Returns responses in a consistent format 5. Tracks usage and costs across all models</p>
</section>
<section id="required-dependencies" class="level3">
<h3 class="anchored" data-anchor-id="required-dependencies">Required Dependencies</h3>
<p>Before you start, ensure you have the necessary Python packages:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install openai python-dotenv</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><strong>openai</strong>: The official OpenAI Python client (compatible with OpenRouter)</li>
<li><strong>python-dotenv</strong>: For loading environment variables from <code>.env</code> files</li>
</ul>
</section>
<section id="basic-text-generation-example" class="level3">
<h3 class="anchored" data-anchor-id="basic-text-generation-example">Basic Text Generation Example</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">python with OpenAI package</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">python with chatlas package</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">R with ellmer package</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from .env file</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>,  <span class="co"># OpenRouter's API endpoint</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>),  <span class="co"># Your secure API key</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a chat completion with OpenRouter</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  extra_headers<span class="op">=</span>{</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HTTP-Referer"</span>: <span class="st">"https://your-site.com"</span>,  <span class="co"># Optional: Helps OpenRouter improve their service</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Title"</span>: <span class="st">"Your Site Name"</span>,             <span class="co"># Optional: Your site name for OpenRouter rankings</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  model<span class="op">=</span><span class="st">"openai/gpt-oss-20b:free"</span>,          <span class="co"># Free model for testing/development</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"content"</span>: <span class="st">"Hello! Can you explain what OpenRouter is in simple terms?"</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  temperature<span class="op">=</span><span class="fl">0.7</span>  <span class="co"># Controls creativity (0.0 = deterministic, 1.0 = very creative)</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and print the response</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(completion.choices[<span class="dv">0</span>].message.content)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatOpenRouter</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from .env file</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> ChatOpenRouter(api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>,base_url<span class="op">=</span><span class="st">'https://openrouter.ai/api/v1'</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a> ,system_prompt<span class="op">=</span><span class="va">None</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a> ,model<span class="op">=</span><span class="st">"openai/gpt-oss-20b:free"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>response<span class="op">=</span>client.chat(<span class="st">"What is the capital of France?"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#str(response)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ellmer)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dotenv)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load_dot_env</span>(<span class="at">file =</span> <span class="st">".env"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>chat <span class="ot">&lt;-</span> <span class="fu">chat_openrouter</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">system_prompt =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span> <span class="fu">Sys.getenv</span>(<span class="st">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"openai/gpt-oss-20b:free"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo =</span> <span class="st">"none"</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>chat<span class="sc">$</span><span class="fu">chat</span>(<span class="st">"Tell me three jokes about statisticians"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
</div>
<p><strong>Key Components Explained:</strong></p>
<ul>
<li><strong><code>base_url</code></strong>: Points to OpenRouter‚Äôs API instead of OpenAI‚Äôs</li>
<li><strong><code>model</code></strong>: Uses OpenRouter‚Äôs model naming format (<code>provider/model-name</code>)</li>
<li><strong><code>extra_headers</code></strong>: Optional but recommended for OpenRouter‚Äôs analytics</li>
<li><strong><code>temperature</code></strong>: Controls response creativity (0.0-2.0 range)</li>
<li><strong><code>messages</code></strong>: Standard chat format with role-based conversation structure</li>
</ul>
<p><strong>üí° Model Selection Tips:</strong> - <strong>Free Models</strong>: Great for development (<code>*free</code> suffix) - <strong>Budget Models</strong>: Cost-effective for production (<code>*:budget</code> suffix) - <strong>Premium Models</strong>: Best performance (<code>*</code>, <code>*:pro</code>, <code>*:latest</code>) - <strong>Specialized</strong>: Task-optimized models (coding, math, creative writing)</p>
</section>
</section>
<section id="mastering-system-prompts" class="level2">
<h2 class="anchored" data-anchor-id="mastering-system-prompts">4. Mastering System Prompts</h2>
<p>System prompts are powerful tools that shape the AI‚Äôs behavior, personality, and response style. They set the context and rules for the entire conversation, appearing before user messages in the conversation flow.</p>
<section id="what-are-system-prompts" class="level3">
<h3 class="anchored" data-anchor-id="what-are-system-prompts">What Are System Prompts?</h3>
<p>System prompts act as <strong>meta-instructions</strong> that guide how the AI should respond throughout the conversation. They‚Äôre processed first and influence all subsequent interactions.</p>
</section>
<section id="why-system-prompts-matter" class="level3">
<h3 class="anchored" data-anchor-id="why-system-prompts-matter">Why System Prompts Matter</h3>
<ul>
<li><strong>Consistent Behavior</strong>: Ensures AI maintains the desired personality throughout</li>
<li><strong>Output Format</strong>: Dictates response structure (JSON, markdown, code blocks)</li>
<li><strong>Safety Constraints</strong>: Sets boundaries and restrictions on responses</li>
<li><strong>Context Setting</strong>: Provides background information for better responses</li>
<li><strong>Task Specialization</strong>: Optimizes AI for specific use cases</li>
</ul>
</section>
<section id="effective-system-prompt-examples" class="level3">
<h3 class="anchored" data-anchor-id="effective-system-prompt-examples">Effective System Prompt Examples</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example with system prompt</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  model<span class="op">=</span><span class="st">"openai/gpt-oss-20b:free"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"role"</span>: <span class="st">"system"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"content"</span>: <span class="st">"You are a helpful AI assistant that explains technical concepts in simple terms. Always be friendly and use analogies when possible and be simple"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"content"</span>: <span class="st">"How does temperature in LLM model work?"</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  temperature<span class="op">=</span><span class="fl">0.7</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(completion.choices[<span class="dv">0</span>].message.content)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Common system prompt patterns:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Different system prompt examples</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>system_prompts <span class="op">=</span> {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"coding_assistant"</span>: <span class="st">"You are an expert programmer. Provide clean, well-commented code solutions and explain your reasoning."</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"creative_writer"</span>: <span class="st">"You are a creative storyteller. Write engaging narratives with vivid descriptions and compelling characters."</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data_analyst"</span>: <span class="st">"You are a data analyst. Provide insights based on data, suggest visualizations, and explain statistical concepts clearly."</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tutor"</span>: <span class="st">"You are a patient tutor. Break down complex topics into simple steps and provide encouraging feedback."</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> chat_with_persona(persona, user_message):</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span><span class="st">"openai/gpt-oss-20b:free"</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>[</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: system_prompts[persona]},</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: user_message}</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span><span class="fl">0.7</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> completion.choices[<span class="dv">0</span>].message.content</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">#response = chat_with_persona("coding_assistant", "How do I reverse a string in Python?")</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">#print(response)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="streaming-responses-real-time-ai-interaction" class="level2">
<h2 class="anchored" data-anchor-id="streaming-responses-real-time-ai-interaction">5. Streaming Responses: Real-Time AI Interaction</h2>
<p>Streaming is a game-changer for user experience, especially in chat applications and interactive tools. Instead of waiting for complete responses, streaming delivers content as it‚Äôs being generated, creating natural and engaging conversations.</p>
<section id="why-streaming-matters" class="level3">
<h3 class="anchored" data-anchor-id="why-streaming-matters">Why Streaming Matters</h3>
<p><strong>üöÄ User Experience Benefits:</strong> - <strong>Immediate Feedback</strong>: Users see responses starting immediately - <strong>Reduced Perceived Latency</strong>: Content appears as it‚Äôs generated - <strong>Natural Conversation Flow</strong>: Mimics human speech patterns - <strong>Progress Indication</strong>: Users know the AI is working - <strong>Early Termination</strong>: Users can stop lengthy responses if needed</p>
<p><strong>‚ö° Technical Advantages:</strong> - <strong>Lower Memory Usage</strong>: No need to buffer complete responses - <strong>Faster Time-to-First-Byte</strong>: Content starts flowing immediately - <strong>Better Error Handling</strong>: Issues detected earlier in process - <strong>Resource Efficiency</strong>: Processes data incrementally</p>
</section>
<section id="implementing-streaming-with-openrouter" class="level3">
<h3 class="anchored" data-anchor-id="implementing-streaming-with-openrouter">Implementing Streaming with OpenRouter</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client (if not already done)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stream_response(model, message):</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    stream <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>model,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: message}],</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        stream<span class="op">=</span><span class="va">True</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> chunk <span class="kw">in</span> stream:</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> chunk.choices[<span class="dv">0</span>].delta.content <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(chunk.choices[<span class="dv">0</span>].delta.content, end<span class="op">=</span><span class="st">''</span>, flush<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Stream example</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Streaming response:"</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>stream_response(<span class="st">"openai/gpt-oss-20b:free"</span>, <span class="st">"Tell me a short story about AI"</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()  <span class="co"># Add newline after streaming</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="text-to-image" class="level3">
<h3 class="anchored" data-anchor-id="text-to-image">6. text to image</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from .env file</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Image generation request</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    extra_headers<span class="op">=</span>{</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"HTTP-Referer"</span>: <span class="st">"www.tonydotdev.com"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"X-Title"</span>: <span class="st">"TT_AI_blog"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"google/gemini-2.5-flash-image"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: <span class="st">"Generate a serene and realistic snowy mountain landscape at sunrise."</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    modalities<span class="op">=</span>[<span class="st">"image"</span>, <span class="st">"text"</span>],</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#image_size="1024x1024",</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract message</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>message <span class="op">=</span> response.choices[<span class="dv">0</span>].message</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle image output (base64 string inside "data:image/png;base64,...")</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> message.images:</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    data_url <span class="op">=</span> message.images[<span class="dv">0</span>][<span class="st">"image_url"</span>][<span class="st">"url"</span>]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Strip prefix if present</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data_url.startswith(<span class="st">"data:image"</span>):</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        _, base64_data <span class="op">=</span> data_url.split(<span class="st">","</span>, <span class="dv">1</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        base64_data <span class="op">=</span> data_url</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decode and save as PNG</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    image_bytes <span class="op">=</span> base64.b64decode(base64_data)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    current_time <span class="op">=</span> datetime.datetime.now().strftime(<span class="st">"%H%M"</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    output_file <span class="op">=</span> <span class="ss">f"text_image_gemini_25_openrouter_</span><span class="sc">{</span>current_time<span class="sc">}</span><span class="ss">.png"</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        f.write(image_bytes)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úÖ Image saved as </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"‚ùå No image returned in response"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image, display</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>display(Image(filename<span class="op">=</span><span class="st">"text_image_gemini_25_openrouter_1352.png"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;IPython.core.display.Image object&gt;</code></pre>
</div>
</div>
</section>
<section id="image-to-text" class="level3">
<h3 class="anchored" data-anchor-id="image-to-text">6 image to text</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert local image to data URL</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"text_image_gemini_25_openrouter_1352.png"</span>, <span class="st">"rb"</span>) <span class="im">as</span> image_file:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    base64_image <span class="op">=</span> base64.b64encode(image_file.read()).decode(<span class="st">'utf-8'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    data_url <span class="op">=</span> <span class="ss">f"data:image/png;base64,</span><span class="sc">{</span>base64_image<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  extra_headers<span class="op">=</span>{</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HTTP-Referer"</span>: <span class="st">"&lt;YOUR_SITE_URL&gt;"</span>, <span class="co"># Optional. Site URL for rankings on openrouter.ai.</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Title"</span>: <span class="st">"&lt;YOUR_SITE_NAME&gt;"</span>, <span class="co"># Optional. Site title for rankings on openrouter.ai.</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  extra_body<span class="op">=</span>{},</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  model<span class="op">=</span><span class="st">"nvidia/nemotron-nano-12b-v2-vl:free"</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>              {</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"content"</span>: [</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>                  {</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"text"</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"text"</span>: <span class="st">"What is in this image?"</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>                  },</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                  {</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"image_url"</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"image_url"</span>: {</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"url"</span>: data_url</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>                  }</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(completion.choices[<span class="dv">0</span>].message.content)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="textimage-to-image" class="level3">
<h3 class="anchored" data-anchor-id="textimage-to-image">7. text,image to image</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the previously generated image to base64</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"text_image_gemini_25_openrouter_1352.png"</span>, <span class="st">"rb"</span>) <span class="im">as</span> image_file:</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    base64_image <span class="op">=</span> base64.b64encode(image_file.read()).decode(<span class="st">"utf-8"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    extra_headers<span class="op">=</span>{</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"HTTP-Referer"</span>: <span class="st">"www.tonydotdev.com"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"X-Title"</span>: <span class="st">"TT_AI_blog"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"google/gemini-2.5-flash-image"</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: [</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"text"</span>,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"text"</span>: <span class="st">"Transform this image into a sunset version with warmer colors and golden light.add one person skiing in the foreground."</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"image_url"</span>,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"image_url"</span>: {<span class="st">"url"</span>: <span class="ss">f"data:image/png;base64,</span><span class="sc">{</span>base64_image<span class="sc">}</span><span class="ss">"</span>},</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    modalities<span class="op">=</span>[<span class="st">"image"</span>, <span class="st">"text"</span>],</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># image_size="1024x1024",</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract message</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>message <span class="op">=</span> response.choices[<span class="dv">0</span>].message</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle image output (base64 string inside "data:image/png;base64,...")</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> message.images:</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    data_url <span class="op">=</span> message.images[<span class="dv">0</span>][<span class="st">"image_url"</span>][<span class="st">"url"</span>]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Strip prefix if present</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data_url.startswith(<span class="st">"data:image"</span>):</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        _, base64_data <span class="op">=</span> data_url.split(<span class="st">","</span>, <span class="dv">1</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        base64_data <span class="op">=</span> data_url</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decode and save as PNG</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    image_bytes <span class="op">=</span> base64.b64decode(base64_data)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    current_time <span class="op">=</span> datetime.datetime.now().strftime(<span class="st">"%H%M"</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    output_file <span class="op">=</span> <span class="ss">f"text_image_gemini_25_openrouter_</span><span class="sc">{</span>current_time<span class="sc">}</span><span class="ss">.png"</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        f.write(image_bytes)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úÖ Image saved as </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"‚ùå No image returned in response"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image, display</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>display(Image(filename<span class="op">=</span><span class="st">"text_image_gemini_25_openrouter_1405.png"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="embedding" class="level3">
<h3 class="anchored" data-anchor-id="embedding">8 Embedding</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from .env file</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>embedding <span class="op">=</span> client.embeddings.create(</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  extra_headers<span class="op">=</span>{</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HTTP-Referer"</span>: <span class="st">"&lt;YOUR_SITE_URL&gt;"</span>, <span class="co"># Optional. Site URL for rankings on openrouter.ai.</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Title"</span>: <span class="st">"&lt;YOUR_SITE_NAME&gt;"</span>, <span class="co"># Optional. Site title for rankings on openrouter.ai.</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  model<span class="op">=</span><span class="st">"thenlper/gte-base"</span>,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="bu">input</span><span class="op">=</span><span class="st">"I can"</span>,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  encoding_format<span class="op">=</span><span class="st">"float"</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">#print(embedding.data[0].embedding) </span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(embedding.data[<span class="dv">0</span>].embedding)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(embedding.data[<span class="dv">0</span>].embedding[:<span class="dv">5</span>])  <span class="co"># Print first 5 dimensions</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="cost-management-optimizing-your-ai-spending" class="level2">
<h2 class="anchored" data-anchor-id="cost-management-optimizing-your-ai-spending">Cost Management: Optimizing Your AI Spending</h2>
<p>One of OpenRouter‚Äôs most powerful features is its transparent pricing model and cost management capabilities. Understanding and managing costs is crucial for production AI applications.</p>
</section>
<section id="why-cost-management-matters" class="level2">
<h2 class="anchored" data-anchor-id="why-cost-management-matters">Why Cost Management Matters</h2>
<p><strong>üí∞ Financial Planning:</strong> - Predictable monthly expenses - Budget allocation across different use cases - ROI analysis for AI features - Cost per user tracking</p>
<p><strong>üîç Technical Optimization:</strong> - Model selection based on cost/performance ratio - Prompt engineering to reduce token usage - Caching strategies for repeated requests - Batch processing for efficiency</p>
</section>
<section id="real-time-cost-tracking" class="level2">
<h2 class="anchored" data-anchor-id="real-time-cost-tracking">Real-Time Cost Tracking</h2>
<p>OpenRouter provides programmatic access to current pricing for all models:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client (if not already done)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_model_pricing():</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    models_list <span class="op">=</span> client.models.<span class="bu">list</span>()</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    pricing_data <span class="op">=</span> []</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model <span class="kw">in</span> models_list.data:</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> model.<span class="bu">id</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        pricing <span class="op">=</span> model.pricing</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get model metadata</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        context_length <span class="op">=</span> <span class="bu">getattr</span>(model, <span class="st">'context_length'</span>, <span class="va">None</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        description <span class="op">=</span> <span class="bu">getattr</span>(model, <span class="st">'description'</span>, <span class="st">''</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get creation date and convert to readable format</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        created_timestamp <span class="op">=</span> <span class="bu">getattr</span>(model, <span class="st">'created'</span>, <span class="va">None</span>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> created_timestamp:</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>            <span class="im">import</span> datetime</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>            created_date <span class="op">=</span> datetime.datetime.fromtimestamp(created_timestamp).strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>            created_date <span class="op">=</span> <span class="va">None</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract company from model name (first part before '/')</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        company <span class="op">=</span> name.split(<span class="st">'/'</span>)[<span class="dv">0</span>] <span class="cf">if</span> <span class="st">'/'</span> <span class="kw">in</span> name <span class="cf">else</span> <span class="st">'Unknown'</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert per-token prices to cost per 1M tokens</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        prompt_cost <span class="op">=</span> <span class="bu">float</span>(pricing.get(<span class="st">'prompt'</span>, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">1000000</span> <span class="cf">if</span> pricing <span class="kw">and</span> pricing.get(<span class="st">'prompt'</span>) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        completion_cost <span class="op">=</span> <span class="bu">float</span>(pricing.get(<span class="st">'completion'</span>, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">1000000</span> <span class="cf">if</span> pricing <span class="kw">and</span> pricing.get(<span class="st">'completion'</span>) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>        request_cost <span class="op">=</span> <span class="bu">float</span>(pricing.get(<span class="st">'request'</span>, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">1000000</span> <span class="cf">if</span> pricing <span class="kw">and</span> pricing.get(<span class="st">'request'</span>) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        image_cost <span class="op">=</span> <span class="bu">float</span>(pricing.get(<span class="st">'image'</span>, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">1000000</span> <span class="cf">if</span> pricing <span class="kw">and</span> pricing.get(<span class="st">'image'</span>) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>        pricing_data.append({</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Model'</span>: name,</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Company'</span>: company,</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Description'</span>: description,</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Context_Length'</span>: context_length,</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Created_Date'</span>: created_date,</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Prompt_Cost_per_1M'</span>: prompt_cost,</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Completion_Cost_per_1M'</span>: completion_cost,</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Request_Cost_per_1M'</span>: request_cost,</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Image_Cost_per_1M'</span>: image_cost</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create pandas DataFrame</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(pricing_data)</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by company then by model name for better organization</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'Company'</span>, <span class="st">'Model'</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Get pricing DataFrames (all models and paid models only)</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>all_models_df <span class="op">=</span> get_model_pricing()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="most-expensive-models" class="level4">
<h4 class="anchored" data-anchor-id="most-expensive-models">Most Expensive Models</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> panel <span class="im">as</span> pn</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> all_models_df[</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Model"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Context_Length"</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Created_Date"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Prompt_Cost_per_1M"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Completion_Cost_per_1M"</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>].sort_values(<span class="st">"Prompt_Cost_per_1M"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a paginated table</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>pn.extension(<span class="st">"tabulator"</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pn.widgets.Tabulator(df, pagination<span class="op">=</span><span class="st">"local"</span>, page_size<span class="op">=</span><span class="dv">10</span>, show_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>table</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Tabulator(page_size=10, pagination='local', show_index=False, value=              ...)</code></pre>
</div>
</div>
</section>
</section>
<section id="best-practices-production-ready-ai-development" class="level2">
<h2 class="anchored" data-anchor-id="best-practices-production-ready-ai-development">Best Practices: Production-Ready AI Development</h2>
<p>Following these best practices will help you build robust, secure, and efficient AI applications with OpenRouter.</p>
</section>
<section id="security-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="security-best-practices">üîí Security Best Practices</h2>
<section id="api-key-management" class="level3">
<h3 class="anchored" data-anchor-id="api-key-management">1. API Key Management</h3>
<ul>
<li><strong>Never hardcode API keys</strong> in source code or configuration files</li>
<li><strong>Use environment variables</strong> or secret management systems (AWS Secrets Manager, Azure Key Vault)</li>
<li><strong>Rotate API keys regularly</strong> and implement key rotation policies</li>
<li><strong>Use different keys</strong> for development, staging, and production environments</li>
<li><strong>Add .env to .gitignore</strong> - Never commit credentials to version control</li>
</ul>
</section>
<section id="input-validation-and-sanitization" class="level3">
<h3 class="anchored" data-anchor-id="input-validation-and-sanitization">2. Input Validation and Sanitization</h3>
<ul>
<li><strong>Validate user inputs</strong> before sending to AI models</li>
<li><strong>Sanitize prompts</strong> to prevent prompt injection attacks</li>
<li><strong>Implement rate limiting</strong> to prevent abuse</li>
<li><strong>Log and monitor</strong> for suspicious activity patterns</li>
</ul>
</section>
</section>
<section id="performance-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="performance-best-practices">‚ö° Performance Best Practices</h2>
<section id="model-selection-strategy" class="level3">
<h3 class="anchored" data-anchor-id="model-selection-strategy">3. Model Selection Strategy</h3>
<ul>
<li><strong>Choose the right model for your use case</strong> - Not all tasks need the most expensive model</li>
<li><strong>Benchmark models</strong> for your specific use cases</li>
<li><strong>Use free models</strong> for development and testing</li>
<li><strong>Consider specialized models</strong> for specific tasks (coding, math, creative writing)</li>
</ul>
</section>
<section id="optimization-techniques" class="level3">
<h3 class="anchored" data-anchor-id="optimization-techniques">4. Optimization Techniques</h3>
<ul>
<li><strong>Implement caching</strong> for repeated requests to reduce costs</li>
<li><strong>Use streaming</strong> for better user experience</li>
<li><strong>Batch requests</strong> when appropriate for efficiency</li>
<li><strong>Optimize prompts</strong> - Well-crafted prompts reduce token usage and improve results</li>
</ul>
</section>
</section>
<section id="reliability-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="reliability-best-practices">üõ°Ô∏è Reliability Best Practices</h2>
<section id="error-handling-and-resilience" class="level3">
<h3 class="anchored" data-anchor-id="error-handling-and-resilience">5. Error Handling and Resilience</h3>
<ul>
<li><strong>Implement comprehensive error handling</strong> - Models can be unavailable or rate-limited</li>
<li><strong>Use fallback models</strong> - Ensure your application remains functional even if one model is down</li>
<li><strong>Implement retry logic</strong> with exponential backoff</li>
<li><strong>Monitor response times</strong> and set appropriate timeouts</li>
</ul>
</section>
<section id="monitoring-and-analytics" class="level3">
<h3 class="anchored" data-anchor-id="monitoring-and-analytics">6. Monitoring and Analytics</h3>
<ul>
<li><strong>Monitor usage</strong> - Keep track of costs and set limits</li>
<li><strong>Track performance metrics</strong> (latency, success rates, error rates)</li>
<li><strong>Set up alerts</strong> for unusual activity patterns</li>
<li><strong>Create dashboards</strong> for real-time monitoring</li>
</ul>
</section>
</section>
<section id="cost-management-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="cost-management-best-practices">üìä Cost Management Best Practices</h2>
<section id="budget-control" class="level3">
<h3 class="anchored" data-anchor-id="budget-control">7. Budget Control</h3>
<ul>
<li><strong>Set spending limits</strong> and alerts in your OpenRouter dashboard</li>
<li><strong>Use cost-effective models</strong> for non-critical tasks</li>
<li><strong>Implement token counting</strong> to estimate costs before requests</li>
<li><strong>Review usage reports</strong> regularly to identify optimization opportunities</li>
</ul>
</section>
</section>
<section id="conclusion-building-the-future-of-ai-applications" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-building-the-future-of-ai-applications">Conclusion: Building the Future of AI Applications</h2>
<p>OpenRouter represents a paradigm shift in how developers interact with AI models. By providing a unified, reliable, and cost-effective gateway to the world‚Äôs most advanced AI models, OpenRouter enables developers to focus on creating value rather than managing infrastructure complexities.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/your-website-url\.example\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "OpenRouter: A Unified API for Multiple AI Models"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Tony D"</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2025-11-01"</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [AI, API, tutorial]</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "images.png"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: false</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Install required packages</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>required_packages <span class="op">=</span> [<span class="st">'openai'</span>, <span class="st">'python-dotenv'</span>, <span class="st">'pandas'</span>, <span class="st">'IPython'</span>,<span class="st">'panel'</span>]</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> package <span class="kw">in</span> required_packages:</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">__import__</span>(package.replace(<span class="st">'-'</span>, <span class="st">'_'</span>))</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>package<span class="sc">}</span><span class="ss"> already installed"</span>)</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Installing </span><span class="sc">{</span>package<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>        subprocess.check_call([sys.executable, <span class="st">"-m"</span>, <span class="st">"pip"</span>, <span class="st">"install"</span>, package])</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys, platform</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sys.executable)</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction to OpenRouter</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>OpenRouter is a powerful platform that provides a unified API interface for accessing multiple AI models from various providers. Instead of integrating with each AI service separately, developers can use OpenRouter's single endpoint to access models from OpenAI, Anthropic, Google, and many others.</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a><span class="fu">## Getting Started with OpenRouter</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>Getting started with OpenRouter is straightforward and can be accomplished in just a few steps. The platform is designed to minimize setup time while maintaining security best practices.</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. Create Your OpenRouter Account</span></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>First, visit <span class="co">[</span><span class="ot">openrouter.ai</span><span class="co">](https://openrouter.ai)</span> and create an account. The registration process is simple:</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Sign Up**: Use your email or social login (Google, GitHub)</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Verify Email**: Confirm your email address through the verification link</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Access Dashboard**: Navigate to your dashboard where you'll find your API key</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>**üí° Pro Tip**: Your dashboard provides valuable insights including:</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Usage statistics and cost tracking</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Model performance metrics</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>API key management</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Billing information</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. Secure API Key Management</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>Security is paramount when working with AI APIs. Never hardcode your API keys directly in your code. Instead, use environment variables to keep your credentials safe:</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Environment Variables Matter</span></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Security**: Prevents accidental exposure in version control</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Flexibility**: Allows different keys for development, staging, and production</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Collaboration**: Team members can use their own keys without sharing</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Deployment**: Easy management across different hosting environments</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setting Up Environment Variables</span></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>Create a <span class="in">`.env`</span> file in your project root:</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>OPENROUTER_API_KEY=your_actual_api_key_here</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a>Install the <span class="in">`python-dotenv`</span> library to load environment variables:</span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>pip install python-dotenv</span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. Your First API Call</span></span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a>Now that you have your API key set up, let's make your first API call. OpenRouter cleverly uses the same API format as OpenAI, which means you can use the familiar <span class="in">`openai`</span> Python library - just with a different base URL.</span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding the Architecture</span></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a>**üîß How It Works**: OpenRouter acts as a smart proxy that:</span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Receives your standardized API requests</span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Routes them to the appropriate AI model provider</span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Handles provider-specific authentication and formatting</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Returns responses in a consistent format</span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Tracks usage and costs across all models</span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a><span class="fu">### Required Dependencies</span></span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>Before you start, ensure you have the necessary Python packages:</span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install openai python-dotenv</span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**openai**: The official OpenAI Python client (compatible with OpenRouter)</span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**python-dotenv**: For loading environment variables from <span class="in">`.env`</span> files</span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic Text Generation Example</span></span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a><span class="fu">## python with OpenAI package</span></span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb28-129"><a href="#cb28-129" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb28-130"><a href="#cb28-130" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb28-131"><a href="#cb28-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-132"><a href="#cb28-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from .env file</span></span>
<span id="cb28-133"><a href="#cb28-133" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb28-134"><a href="#cb28-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-135"><a href="#cb28-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb28-136"><a href="#cb28-136" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb28-137"><a href="#cb28-137" aria-hidden="true" tabindex="-1"></a>  base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>,  <span class="co"># OpenRouter's API endpoint</span></span>
<span id="cb28-138"><a href="#cb28-138" aria-hidden="true" tabindex="-1"></a>  api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>),  <span class="co"># Your secure API key</span></span>
<span id="cb28-139"><a href="#cb28-139" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-140"><a href="#cb28-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-141"><a href="#cb28-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a chat completion with OpenRouter</span></span>
<span id="cb28-142"><a href="#cb28-142" aria-hidden="true" tabindex="-1"></a>completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb28-143"><a href="#cb28-143" aria-hidden="true" tabindex="-1"></a>  extra_headers<span class="op">=</span>{</span>
<span id="cb28-144"><a href="#cb28-144" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HTTP-Referer"</span>: <span class="st">"https://your-site.com"</span>,  <span class="co"># Optional: Helps OpenRouter improve their service</span></span>
<span id="cb28-145"><a href="#cb28-145" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Title"</span>: <span class="st">"Your Site Name"</span>,             <span class="co"># Optional: Your site name for OpenRouter rankings</span></span>
<span id="cb28-146"><a href="#cb28-146" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb28-147"><a href="#cb28-147" aria-hidden="true" tabindex="-1"></a>  model<span class="op">=</span><span class="st">"openai/gpt-oss-20b:free"</span>,          <span class="co"># Free model for testing/development</span></span>
<span id="cb28-148"><a href="#cb28-148" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[</span>
<span id="cb28-149"><a href="#cb28-149" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-150"><a href="#cb28-150" aria-hidden="true" tabindex="-1"></a>      <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb28-151"><a href="#cb28-151" aria-hidden="true" tabindex="-1"></a>      <span class="st">"content"</span>: <span class="st">"Hello! Can you explain what OpenRouter is in simple terms?"</span></span>
<span id="cb28-152"><a href="#cb28-152" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-153"><a href="#cb28-153" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb28-154"><a href="#cb28-154" aria-hidden="true" tabindex="-1"></a>  temperature<span class="op">=</span><span class="fl">0.7</span>  <span class="co"># Controls creativity (0.0 = deterministic, 1.0 = very creative)</span></span>
<span id="cb28-155"><a href="#cb28-155" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-156"><a href="#cb28-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-157"><a href="#cb28-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and print the response</span></span>
<span id="cb28-158"><a href="#cb28-158" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(completion.choices[<span class="dv">0</span>].message.content)</span>
<span id="cb28-159"><a href="#cb28-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-160"><a href="#cb28-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-161"><a href="#cb28-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-162"><a href="#cb28-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-163"><a href="#cb28-163" aria-hidden="true" tabindex="-1"></a><span class="fu">## python with chatlas package</span></span>
<span id="cb28-164"><a href="#cb28-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-167"><a href="#cb28-167" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-168"><a href="#cb28-168" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb28-169"><a href="#cb28-169" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> chatlas <span class="im">import</span> ChatOpenRouter</span>
<span id="cb28-170"><a href="#cb28-170" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb28-171"><a href="#cb28-171" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb28-172"><a href="#cb28-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-173"><a href="#cb28-173" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from .env file</span></span>
<span id="cb28-174"><a href="#cb28-174" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb28-175"><a href="#cb28-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-176"><a href="#cb28-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb28-177"><a href="#cb28-177" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> ChatOpenRouter(api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>)</span>
<span id="cb28-178"><a href="#cb28-178" aria-hidden="true" tabindex="-1"></a>,base_url<span class="op">=</span><span class="st">'https://openrouter.ai/api/v1'</span></span>
<span id="cb28-179"><a href="#cb28-179" aria-hidden="true" tabindex="-1"></a> ,system_prompt<span class="op">=</span><span class="va">None</span></span>
<span id="cb28-180"><a href="#cb28-180" aria-hidden="true" tabindex="-1"></a> ,model<span class="op">=</span><span class="st">"openai/gpt-oss-20b:free"</span>)</span>
<span id="cb28-181"><a href="#cb28-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-182"><a href="#cb28-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-185"><a href="#cb28-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-186"><a href="#cb28-186" aria-hidden="true" tabindex="-1"></a>response<span class="op">=</span>client.chat(<span class="st">"What is the capital of France?"</span>)</span>
<span id="cb28-187"><a href="#cb28-187" aria-hidden="true" tabindex="-1"></a><span class="co">#str(response)</span></span>
<span id="cb28-188"><a href="#cb28-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-189"><a href="#cb28-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-190"><a href="#cb28-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-191"><a href="#cb28-191" aria-hidden="true" tabindex="-1"></a><span class="fu">## R with ellmer package</span></span>
<span id="cb28-192"><a href="#cb28-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-195"><a href="#cb28-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-196"><a href="#cb28-196" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ellmer)</span>
<span id="cb28-197"><a href="#cb28-197" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dotenv)</span>
<span id="cb28-198"><a href="#cb28-198" aria-hidden="true" tabindex="-1"></a><span class="fu">load_dot_env</span>(<span class="at">file =</span> <span class="st">".env"</span>)</span>
<span id="cb28-199"><a href="#cb28-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-200"><a href="#cb28-200" aria-hidden="true" tabindex="-1"></a>chat <span class="ot">&lt;-</span> <span class="fu">chat_openrouter</span>(</span>
<span id="cb28-201"><a href="#cb28-201" aria-hidden="true" tabindex="-1"></a>  <span class="at">system_prompt =</span> <span class="cn">NULL</span>,</span>
<span id="cb28-202"><a href="#cb28-202" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span> <span class="fu">Sys.getenv</span>(<span class="st">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb28-203"><a href="#cb28-203" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-204"><a href="#cb28-204" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"openai/gpt-oss-20b:free"</span>,</span>
<span id="cb28-205"><a href="#cb28-205" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo =</span> <span class="st">"none"</span></span>
<span id="cb28-206"><a href="#cb28-206" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-207"><a href="#cb28-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-208"><a href="#cb28-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-209"><a href="#cb28-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-210"><a href="#cb28-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-213"><a href="#cb28-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-214"><a href="#cb28-214" aria-hidden="true" tabindex="-1"></a>chat<span class="sc">$</span><span class="fu">chat</span>(<span class="st">"Tell me three jokes about statisticians"</span>)</span>
<span id="cb28-215"><a href="#cb28-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-216"><a href="#cb28-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-217"><a href="#cb28-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-218"><a href="#cb28-218" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb28-219"><a href="#cb28-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-220"><a href="#cb28-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-221"><a href="#cb28-221" aria-hidden="true" tabindex="-1"></a>**Key Components Explained:**</span>
<span id="cb28-222"><a href="#cb28-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-223"><a href="#cb28-223" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`base_url`**: Points to OpenRouter's API instead of OpenAI's</span>
<span id="cb28-224"><a href="#cb28-224" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`model`**: Uses OpenRouter's model naming format (<span class="in">`provider/model-name`</span>)</span>
<span id="cb28-225"><a href="#cb28-225" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`extra_headers`**: Optional but recommended for OpenRouter's analytics</span>
<span id="cb28-226"><a href="#cb28-226" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`temperature`**: Controls response creativity (0.0-2.0 range)</span>
<span id="cb28-227"><a href="#cb28-227" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**`messages`**: Standard chat format with role-based conversation structure</span>
<span id="cb28-228"><a href="#cb28-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-229"><a href="#cb28-229" aria-hidden="true" tabindex="-1"></a>**üí° Model Selection Tips:**</span>
<span id="cb28-230"><a href="#cb28-230" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Free Models**: Great for development (<span class="in">`*free`</span> suffix)</span>
<span id="cb28-231"><a href="#cb28-231" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Budget Models**: Cost-effective for production (<span class="in">`*:budget`</span> suffix)</span>
<span id="cb28-232"><a href="#cb28-232" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Premium Models**: Best performance (<span class="in">`*`</span>, <span class="in">`*:pro`</span>, <span class="in">`*:latest`</span>)</span>
<span id="cb28-233"><a href="#cb28-233" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Specialized**: Task-optimized models (coding, math, creative writing)</span>
<span id="cb28-234"><a href="#cb28-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-235"><a href="#cb28-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-236"><a href="#cb28-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-237"><a href="#cb28-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-238"><a href="#cb28-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-239"><a href="#cb28-239" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4. Mastering System Prompts</span></span>
<span id="cb28-240"><a href="#cb28-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-241"><a href="#cb28-241" aria-hidden="true" tabindex="-1"></a>System prompts are powerful tools that shape the AI's behavior, personality, and response style. They set the context and rules for the entire conversation, appearing before user messages in the conversation flow.</span>
<span id="cb28-242"><a href="#cb28-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-243"><a href="#cb28-243" aria-hidden="true" tabindex="-1"></a><span class="fu">### What Are System Prompts?</span></span>
<span id="cb28-244"><a href="#cb28-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-245"><a href="#cb28-245" aria-hidden="true" tabindex="-1"></a>System prompts act as **meta-instructions** that guide how the AI should respond throughout the conversation. They're processed first and influence all subsequent interactions.</span>
<span id="cb28-246"><a href="#cb28-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-247"><a href="#cb28-247" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why System Prompts Matter</span></span>
<span id="cb28-248"><a href="#cb28-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-249"><a href="#cb28-249" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Consistent Behavior**: Ensures AI maintains the desired personality throughout</span>
<span id="cb28-250"><a href="#cb28-250" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Output Format**: Dictates response structure (JSON, markdown, code blocks)</span>
<span id="cb28-251"><a href="#cb28-251" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Safety Constraints**: Sets boundaries and restrictions on responses</span>
<span id="cb28-252"><a href="#cb28-252" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Context Setting**: Provides background information for better responses</span>
<span id="cb28-253"><a href="#cb28-253" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Task Specialization**: Optimizes AI for specific use cases</span>
<span id="cb28-254"><a href="#cb28-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-255"><a href="#cb28-255" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effective System Prompt Examples</span></span>
<span id="cb28-256"><a href="#cb28-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-259"><a href="#cb28-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-260"><a href="#cb28-260" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb28-261"><a href="#cb28-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Example with system prompt</span></span>
<span id="cb28-262"><a href="#cb28-262" aria-hidden="true" tabindex="-1"></a>completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb28-263"><a href="#cb28-263" aria-hidden="true" tabindex="-1"></a>  model<span class="op">=</span><span class="st">"openai/gpt-oss-20b:free"</span>,</span>
<span id="cb28-264"><a href="#cb28-264" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[</span>
<span id="cb28-265"><a href="#cb28-265" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-266"><a href="#cb28-266" aria-hidden="true" tabindex="-1"></a>      <span class="st">"role"</span>: <span class="st">"system"</span>,</span>
<span id="cb28-267"><a href="#cb28-267" aria-hidden="true" tabindex="-1"></a>      <span class="st">"content"</span>: <span class="st">"You are a helpful AI assistant that explains technical concepts in simple terms. Always be friendly and use analogies when possible and be simple"</span></span>
<span id="cb28-268"><a href="#cb28-268" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb28-269"><a href="#cb28-269" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-270"><a href="#cb28-270" aria-hidden="true" tabindex="-1"></a>      <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb28-271"><a href="#cb28-271" aria-hidden="true" tabindex="-1"></a>      <span class="st">"content"</span>: <span class="st">"How does temperature in LLM model work?"</span></span>
<span id="cb28-272"><a href="#cb28-272" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-273"><a href="#cb28-273" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb28-274"><a href="#cb28-274" aria-hidden="true" tabindex="-1"></a>  temperature<span class="op">=</span><span class="fl">0.7</span></span>
<span id="cb28-275"><a href="#cb28-275" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-276"><a href="#cb28-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-277"><a href="#cb28-277" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(completion.choices[<span class="dv">0</span>].message.content)</span>
<span id="cb28-278"><a href="#cb28-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-279"><a href="#cb28-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-280"><a href="#cb28-280" aria-hidden="true" tabindex="-1"></a>Common system prompt patterns:</span>
<span id="cb28-281"><a href="#cb28-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-284"><a href="#cb28-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-285"><a href="#cb28-285" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb28-286"><a href="#cb28-286" aria-hidden="true" tabindex="-1"></a><span class="co"># Different system prompt examples</span></span>
<span id="cb28-287"><a href="#cb28-287" aria-hidden="true" tabindex="-1"></a>system_prompts <span class="op">=</span> {</span>
<span id="cb28-288"><a href="#cb28-288" aria-hidden="true" tabindex="-1"></a>    <span class="st">"coding_assistant"</span>: <span class="st">"You are an expert programmer. Provide clean, well-commented code solutions and explain your reasoning."</span>,</span>
<span id="cb28-289"><a href="#cb28-289" aria-hidden="true" tabindex="-1"></a>    <span class="st">"creative_writer"</span>: <span class="st">"You are a creative storyteller. Write engaging narratives with vivid descriptions and compelling characters."</span>,</span>
<span id="cb28-290"><a href="#cb28-290" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data_analyst"</span>: <span class="st">"You are a data analyst. Provide insights based on data, suggest visualizations, and explain statistical concepts clearly."</span>,</span>
<span id="cb28-291"><a href="#cb28-291" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tutor"</span>: <span class="st">"You are a patient tutor. Break down complex topics into simple steps and provide encouraging feedback."</span></span>
<span id="cb28-292"><a href="#cb28-292" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-293"><a href="#cb28-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-294"><a href="#cb28-294" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> chat_with_persona(persona, user_message):</span>
<span id="cb28-295"><a href="#cb28-295" aria-hidden="true" tabindex="-1"></a>    completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb28-296"><a href="#cb28-296" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span><span class="st">"openai/gpt-oss-20b:free"</span>,</span>
<span id="cb28-297"><a href="#cb28-297" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>[</span>
<span id="cb28-298"><a href="#cb28-298" aria-hidden="true" tabindex="-1"></a>            {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: system_prompts[persona]},</span>
<span id="cb28-299"><a href="#cb28-299" aria-hidden="true" tabindex="-1"></a>            {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: user_message}</span>
<span id="cb28-300"><a href="#cb28-300" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb28-301"><a href="#cb28-301" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span><span class="fl">0.7</span></span>
<span id="cb28-302"><a href="#cb28-302" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-303"><a href="#cb28-303" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> completion.choices[<span class="dv">0</span>].message.content</span>
<span id="cb28-304"><a href="#cb28-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-305"><a href="#cb28-305" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb28-306"><a href="#cb28-306" aria-hidden="true" tabindex="-1"></a><span class="co">#response = chat_with_persona("coding_assistant", "How do I reverse a string in Python?")</span></span>
<span id="cb28-307"><a href="#cb28-307" aria-hidden="true" tabindex="-1"></a><span class="co">#print(response)</span></span>
<span id="cb28-308"><a href="#cb28-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-309"><a href="#cb28-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-310"><a href="#cb28-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-311"><a href="#cb28-311" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5. Streaming Responses: Real-Time AI Interaction</span></span>
<span id="cb28-312"><a href="#cb28-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-313"><a href="#cb28-313" aria-hidden="true" tabindex="-1"></a>Streaming is a game-changer for user experience, especially in chat applications and interactive tools. Instead of waiting for complete responses, streaming delivers content as it's being generated, creating natural and engaging conversations.</span>
<span id="cb28-314"><a href="#cb28-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-315"><a href="#cb28-315" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Streaming Matters</span></span>
<span id="cb28-316"><a href="#cb28-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-317"><a href="#cb28-317" aria-hidden="true" tabindex="-1"></a>**üöÄ User Experience Benefits:**</span>
<span id="cb28-318"><a href="#cb28-318" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Immediate Feedback**: Users see responses starting immediately</span>
<span id="cb28-319"><a href="#cb28-319" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Reduced Perceived Latency**: Content appears as it's generated</span>
<span id="cb28-320"><a href="#cb28-320" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Natural Conversation Flow**: Mimics human speech patterns</span>
<span id="cb28-321"><a href="#cb28-321" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Progress Indication**: Users know the AI is working</span>
<span id="cb28-322"><a href="#cb28-322" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Early Termination**: Users can stop lengthy responses if needed</span>
<span id="cb28-323"><a href="#cb28-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-324"><a href="#cb28-324" aria-hidden="true" tabindex="-1"></a>**‚ö° Technical Advantages:**</span>
<span id="cb28-325"><a href="#cb28-325" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Lower Memory Usage**: No need to buffer complete responses</span>
<span id="cb28-326"><a href="#cb28-326" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Faster Time-to-First-Byte**: Content starts flowing immediately</span>
<span id="cb28-327"><a href="#cb28-327" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Better Error Handling**: Issues detected earlier in process</span>
<span id="cb28-328"><a href="#cb28-328" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Resource Efficiency**: Processes data incrementally</span>
<span id="cb28-329"><a href="#cb28-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-330"><a href="#cb28-330" aria-hidden="true" tabindex="-1"></a><span class="fu">### Implementing Streaming with OpenRouter</span></span>
<span id="cb28-331"><a href="#cb28-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-334"><a href="#cb28-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-335"><a href="#cb28-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb28-336"><a href="#cb28-336" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client (if not already done)</span></span>
<span id="cb28-337"><a href="#cb28-337" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb28-338"><a href="#cb28-338" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb28-339"><a href="#cb28-339" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb28-340"><a href="#cb28-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-341"><a href="#cb28-341" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb28-342"><a href="#cb28-342" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb28-343"><a href="#cb28-343" aria-hidden="true" tabindex="-1"></a>  base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb28-344"><a href="#cb28-344" aria-hidden="true" tabindex="-1"></a>  api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb28-345"><a href="#cb28-345" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-346"><a href="#cb28-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-347"><a href="#cb28-347" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stream_response(model, message):</span>
<span id="cb28-348"><a href="#cb28-348" aria-hidden="true" tabindex="-1"></a>    stream <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb28-349"><a href="#cb28-349" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>model,</span>
<span id="cb28-350"><a href="#cb28-350" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: message}],</span>
<span id="cb28-351"><a href="#cb28-351" aria-hidden="true" tabindex="-1"></a>        stream<span class="op">=</span><span class="va">True</span></span>
<span id="cb28-352"><a href="#cb28-352" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-353"><a href="#cb28-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-354"><a href="#cb28-354" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> chunk <span class="kw">in</span> stream:</span>
<span id="cb28-355"><a href="#cb28-355" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> chunk.choices[<span class="dv">0</span>].delta.content <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb28-356"><a href="#cb28-356" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(chunk.choices[<span class="dv">0</span>].delta.content, end<span class="op">=</span><span class="st">''</span>, flush<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-357"><a href="#cb28-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-358"><a href="#cb28-358" aria-hidden="true" tabindex="-1"></a><span class="co"># Stream example</span></span>
<span id="cb28-359"><a href="#cb28-359" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Streaming response:"</span>)</span>
<span id="cb28-360"><a href="#cb28-360" aria-hidden="true" tabindex="-1"></a>stream_response(<span class="st">"openai/gpt-oss-20b:free"</span>, <span class="st">"Tell me a short story about AI"</span>)</span>
<span id="cb28-361"><a href="#cb28-361" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()  <span class="co"># Add newline after streaming</span></span>
<span id="cb28-362"><a href="#cb28-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-363"><a href="#cb28-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-364"><a href="#cb28-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-365"><a href="#cb28-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-366"><a href="#cb28-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-367"><a href="#cb28-367" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6. text to image</span></span>
<span id="cb28-368"><a href="#cb28-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-369"><a href="#cb28-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-372"><a href="#cb28-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-373"><a href="#cb28-373" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb28-374"><a href="#cb28-374" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb28-375"><a href="#cb28-375" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb28-376"><a href="#cb28-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-377"><a href="#cb28-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-378"><a href="#cb28-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-381"><a href="#cb28-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-382"><a href="#cb28-382" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb28-383"><a href="#cb28-383" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb28-384"><a href="#cb28-384" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb28-385"><a href="#cb28-385" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb28-386"><a href="#cb28-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-387"><a href="#cb28-387" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from .env file</span></span>
<span id="cb28-388"><a href="#cb28-388" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb28-389"><a href="#cb28-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-390"><a href="#cb28-390" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb28-391"><a href="#cb28-391" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb28-392"><a href="#cb28-392" aria-hidden="true" tabindex="-1"></a>    base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb28-393"><a href="#cb28-393" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb28-394"><a href="#cb28-394" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-395"><a href="#cb28-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-396"><a href="#cb28-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-397"><a href="#cb28-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-400"><a href="#cb28-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-401"><a href="#cb28-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb28-402"><a href="#cb28-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Image generation request</span></span>
<span id="cb28-403"><a href="#cb28-403" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb28-404"><a href="#cb28-404" aria-hidden="true" tabindex="-1"></a>    extra_headers<span class="op">=</span>{</span>
<span id="cb28-405"><a href="#cb28-405" aria-hidden="true" tabindex="-1"></a>        <span class="st">"HTTP-Referer"</span>: <span class="st">"www.tonydotdev.com"</span>,</span>
<span id="cb28-406"><a href="#cb28-406" aria-hidden="true" tabindex="-1"></a>        <span class="st">"X-Title"</span>: <span class="st">"TT_AI_blog"</span>,</span>
<span id="cb28-407"><a href="#cb28-407" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb28-408"><a href="#cb28-408" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"google/gemini-2.5-flash-image"</span>,</span>
<span id="cb28-409"><a href="#cb28-409" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb28-410"><a href="#cb28-410" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb28-411"><a href="#cb28-411" aria-hidden="true" tabindex="-1"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb28-412"><a href="#cb28-412" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: <span class="st">"Generate a serene and realistic snowy mountain landscape at sunrise."</span>,</span>
<span id="cb28-413"><a href="#cb28-413" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb28-414"><a href="#cb28-414" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb28-415"><a href="#cb28-415" aria-hidden="true" tabindex="-1"></a>    modalities<span class="op">=</span>[<span class="st">"image"</span>, <span class="st">"text"</span>],</span>
<span id="cb28-416"><a href="#cb28-416" aria-hidden="true" tabindex="-1"></a>    <span class="co">#image_size="1024x1024",</span></span>
<span id="cb28-417"><a href="#cb28-417" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-418"><a href="#cb28-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-419"><a href="#cb28-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-420"><a href="#cb28-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-421"><a href="#cb28-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-422"><a href="#cb28-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-425"><a href="#cb28-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-426"><a href="#cb28-426" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb28-427"><a href="#cb28-427" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb28-428"><a href="#cb28-428" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb28-429"><a href="#cb28-429" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract message</span></span>
<span id="cb28-430"><a href="#cb28-430" aria-hidden="true" tabindex="-1"></a>message <span class="op">=</span> response.choices[<span class="dv">0</span>].message</span>
<span id="cb28-431"><a href="#cb28-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-432"><a href="#cb28-432" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle image output (base64 string inside "data:image/png;base64,...")</span></span>
<span id="cb28-433"><a href="#cb28-433" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> message.images:</span>
<span id="cb28-434"><a href="#cb28-434" aria-hidden="true" tabindex="-1"></a>    data_url <span class="op">=</span> message.images[<span class="dv">0</span>][<span class="st">"image_url"</span>][<span class="st">"url"</span>]</span>
<span id="cb28-435"><a href="#cb28-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-436"><a href="#cb28-436" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Strip prefix if present</span></span>
<span id="cb28-437"><a href="#cb28-437" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data_url.startswith(<span class="st">"data:image"</span>):</span>
<span id="cb28-438"><a href="#cb28-438" aria-hidden="true" tabindex="-1"></a>        _, base64_data <span class="op">=</span> data_url.split(<span class="st">","</span>, <span class="dv">1</span>)</span>
<span id="cb28-439"><a href="#cb28-439" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb28-440"><a href="#cb28-440" aria-hidden="true" tabindex="-1"></a>        base64_data <span class="op">=</span> data_url</span>
<span id="cb28-441"><a href="#cb28-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-442"><a href="#cb28-442" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decode and save as PNG</span></span>
<span id="cb28-443"><a href="#cb28-443" aria-hidden="true" tabindex="-1"></a>    image_bytes <span class="op">=</span> base64.b64decode(base64_data)</span>
<span id="cb28-444"><a href="#cb28-444" aria-hidden="true" tabindex="-1"></a>    current_time <span class="op">=</span> datetime.datetime.now().strftime(<span class="st">"%H%M"</span>)</span>
<span id="cb28-445"><a href="#cb28-445" aria-hidden="true" tabindex="-1"></a>    output_file <span class="op">=</span> <span class="ss">f"text_image_gemini_25_openrouter_</span><span class="sc">{</span>current_time<span class="sc">}</span><span class="ss">.png"</span></span>
<span id="cb28-446"><a href="#cb28-446" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb28-447"><a href="#cb28-447" aria-hidden="true" tabindex="-1"></a>        f.write(image_bytes)</span>
<span id="cb28-448"><a href="#cb28-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-449"><a href="#cb28-449" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úÖ Image saved as </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-450"><a href="#cb28-450" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb28-451"><a href="#cb28-451" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"‚ùå No image returned in response"</span>)</span>
<span id="cb28-452"><a href="#cb28-452" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-453"><a href="#cb28-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-456"><a href="#cb28-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-457"><a href="#cb28-457" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb28-458"><a href="#cb28-458" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb28-459"><a href="#cb28-459" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure IPython is available</span></span>
<span id="cb28-460"><a href="#cb28-460" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb28-461"><a href="#cb28-461" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> IPython.display <span class="im">import</span> Image, display</span>
<span id="cb28-462"><a href="#cb28-462" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"IPython loaded successfully"</span>)</span>
<span id="cb28-463"><a href="#cb28-463" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span> <span class="im">as</span> e:</span>
<span id="cb28-464"><a href="#cb28-464" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"IPython import error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-465"><a href="#cb28-465" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> subprocess</span>
<span id="cb28-466"><a href="#cb28-466" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> sys</span>
<span id="cb28-467"><a href="#cb28-467" aria-hidden="true" tabindex="-1"></a>    subprocess.check_call([sys.executable, <span class="st">"-m"</span>, <span class="st">"pip"</span>, <span class="st">"install"</span>, <span class="st">"IPython"</span>])</span>
<span id="cb28-468"><a href="#cb28-468" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> IPython.display <span class="im">import</span> Image, display</span>
<span id="cb28-469"><a href="#cb28-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-470"><a href="#cb28-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-473"><a href="#cb28-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-474"><a href="#cb28-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb28-475"><a href="#cb28-475" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image, display</span>
<span id="cb28-476"><a href="#cb28-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-477"><a href="#cb28-477" aria-hidden="true" tabindex="-1"></a>display(Image(filename<span class="op">=</span><span class="st">"text_image_gemini_25_openrouter_1352.png"</span>))</span>
<span id="cb28-478"><a href="#cb28-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-479"><a href="#cb28-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-480"><a href="#cb28-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-481"><a href="#cb28-481" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6 image to text</span></span>
<span id="cb28-482"><a href="#cb28-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-485"><a href="#cb28-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-486"><a href="#cb28-486" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb28-487"><a href="#cb28-487" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb28-488"><a href="#cb28-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-489"><a href="#cb28-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert local image to data URL</span></span>
<span id="cb28-490"><a href="#cb28-490" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"text_image_gemini_25_openrouter_1352.png"</span>, <span class="st">"rb"</span>) <span class="im">as</span> image_file:</span>
<span id="cb28-491"><a href="#cb28-491" aria-hidden="true" tabindex="-1"></a>    base64_image <span class="op">=</span> base64.b64encode(image_file.read()).decode(<span class="st">'utf-8'</span>)</span>
<span id="cb28-492"><a href="#cb28-492" aria-hidden="true" tabindex="-1"></a>    data_url <span class="op">=</span> <span class="ss">f"data:image/png;base64,</span><span class="sc">{</span>base64_image<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb28-493"><a href="#cb28-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-494"><a href="#cb28-494" aria-hidden="true" tabindex="-1"></a>completion <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb28-495"><a href="#cb28-495" aria-hidden="true" tabindex="-1"></a>  extra_headers<span class="op">=</span>{</span>
<span id="cb28-496"><a href="#cb28-496" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HTTP-Referer"</span>: <span class="st">"&lt;YOUR_SITE_URL&gt;"</span>, <span class="co"># Optional. Site URL for rankings on openrouter.ai.</span></span>
<span id="cb28-497"><a href="#cb28-497" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Title"</span>: <span class="st">"&lt;YOUR_SITE_NAME&gt;"</span>, <span class="co"># Optional. Site title for rankings on openrouter.ai.</span></span>
<span id="cb28-498"><a href="#cb28-498" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb28-499"><a href="#cb28-499" aria-hidden="true" tabindex="-1"></a>  extra_body<span class="op">=</span>{},</span>
<span id="cb28-500"><a href="#cb28-500" aria-hidden="true" tabindex="-1"></a>  model<span class="op">=</span><span class="st">"nvidia/nemotron-nano-12b-v2-vl:free"</span>,</span>
<span id="cb28-501"><a href="#cb28-501" aria-hidden="true" tabindex="-1"></a>  messages<span class="op">=</span>[</span>
<span id="cb28-502"><a href="#cb28-502" aria-hidden="true" tabindex="-1"></a>              {</span>
<span id="cb28-503"><a href="#cb28-503" aria-hidden="true" tabindex="-1"></a>                <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb28-504"><a href="#cb28-504" aria-hidden="true" tabindex="-1"></a>                <span class="st">"content"</span>: [</span>
<span id="cb28-505"><a href="#cb28-505" aria-hidden="true" tabindex="-1"></a>                  {</span>
<span id="cb28-506"><a href="#cb28-506" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"text"</span>,</span>
<span id="cb28-507"><a href="#cb28-507" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"text"</span>: <span class="st">"What is in this image?"</span></span>
<span id="cb28-508"><a href="#cb28-508" aria-hidden="true" tabindex="-1"></a>                  },</span>
<span id="cb28-509"><a href="#cb28-509" aria-hidden="true" tabindex="-1"></a>                  {</span>
<span id="cb28-510"><a href="#cb28-510" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"image_url"</span>,</span>
<span id="cb28-511"><a href="#cb28-511" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"image_url"</span>: {</span>
<span id="cb28-512"><a href="#cb28-512" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"url"</span>: data_url</span>
<span id="cb28-513"><a href="#cb28-513" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb28-514"><a href="#cb28-514" aria-hidden="true" tabindex="-1"></a>                  }</span>
<span id="cb28-515"><a href="#cb28-515" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb28-516"><a href="#cb28-516" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb28-517"><a href="#cb28-517" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb28-518"><a href="#cb28-518" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-519"><a href="#cb28-519" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(completion.choices[<span class="dv">0</span>].message.content)</span>
<span id="cb28-520"><a href="#cb28-520" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-521"><a href="#cb28-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-522"><a href="#cb28-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-523"><a href="#cb28-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-524"><a href="#cb28-524" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7. text,image to image</span></span>
<span id="cb28-525"><a href="#cb28-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-528"><a href="#cb28-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-529"><a href="#cb28-529" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb28-530"><a href="#cb28-530" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb28-531"><a href="#cb28-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-532"><a href="#cb28-532" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the previously generated image to base64</span></span>
<span id="cb28-533"><a href="#cb28-533" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"text_image_gemini_25_openrouter_1352.png"</span>, <span class="st">"rb"</span>) <span class="im">as</span> image_file:</span>
<span id="cb28-534"><a href="#cb28-534" aria-hidden="true" tabindex="-1"></a>    base64_image <span class="op">=</span> base64.b64encode(image_file.read()).decode(<span class="st">"utf-8"</span>)</span>
<span id="cb28-535"><a href="#cb28-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-536"><a href="#cb28-536" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> client.chat.completions.create(</span>
<span id="cb28-537"><a href="#cb28-537" aria-hidden="true" tabindex="-1"></a>    extra_headers<span class="op">=</span>{</span>
<span id="cb28-538"><a href="#cb28-538" aria-hidden="true" tabindex="-1"></a>        <span class="st">"HTTP-Referer"</span>: <span class="st">"www.tonydotdev.com"</span>,</span>
<span id="cb28-539"><a href="#cb28-539" aria-hidden="true" tabindex="-1"></a>        <span class="st">"X-Title"</span>: <span class="st">"TT_AI_blog"</span>,</span>
<span id="cb28-540"><a href="#cb28-540" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb28-541"><a href="#cb28-541" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"google/gemini-2.5-flash-image"</span>,</span>
<span id="cb28-542"><a href="#cb28-542" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>[</span>
<span id="cb28-543"><a href="#cb28-543" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb28-544"><a href="#cb28-544" aria-hidden="true" tabindex="-1"></a>            <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb28-545"><a href="#cb28-545" aria-hidden="true" tabindex="-1"></a>            <span class="st">"content"</span>: [</span>
<span id="cb28-546"><a href="#cb28-546" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb28-547"><a href="#cb28-547" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"text"</span>,</span>
<span id="cb28-548"><a href="#cb28-548" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"text"</span>: <span class="st">"Transform this image into a sunset version with warmer colors and golden light.add one person skiing in the foreground."</span>,</span>
<span id="cb28-549"><a href="#cb28-549" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb28-550"><a href="#cb28-550" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb28-551"><a href="#cb28-551" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"type"</span>: <span class="st">"image_url"</span>,</span>
<span id="cb28-552"><a href="#cb28-552" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"image_url"</span>: {<span class="st">"url"</span>: <span class="ss">f"data:image/png;base64,</span><span class="sc">{</span>base64_image<span class="sc">}</span><span class="ss">"</span>},</span>
<span id="cb28-553"><a href="#cb28-553" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb28-554"><a href="#cb28-554" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb28-555"><a href="#cb28-555" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb28-556"><a href="#cb28-556" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb28-557"><a href="#cb28-557" aria-hidden="true" tabindex="-1"></a>    modalities<span class="op">=</span>[<span class="st">"image"</span>, <span class="st">"text"</span>],</span>
<span id="cb28-558"><a href="#cb28-558" aria-hidden="true" tabindex="-1"></a>    <span class="co"># image_size="1024x1024",</span></span>
<span id="cb28-559"><a href="#cb28-559" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-560"><a href="#cb28-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-561"><a href="#cb28-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-562"><a href="#cb28-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-565"><a href="#cb28-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-566"><a href="#cb28-566" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb28-567"><a href="#cb28-567" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb28-568"><a href="#cb28-568" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract message</span></span>
<span id="cb28-569"><a href="#cb28-569" aria-hidden="true" tabindex="-1"></a>message <span class="op">=</span> response.choices[<span class="dv">0</span>].message</span>
<span id="cb28-570"><a href="#cb28-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-571"><a href="#cb28-571" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle image output (base64 string inside "data:image/png;base64,...")</span></span>
<span id="cb28-572"><a href="#cb28-572" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> message.images:</span>
<span id="cb28-573"><a href="#cb28-573" aria-hidden="true" tabindex="-1"></a>    data_url <span class="op">=</span> message.images[<span class="dv">0</span>][<span class="st">"image_url"</span>][<span class="st">"url"</span>]</span>
<span id="cb28-574"><a href="#cb28-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-575"><a href="#cb28-575" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Strip prefix if present</span></span>
<span id="cb28-576"><a href="#cb28-576" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data_url.startswith(<span class="st">"data:image"</span>):</span>
<span id="cb28-577"><a href="#cb28-577" aria-hidden="true" tabindex="-1"></a>        _, base64_data <span class="op">=</span> data_url.split(<span class="st">","</span>, <span class="dv">1</span>)</span>
<span id="cb28-578"><a href="#cb28-578" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb28-579"><a href="#cb28-579" aria-hidden="true" tabindex="-1"></a>        base64_data <span class="op">=</span> data_url</span>
<span id="cb28-580"><a href="#cb28-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-581"><a href="#cb28-581" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decode and save as PNG</span></span>
<span id="cb28-582"><a href="#cb28-582" aria-hidden="true" tabindex="-1"></a>    image_bytes <span class="op">=</span> base64.b64decode(base64_data)</span>
<span id="cb28-583"><a href="#cb28-583" aria-hidden="true" tabindex="-1"></a>    current_time <span class="op">=</span> datetime.datetime.now().strftime(<span class="st">"%H%M"</span>)</span>
<span id="cb28-584"><a href="#cb28-584" aria-hidden="true" tabindex="-1"></a>    output_file <span class="op">=</span> <span class="ss">f"text_image_gemini_25_openrouter_</span><span class="sc">{</span>current_time<span class="sc">}</span><span class="ss">.png"</span></span>
<span id="cb28-585"><a href="#cb28-585" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb28-586"><a href="#cb28-586" aria-hidden="true" tabindex="-1"></a>        f.write(image_bytes)</span>
<span id="cb28-587"><a href="#cb28-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-588"><a href="#cb28-588" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"‚úÖ Image saved as </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-589"><a href="#cb28-589" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb28-590"><a href="#cb28-590" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"‚ùå No image returned in response"</span>)</span>
<span id="cb28-591"><a href="#cb28-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-592"><a href="#cb28-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-593"><a href="#cb28-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-596"><a href="#cb28-596" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-597"><a href="#cb28-597" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image, display</span>
<span id="cb28-598"><a href="#cb28-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-599"><a href="#cb28-599" aria-hidden="true" tabindex="-1"></a>display(Image(filename<span class="op">=</span><span class="st">"text_image_gemini_25_openrouter_1405.png"</span>))</span>
<span id="cb28-600"><a href="#cb28-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-601"><a href="#cb28-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-602"><a href="#cb28-602" aria-hidden="true" tabindex="-1"></a><span class="fu">### 8 Embedding</span></span>
<span id="cb28-603"><a href="#cb28-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-606"><a href="#cb28-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-607"><a href="#cb28-607" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb28-608"><a href="#cb28-608" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb28-609"><a href="#cb28-609" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb28-610"><a href="#cb28-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-611"><a href="#cb28-611" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from .env file</span></span>
<span id="cb28-612"><a href="#cb28-612" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb28-613"><a href="#cb28-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-614"><a href="#cb28-614" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client with OpenRouter</span></span>
<span id="cb28-615"><a href="#cb28-615" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb28-616"><a href="#cb28-616" aria-hidden="true" tabindex="-1"></a>    base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb28-617"><a href="#cb28-617" aria-hidden="true" tabindex="-1"></a>    api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb28-618"><a href="#cb28-618" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-619"><a href="#cb28-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-620"><a href="#cb28-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-621"><a href="#cb28-621" aria-hidden="true" tabindex="-1"></a>embedding <span class="op">=</span> client.embeddings.create(</span>
<span id="cb28-622"><a href="#cb28-622" aria-hidden="true" tabindex="-1"></a>  extra_headers<span class="op">=</span>{</span>
<span id="cb28-623"><a href="#cb28-623" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HTTP-Referer"</span>: <span class="st">"&lt;YOUR_SITE_URL&gt;"</span>, <span class="co"># Optional. Site URL for rankings on openrouter.ai.</span></span>
<span id="cb28-624"><a href="#cb28-624" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X-Title"</span>: <span class="st">"&lt;YOUR_SITE_NAME&gt;"</span>, <span class="co"># Optional. Site title for rankings on openrouter.ai.</span></span>
<span id="cb28-625"><a href="#cb28-625" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb28-626"><a href="#cb28-626" aria-hidden="true" tabindex="-1"></a>  model<span class="op">=</span><span class="st">"thenlper/gte-base"</span>,</span>
<span id="cb28-627"><a href="#cb28-627" aria-hidden="true" tabindex="-1"></a>  <span class="bu">input</span><span class="op">=</span><span class="st">"I can"</span>,</span>
<span id="cb28-628"><a href="#cb28-628" aria-hidden="true" tabindex="-1"></a>  encoding_format<span class="op">=</span><span class="st">"float"</span></span>
<span id="cb28-629"><a href="#cb28-629" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-630"><a href="#cb28-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-631"><a href="#cb28-631" aria-hidden="true" tabindex="-1"></a><span class="co">#print(embedding.data[0].embedding) </span></span>
<span id="cb28-632"><a href="#cb28-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-633"><a href="#cb28-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-634"><a href="#cb28-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-637"><a href="#cb28-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-638"><a href="#cb28-638" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(embedding.data[<span class="dv">0</span>].embedding)</span>
<span id="cb28-639"><a href="#cb28-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-640"><a href="#cb28-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-641"><a href="#cb28-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-644"><a href="#cb28-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-645"><a href="#cb28-645" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(embedding.data[<span class="dv">0</span>].embedding[:<span class="dv">5</span>])  <span class="co"># Print first 5 dimensions</span></span>
<span id="cb28-646"><a href="#cb28-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-647"><a href="#cb28-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-648"><a href="#cb28-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-649"><a href="#cb28-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-650"><a href="#cb28-650" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cost Management: Optimizing Your AI Spending</span></span>
<span id="cb28-651"><a href="#cb28-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-652"><a href="#cb28-652" aria-hidden="true" tabindex="-1"></a>One of OpenRouter's most powerful features is its transparent pricing model and cost management capabilities. Understanding and managing costs is crucial for production AI applications.</span>
<span id="cb28-653"><a href="#cb28-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-654"><a href="#cb28-654" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why Cost Management Matters</span></span>
<span id="cb28-655"><a href="#cb28-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-656"><a href="#cb28-656" aria-hidden="true" tabindex="-1"></a>**üí∞ Financial Planning:**</span>
<span id="cb28-657"><a href="#cb28-657" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Predictable monthly expenses</span>
<span id="cb28-658"><a href="#cb28-658" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Budget allocation across different use cases</span>
<span id="cb28-659"><a href="#cb28-659" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ROI analysis for AI features</span>
<span id="cb28-660"><a href="#cb28-660" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Cost per user tracking</span>
<span id="cb28-661"><a href="#cb28-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-662"><a href="#cb28-662" aria-hidden="true" tabindex="-1"></a>**üîç Technical Optimization:**</span>
<span id="cb28-663"><a href="#cb28-663" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Model selection based on cost/performance ratio</span>
<span id="cb28-664"><a href="#cb28-664" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Prompt engineering to reduce token usage</span>
<span id="cb28-665"><a href="#cb28-665" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Caching strategies for repeated requests</span>
<span id="cb28-666"><a href="#cb28-666" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Batch processing for efficiency</span>
<span id="cb28-667"><a href="#cb28-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-668"><a href="#cb28-668" aria-hidden="true" tabindex="-1"></a><span class="fu">## Real-Time Cost Tracking</span></span>
<span id="cb28-669"><a href="#cb28-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-670"><a href="#cb28-670" aria-hidden="true" tabindex="-1"></a>OpenRouter provides programmatic access to current pricing for all models:</span>
<span id="cb28-671"><a href="#cb28-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-674"><a href="#cb28-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-675"><a href="#cb28-675" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb28-676"><a href="#cb28-676" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb28-677"><a href="#cb28-677" aria-hidden="true" tabindex="-1"></a><span class="co"># Install required packages</span></span>
<span id="cb28-678"><a href="#cb28-678" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb28-679"><a href="#cb28-679" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb28-680"><a href="#cb28-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-681"><a href="#cb28-681" aria-hidden="true" tabindex="-1"></a>required_packages <span class="op">=</span> [<span class="st">'openai'</span>, <span class="st">'python-dotenv'</span>, <span class="st">'pandas'</span>, <span class="st">'IPython'</span>,<span class="st">'panel'</span>]</span>
<span id="cb28-682"><a href="#cb28-682" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> package <span class="kw">in</span> required_packages:</span>
<span id="cb28-683"><a href="#cb28-683" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb28-684"><a href="#cb28-684" aria-hidden="true" tabindex="-1"></a>        <span class="bu">__import__</span>(package.replace(<span class="st">'-'</span>, <span class="st">'_'</span>))</span>
<span id="cb28-685"><a href="#cb28-685" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>package<span class="sc">}</span><span class="ss"> already installed"</span>)</span>
<span id="cb28-686"><a href="#cb28-686" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb28-687"><a href="#cb28-687" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Installing </span><span class="sc">{</span>package<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb28-688"><a href="#cb28-688" aria-hidden="true" tabindex="-1"></a>        subprocess.check_call([sys.executable, <span class="st">"-m"</span>, <span class="st">"pip"</span>, <span class="st">"install"</span>, package])</span>
<span id="cb28-689"><a href="#cb28-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-690"><a href="#cb28-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-693"><a href="#cb28-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-694"><a href="#cb28-694" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb28-695"><a href="#cb28-695" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the OpenAI client (if not already done)</span></span>
<span id="cb28-696"><a href="#cb28-696" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb28-697"><a href="#cb28-697" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb28-698"><a href="#cb28-698" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb28-699"><a href="#cb28-699" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-700"><a href="#cb28-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-701"><a href="#cb28-701" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb28-702"><a href="#cb28-702" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> OpenAI(</span>
<span id="cb28-703"><a href="#cb28-703" aria-hidden="true" tabindex="-1"></a>  base_url<span class="op">=</span><span class="st">"https://openrouter.ai/api/v1"</span>,</span>
<span id="cb28-704"><a href="#cb28-704" aria-hidden="true" tabindex="-1"></a>  api_key<span class="op">=</span>os.getenv(<span class="st">"OPENROUTER_API_KEY"</span>),</span>
<span id="cb28-705"><a href="#cb28-705" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-706"><a href="#cb28-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-707"><a href="#cb28-707" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_model_pricing():</span>
<span id="cb28-708"><a href="#cb28-708" aria-hidden="true" tabindex="-1"></a>    models_list <span class="op">=</span> client.models.<span class="bu">list</span>()</span>
<span id="cb28-709"><a href="#cb28-709" aria-hidden="true" tabindex="-1"></a>    pricing_data <span class="op">=</span> []</span>
<span id="cb28-710"><a href="#cb28-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-711"><a href="#cb28-711" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model <span class="kw">in</span> models_list.data:</span>
<span id="cb28-712"><a href="#cb28-712" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> model.<span class="bu">id</span></span>
<span id="cb28-713"><a href="#cb28-713" aria-hidden="true" tabindex="-1"></a>        pricing <span class="op">=</span> model.pricing</span>
<span id="cb28-714"><a href="#cb28-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-715"><a href="#cb28-715" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get model metadata</span></span>
<span id="cb28-716"><a href="#cb28-716" aria-hidden="true" tabindex="-1"></a>        context_length <span class="op">=</span> <span class="bu">getattr</span>(model, <span class="st">'context_length'</span>, <span class="va">None</span>)</span>
<span id="cb28-717"><a href="#cb28-717" aria-hidden="true" tabindex="-1"></a>        description <span class="op">=</span> <span class="bu">getattr</span>(model, <span class="st">'description'</span>, <span class="st">''</span>)</span>
<span id="cb28-718"><a href="#cb28-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-719"><a href="#cb28-719" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get creation date and convert to readable format</span></span>
<span id="cb28-720"><a href="#cb28-720" aria-hidden="true" tabindex="-1"></a>        created_timestamp <span class="op">=</span> <span class="bu">getattr</span>(model, <span class="st">'created'</span>, <span class="va">None</span>)</span>
<span id="cb28-721"><a href="#cb28-721" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> created_timestamp:</span>
<span id="cb28-722"><a href="#cb28-722" aria-hidden="true" tabindex="-1"></a>            <span class="im">import</span> datetime</span>
<span id="cb28-723"><a href="#cb28-723" aria-hidden="true" tabindex="-1"></a>            created_date <span class="op">=</span> datetime.datetime.fromtimestamp(created_timestamp).strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb28-724"><a href="#cb28-724" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb28-725"><a href="#cb28-725" aria-hidden="true" tabindex="-1"></a>            created_date <span class="op">=</span> <span class="va">None</span></span>
<span id="cb28-726"><a href="#cb28-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-727"><a href="#cb28-727" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract company from model name (first part before '/')</span></span>
<span id="cb28-728"><a href="#cb28-728" aria-hidden="true" tabindex="-1"></a>        company <span class="op">=</span> name.split(<span class="st">'/'</span>)[<span class="dv">0</span>] <span class="cf">if</span> <span class="st">'/'</span> <span class="kw">in</span> name <span class="cf">else</span> <span class="st">'Unknown'</span></span>
<span id="cb28-729"><a href="#cb28-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-730"><a href="#cb28-730" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert per-token prices to cost per 1M tokens</span></span>
<span id="cb28-731"><a href="#cb28-731" aria-hidden="true" tabindex="-1"></a>        prompt_cost <span class="op">=</span> <span class="bu">float</span>(pricing.get(<span class="st">'prompt'</span>, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">1000000</span> <span class="cf">if</span> pricing <span class="kw">and</span> pricing.get(<span class="st">'prompt'</span>) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb28-732"><a href="#cb28-732" aria-hidden="true" tabindex="-1"></a>        completion_cost <span class="op">=</span> <span class="bu">float</span>(pricing.get(<span class="st">'completion'</span>, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">1000000</span> <span class="cf">if</span> pricing <span class="kw">and</span> pricing.get(<span class="st">'completion'</span>) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb28-733"><a href="#cb28-733" aria-hidden="true" tabindex="-1"></a>        request_cost <span class="op">=</span> <span class="bu">float</span>(pricing.get(<span class="st">'request'</span>, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">1000000</span> <span class="cf">if</span> pricing <span class="kw">and</span> pricing.get(<span class="st">'request'</span>) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb28-734"><a href="#cb28-734" aria-hidden="true" tabindex="-1"></a>        image_cost <span class="op">=</span> <span class="bu">float</span>(pricing.get(<span class="st">'image'</span>, <span class="dv">0</span>)) <span class="op">*</span> <span class="dv">1000000</span> <span class="cf">if</span> pricing <span class="kw">and</span> pricing.get(<span class="st">'image'</span>) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb28-735"><a href="#cb28-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-736"><a href="#cb28-736" aria-hidden="true" tabindex="-1"></a>        pricing_data.append({</span>
<span id="cb28-737"><a href="#cb28-737" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Model'</span>: name,</span>
<span id="cb28-738"><a href="#cb28-738" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Company'</span>: company,</span>
<span id="cb28-739"><a href="#cb28-739" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Description'</span>: description,</span>
<span id="cb28-740"><a href="#cb28-740" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Context_Length'</span>: context_length,</span>
<span id="cb28-741"><a href="#cb28-741" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Created_Date'</span>: created_date,</span>
<span id="cb28-742"><a href="#cb28-742" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Prompt_Cost_per_1M'</span>: prompt_cost,</span>
<span id="cb28-743"><a href="#cb28-743" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Completion_Cost_per_1M'</span>: completion_cost,</span>
<span id="cb28-744"><a href="#cb28-744" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Request_Cost_per_1M'</span>: request_cost,</span>
<span id="cb28-745"><a href="#cb28-745" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Image_Cost_per_1M'</span>: image_cost</span>
<span id="cb28-746"><a href="#cb28-746" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb28-747"><a href="#cb28-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-748"><a href="#cb28-748" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create pandas DataFrame</span></span>
<span id="cb28-749"><a href="#cb28-749" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(pricing_data)</span>
<span id="cb28-750"><a href="#cb28-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-751"><a href="#cb28-751" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by company then by model name for better organization</span></span>
<span id="cb28-752"><a href="#cb28-752" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values([<span class="st">'Company'</span>, <span class="st">'Model'</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-753"><a href="#cb28-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-754"><a href="#cb28-754" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb28-755"><a href="#cb28-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-756"><a href="#cb28-756" aria-hidden="true" tabindex="-1"></a><span class="co"># Get pricing DataFrames (all models and paid models only)</span></span>
<span id="cb28-757"><a href="#cb28-757" aria-hidden="true" tabindex="-1"></a>all_models_df <span class="op">=</span> get_model_pricing()</span>
<span id="cb28-758"><a href="#cb28-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-759"><a href="#cb28-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-760"><a href="#cb28-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-761"><a href="#cb28-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-762"><a href="#cb28-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-763"><a href="#cb28-763" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Most Expensive Models</span></span>
<span id="cb28-764"><a href="#cb28-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-765"><a href="#cb28-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-768"><a href="#cb28-768" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb28-769"><a href="#cb28-769" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb28-770"><a href="#cb28-770" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> panel <span class="im">as</span> pn</span>
<span id="cb28-771"><a href="#cb28-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-772"><a href="#cb28-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-773"><a href="#cb28-773" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> all_models_df[</span>
<span id="cb28-774"><a href="#cb28-774" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb28-775"><a href="#cb28-775" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Model"</span>,</span>
<span id="cb28-776"><a href="#cb28-776" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Context_Length"</span>,</span>
<span id="cb28-777"><a href="#cb28-777" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Created_Date"</span>,</span>
<span id="cb28-778"><a href="#cb28-778" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Prompt_Cost_per_1M"</span>,</span>
<span id="cb28-779"><a href="#cb28-779" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Completion_Cost_per_1M"</span>,</span>
<span id="cb28-780"><a href="#cb28-780" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb28-781"><a href="#cb28-781" aria-hidden="true" tabindex="-1"></a>].sort_values(<span class="st">"Prompt_Cost_per_1M"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-782"><a href="#cb28-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-783"><a href="#cb28-783" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a paginated table</span></span>
<span id="cb28-784"><a href="#cb28-784" aria-hidden="true" tabindex="-1"></a>pn.extension(<span class="st">"tabulator"</span>)</span>
<span id="cb28-785"><a href="#cb28-785" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pn.widgets.Tabulator(df, pagination<span class="op">=</span><span class="st">"local"</span>, page_size<span class="op">=</span><span class="dv">10</span>, show_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-786"><a href="#cb28-786" aria-hidden="true" tabindex="-1"></a>table</span>
<span id="cb28-787"><a href="#cb28-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-788"><a href="#cb28-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-789"><a href="#cb28-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-790"><a href="#cb28-790" aria-hidden="true" tabindex="-1"></a><span class="fu">## Best Practices: Production-Ready AI Development</span></span>
<span id="cb28-791"><a href="#cb28-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-792"><a href="#cb28-792" aria-hidden="true" tabindex="-1"></a>Following these best practices will help you build robust, secure, and efficient AI applications with OpenRouter.</span>
<span id="cb28-793"><a href="#cb28-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-794"><a href="#cb28-794" aria-hidden="true" tabindex="-1"></a><span class="fu">## üîí Security Best Practices</span></span>
<span id="cb28-795"><a href="#cb28-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-796"><a href="#cb28-796" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. API Key Management</span></span>
<span id="cb28-797"><a href="#cb28-797" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Never hardcode API keys** in source code or configuration files</span>
<span id="cb28-798"><a href="#cb28-798" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use environment variables** or secret management systems (AWS Secrets Manager, Azure Key Vault)</span>
<span id="cb28-799"><a href="#cb28-799" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Rotate API keys regularly** and implement key rotation policies</span>
<span id="cb28-800"><a href="#cb28-800" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use different keys** for development, staging, and production environments</span>
<span id="cb28-801"><a href="#cb28-801" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Add .env to .gitignore** - Never commit credentials to version control</span>
<span id="cb28-802"><a href="#cb28-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-803"><a href="#cb28-803" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Input Validation and Sanitization</span></span>
<span id="cb28-804"><a href="#cb28-804" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Validate user inputs** before sending to AI models</span>
<span id="cb28-805"><a href="#cb28-805" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sanitize prompts** to prevent prompt injection attacks</span>
<span id="cb28-806"><a href="#cb28-806" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Implement rate limiting** to prevent abuse</span>
<span id="cb28-807"><a href="#cb28-807" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Log and monitor** for suspicious activity patterns</span>
<span id="cb28-808"><a href="#cb28-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-809"><a href="#cb28-809" aria-hidden="true" tabindex="-1"></a><span class="fu">## ‚ö° Performance Best Practices</span></span>
<span id="cb28-810"><a href="#cb28-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-811"><a href="#cb28-811" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. Model Selection Strategy</span></span>
<span id="cb28-812"><a href="#cb28-812" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Choose the right model for your use case** - Not all tasks need the most expensive model</span>
<span id="cb28-813"><a href="#cb28-813" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Benchmark models** for your specific use cases</span>
<span id="cb28-814"><a href="#cb28-814" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use free models** for development and testing</span>
<span id="cb28-815"><a href="#cb28-815" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Consider specialized models** for specific tasks (coding, math, creative writing)</span>
<span id="cb28-816"><a href="#cb28-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-817"><a href="#cb28-817" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4. Optimization Techniques</span></span>
<span id="cb28-818"><a href="#cb28-818" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Implement caching** for repeated requests to reduce costs</span>
<span id="cb28-819"><a href="#cb28-819" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use streaming** for better user experience</span>
<span id="cb28-820"><a href="#cb28-820" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Batch requests** when appropriate for efficiency</span>
<span id="cb28-821"><a href="#cb28-821" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Optimize prompts** - Well-crafted prompts reduce token usage and improve results</span>
<span id="cb28-822"><a href="#cb28-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-823"><a href="#cb28-823" aria-hidden="true" tabindex="-1"></a><span class="fu">## üõ°Ô∏è Reliability Best Practices</span></span>
<span id="cb28-824"><a href="#cb28-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-825"><a href="#cb28-825" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5. Error Handling and Resilience</span></span>
<span id="cb28-826"><a href="#cb28-826" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Implement comprehensive error handling** - Models can be unavailable or rate-limited</span>
<span id="cb28-827"><a href="#cb28-827" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use fallback models** - Ensure your application remains functional even if one model is down</span>
<span id="cb28-828"><a href="#cb28-828" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Implement retry logic** with exponential backoff</span>
<span id="cb28-829"><a href="#cb28-829" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Monitor response times** and set appropriate timeouts</span>
<span id="cb28-830"><a href="#cb28-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-831"><a href="#cb28-831" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6. Monitoring and Analytics</span></span>
<span id="cb28-832"><a href="#cb28-832" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Monitor usage** - Keep track of costs and set limits</span>
<span id="cb28-833"><a href="#cb28-833" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Track performance metrics** (latency, success rates, error rates)</span>
<span id="cb28-834"><a href="#cb28-834" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Set up alerts** for unusual activity patterns</span>
<span id="cb28-835"><a href="#cb28-835" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Create dashboards** for real-time monitoring</span>
<span id="cb28-836"><a href="#cb28-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-837"><a href="#cb28-837" aria-hidden="true" tabindex="-1"></a><span class="fu">## üìä Cost Management Best Practices</span></span>
<span id="cb28-838"><a href="#cb28-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-839"><a href="#cb28-839" aria-hidden="true" tabindex="-1"></a><span class="fu">### 7. Budget Control</span></span>
<span id="cb28-840"><a href="#cb28-840" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Set spending limits** and alerts in your OpenRouter dashboard</span>
<span id="cb28-841"><a href="#cb28-841" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Use cost-effective models** for non-critical tasks</span>
<span id="cb28-842"><a href="#cb28-842" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Implement token counting** to estimate costs before requests</span>
<span id="cb28-843"><a href="#cb28-843" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Review usage reports** regularly to identify optimization opportunities</span>
<span id="cb28-844"><a href="#cb28-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-845"><a href="#cb28-845" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion: Building the Future of AI Applications</span></span>
<span id="cb28-846"><a href="#cb28-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-847"><a href="#cb28-847" aria-hidden="true" tabindex="-1"></a>OpenRouter represents a paradigm shift in how developers interact with AI models. By providing a unified, reliable, and cost-effective gateway to the world's most advanced AI models, OpenRouter enables developers to focus on creating value rather than managing infrastructure complexities.</span>
<span id="cb28-848"><a href="#cb28-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-849"><a href="#cb28-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-850"><a href="#cb28-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-851"><a href="#cb28-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-852"><a href="#cb28-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-853"><a href="#cb28-853" aria-hidden="true" tabindex="-1"></a></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This blog is built with ‚ù§Ô∏è and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>